%% Macula Gateway Mode Configuration
%% Purpose: Relay for NAT-ed peers, fallback for unreachable nodes
%%
%% Gateway nodes provide:
%% - QUIC listener for incoming connections
%% - Message relay for NAT-ed peers
%% - Fallback routing when direct P2P fails
%%
%% Gateway nodes do NOT:
%% - Bootstrap the DHT (connect to bootstrap nodes instead)
%% - Relay ALL traffic (most traffic is direct P2P)

[
    {macula, [
        %% Deployment mode
        {mode, gateway},

        %% Gateway enabled
        {start_gateway, true},

        %% Gateway configuration
        {gateway_port, 9443},
        {health_port, 8080},
        {gateway_realm, <<"macula.relay">>},

        %% Bootstrap nodes for DHT discovery
        {bootstrap_nodes, [
            <<"bootstrap.macula.io:9443">>,
            <<"bootstrap-backup.macula.io:9443">>
        ]},

        %% DHT configuration
        {dht_k, 20},
        {dht_alpha, 3},

        %% Gateway-specific limits
        {max_clients, 10000},          % Max simultaneous client connections
        {max_mesh_connections, 1000},  % Max mesh connection pool size
        {connection_timeout, 300000},  % 5 minutes idle timeout

        %% RPC configuration
        {rpc_timeout, 5000},
        {rpc_max_hops, 10},

        %% Pub/Sub configuration
        {pubsub_max_hops, 10},
        {pubsub_qos, 0}
    ]},

    {kernel, [
        {logger_level, info},
        {logger, [
            {handler, default, logger_std_h, #{
                formatter => {logger_formatter, #{
                    single_line => true,
                    template => [time, " [", level, "] ", msg, "\n"]
                }}
            }}
        ]}
    ]},

    {sasl, [
        {sasl_error_logger, false}
    ]}
].
