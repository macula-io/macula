# Macula v0.8.0 Release Cleanup Plan

**Date**: 2025-11-17
**Goal**: Prepare codebase and documentation for v0.8.0 release

---

## Phase 1: Code Cleanup

### 1.1 Remove Backup Files
- [ ] Delete `src/macula_connection.erl.backup`

### 1.2 Address TODOs
Review and either fix or document TODOs:
- [ ] `macula_connection.erl` - TLS verification (document as v0.9.0)
- [ ] `macula_connection_pool.erl` - TLS verification (document as v0.9.0)
- [ ] `macula_dht_rpc.erl` - Implement or mark deprecated
- [ ] `macula_gateway_dht.erl` - Request/response pattern (v0.9.0)
- [ ] `macula_peer_connector.erl` - Certificate verification (v0.9.0)
- [ ] `macula_pubsub_qos.erl` - Add helpers or remove TODO
- [ ] `macula_pubsub_subscription.erl` - Add helpers or remove TODO
- [ ] `macula_routing_server.erl` - Document limitation
- [ ] `macula_routing_table.erl` - Document bucket limitation
- [ ] `macula_rpc_handler.erl` - Phase 6 notes (remove if obsolete)

### 1.3 Identify Unused Modules
Check for modules that aren't used:
- [ ] `macula_dht_rpc.erl` - Is this still used or superseded by peer_connector?

---

## Phase 2: Architecture Documentation Cleanup

### 2.1 Consolidate V0.8.0 Documents

**Current v0.8.0 docs (16 files)**:
- V0.8.0_ARCHITECTURE_OVERVIEW.md
- V0.8.0_COMPLETION_STATUS.md
- V0.8.0_CURRENT_STATUS.md
- V0.8.0_DHT_IMPLEMENTATION_BLOCKERS.md
- V0.8.0_DHT_PROPAGATION_PLAN.md
- V0.8.0_DOCKER_SUCCESS.md
- V0.8.0_FINAL_STATUS.md
- V0.8.0_FINAL_SUMMARY.md
- V0.8.0_IMPLEMENTATION_ROADMAP.md
- V0.8.0_PHASE1_COMPLETE.md
- V0.8.0_PHASE2_PROGRESS.md
- V0.8.0_PROGRESS.md
- V0.8.0_SESSION_SUMMARY.md
- V0.8.0_SUPERVISION_DIAGRAMS.md
- V0.8.0_TEST_PROGRESS.md
- V0.8.0_WORK_BREAKDOWN.md

**Action**: Consolidate into clean structure:
- [ ] `v0.8.0-OVERVIEW.md` - What was implemented, key achievements
- [ ] `v0.8.0-ARCHITECTURE.md` - Technical architecture, diagrams
- [ ] `v0.8.0-DECISIONS.md` - ADRs and key decisions
- [ ] `v0.8.0-CHANGELOG.md` - What changed from v0.7.x
- [ ] `v0.8.0-ROADMAP.md` - What's next (v0.9.0 planning)
- [ ] `v0.8.0-HISTORY.md` - Development history, session summaries
- [ ] Move old docs to `architecture/archive/v0.8.0/`

### 2.2 Rename http3_mesh Documents

**Current naming**: `macula_http3_mesh_*.md` (inconsistent)

**New naming standard**: `vX.Y.Z-DOCNAME.md` or `TOPIC-DOCNAME.md`

Files to rename:
- [ ] `macula_http3_mesh_root.md` → `ARCHITECTURE-INDEX.md`
- [ ] `macula_http3_mesh_quick_start.md` → `QUICKSTART.md`
- [ ] `macula_http3_mesh_roadmap.md` → `ROADMAP.md`
- [ ] `macula_http3_mesh_api_reference.md` → `API-REFERENCE.md`
- [ ] `macula_http3_mesh_glossary.md` → `GLOSSARY.md`
- [ ] etc.

### 2.3 Create Master Index

Create `architecture/INDEX.md` with:
- [ ] Overview of architecture documentation
- [ ] Links to version-specific docs (v0.7.x, v0.8.0, v0.9.0)
- [ ] Links to topic guides (RPC, PubSub, DHT, NAT)
- [ ] Links to operational docs (deployment, troubleshooting)

### 2.4 Cleanup Old/Redundant Docs

Files to archive or remove:
- [ ] Gateway refactoring docs (completed, archive)
- [ ] God module refactoring (superseded by v0.7.0 nomenclature)
- [ ] Old DHT RPC status docs (superseded by v0.8.0 direct P2P)

---

## Phase 3: Hex Docs Revision

### 3.1 Update README.md

Current issues:
- [ ] May reference old architecture
- [ ] Needs v0.8.0 features documented
- [ ] Quick start may be outdated

### 3.2 Module Documentation

For each major module:
- [ ] `macula_peer.erl` - High-level API documentation
- [ ] `macula_connection.erl` - QUIC transport documentation
- [ ] `macula_peer_connector.erl` - P2P connector documentation
- [ ] `macula_routing_server.erl` - DHT operations documentation
- [ ] `macula_pubsub_dht.erl` - PubSub DHT integration
- [ ] `macula_gateway.erl` - Gateway functionality

### 3.3 Guides

Create or update:
- [ ] Getting Started guide
- [ ] RPC guide (update with v0.8.0 direct P2P)
- [ ] PubSub guide (update with v0.8.0 direct P2P)
- [ ] DHT guide (new - explain Kademlia, propagation)

---

## Phase 4: Tutorial Verification

### 4.1 Walk Through Tutorial

Test each step:
- [ ] Installation
- [ ] Starting a node
- [ ] RPC example
- [ ] PubSub example
- [ ] Multi-node setup

### 4.2 Update for v0.8.0

- [ ] Remove references to old architecture
- [ ] Update code examples
- [ ] Add Docker Compose examples
- [ ] Test all commands work

---

## Phase 5: Algorithms & Techniques Documentation

### 5.1 Create Algorithm Docs

New documents with diagrams:
- [ ] `ALGORITHMS-KADEMLIA.md` - DHT routing, k-bucket management
- [ ] `ALGORITHMS-P2P-MESSAGING.md` - Direct QUIC connections, fire-and-forget
- [ ] `ALGORITHMS-SERVICE-DISCOVERY.md` - Advertisement, TTL, cleanup
- [ ] `TECHNIQUES-DHT-PROPAGATION.md` - k-node replication
- [ ] `TECHNIQUES-DIRECT-P2P.md` - Peer connector pattern

### 5.2 Create Diagrams

Using Mermaid or ASCII art:
- [ ] DHT routing diagram
- [ ] RPC message flow (v0.8.0)
- [ ] PubSub message flow (v0.8.0)
- [ ] Service discovery sequence
- [ ] Supervision tree (updated for v0.8.0)

---

## Phase 6: Final Tasks

### 6.1 Version Tagging

- [ ] Ensure all tests pass
- [ ] Update version in `src/macula.app.src`
- [ ] Create `CHANGELOG.md` for v0.8.0
- [ ] Tag release: `git tag -a v0.8.0 -m "Direct P2P with DHT propagation"`

### 6.2 Hex Publishing Prep

- [ ] Update `rebar.config` hex metadata
- [ ] Verify hex docs generation works
- [ ] Test `rebar3 hex build`
- [ ] Update hex description

### 6.3 Final Checklist

- [ ] All tests passing (21/21 integration tests)
- [ ] Documentation complete and organized
- [ ] No backup files or cruft
- [ ] README accurate
- [ ] Tutorial verified
- [ ] Hex docs buildable

---

## Priority Order

1. **Code cleanup** (30 min) - Remove backup files, address TODOs
2. **v0.8.0 doc consolidation** (2 hours) - Merge all v0.8.0 docs into clean structure
3. **Architecture index** (1 hour) - Create master navigation
4. **Hex docs** (2 hours) - Update README, module docs
5. **Tutorial** (1 hour) - Verify and update
6. **Algorithms/diagrams** (3 hours) - Create technical documentation
7. **http3_mesh rename** (1 hour) - Apply consistent naming
8. **Final release** (30 min) - Tag, test hex build

**Total estimate**: ~11 hours of work

---

## Success Criteria

- ✅ No backup/old files in repository
- ✅ All TODOs addressed or documented for future versions
- ✅ Clean v0.8.0 documentation structure
- ✅ Master architecture index exists
- ✅ Hex docs build successfully
- ✅ README is accurate and current
- ✅ Tutorial tested and works
- ✅ Algorithm documentation with diagrams
- ✅ Consistent naming throughout
- ✅ v0.8.0 tagged and ready for publishing
