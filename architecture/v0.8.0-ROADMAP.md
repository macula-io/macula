# Macula Roadmap - Post-v0.9.1

**Current Version**: v0.9.1
**This Document**: Release history and future planning

---

## Release History

### v0.9.1 (2025-11-23) - RELEASED

**Theme**: Test Coverage & CRDTs

**What Shipped:**
- ✅ Comprehensive test coverage for Platform Layer supervisor (8 tests)
- ✅ LWW-Register CRDT implementation with 14 comprehensive tests
- ✅ Foundation for future CRDT types (G-Counter, PN-Counter, OR-Set, LWW-Element-Set)

### v0.9.0 (2025-11-23) - RELEASED

**Theme**: Platform Layer with Distributed Coordination

**What Shipped:**
- ✅ Platform Layer architecture (3-tier: Workload → Platform → Infrastructure)
- ✅ Leader election via Ra (Raft consensus)
- ✅ Callback system for leadership changes
- ✅ Integration with macula_root supervision tree
- ✅ Production patterns from Khepri applied

**Impact:** Enabled distributed matchmaking, multi-tenant game servers, and single coordinator patterns across the mesh.

**The Pivot:**

v0.9.0 diverged from the original roadmap (NAT traversal, TLS, connection pooling) to solve a critical coordination problem: workload applications had no way to elect a single coordinator or share state across peers. This made distributed applications like matchmaking impossible.

**Rationale:** Platform-layer coordination unlocked an entire class of distributed applications and proved more valuable than infrastructure optimizations. The original roadmap features (NAT traversal, TLS cert verification, connection pooling) remain valid but were deferred.

---

## v0.10.0 Planning - Production Hardening

**Target Release**: Q1-Q2 2025
**Status**: PLANNING
**Focus**: Security, Performance, Reliability

### Goals

Make Macula production-ready by addressing infrastructure gaps deferred from v0.9.0:

1. **Security Hardening** - TLS certificate verification
2. **Performance Optimization** - Connection pooling, batching, caching
3. **Reliability Improvements** - Request/response patterns, retry logic
4. **Shared State** - Platform-layer KV store or CRDT integration

### Proposed Features

#### 1. Platform-Layer Shared State (NEW - High Priority)

**Problem**: Leader election solved single coordinator, but applications still need shared state across peers

**Options** (choose one):
1. **Integrate CRDTs** - Build on v0.9.1's LWW-Register foundation
   - Add G-Counter, PN-Counter, OR-Set, LWW-Element-Set
   - Replicate via DHT pub/sub
   - No strong consistency guarantees (eventual consistency)

2. **Ra-backed KV Store** - Raft consensus for shared state
   - Strong consistency guarantees
   - Similar to Khepri's approach
   - Single Raft cluster limits scalability

**Effort**: 3-4 weeks
**Decision**: TBD based on use case requirements

#### 2. TLS Certificate Verification (High Priority - Deferred from v0.9.0)

**Problem**: Currently using `{verify, none}` (security risk)

**Implementation**:
- CA certificate bundle support
- Certificate validation
- Certificate pinning option
- Configuration via application env

**Effort**: 1-2 weeks
**Impact**: Security (high)

#### 3. Connection Pooling (High Priority - Deferred from v0.9.0)

**Problem**: New connection per message creates overhead

**Implementation**:
- LRU eviction policy
- Max connections per pool (configurable)
- TTL-based cleanup
- Automatic reconnection

**Effort**: 2-3 weeks
**Impact**: 10x performance improvement for repeated operations

#### 4. Request/Response Pattern for DHT (Medium Priority - Deferred from v0.9.0)

**Problem**: Fire-and-forget provides no feedback

**Implementation**:
- Correlation IDs
- Response tracking with timeout
- Retry logic

**Effort**: 2-3 weeks
**Impact**: Observability, reliability

#### 5. Performance Tuning (Medium Priority - Deferred from v0.9.0)

**Optimizations**:
- Adaptive delay tuning (currently fixed 100ms)
- Batch DHT operations
- DHT cache tuning
- Message batching

**Effort**: 2-3 weeks
**Impact**: 2-3x throughput, 30-50% latency reduction

#### 6. Observability & Metrics (Low Priority - Deferred from v0.9.0)

**Implementation**:
- Telemetry events for DHT, RPC, PubSub
- Connection pool statistics
- Health check endpoints
- Prometheus/Grafana integration

**Effort**: 2 weeks
**Impact**: Operations visibility

---

## Beyond v0.10.0

### NAT Traversal (Future - v0.11.0+)

**Deferred Reason**: Current gateway relay provides 100% connectivity. NAT hole punching would improve from 0% direct P2P to 80% direct, reducing relay load.

**When to Prioritize**:
- Relay costs become prohibitive
- Direct P2P latency critical for use case
- Edge deployment with limited WAN bandwidth

**See**: `architecture/NAT_TRAVERSAL_ROADMAP.md` for detailed design

**Effort**: 6-8 weeks

### Subsystem Refactoring (Future - If Needed)

**Deferred Reason**: Current architecture works well. Refactoring is architectural cleanup, not critical.

**When to Reconsider**:
- Deploying dedicated bootstrap nodes
- Relay logic becomes complex
- Separation of concerns becomes important

**See**: `architecture/V0.8.0_IMPLEMENTATION_ROADMAP.md` for original plan

**Effort**: 4 weeks

---

## Development Priorities (v0.10.0)

### Phase 1: Planning & Design (Weeks 1-2)
- Decide on shared state approach (CRDT vs Ra KV)
- Design APIs and integration patterns
- Review security requirements

### Phase 2: Shared State (Weeks 3-6)
- Implement chosen shared state solution
- Integration tests
- Documentation

### Phase 3: Security (Weeks 7-9)
- TLS certificate verification
- Certificate pinning
- Security audit

### Phase 4: Performance (Weeks 10-14)
- Connection pooling
- Batch operations
- Performance benchmarking

### Phase 5: Reliability (Weeks 15-17)
- Request/response DHT pattern
- Retry logic
- Error handling improvements

### Phase 6: Observability (Weeks 18-19)
- Telemetry integration
- Metrics endpoints
- Dashboards

### Phase 7: Polish (Weeks 20-22)
- Documentation
- Tutorial updates
- Release preparation

---

## Success Criteria (v0.10.0)

### Functionality
- ✅ Shared state available across mesh (CRDT or Ra KV)
- ✅ Applications can coordinate beyond leader election

### Security
- ✅ TLS certificate verification enabled by default
- ✅ Certificate pinning option available
- ✅ Security audit passed

### Performance
- ✅ 10x improvement in repeated P2P operations (connection pooling)
- ✅ 2-3x throughput increase (batching + tuning)

### Reliability
- ✅ 100% test coverage maintained
- ✅ DHT operation confirmation available
- ✅ Retry logic for failed operations

### Observability
- ✅ Comprehensive metrics available
- ✅ Integration with Prometheus
- ✅ Sample Grafana dashboards

---

## Breaking Changes (v0.10.0)

**Possible**:
- TLS verification enabled by default (may require configuration)
- Connection pool configuration (optional)
- Shared state API (new feature)

**Mitigation**:
- Feature flags for gradual rollout
- Backward compatibility mode
- Clear migration guide

---

## Community Feedback

We welcome feedback on this roadmap!

**Questions**:
- Which shared state approach fits your use case? (CRDT vs Ra KV)
- Is NAT traversal critical for your deployment?
- What performance metrics matter most?

**How to Provide Feedback**:
- GitHub Issues: https://github.com/macula-io/macula/issues
- GitHub Discussions: https://github.com/macula-io/macula/discussions

---

## References

- **CHANGELOG**: `CHANGELOG.md` (detailed release notes)
- **NAT Traversal Design**: `architecture/NAT_TRAVERSAL_ROADMAP.md`
- **Platform Vision**: `architecture/PLATFORM_VISION.md`
- **Current Architecture**: `architecture/v0.8.0-ARCHITECTURE.md`
- **Known Issues**: `TODO.md`

---

**Document Version**: 2.0
**Last Updated**: 2025-11-23
**Next Review**: After v0.10.0 planning complete
