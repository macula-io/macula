<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 400" width="800" height="400">
  <defs>
    <linearGradient id="oldGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#EF4444;stop-opacity:0.8" />
      <stop offset="100%" style="stop-color:#DC2626;stop-opacity:0.8" />
    </linearGradient>
    <linearGradient id="newGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#10B981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="midGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#F59E0B;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#D97706;stop-opacity:1" />
    </linearGradient>
  </defs>

  <!-- Background -->
  <rect width="800" height="400" fill="#F9FAFB"/>

  <!-- Title -->
  <text x="400" y="35" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="20" font-weight="600" fill="#111827">LRU (Least Recently Used) Cache Eviction</text>
  <text x="400" y="55" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="12" fill="#6B7280">Used in audit log to bound memory usage while keeping recent entries</text>

  <!-- Cache visualization - before -->
  <text x="200" y="90" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="600" fill="#374151">Before (at max_entries=5)</text>

  <rect x="50" y="105" width="300" height="140" rx="8" fill="white" stroke="#E5E7EB" stroke-width="1"/>

  <!-- Entries before -->
  <rect x="65" y="115" width="270" height="22" rx="4" fill="url(#oldGrad)"/>
  <text x="80" y="130" font-family="monospace" font-size="10" fill="white">Entry 1 (oldest - 10:00:01)</text>
  <text x="310" y="130" text-anchor="end" font-family="Inter, system-ui, sans-serif" font-size="9" fill="white">evict</text>

  <rect x="65" y="140" width="270" height="22" rx="4" fill="url(#midGrad)" opacity="0.7"/>
  <text x="80" y="155" font-family="monospace" font-size="10" fill="white">Entry 2           (10:00:05)</text>

  <rect x="65" y="165" width="270" height="22" rx="4" fill="url(#midGrad)" opacity="0.8"/>
  <text x="80" y="180" font-family="monospace" font-size="10" fill="white">Entry 3           (10:00:10)</text>

  <rect x="65" y="190" width="270" height="22" rx="4" fill="url(#midGrad)" opacity="0.9"/>
  <text x="80" y="205" font-family="monospace" font-size="10" fill="white">Entry 4           (10:00:15)</text>

  <rect x="65" y="215" width="270" height="22" rx="4" fill="url(#newGrad)"/>
  <text x="80" y="230" font-family="monospace" font-size="10" fill="white">Entry 5 (newest - 10:00:20)</text>
  <text x="310" y="230" text-anchor="end" font-family="Inter, system-ui, sans-serif" font-size="9" fill="white">keep</text>

  <!-- Arrow -->
  <polygon points="380,180 420,165 420,175 470,175 470,185 420,185 420,195" fill="#3B82F6"/>
  <text x="425" y="168" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#1D4ED8">New entry</text>
  <text x="425" y="202" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#1D4ED8">arrives</text>

  <!-- Cache visualization - after -->
  <text x="600" y="90" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="600" fill="#374151">After (oldest evicted)</text>

  <rect x="450" y="105" width="300" height="140" rx="8" fill="white" stroke="#E5E7EB" stroke-width="1"/>

  <!-- Entries after -->
  <rect x="465" y="115" width="270" height="22" rx="4" fill="url(#midGrad)" opacity="0.7"/>
  <text x="480" y="130" font-family="monospace" font-size="10" fill="white">Entry 2           (10:00:05)</text>

  <rect x="465" y="140" width="270" height="22" rx="4" fill="url(#midGrad)" opacity="0.8"/>
  <text x="480" y="155" font-family="monospace" font-size="10" fill="white">Entry 3           (10:00:10)</text>

  <rect x="465" y="165" width="270" height="22" rx="4" fill="url(#midGrad)" opacity="0.9"/>
  <text x="480" y="180" font-family="monospace" font-size="10" fill="white">Entry 4           (10:00:15)</text>

  <rect x="465" y="190" width="270" height="22" rx="4" fill="url(#newGrad)" opacity="0.95"/>
  <text x="480" y="205" font-family="monospace" font-size="10" fill="white">Entry 5           (10:00:20)</text>

  <rect x="465" y="215" width="270" height="22" rx="4" fill="url(#newGrad)"/>
  <text x="480" y="230" font-family="monospace" font-size="10" fill="white">Entry 6 (new!   - 10:00:25)</text>

  <!-- Algorithm explanation -->
  <rect x="50" y="265" width="700" height="125" rx="8" fill="white" stroke="#E5E7EB" stroke-width="1"/>
  <text x="400" y="290" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="13" font-weight="600" fill="#111827">LRU Algorithm in macula_authorization_audit</text>

  <!-- Step 1 -->
  <circle cx="80" cy="315" r="12" fill="#3B82F6"/>
  <text x="80" y="319" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="700" fill="white">1</text>
  <text x="100" y="319" font-family="Inter, system-ui, sans-serif" font-size="11" fill="#374151">New entry arrives, check <tspan font-family="monospace" fill="#7C3AED">ets:info(table, size)</tspan></text>

  <!-- Step 2 -->
  <circle cx="80" cy="345" r="12" fill="#3B82F6"/>
  <text x="80" y="349" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="700" fill="white">2</text>
  <text x="100" y="349" font-family="Inter, system-ui, sans-serif" font-size="11" fill="#374151">If size &gt; max_entries, call <tspan font-family="monospace" fill="#7C3AED">evict_oldest(count)</tspan></text>

  <!-- Step 3 -->
  <circle cx="80" cy="375" r="12" fill="#3B82F6"/>
  <text x="80" y="379" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="700" fill="white">3</text>
  <text x="100" y="379" font-family="Inter, system-ui, sans-serif" font-size="11" fill="#374151">Sort by timestamp ascending, delete N oldest entries</text>

  <!-- Complexity box -->
  <rect x="520" y="305" width="215" height="70" rx="6" fill="#F3F4F6" stroke="#D1D5DB" stroke-width="1"/>
  <text x="628" y="328" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="600" fill="#374151">Complexity</text>
  <text x="535" y="348" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#6B7280">Insert: O(1)</text>
  <text x="535" y="365" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#6B7280">Eviction: O(n log n) - rare</text>
</svg>
