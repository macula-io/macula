<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 500">
  <defs>
    <marker id="arr" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#1976d2"/>
    </marker>
    <marker id="arr-g" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#388e3c"/>
    </marker>
    <marker id="arr-o" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#f57c00"/>
    </marker>
    <marker id="arr-p" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#7b1fa2"/>
    </marker>
    <style>
      .title { font: bold 14px sans-serif; fill: #333; }
      .node { font: bold 11px sans-serif; fill: #333; }
      .step { font: 10px sans-serif; fill: #666; }
      .msg { font: 10px monospace; }
      .action { font: 9px sans-serif; fill: #888; font-style: italic; }
    </style>
  </defs>

  <!-- Title -->
  <text x="450" y="25" text-anchor="middle" class="title">Parallel Multi-Provider Download</text>

  <!-- Nodes -->
  <rect x="60" y="50" width="100" height="35" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="6"/>
  <text x="110" y="72" text-anchor="middle" class="node">Requester</text>

  <rect x="280" y="50" width="100" height="35" fill="#e8f5e9" stroke="#388e3c" stroke-width="2" rx="6"/>
  <text x="330" y="72" text-anchor="middle" class="node">Provider 1</text>

  <rect x="500" y="50" width="100" height="35" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="6"/>
  <text x="550" y="72" text-anchor="middle" class="node">Provider 2</text>

  <rect x="720" y="50" width="100" height="35" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="6"/>
  <text x="770" y="72" text-anchor="middle" class="node">Provider 3</text>

  <!-- Lifelines -->
  <line x1="110" y1="85" x2="110" y2="480" stroke="#999" stroke-dasharray="4"/>
  <line x1="330" y1="85" x2="330" y2="480" stroke="#999" stroke-dasharray="4"/>
  <line x1="550" y1="85" x2="550" y2="480" stroke="#999" stroke-dasharray="4"/>
  <line x1="770" y1="85" x2="770" y2="480" stroke="#999" stroke-dasharray="4"/>

  <!-- DHT Query -->
  <rect x="30" y="100" width="160" height="25" fill="#fff8e1" stroke="#ffc107" rx="4"/>
  <text x="110" y="117" text-anchor="middle" class="action">Query DHT for manifest providers</text>

  <!-- Parallel WANT messages -->
  <text x="10" y="150" class="step">1.</text>
  <line x1="115" y1="145" x2="325" y2="145" stroke="#388e3c" stroke-width="1.5" marker-end="url(#arr-g)"/>
  <text x="220" y="140" text-anchor="middle" class="msg" fill="#388e3c">WANT(chunks 0-9)</text>

  <line x1="115" y1="160" x2="545" y2="160" stroke="#f57c00" stroke-width="1.5" marker-end="url(#arr-o)"/>
  <text x="330" y="175" text-anchor="middle" class="msg" fill="#f57c00">WANT(chunks 10-19)</text>

  <line x1="115" y1="175" x2="765" y2="175" stroke="#7b1fa2" stroke-width="1.5" marker-end="url(#arr-p)"/>
  <text x="440" y="190" text-anchor="middle" class="msg" fill="#7b1fa2">WANT(chunks 20-29)</text>

  <!-- Blocks from Provider 1 -->
  <text x="10" y="230" class="step">2.</text>
  <line x1="325" y1="225" x2="115" y2="225" stroke="#388e3c" stroke-width="1.5" marker-end="url(#arr-g)"/>
  <text x="220" y="220" text-anchor="middle" class="msg" fill="#388e3c">BLOCK(c0)</text>

  <line x1="325" y1="250" x2="115" y2="250" stroke="#388e3c" stroke-width="1.5" marker-end="url(#arr-g)"/>
  <text x="220" y="245" text-anchor="middle" class="msg" fill="#388e3c">BLOCK(c1)</text>

  <line x1="325" y1="275" x2="115" y2="275" stroke="#388e3c" stroke-width="1.5" marker-end="url(#arr-g)"/>
  <text x="220" y="270" text-anchor="middle" class="msg" fill="#388e3c">BLOCK(c2)...</text>

  <!-- Blocks from Provider 2 -->
  <line x1="545" y1="235" x2="115" y2="235" stroke="#f57c00" stroke-width="1.5" marker-end="url(#arr-o)"/>
  <text x="400" y="230" text-anchor="middle" class="msg" fill="#f57c00">BLOCK(c10)</text>

  <line x1="545" y1="260" x2="115" y2="260" stroke="#f57c00" stroke-width="1.5" marker-end="url(#arr-o)"/>
  <text x="400" y="255" text-anchor="middle" class="msg" fill="#f57c00">BLOCK(c11)</text>

  <line x1="545" y1="285" x2="115" y2="285" stroke="#f57c00" stroke-width="1.5" marker-end="url(#arr-o)"/>
  <text x="400" y="280" text-anchor="middle" class="msg" fill="#f57c00">BLOCK(c12)...</text>

  <!-- Blocks from Provider 3 -->
  <line x1="765" y1="245" x2="115" y2="245" stroke="#7b1fa2" stroke-width="1.5" marker-end="url(#arr-p)"/>
  <text x="500" y="242" text-anchor="middle" class="msg" fill="#7b1fa2">BLOCK(c20)</text>

  <line x1="765" y1="270" x2="115" y2="270" stroke="#7b1fa2" stroke-width="1.5" marker-end="url(#arr-p)"/>
  <text x="500" y="267" text-anchor="middle" class="msg" fill="#7b1fa2">BLOCK(c21)</text>

  <line x1="765" y1="295" x2="115" y2="295" stroke="#7b1fa2" stroke-width="1.5" marker-end="url(#arr-p)"/>
  <text x="500" y="292" text-anchor="middle" class="msg" fill="#7b1fa2">BLOCK(c22)...</text>

  <!-- Interleaved reception indicator -->
  <rect x="30" y="320" width="160" height="40" fill="#e8eaf6" stroke="#5c6bc0" rx="4"/>
  <text x="110" y="338" text-anchor="middle" class="action">Blocks arrive interleaved</text>
  <text x="110" y="352" text-anchor="middle" class="action">from all providers</text>

  <!-- Final assembly -->
  <rect x="30" y="390" width="160" height="40" fill="#e3f2fd" stroke="#90caf9" rx="4"/>
  <text x="110" y="408" text-anchor="middle" class="action">All chunks received</text>
  <text x="110" y="422" text-anchor="middle" class="action">Verify Merkle root</text>

  <rect x="30" y="445" width="160" height="30" fill="#c8e6c9" stroke="#66bb6a" rx="4"/>
  <text x="110" y="465" text-anchor="middle" class="node" fill="#2e7d32">Reassemble File</text>

  <!-- Speed indicator -->
  <rect x="680" y="380" width="150" height="80" fill="#fff" stroke="#ddd" rx="4"/>
  <text x="755" y="400" text-anchor="middle" class="node">Speedup</text>
  <text x="755" y="420" text-anchor="middle" class="step">3 providers = ~3x faster</text>
  <text x="755" y="440" text-anchor="middle" class="step">Fault tolerant:</text>
  <text x="755" y="455" text-anchor="middle" class="step">if one fails, others continue</text>
</svg>
