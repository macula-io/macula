<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.2">
    <meta name="project" content="macula v0.12.4">


    <title>Roadmap — macula v0.12.4</title>

    <link rel="stylesheet" href="dist/html-erlang-DQDXQC7W.css" />

    <script defer src="dist/sidebar_items-DE2E663F.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="overview.html" class="sidebar-projectImage">
          <img src="assets/logo.svg" alt="macula" />
        </a>

      <div>
        <a href="overview.html" class="sidebar-projectName" translate="no">
macula
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.12.4
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of macula</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>Macula Roadmap</h1>


      <a href="https://github.com/macula-io/macula/blob/0.12.4/architecture/ROADMAP.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


<blockquote><p><strong>Last Updated:</strong> 2025-11-28
<strong>Current Version:</strong> v0.11.2
<strong>Status:</strong> This is a realistic roadmap based on source code analysis</p></blockquote><hr class="thin"/><h2 id="executive-summary" class="section-heading"><a href="#executive-summary" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Executive Summary</span></h2><p>This roadmap is based on an honest assessment of the codebase as of November 2025. It prioritizes completing partially-implemented features before adding new ones.</p><p><strong>Key Finding:</strong> The documentation claims features that are only partially implemented. This roadmap focuses on completing what exists before expanding scope.</p><hr class="thin"/><h2 id="current-state-v0-10-1" class="section-heading"><a href="#current-state-v0-10-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Current State (v0.10.1)</span></h2><h3 id="what-actually-works" class="section-heading"><a href="#what-actually-works" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">What Actually Works</span></h3><table><thead><tr><th style="text-align: left;">Component</th><th style="text-align: left;">Status</th><th style="text-align: left;">Evidence</th></tr></thead><tbody><tr><td style="text-align: left;">QUIC Transport</td><td style="text-align: left;"><strong>Working</strong></td><td style="text-align: left;"><code class="inline">macula_connection.erl</code> - Full gen_server, QUIC via quicer</td></tr><tr><td style="text-align: left;">PubSub (local)</td><td style="text-align: left;"><strong>Working</strong></td><td style="text-align: left;">11 files in <code class="inline">macula_pubsub_system/</code></td></tr><tr><td style="text-align: left;">RPC (local)</td><td style="text-align: left;"><strong>Working</strong></td><td style="text-align: left;">9 files in <code class="inline">macula_rpc_system/</code></td></tr><tr><td style="text-align: left;">DHT Kademlia</td><td style="text-align: left;"><strong>Working</strong></td><td style="text-align: left;">6 files in <code class="inline">macula_routing_system/</code>, k-bucket routing</td></tr><tr><td style="text-align: left;">Gateway System</td><td style="text-align: left;"><strong>Working</strong></td><td style="text-align: left;">13 files in <code class="inline">macula_gateway_system/</code></td></tr><tr><td style="text-align: left;">Bootstrap System</td><td style="text-align: left;"><strong>Working</strong></td><td style="text-align: left;">4 files in <code class="inline">macula_bootstrap_system/</code></td></tr><tr><td style="text-align: left;">Memory Management</td><td style="text-align: left;"><strong>Working</strong></td><td style="text-align: left;">Bounded pools, TTL cleanup</td></tr><tr><td style="text-align: left;">Performance Cache</td><td style="text-align: left;"><strong>Working</strong></td><td style="text-align: left;">Subscriber cache, direct routing</td></tr><tr><td style="text-align: left;">TLS Configuration</td><td style="text-align: left;"><strong>Working</strong></td><td style="text-align: left;">Two-mode system: production/development</td></tr><tr><td style="text-align: left;">Hybrid Trust Model</td><td style="text-align: left;"><strong>Working</strong></td><td style="text-align: left;">Realm auth + TOFU + rate limit + audit (37 tests)</td></tr></tbody></table><h3 id="what-is-incomplete" class="section-heading"><a href="#what-is-incomplete" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">What Is Incomplete</span></h3><table><thead><tr><th style="text-align: left;">Component</th><th style="text-align: left;">Claimed Status</th><th style="text-align: left;">Actual Status</th></tr></thead><tbody><tr><td style="text-align: left;">Platform Layer</td><td style="text-align: left;">&quot;Raft consensus&quot;</td><td style="text-align: left;"><strong>Single-node only</strong> - Line 177 in <code class="inline">macula_leader_election.erl</code>: <code class="inline">initial_members =&gt; [ServerId], % Single node for now</code></td></tr><tr><td style="text-align: left;">CRDTs</td><td style="text-align: left;">&quot;LWW, G-Counter, PN-Counter, etc.&quot;</td><td style="text-align: left;"><strong>Only LWW-Register</strong> - Others are <code class="inline">%% Future:</code> comments</td></tr><tr><td style="text-align: left;">Distributed CRDTs</td><td style="text-align: left;">&quot;Eventually consistent&quot;</td><td style="text-align: left;"><strong>Local ETS only</strong> - No replication across nodes</td></tr><tr><td style="text-align: left;">TLS Verification</td><td style="text-align: left;"><strong>COMPLETED</strong></td><td style="text-align: left;">Two-mode system: production (strict verification) / development (self-signed)</td></tr><tr><td style="text-align: left;">NAT Traversal</td><td style="text-align: left;">&quot;Hole punching&quot;</td><td style="text-align: left;"><strong>Incomplete</strong> - TODOs in detector, only relay works</td></tr><tr><td style="text-align: left;">QUIC Distribution</td><td style="text-align: left;">&quot;31 tests passing&quot;</td><td style="text-align: left;"><strong>Not integrated</strong> - Standalone module, not used by mesh</td></tr></tbody></table><hr class="thin"/><h2 id="architectural-decision-reckon_db-as-platform-service-future" class="section-heading"><a href="#architectural-decision-reckon_db-as-platform-service-future" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Architectural Decision: reckon_db as Platform Service (Future)</span></h2><blockquote><p><strong>Decision Date:</strong> 2025-11-28
<strong>Status:</strong> Planned for v0.14.0+
<strong>Prerequisite:</strong> reckon_db (pure Erlang event store) must be developed first</p></blockquote><h3 id="problem" class="section-heading"><a href="#problem" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Problem</span></h3><p>The current Platform Layer uses Ra directly for leader election and local ETS for CRDT storage.
If workloads also use an event store (which uses Khepri/Ra), there would be:</p><ul><li>Two competing Ra clusters on the same BEAM node</li><li>Resource contention (disk I/O, memory, consensus traffic)</li><li>Potential data directory collisions</li><li>Redundant consensus mechanisms</li></ul><h3 id="solution-deferred" class="section-heading"><a href="#solution-deferred" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Solution (Deferred)</span></h3><p>Integrate <strong>reckon_db</strong> (pure Erlang rewrite of ex_esdb) as the Platform Layer's storage backend.</p><p><strong>Why reckon_db instead of ex_esdb?</strong></p><ul><li>Macula is pure Erlang - avoid Elixir dependency</li><li>reckon_db will be a clean, focused implementation</li><li>Ecosystem alignment: reckon_db_gater, reckon_db_commanded adapters</li></ul><pre><code class="makeup erlang" translate="no"><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">
</span><span class="err">│</span><span class="w">                   </span><span class="n">Workload</span><span class="w"> </span><span class="n">Application</span><span class="w">                       </span><span class="err">│</span><span class="w">
</span><span class="err">├</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┤</span><span class="w">
</span><span class="err">│</span><span class="w">           </span><span class="n">Macula</span><span class="w"> </span><span class="n">Platform</span><span class="w"> </span><span class="n">Layer</span><span class="w"> </span><span class="p" data-group-id="7496015757-1">(</span><span class="n">API</span><span class="w"> </span><span class="n">Facade</span><span class="p" data-group-id="7496015757-1">)</span><span class="w">                 </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┬</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┬</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">    </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="n">Leader</span><span class="w">    </span><span class="err">│</span><span class="w">    </span><span class="n">CRDT</span><span class="w">      </span><span class="err">│</span><span class="w">    </span><span class="n">Service</span><span class="w">             </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Election</span><span class="w">   </span><span class="err">│</span><span class="w">    </span><span class="n">State</span><span class="w">     </span><span class="err">│</span><span class="w">    </span><span class="n">Registry</span><span class="w">            </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┬</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┴</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┬</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┴</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┬</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┘</span><span class="w">    </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">         </span><span class="err">│</span><span class="w">              </span><span class="err">│</span><span class="w">                  </span><span class="err">│</span><span class="w">                  </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">         </span><span class="err">▼</span><span class="w">              </span><span class="err">▼</span><span class="w">                  </span><span class="err">▼</span><span class="w">                  </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">   </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">              </span><span class="nf">reckon_db</span><span class="w"> </span><span class="p" data-group-id="7496015757-2">(</span><span class="n">Platform</span><span class="w"> </span><span class="n">Service</span><span class="p" data-group-id="7496015757-2">)</span><span class="w">             </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Event</span><span class="w"> </span><span class="n">Streams</span><span class="p">:</span><span class="w">                                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="sc">$p</span><span class="ss">latform</span><span class="p">.</span><span class="ss">leader_elections</span><span class="w">                         </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="sc">$p</span><span class="ss">latform</span><span class="p">.</span><span class="ss">crdt_updates</span><span class="w">                             </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="sc">$p</span><span class="ss">latform</span><span class="p">.</span><span class="ss">node_membership</span><span class="w">                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span><span class="w">                              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                    </span><span class="n">Khepri</span><span class="o">/</span><span class="n">Ra</span><span class="w">                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">              </span><span class="p" data-group-id="7496015757-3">(</span><span class="n">Single</span><span class="w"> </span><span class="n">Consensus</span><span class="w"> </span><span class="n">Layer</span><span class="p" data-group-id="7496015757-3">)</span><span class="w">                 </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┘</span><span class="w">   </span><span class="err">│</span><span class="w">
</span><span class="err">├</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┤</span><span class="w">
</span><span class="err">│</span><span class="w">                  </span><span class="n">Macula</span><span class="w"> </span><span class="n">Mesh</span><span class="w"> </span><span class="p" data-group-id="7496015757-4">(</span><span class="n">Transport</span><span class="p" data-group-id="7496015757-4">)</span><span class="w">                     </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">         </span><span class="n">QUIC</span><span class="o">/</span><span class="n">HTTP3</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">DHT</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">PubSub</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">RPC</span><span class="w">               </span><span class="err">│</span><span class="w">
</span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┘</span></code></pre><h3 id="benefits-when-implemented" class="section-heading"><a href="#benefits-when-implemented" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Benefits (When Implemented)</span></h3><table><thead><tr><th style="text-align: left;">Benefit</th><th style="text-align: left;">Description</th></tr></thead><tbody><tr><td style="text-align: left;">Single Consensus</td><td style="text-align: left;">One Ra cluster (via Khepri) for all coordination</td></tr><tr><td style="text-align: left;">Event Sourced Platform</td><td style="text-align: left;">Leader elections, CRDTs become auditable events</td></tr><tr><td style="text-align: left;">Replay &amp; Recovery</td><td style="text-align: left;">Platform state can be rebuilt from event log</td></tr><tr><td style="text-align: left;">Pure Erlang</td><td style="text-align: left;">No Elixir dependency in Macula core</td></tr><tr><td style="text-align: left;">Ecosystem Parity</td><td style="text-align: left;">reckon_db_gater, reckon_db_commanded alignment</td></tr></tbody></table><h3 id="prerequisites" class="section-heading"><a href="#prerequisites" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Prerequisites</span></h3><p>Before Platform Layer integration (v0.14.0+):</p><ol><li><strong>reckon_db</strong> - Pure Erlang event store (rewrite of ex_esdb)</li><li><strong>reckon_db_gater</strong> - Gateway/proxy for reckon_db</li><li><strong>reckon_db_commanded</strong> - Commanded adapter (optional, Elixir workloads)</li></ol><h3 id="current-state-v0-10-1-1" class="section-heading"><a href="#current-state-v0-10-1-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Current State (v0.10.1)</span></h3><p>Platform Layer works for <strong>single-node demos</strong>:</p><ul><li>Leader election: Single-node Ra cluster (functional but not distributed)</li><li>CRDTs: Local ETS storage (not replicated)</li><li>Sufficient for development and testing</li></ul><p><strong>No changes needed until reckon_db is ready.</strong></p><hr class="thin"/><h2 id="priority-1-security-first" class="section-heading"><a href="#priority-1-security-first" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Priority 1: Security First</span></h2><h3 id="v0-11-0-security-hardening" class="section-heading"><a href="#v0-11-0-security-hardening" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">v0.11.0 - Security Hardening</span></h3><p><strong>Goal:</strong> Fix critical security gaps before any production use.</p><p><strong>Rationale:</strong> TLS verification is more urgent than Platform Layer distribution.
The current Platform Layer works for demos; insecure TLS does not work for anything.</p><h4>P1.1 TLS Certificate Verification (COMPLETED - Nov 2025)</h4><p><strong>Status:</strong> Complete</p><p><strong>Implementation:</strong></p><ul><li>Created <code class="inline">macula_tls.erl</code> - centralized TLS configuration module</li><li>Two TLS modes: <code class="inline">production</code> (strict verification) and <code class="inline">development</code> (self-signed)</li><li>Environment variable configuration: <code class="inline">MACULA_TLS_MODE</code>, <code class="inline">MACULA_TLS_CACERTFILE</code>, etc.</li></ul><p><strong>Completed:</strong></p><ul><li>[x] Add CA bundle configuration option</li><li>[x] Implement certificate chain verification</li><li>[x] Add hostname verification</li><li>[x] Provide self-signed cert generation for development (<code class="inline">scripts/setup-dev-tls.sh</code>)</li><li>[x] Document TLS configuration in operator guide (<code class="inline">docs/operator/TLS_CONFIGURATION.md</code>)</li></ul><p><strong>Files Modified:</strong></p><ul><li><code class="inline">src/macula_tls.erl</code> (new - centralized TLS config)</li><li><code class="inline">src/macula_connection.erl</code> (uses macula_tls)</li><li><code class="inline">src/macula_connection_pool.erl</code> (uses macula_tls)</li><li><code class="inline">src/macula_dist.erl</code> (uses macula_tls)</li><li><code class="inline">config/sys.config</code> (TLS options)</li><li><code class="inline">scripts/setup-dev-tls.sh</code> (new - cert generation)</li><li><code class="inline">docs/operator/TLS_CONFIGURATION.md</code> (new - documentation)</li><li><code class="inline">test/macula_tls_tests.erl</code> (29 tests passing)</li></ul><p><strong>Acceptance Criteria Met:</strong></p><ul><li>Production mode rejects invalid certificates</li><li>Development mode allows self-signed with explicit opt-in</li><li>Hostname verification validates CN/SAN against connection hostname</li></ul><h4>P1.2 Hybrid Trust Model (COMPLETED - Nov 2025)</h4><p><strong>Status:</strong> Complete (Core Implementation)</p><p><strong>Problem Solved:</strong> TLS certificates required on every node creates friction for plug-and-play mesh.</p><p><strong>Solution:</strong> Hybrid Trust Model with three levels:</p><ul><li><strong>Level 1</strong>: Realm Authentication (API key validation)</li><li><strong>Level 2</strong>: Certificate Trust (TOFU within authenticated realm)</li><li><strong>Level 3</strong>: Optional CA-signed certificates for seed nodes</li></ul><p><strong>Implementation:</strong></p><ul><li>Created <code class="inline">macula_realm_trust.erl</code> - realm-scoped trust management</li><li>TOFU (Trust On First Use) pattern for certificate fingerprints</li><li>Fingerprint storage with realm scoping</li><li>Trust revocation support</li><li>24 tests passing</li></ul><p><strong>Completed:</strong></p><ul><li>[x] Architecture Decision Record (<code class="inline">architecture/decisions/ADR-001-HYBRID_TRUST_MODEL.md</code>)</li><li>[x] Realm authentication API (<code class="inline">authenticate/2</code>)</li><li>[x] Fingerprint registration (<code class="inline">register_fingerprint/3</code>)</li><li>[x] TOFU verification (<code class="inline">verify_fingerprint/3</code>)</li><li>[x] Trusted peers query (<code class="inline">get_trusted_peers/1</code>)</li><li>[x] Trust revocation (<code class="inline">revoke_trust/2</code>)</li><li>[x] Certificate fingerprint extraction (<code class="inline">extract_fingerprint/1</code>)</li></ul><p><strong>Files Added:</strong></p><ul><li><code class="inline">src/macula_realm_trust.erl</code> (new - 200+ LOC)</li><li><code class="inline">test/macula_realm_trust_tests.erl</code> (new - 24 tests)</li><li><code class="inline">architecture/decisions/ADR-001-HYBRID_TRUST_MODEL.md</code> (new - ADR)</li></ul><p><strong>Completed (v0.11.2):</strong></p><ul><li>[x] Rate limiting per realm (<code class="inline">init_rate_limiter/0</code>, <code class="inline">reset_rate_limit/1</code>)</li><li>[x] Audit logging for authentication events (auth_success, auth_failure, tofu_trust, fingerprint_mismatch, trust_revoked)</li><li>[x] 37 tests passing (13 new tests for DHT, rate limiting, audit logging)</li></ul><p><strong>Remaining (Future):</strong></p><ul><li>[ ] DHT integration for fingerprint storage (currently mock ETS - production uses bootstrap_registry)</li><li>[ ] macula_tls integration for automatic TOFU verification</li></ul><hr class="thin"/><h2 id="priority-2-core-improvements" class="section-heading"><a href="#priority-2-core-improvements" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Priority 2: Core Improvements</span></h2><h3 id="v0-12-0-dht-improvements" class="section-heading"><a href="#v0-12-0-dht-improvements" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">v0.12.0 - DHT Improvements</span></h3><h4>P2.1 DHT Request/Response Pattern</h4><p><strong>Current:</strong> <code class="inline">macula_gateway_dht.erl</code> uses fire-and-forget.</p><p><strong>Required:</strong></p><ul><li>[ ] Add correlation IDs to DHT queries</li><li>[ ] Implement timeout and retry logic</li><li>[ ] Add response tracking for observability</li></ul><p><strong>Files Affected:</strong></p><ul><li><code class="inline">src/macula_gateway_system/macula_gateway_dht.erl</code></li></ul><h4>P2.2 K-Bucket Splitting</h4><p><strong>Current:</strong> <code class="inline">macula_routing_table.erl</code> - buckets have max capacity but don't split.</p><p><strong>Required:</strong></p><ul><li>[ ] Implement bucket splitting when full</li><li>[ ] Maintain routing table invariants</li><li>[ ] Add routing table health metrics</li></ul><p><strong>Files Affected:</strong></p><ul><li><code class="inline">src/macula_routing_system/macula_routing_table.erl</code></li></ul><hr class="thin"/><h3 id="v0-13-0-nat-traversal-optional" class="section-heading"><a href="#v0-13-0-nat-traversal-optional" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">v0.13.0 - NAT Traversal (Optional)</span></h3><p><strong>Note:</strong> Only implement if targeting edge deployment. Gateway relay works for cloud deployments.</p><h4>P3.1 Complete NAT Detection</h4><p><strong>Current:</strong> <code class="inline">macula_nat_detector.erl</code> has TODO stubs.</p><p><strong>Required:</strong></p><ul><li>[ ] Implement NAT_PROBE message handling</li><li>[ ] Detect NAT type (EI, HD, PP, PC, RD)</li><li>[ ] Cache NAT type per connection</li></ul><h4>P3.2 STUN/TURN Support</h4><p><strong>Required:</strong></p><ul><li>[ ] Add STUN client for address discovery</li><li>[ ] Integrate TURN relay as fallback</li><li>[ ] Hole punch coordination protocol</li></ul><p><strong>Acceptance Criteria:</strong></p><ul><li>80%+ success rate for EI/PP NAT types</li><li>Automatic fallback to relay for restrictive NAT</li></ul><hr class="thin"/><h2 id="priority-3-ecosystem-contributions" class="section-heading"><a href="#priority-3-ecosystem-contributions" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Priority 3: Ecosystem Contributions</span></h2><h3 id="v1-0-0-production-ready" class="section-heading"><a href="#v1-0-0-production-ready" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">v1.0.0 - Production Ready</span></h3><p><strong>Goal:</strong> Complete feature set for production use.</p><h4>Checklist</h4><ul><li>[ ] All P1 and P2 items complete</li><li>[ ] E2E test suite with multi-node scenarios</li><li>[ ] Production deployment guide</li><li>[ ] Monitoring and alerting documentation</li><li>[ ] Performance benchmarks documented</li></ul><hr class="thin"/><h3 id="v1-1-0-quic-distribution-ecosystem-contribution" class="section-heading"><a href="#v1-1-0-quic-distribution-ecosystem-contribution" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">v1.1.0+ - QUIC Distribution (Ecosystem Contribution)</span></h3><p><strong>Note:</strong> This is a BEAM ecosystem contribution, not core Macula functionality. Only pursue after v1.0.0 is proven in production.</p><p><strong>Current State:</strong> <code class="inline">macula_dist.erl</code> exists but is standalone.</p><p><strong>Why Defer:</strong></p><ol><li>Macula mesh works fine over HTTP/3 without this</li><li>Requires TLS verification to be complete first</li><li>Integration with Ra cluster requires multi-node Platform Layer</li><li>Better to contribute after proving the core works</li></ol><p><strong>When Ready:</strong></p><ul><li>[ ] Integrate with existing Macula discovery</li><li>[ ] Add libcluster strategy</li><li>[ ] Test with Horde, Mnesia, :pg</li><li>[ ] Publish as separate hex package</li><li>[ ] Submit to OTP for consideration</li></ul><hr class="thin"/><h2 id="technical-debt" class="section-heading"><a href="#technical-debt" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Technical Debt</span></h2><h3 id="code-cleanup" class="section-heading"><a href="#code-cleanup" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Code Cleanup</span></h3><table><thead><tr><th style="text-align: left;">Issue</th><th style="text-align: left;">Priority</th><th style="text-align: left;">Location</th></tr></thead><tbody><tr><td style="text-align: left;">Remove TODO comments</td><td style="text-align: left;">Low</td><td style="text-align: left;">Various</td></tr><tr><td style="text-align: left;">Fix test harness instability</td><td style="text-align: left;">Medium</td><td style="text-align: left;">Tests cancel unexpectedly</td></tr><tr><td style="text-align: left;">Update documentation to match reality</td><td style="text-align: left;">High</td><td style="text-align: left;">GETTING_STARTED.md done, others pending</td></tr></tbody></table><h3 id="testing" class="section-heading"><a href="#testing" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Testing</span></h3><table><thead><tr><th style="text-align: left;">Area</th><th style="text-align: left;">Current</th><th style="text-align: left;">Target</th></tr></thead><tbody><tr><td style="text-align: left;">Unit tests</td><td style="text-align: left;">44 passing (unstable)</td><td style="text-align: left;">100+ stable</td></tr><tr><td style="text-align: left;">Integration tests</td><td style="text-align: left;">Minimal</td><td style="text-align: left;">Multi-node scenarios</td></tr><tr><td style="text-align: left;">E2E tests</td><td style="text-align: left;">None</td><td style="text-align: left;">Full workflow tests</td></tr></tbody></table><hr class="thin"/><h2 id="version-timeline" class="section-heading"><a href="#version-timeline" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Version Timeline</span></h2><table><thead><tr><th style="text-align: left;">Version</th><th style="text-align: left;">Focus</th><th style="text-align: left;">Prerequisites</th></tr></thead><tbody><tr><td style="text-align: left;">v0.11.0</td><td style="text-align: left;">Security Hardening (TLS)</td><td style="text-align: left;">None</td></tr><tr><td style="text-align: left;">v0.12.0</td><td style="text-align: left;">DHT Improvements</td><td style="text-align: left;">v0.11.0</td></tr><tr><td style="text-align: left;">v0.13.0</td><td style="text-align: left;">NAT Traversal (optional)</td><td style="text-align: left;">v0.11.0</td></tr><tr><td style="text-align: left;">v0.14.0</td><td style="text-align: left;">Platform Layer + reckon_db</td><td style="text-align: left;">reckon_db ready</td></tr><tr><td style="text-align: left;">v1.0.0</td><td style="text-align: left;">Production Ready</td><td style="text-align: left;">v0.11.0, v0.12.0</td></tr><tr><td style="text-align: left;">v1.1.0+</td><td style="text-align: left;">QUIC Distribution</td><td style="text-align: left;">v1.0.0 proven</td></tr></tbody></table><h3 id="external-dependencies" class="section-heading"><a href="#external-dependencies" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">External Dependencies</span></h3><table><thead><tr><th style="text-align: left;">Component</th><th style="text-align: left;">Status</th><th style="text-align: left;">Repository</th></tr></thead><tbody><tr><td style="text-align: left;"><strong>reckon_db</strong></td><td style="text-align: left;">Planned</td><td style="text-align: left;">Pure Erlang event store (rewrite of ex_esdb)</td></tr><tr><td style="text-align: left;"><strong>reckon_db_gater</strong></td><td style="text-align: left;">Planned</td><td style="text-align: left;">Gateway/proxy for reckon_db</td></tr><tr><td style="text-align: left;"><strong>reckon_db_commanded</strong></td><td style="text-align: left;">Planned</td><td style="text-align: left;">Commanded adapter (Elixir workloads)</td></tr></tbody></table><p><strong>Note:</strong> Platform Layer integration (v0.14.0) is blocked until reckon_db ecosystem is ready.</p><hr class="thin"/><h2 id="archived-documents" class="section-heading"><a href="#archived-documents" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Archived Documents</span></h2><p>Previous planning documents are preserved in <code class="inline">architecture/archive/planning-2025-11/</code>:</p><ul><li><code class="inline">ROADMAP.md</code> - Original 107KB roadmap</li><li><code class="inline">v0.8.0-ROADMAP.md</code> - v0.8.0 planning</li><li><code class="inline">v1.0.0-ROADMAP.md</code> - v1.0.0 planning</li><li><code class="inline">PLATFORM_VISION.md</code> - Platform vision document</li><li><code class="inline">v0.11.0-QUIC_DISTRIBUTION.md</code> - QUIC distribution vision</li><li>Others...</li></ul><hr class="thin"/><h2 id="references" class="section-heading"><a href="#references" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">References</span></h2><ul><li>Source code analysis: 102 <code class="inline">.erl</code> files, 52 test files</li><li>TODOs found: ~10 critical, ~20 minor</li><li>Test status: 44 passing (harness unstable)</li></ul><hr class="thin"/><p><strong>Document Version:</strong> 2.0 (Reality-based)
<strong>Author:</strong> Source code analysis, November 2025</p>

</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="index.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Architecture Index
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="v0-8-0-overview.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
v0.8.0 Overview
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/macula/0.12.4" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/macula/0.12.4">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/macula/0.12.4/show/architecture/ROADMAP.md">current file</a>)

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="macula.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.2) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
