<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.2">
    <meta name="project" content="macula v0.12.6">


    <title>Monitoring Guide — macula v0.12.6</title>

    <link rel="stylesheet" href="dist/html-erlang-DQDXQC7W.css" />

    <script defer src="dist/sidebar_items-969EFB48.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="overview.html" class="sidebar-projectImage">
          <img src="assets/logo.svg" alt="macula" />
        </a>

      <div>
        <a href="overview.html" class="sidebar-projectName" translate="no">
macula
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.12.6
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of macula</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>Macula Monitoring Guide</h1>


      <a href="https://github.com/macula-io/macula/blob/0.12.6/docs/operator/MONITORING_GUIDE.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


<p><strong>Complete guide to monitoring Macula mesh deployments</strong></p><p><strong>Audience</strong>: Operators
<strong>Last Updated</strong>: 2025-11-28</p><hr class="thin"/><h2 id="table-of-contents" class="section-heading"><a href="#table-of-contents" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Table of Contents</span></h2><ol><li><a href="#overview">Overview</a></li><li><a href="#key-metrics">Key Metrics</a></li><li><a href="#log-monitoring">Log Monitoring</a></li><li><a href="#health-checks">Health Checks</a></li><li><a href="#alerting">Alerting</a></li><li><a href="#dashboards">Dashboards</a></li><li><a href="#capacity-planning">Capacity Planning</a></li></ol><hr class="thin"/><h2 id="overview" class="section-heading"><a href="#overview" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Overview</span></h2><p>Macula provides several observable metrics and log messages for production monitoring. This guide covers what to monitor, how to interpret metrics, and when to alert.</p><h3 id="monitoring-philosophy" class="section-heading"><a href="#monitoring-philosophy" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Monitoring Philosophy</span></h3><pre><code class="makeup erlang" translate="no"><span class="w">                    </span><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">
                    </span><span class="err">│</span><span class="w">         </span><span class="n">Observability</span><span class="w"> </span><span class="n">Layers</span><span class="w">        </span><span class="err">│</span><span class="w">
                    </span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┘</span><span class="w">
                                      </span><span class="err">│</span><span class="w">
        </span><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┼</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">
        </span><span class="err">│</span><span class="w">                             </span><span class="err">│</span><span class="w">                             </span><span class="err">│</span><span class="w">
        </span><span class="err">▼</span><span class="w">                             </span><span class="err">▼</span><span class="w">                             </span><span class="err">▼</span><span class="w">
</span><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">           </span><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">           </span><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">
</span><span class="err">│</span><span class="w">    </span><span class="n">Metrics</span><span class="w">    </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w">      </span><span class="n">Logs</span><span class="w">       </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w">     </span><span class="n">Traces</span><span class="w">      </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="p" data-group-id="0127556215-1">(</span><span class="n">Numerical</span><span class="p" data-group-id="0127556215-1">)</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w">   </span><span class="p" data-group-id="0127556215-2">(</span><span class="n">Textual</span><span class="p" data-group-id="0127556215-2">)</span><span class="w">     </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="p" data-group-id="0127556215-3">(</span><span class="n">Distributed</span><span class="p" data-group-id="0127556215-3">)</span><span class="w">  </span><span class="err">│</span><span class="w">
</span><span class="err">├</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┤</span><span class="w">           </span><span class="err">├</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┤</span><span class="w">           </span><span class="err">├</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┤</span><span class="w">
</span><span class="err">│</span><span class="w"> </span><span class="err">•</span><span class="w"> </span><span class="n">Pool</span><span class="w"> </span><span class="ss">sizes</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w"> </span><span class="err">•</span><span class="w"> </span><span class="n">Cleanup</span><span class="w"> </span><span class="ss">events</span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w"> </span><span class="err">•</span><span class="w"> </span><span class="n">RPC</span><span class="w"> </span><span class="ss">call</span><span class="w"> </span><span class="ss">flow</span><span class="w"> </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w"> </span><span class="err">•</span><span class="w"> </span><span class="n">Latencies</span><span class="w">   </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w"> </span><span class="err">•</span><span class="w"> </span><span class="n">Rejections</span><span class="w">    </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w"> </span><span class="err">•</span><span class="w"> </span><span class="n">PubSub</span><span class="w"> </span><span class="ss">fanout</span><span class="w"> </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w"> </span><span class="err">•</span><span class="w"> </span><span class="n">Throughput</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w"> </span><span class="err">•</span><span class="w"> </span><span class="n">Errors</span><span class="o">/</span><span class="n">Warns</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w"> </span><span class="err">•</span><span class="w"> </span><span class="n">DHT</span><span class="w"> </span><span class="ss">queries</span><span class="w">   </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w"> </span><span class="err">•</span><span class="w"> </span><span class="n">Memory</span><span class="w">      </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w"> </span><span class="err">•</span><span class="w"> </span><span class="n">State</span><span class="w"> </span><span class="ss">changes</span><span class="w"> </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w">                 </span><span class="err">│</span><span class="w">
</span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┘</span><span class="w">           </span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┘</span><span class="w">           </span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┘</span></code></pre><hr class="thin"/><h2 id="key-metrics" class="section-heading"><a href="#key-metrics" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Key Metrics</span></h2><h3 id="memory-management-metrics" class="section-heading"><a href="#memory-management-metrics" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Memory Management Metrics</span></h3><p>These metrics indicate the health of Macula's bounded resource pools.</p><table><thead><tr><th style="text-align: left;">Metric</th><th style="text-align: left;">Module</th><th style="text-align: left;">Threshold</th><th style="text-align: left;">Action</th></tr></thead><tbody><tr><td style="text-align: left;">Connection Pool Size</td><td style="text-align: left;"><code class="inline">macula_gateway_mesh</code></td><td style="text-align: left;">&gt; 800 (of 1,000)</td><td style="text-align: left;">Scale horizontally</td></tr><tr><td style="text-align: left;">Client Count</td><td style="text-align: left;"><code class="inline">macula_gateway_client_manager</code></td><td style="text-align: left;">&gt; 8,000 (of 10,000)</td><td style="text-align: left;">Scale or rate-limit</td></tr><tr><td style="text-align: left;">Service Registry Size</td><td style="text-align: left;"><code class="inline">macula_service_registry</code></td><td style="text-align: left;">Increasing trend</td><td style="text-align: left;">Check for stale services</td></tr><tr><td style="text-align: left;">Pending RPC Calls</td><td style="text-align: left;"><code class="inline">macula_rpc_handler</code></td><td style="text-align: left;">&gt; 100 sustained</td><td style="text-align: left;">Check handler latency</td></tr><tr><td style="text-align: left;">Pending DHT Queries</td><td style="text-align: left;"><code class="inline">macula_rpc_handler</code></td><td style="text-align: left;">&gt; 50 sustained</td><td style="text-align: left;">Check DHT health</td></tr></tbody></table><h3 id="querying-metrics" class="section-heading"><a href="#querying-metrics" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Querying Metrics</span></h3><h4>Connection Pool (via Erlang shell)</h4><pre><code class="makeup erlang" translate="no"><span class="c1">%% Get connection pool stats</span><span class="w">
</span><span class="nc">macula_gateway_mesh</span><span class="p">:</span><span class="nf">get_stats</span><span class="p" data-group-id="1937716213-1">(</span><span class="p" data-group-id="1937716213-1">)</span><span class="p">.</span><span class="w">
</span><span class="c1">%% Returns: #{connections =&gt; 245, max =&gt; 1000, lru_evictions =&gt; 12}</span><span class="w">

</span><span class="c1">%% Check if pool is near capacity</span><span class="w">
</span><span class="k">case</span><span class="w"> </span><span class="nc">macula_gateway_mesh</span><span class="p">:</span><span class="nf">get_stats</span><span class="p" data-group-id="1937716213-2">(</span><span class="p" data-group-id="1937716213-2">)</span><span class="w"> </span><span class="k">of</span><span class="w">
    </span><span class="p" data-group-id="1937716213-3">#{</span><span class="ss">connections</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="ss">max</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="n">Max</span><span class="p" data-group-id="1937716213-3">}</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">Max</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.8</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
        </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1937716213-4">(</span><span class="s">&quot;WARNING: Pool at </span><span class="si">~p</span><span class="s">% capacity</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1937716213-5">[</span><span class="n">C</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="ow">div</span><span class="w"> </span><span class="n">Max</span><span class="p" data-group-id="1937716213-5">]</span><span class="p" data-group-id="1937716213-4">)</span><span class="p">;</span><span class="w">
    </span><span class="p">_</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
        </span><span class="ss">ok</span><span class="w">
</span><span class="k">end</span><span class="p">.</span></code></pre><h4>Client Count</h4><pre><code class="makeup erlang" translate="no"><span class="c1">%% Get client manager stats</span><span class="w">
</span><span class="nc">macula_gateway_client_manager</span><span class="p">:</span><span class="nf">get_stats</span><span class="p" data-group-id="8932633534-1">(</span><span class="p" data-group-id="8932633534-1">)</span><span class="p">.</span><span class="w">
</span><span class="c1">%% Returns: #{clients =&gt; 1234, max =&gt; 10000, streams =&gt; 3456}</span><span class="w">

</span><span class="c1">%% Check rejection rate (if tracked)</span><span class="w">
</span><span class="nc">macula_gateway_client_manager</span><span class="p">:</span><span class="nf">get_rejection_count</span><span class="p" data-group-id="8932633534-2">(</span><span class="p" data-group-id="8932633534-2">)</span><span class="p">.</span></code></pre><h4>Service Registry</h4><pre><code class="makeup erlang" translate="no"><span class="c1">%% Get service count</span><span class="w">
</span><span class="nc">macula_service_registry</span><span class="p">:</span><span class="nf">count_services</span><span class="p" data-group-id="6157430813-1">(</span><span class="p" data-group-id="6157430813-1">)</span><span class="p">.</span><span class="w">
</span><span class="c1">%% Returns: 45</span><span class="w">

</span><span class="c1">%% List all registered services (debug only)</span><span class="w">
</span><span class="nc">macula_service_registry</span><span class="p">:</span><span class="nf">list_services</span><span class="p" data-group-id="6157430813-2">(</span><span class="p" data-group-id="6157430813-2">)</span><span class="p">.</span></code></pre><h3 id="performance-metrics" class="section-heading"><a href="#performance-metrics" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Performance Metrics</span></h3><table><thead><tr><th style="text-align: left;">Metric</th><th style="text-align: left;">Target</th><th style="text-align: left;">Warning</th><th style="text-align: left;">Critical</th></tr></thead><tbody><tr><td style="text-align: left;">RPC Latency (p50)</td><td style="text-align: left;">&lt; 10ms</td><td style="text-align: left;">&gt; 50ms</td><td style="text-align: left;">&gt; 200ms</td></tr><tr><td style="text-align: left;">RPC Latency (p99)</td><td style="text-align: left;">&lt; 50ms</td><td style="text-align: left;">&gt; 200ms</td><td style="text-align: left;">&gt; 1000ms</td></tr><tr><td style="text-align: left;">PubSub Throughput</td><td style="text-align: left;">&gt; 1,000 msg/s</td><td style="text-align: left;">&lt; 500 msg/s</td><td style="text-align: left;">&lt; 100 msg/s</td></tr><tr><td style="text-align: left;">DHT Query Time</td><td style="text-align: left;">&lt; 100ms</td><td style="text-align: left;">&gt; 200ms</td><td style="text-align: left;">&gt; 500ms</td></tr><tr><td style="text-align: left;">Cache Hit Rate</td><td style="text-align: left;">&gt; 90%</td><td style="text-align: left;">&lt; 80%</td><td style="text-align: left;">&lt; 50%</td></tr></tbody></table><hr class="thin"/><h2 id="log-monitoring" class="section-heading"><a href="#log-monitoring" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Log Monitoring</span></h2><h3 id="log-levels" class="section-heading"><a href="#log-levels" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Log Levels</span></h3><p>Macula uses standard OTP log levels:</p><table><thead><tr><th style="text-align: left;">Level</th><th style="text-align: left;">Usage</th><th style="text-align: left;">Action Required</th></tr></thead><tbody><tr><td style="text-align: left;"><code class="inline">debug</code></td><td style="text-align: left;">Detailed operational info</td><td style="text-align: left;">None (high volume)</td></tr><tr><td style="text-align: left;"><code class="inline">info</code></td><td style="text-align: left;">Normal operations</td><td style="text-align: left;">None</td></tr><tr><td style="text-align: left;"><code class="inline">notice</code></td><td style="text-align: left;">Significant events</td><td style="text-align: left;">Review if unusual</td></tr><tr><td style="text-align: left;"><code class="inline">warning</code></td><td style="text-align: left;">Potential issues</td><td style="text-align: left;">Investigate</td></tr><tr><td style="text-align: left;"><code class="inline">error</code></td><td style="text-align: left;">Operation failures</td><td style="text-align: left;">Fix required</td></tr></tbody></table><h3 id="critical-log-patterns" class="section-heading"><a href="#critical-log-patterns" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Critical Log Patterns</span></h3><h4>Memory Management (Normal Operation)</h4><pre><code class="makeup erlang" translate="no"><span class="c1">%% Service cleanup - runs every 60 seconds</span><span class="w">
</span><span class="p" data-group-id="1562862087-1">[</span><span class="ss">info</span><span class="p" data-group-id="1562862087-1">]</span><span class="w"> </span><span class="n">Service</span><span class="w"> </span><span class="nc">cleanup</span><span class="p">:</span><span class="w"> </span><span class="ss">removed</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="ss">expired</span><span class="w"> </span><span class="nf">service</span><span class="p" data-group-id="1562862087-2">(</span><span class="ss">s</span><span class="p" data-group-id="1562862087-2">)</span><span class="w">
</span><span class="p" data-group-id="1562862087-3">[</span><span class="ss">debug</span><span class="p" data-group-id="1562862087-3">]</span><span class="w"> </span><span class="n">Service</span><span class="w"> </span><span class="nc">cleanup</span><span class="p">:</span><span class="w"> </span><span class="ss">no</span><span class="w"> </span><span class="ss">expired</span><span class="w"> </span><span class="ss">services</span><span class="w">

</span><span class="c1">%% Connection pool LRU eviction</span><span class="w">
</span><span class="p" data-group-id="1562862087-4">[</span><span class="ss">debug</span><span class="p" data-group-id="1562862087-4">]</span><span class="w"> </span><span class="n">Evicted</span><span class="w"> </span><span class="n">LRU</span><span class="w"> </span><span class="nc">connection</span><span class="p">:</span><span class="w"> </span><span class="n">NodeId</span><span class="o">=</span><span class="ss">abc123</span><span class="w">

</span><span class="c1">%% Stream cleanup on disconnect</span><span class="w">
</span><span class="p" data-group-id="1562862087-5">[</span><span class="ss">debug</span><span class="p" data-group-id="1562862087-5">]</span><span class="w"> </span><span class="n">Cleaned</span><span class="w"> </span><span class="ss">up</span><span class="w"> </span><span class="ss">streams</span><span class="w"> </span><span class="ss">for</span><span class="w"> </span><span class="ss">disconnected</span><span class="w"> </span><span class="nc">client</span><span class="p">:</span><span class="w"> </span><span class="n">NodeId</span><span class="o">=</span><span class="ss">xyz789</span></code></pre><h4>Warning Signs</h4><pre><code class="makeup erlang" translate="no"><span class="c1">%% Client rejection - monitor frequency</span><span class="w">
</span><span class="p" data-group-id="5303387757-1">[</span><span class="ss">warning</span><span class="p" data-group-id="5303387757-1">]</span><span class="w"> </span><span class="n">Client</span><span class="w"> </span><span class="ss">connection</span><span class="w"> </span><span class="nc">rejected</span><span class="p">:</span><span class="w"> </span><span class="ss">max_clients_reached</span><span class="w">

</span><span class="c1">%% RPC timeout</span><span class="w">
</span><span class="p" data-group-id="5303387757-2">[</span><span class="ss">warning</span><span class="p" data-group-id="5303387757-2">]</span><span class="w"> </span><span class="n">RPC</span><span class="w"> </span><span class="ss">call</span><span class="w"> </span><span class="ss">timed</span><span class="w"> </span><span class="nc">out</span><span class="p">:</span><span class="w"> </span><span class="n">Procedure</span><span class="o">=</span><span class="ss">energy</span><span class="p">.</span><span class="ss">home</span><span class="p">.</span><span class="nb">get</span><span class="p">,</span><span class="w"> </span><span class="n">CallId</span><span class="o">=</span><span class="ss">call</span><span class="o">-</span><span class="mi">123</span><span class="w">

</span><span class="c1">%% DHT query failure</span><span class="w">
</span><span class="p" data-group-id="5303387757-3">[</span><span class="ss">warning</span><span class="p" data-group-id="5303387757-3">]</span><span class="w"> </span><span class="n">DHT</span><span class="w"> </span><span class="k">query</span><span class="w"> </span><span class="nc">failed</span><span class="p">:</span><span class="w"> </span><span class="n">Key</span><span class="o">=</span><span class="ss">energy</span><span class="p">.</span><span class="ss">home</span><span class="p">.</span><span class="nb">get</span><span class="p">,</span><span class="w"> </span><span class="n">Reason</span><span class="o">=</span><span class="ss">timeout</span></code></pre><h4>Errors Requiring Action</h4><pre><code class="makeup erlang" translate="no"><span class="c1">%% Gateway crash</span><span class="w">
</span><span class="p" data-group-id="1452430175-1">[</span><span class="ss">error</span><span class="p" data-group-id="1452430175-1">]</span><span class="w"> </span><span class="n">Gateway</span><span class="w"> </span><span class="ss">process</span><span class="w"> </span><span class="nc">crashed</span><span class="p">:</span><span class="w"> </span><span class="n">Reason</span><span class="o">=</span><span class="p" data-group-id="1452430175-2">{</span><span class="ss">badmatch</span><span class="p">,</span><span class="w"> </span><span class="ss">undefined</span><span class="p" data-group-id="1452430175-2">}</span><span class="w">

</span><span class="c1">%% QUIC connection failure</span><span class="w">
</span><span class="p" data-group-id="1452430175-3">[</span><span class="ss">error</span><span class="p" data-group-id="1452430175-3">]</span><span class="w"> </span><span class="n">QUIC</span><span class="w"> </span><span class="ss">handshake</span><span class="w"> </span><span class="nc">failed</span><span class="p">:</span><span class="w"> </span><span class="n">Endpoint</span><span class="o">=</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.100</span><span class="p">:</span><span class="mi">4433</span><span class="p">,</span><span class="w"> </span><span class="n">Reason</span><span class="o">=</span><span class="ss">tls_alert</span><span class="w">

</span><span class="c1">%% Memory pressure</span><span class="w">
</span><span class="p" data-group-id="1452430175-4">[</span><span class="ss">error</span><span class="p" data-group-id="1452430175-4">]</span><span class="w"> </span><span class="n">Memory</span><span class="w"> </span><span class="ss">threshold</span><span class="w"> </span><span class="nc">exceeded</span><span class="p">:</span><span class="w"> </span><span class="n">Current</span><span class="o">=</span><span class="mi">85</span><span class="c1">%, Threshold=80%</span></code></pre><h3 id="log-aggregation-queries" class="section-heading"><a href="#log-aggregation-queries" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Log Aggregation Queries</span></h3><h4>Grafana Loki / Elasticsearch</h4><pre><code class="makeup erlang" translate="no"><span class="p">#</span><span class="w"> </span><span class="n">Client</span><span class="w"> </span><span class="ss">rejections</span><span class="w"> </span><span class="ss">in</span><span class="w"> </span><span class="ss">last</span><span class="w"> </span><span class="ss">hour</span><span class="w">
</span><span class="p" data-group-id="1403538380-1">{</span><span class="ss">app</span><span class="o">=</span><span class="s">&quot;macula&quot;</span><span class="p" data-group-id="1403538380-1">}</span><span class="w"> </span><span class="p">|</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;max_clients_reached&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">count_over_time</span><span class="p" data-group-id="1403538380-2">(</span><span class="p" data-group-id="1403538380-3">[</span><span class="mi">1</span><span class="ss">h</span><span class="p" data-group-id="1403538380-3">]</span><span class="p" data-group-id="1403538380-2">)</span><span class="w">

</span><span class="p">#</span><span class="w"> </span><span class="n">RPC</span><span class="w"> </span><span class="ss">timeouts</span><span class="w"> </span><span class="ss">by</span><span class="w"> </span><span class="ss">procedure</span><span class="w">
</span><span class="p" data-group-id="1403538380-4">{</span><span class="ss">app</span><span class="o">=</span><span class="s">&quot;macula&quot;</span><span class="p" data-group-id="1403538380-4">}</span><span class="w"> </span><span class="p">|</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;RPC call timed out&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="ss">regexp</span><span class="w"> </span><span class="s">&quot;Procedure=(?P&lt;proc&gt;[^,]+)&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">by</span><span class="w"> </span><span class="p" data-group-id="1403538380-5">(</span><span class="ss">proc</span><span class="p" data-group-id="1403538380-5">)</span><span class="w">

</span><span class="p">#</span><span class="w"> </span><span class="n">Service</span><span class="w"> </span><span class="ss">cleanup</span><span class="w"> </span><span class="ss">activity</span><span class="w">
</span><span class="p" data-group-id="1403538380-6">{</span><span class="ss">app</span><span class="o">=</span><span class="s">&quot;macula&quot;</span><span class="p" data-group-id="1403538380-6">}</span><span class="w"> </span><span class="p">|</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Service cleanup&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">rate</span><span class="p" data-group-id="1403538380-7">(</span><span class="p" data-group-id="1403538380-8">[</span><span class="mi">5</span><span class="ss">m</span><span class="p" data-group-id="1403538380-8">]</span><span class="p" data-group-id="1403538380-7">)</span></code></pre><hr class="thin"/><h2 id="health-checks" class="section-heading"><a href="#health-checks" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Health Checks</span></h2><h3 id="http-health-endpoint" class="section-heading"><a href="#http-health-endpoint" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">HTTP Health Endpoint</span></h3><p>If using <code class="inline">macula_gateway</code> with HTTP enabled:</p><pre><code class="makeup bash" translate="no"><span class=""># Basic health check
</span><span class="">curl http://localhost:4433/health
</span><span class="">
</span><span class=""># Detailed status
</span><span class="">curl http://localhost:4433/status
</span></code></pre><h3 id="erlang-health-functions" class="section-heading"><a href="#erlang-health-functions" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Erlang Health Functions</span></h3><pre><code class="makeup erlang" translate="no"><span class="c1">%% Check gateway is alive</span><span class="w">
</span><span class="nf">is_pid</span><span class="p" data-group-id="6208812529-1">(</span><span class="nf">whereis</span><span class="p" data-group-id="6208812529-2">(</span><span class="ss">macula_gateway</span><span class="p" data-group-id="6208812529-2">)</span><span class="p" data-group-id="6208812529-1">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Check all supervisors</span><span class="w">
</span><span class="p" data-group-id="6208812529-3">[</span><span class="p" data-group-id="6208812529-4">{</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="nf">is_pid</span><span class="p" data-group-id="6208812529-5">(</span><span class="nf">whereis</span><span class="p" data-group-id="6208812529-6">(</span><span class="n">Name</span><span class="p" data-group-id="6208812529-6">)</span><span class="p" data-group-id="6208812529-5">)</span><span class="p" data-group-id="6208812529-4">}</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6208812529-7">[</span><span class="w">
    </span><span class="ss">macula_sup</span><span class="p">,</span><span class="w">
    </span><span class="ss">macula_gateway_sup</span><span class="p">,</span><span class="w">
    </span><span class="ss">macula_connection_sup</span><span class="w">
</span><span class="p" data-group-id="6208812529-7">]</span><span class="p" data-group-id="6208812529-3">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Check DHT connectivity</span><span class="w">
</span><span class="nc">macula_dht</span><span class="p">:</span><span class="nf">ping</span><span class="p" data-group-id="6208812529-8">(</span><span class="p" data-group-id="6208812529-8">)</span><span class="p">.</span><span class="w">
</span><span class="c1">%% Returns: pong | {error, Reason}</span></code></pre><h3 id="kubernetes-probes" class="section-heading"><a href="#kubernetes-probes" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Kubernetes Probes</span></h3><pre><code class="yaml"># Liveness probe - is the process running?
livenessProbe:
  exec:
    command:
      - /opt/macula/bin/macula
      - eval
      - &quot;is_pid(whereis(macula_gateway)).&quot;
  initialDelaySeconds: 30
  periodSeconds: 10

# Readiness probe - is it accepting traffic?
readinessProbe:
  exec:
    command:
      - /opt/macula/bin/macula
      - eval
      - &quot;macula_gateway:is_ready().&quot;
  initialDelaySeconds: 10
  periodSeconds: 5</code></pre><hr class="thin"/><h2 id="alerting" class="section-heading"><a href="#alerting" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Alerting</span></h2><h3 id="alert-priority-matrix" class="section-heading"><a href="#alert-priority-matrix" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Alert Priority Matrix</span></h3><table><thead><tr><th style="text-align: left;">Severity</th><th style="text-align: left;">Response Time</th><th style="text-align: left;">Examples</th></tr></thead><tbody><tr><td style="text-align: left;">P1 (Critical)</td><td style="text-align: left;">&lt; 15 min</td><td style="text-align: left;">Gateway down, OOM, all clients disconnected</td></tr><tr><td style="text-align: left;">P2 (High)</td><td style="text-align: left;">&lt; 1 hour</td><td style="text-align: left;">80%+ capacity, sustained errors</td></tr><tr><td style="text-align: left;">P3 (Medium)</td><td style="text-align: left;">&lt; 4 hours</td><td style="text-align: left;">Elevated latency, cache miss rate</td></tr><tr><td style="text-align: left;">P4 (Low)</td><td style="text-align: left;">Next business day</td><td style="text-align: left;">Warnings, cleanup anomalies</td></tr></tbody></table><h3 id="recommended-alerts" class="section-heading"><a href="#recommended-alerts" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Recommended Alerts</span></h3><h4>Critical (P1)</h4><pre><code class="yaml">- alert: MaculaGatewayDown
  expr: up{job=&quot;macula&quot;} == 0
  for: 1m
  labels:
    severity: critical
  annotations:
    summary: &quot;Macula gateway is down&quot;

- alert: MaculaOOMRisk
  expr: process_resident_memory_bytes{job=&quot;macula&quot;} &gt; 8e9  # 8GB
  for: 5m
  labels:
    severity: critical
  annotations:
    summary: &quot;Macula memory exceeds 8GB - OOM risk&quot;</code></pre><h4>High (P2)</h4><pre><code class="yaml">- alert: MaculaClientPoolNearCapacity
  expr: macula_peers_current / macula_peers_max &gt; 0.8
  for: 10m
  labels:
    severity: high
  annotations:
    summary: &quot;Client pool at {{ $value | humanizePercentage }} capacity&quot;

- alert: MaculaHighRejectionRate
  expr: rate(macula_peer_rejections_total[5m]) &gt; 10
  for: 5m
  labels:
    severity: high
  annotations:
    summary: &quot;High client rejection rate: {{ $value }}/sec&quot;</code></pre><h4>Medium (P3)</h4><pre><code class="yaml">- alert: MaculaElevatedLatency
  expr: histogram_quantile(0.99, macula_rpc_latency_bucket) &gt; 0.5
  for: 15m
  labels:
    severity: medium
  annotations:
    summary: &quot;RPC p99 latency elevated: {{ $value }}s&quot;

- alert: MaculaLowCacheHitRate
  expr: macula_cache_hits / (macula_cache_hits + macula_cache_misses) &lt; 0.8
  for: 30m
  labels:
    severity: medium
  annotations:
    summary: &quot;Cache hit rate below 80%&quot;</code></pre><hr class="thin"/><h2 id="dashboards" class="section-heading"><a href="#dashboards" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Dashboards</span></h2><h3 id="essential-dashboard-panels" class="section-heading"><a href="#essential-dashboard-panels" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Essential Dashboard Panels</span></h3><h4>1. Resource Utilization</h4><pre><code class="makeup erlang" translate="no"><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="n">Connection</span><span class="w"> </span><span class="n">Pool</span><span class="w">        </span><span class="err">│</span><span class="w">  </span><span class="n">Client</span><span class="w"> </span><span class="n">Pool</span><span class="w">          </span><span class="err">│</span><span class="w">  </span><span class="n">Memory</span><span class="w">   </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">  </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="err">▓</span><span class="err">▓</span><span class="err">▓</span><span class="err">▓</span><span class="err">▓</span><span class="err">▓</span><span class="err">▓</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="err">▓</span><span class="err">▓</span><span class="err">▓</span><span class="err">▓</span><span class="err">▓</span><span class="err">▓</span><span class="err">▓</span><span class="err">▓</span><span class="err">▓</span><span class="err">▓</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="err">▓</span><span class="err">▓</span><span class="err">▓</span><span class="err">▓</span><span class="err">░</span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="mi">245</span><span class="o">/</span><span class="mi">1000</span><span class="w"> </span><span class="p" data-group-id="5602406417-1">(</span><span class="mi">24</span><span class="c1">%)   │  │  │ 6,234/10,000    │  │  │ 2.1G│  │</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┘</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┘</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┘</span><span class="w">  </span><span class="err">│</span><span class="w">
</span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┘</span></code></pre><h4>2. Throughput</h4><pre><code class="makeup erlang" translate="no"><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="n">RPC</span><span class="w"> </span><span class="n">Calls</span><span class="o">/</span><span class="ss">sec</span><span class="w">                                              </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="mi">2500</span><span class="w"> </span><span class="err">┤</span><span class="w">                    </span><span class="err">╭</span><span class="err">─</span><span class="err">╮</span><span class="w">                               </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="mi">2000</span><span class="w"> </span><span class="err">┤</span><span class="w">               </span><span class="err">╭</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">╯</span><span class="w"> </span><span class="err">╰</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">╮</span><span class="w">                          </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="mi">1500</span><span class="w"> </span><span class="err">┤</span><span class="w">          </span><span class="err">╭</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">╯</span><span class="w">           </span><span class="err">╰</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">╮</span><span class="w">                     </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="mi">1000</span><span class="w"> </span><span class="err">┤</span><span class="w">     </span><span class="err">╭</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">╯</span><span class="w">                     </span><span class="err">╰</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="w">                 </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">   </span><span class="mi">500</span><span class="w"> </span><span class="err">┼</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">╯</span><span class="w">                                                </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">       </span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┴</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┴</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┴</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┴</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┴</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┴</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┴</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┴</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="w">  </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">        </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">03</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">06</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">18</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">21</span><span class="p">:</span><span class="mi">00</span><span class="w">       </span><span class="err">│</span><span class="w">
</span><span class="err">├</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┤</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="n">PubSub</span><span class="w"> </span><span class="n">Events</span><span class="o">/</span><span class="ss">sec</span><span class="w">                                          </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="mi">5000</span><span class="w"> </span><span class="err">┤</span><span class="w">          </span><span class="err">╭</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">╮</span><span class="w">                          </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="mi">4000</span><span class="w"> </span><span class="err">┤</span><span class="w">     </span><span class="err">╭</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">╯</span><span class="w">                </span><span class="err">╰</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">╮</span><span class="w">                 </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="mi">3000</span><span class="w"> </span><span class="err">┤</span><span class="err">╭</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">╯</span><span class="w">                              </span><span class="err">╰</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="w">             </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="mi">2000</span><span class="w"> </span><span class="err">┼</span><span class="err">╯</span><span class="w">                                                     </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">       </span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┴</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┴</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┴</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┴</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┴</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┴</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┴</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┴</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="w">  </span><span class="err">│</span><span class="w">
</span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┘</span></code></pre><h4>3. Latency Distribution</h4><pre><code class="makeup erlang" translate="no"><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="n">RPC</span><span class="w"> </span><span class="n">Latency</span><span class="w"> </span><span class="p" data-group-id="8911184376-1">(</span><span class="ss">ms</span><span class="p" data-group-id="8911184376-1">)</span><span class="w">                                           </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">                                                             </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="nc">p50</span><span class="p">:</span><span class="w">  </span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="w">  </span><span class="mi">8</span><span class="ss">ms</span><span class="w">       </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="nc">p90</span><span class="p">:</span><span class="w">  </span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="w">  </span><span class="mi">25</span><span class="ss">ms</span><span class="w">      </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="nc">p99</span><span class="p">:</span><span class="w">  </span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="err">░</span><span class="w">  </span><span class="mi">45</span><span class="ss">ms</span><span class="w">      </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="nc">max</span><span class="p">:</span><span class="w">  </span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="err">█</span><span class="w">  </span><span class="mi">120</span><span class="ss">ms</span><span class="w">     </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">                                                             </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">        </span><span class="mi">0</span><span class="w">    </span><span class="mi">25</span><span class="w">    </span><span class="mi">50</span><span class="w">    </span><span class="mi">75</span><span class="w">    </span><span class="mi">100</span><span class="w">   </span><span class="mi">125</span><span class="w">   </span><span class="mi">150</span><span class="w">              </span><span class="err">│</span><span class="w">
</span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┘</span></code></pre><h3 id="grafana-dashboard-json" class="section-heading"><a href="#grafana-dashboard-json" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Grafana Dashboard JSON</span></h3><p>A basic dashboard template:</p><pre><code class="json">{
  &quot;title&quot;: &quot;Macula Overview&quot;,
  &quot;panels&quot;: [
    {
      &quot;title&quot;: &quot;Client Pool Utilization&quot;,
      &quot;type&quot;: &quot;gauge&quot;,
      &quot;targets&quot;: [{&quot;expr&quot;: &quot;macula_peers_current / macula_peers_max * 100&quot;}],
      &quot;fieldConfig&quot;: {
        &quot;defaults&quot;: {
          &quot;thresholds&quot;: {
            &quot;steps&quot;: [
              {&quot;color&quot;: &quot;green&quot;, &quot;value&quot;: 0},
              {&quot;color&quot;: &quot;yellow&quot;, &quot;value&quot;: 70},
              {&quot;color&quot;: &quot;red&quot;, &quot;value&quot;: 90}
            ]
          }
        }
      }
    },
    {
      &quot;title&quot;: &quot;RPC Throughput&quot;,
      &quot;type&quot;: &quot;graph&quot;,
      &quot;targets&quot;: [{&quot;expr&quot;: &quot;rate(macula_rpc_calls_total[5m])&quot;}]
    },
    {
      &quot;title&quot;: &quot;Memory Usage&quot;,
      &quot;type&quot;: &quot;graph&quot;,
      &quot;targets&quot;: [{&quot;expr&quot;: &quot;process_resident_memory_bytes{job=\&quot;macula\&quot;}&quot;}]
    }
  ]
}</code></pre><hr class="thin"/><h2 id="capacity-planning" class="section-heading"><a href="#capacity-planning" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Capacity Planning</span></h2><h3 id="resource-sizing" class="section-heading"><a href="#resource-sizing" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Resource Sizing</span></h3><table><thead><tr><th style="text-align: left;">Deployment Size</th><th style="text-align: left;">Clients</th><th style="text-align: left;">Memory</th><th style="text-align: left;">CPU</th><th style="text-align: left;">Notes</th></tr></thead><tbody><tr><td style="text-align: left;">Small (Dev)</td><td style="text-align: left;">&lt; 100</td><td style="text-align: left;">512MB</td><td style="text-align: left;">1 core</td><td style="text-align: left;">Single node</td></tr><tr><td style="text-align: left;">Medium</td><td style="text-align: left;">100-1,000</td><td style="text-align: left;">2GB</td><td style="text-align: left;">2 cores</td><td style="text-align: left;">Typical production</td></tr><tr><td style="text-align: left;">Large</td><td style="text-align: left;">1,000-10,000</td><td style="text-align: left;">8GB</td><td style="text-align: left;">4 cores</td><td style="text-align: left;">High availability</td></tr><tr><td style="text-align: left;">XL</td><td style="text-align: left;">10,000+</td><td style="text-align: left;">16GB+</td><td style="text-align: left;">8+ cores</td><td style="text-align: left;">Multi-gateway</td></tr></tbody></table><h3 id="scaling-triggers" class="section-heading"><a href="#scaling-triggers" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Scaling Triggers</span></h3><table><thead><tr><th style="text-align: left;">Metric</th><th style="text-align: left;">Threshold</th><th style="text-align: left;">Action</th></tr></thead><tbody><tr><td style="text-align: left;">Client pool</td><td style="text-align: left;">&gt; 80% for 1 hour</td><td style="text-align: left;">Add gateway node</td></tr><tr><td style="text-align: left;">Memory</td><td style="text-align: left;">&gt; 70% sustained</td><td style="text-align: left;">Increase memory or add node</td></tr><tr><td style="text-align: left;">CPU</td><td style="text-align: left;">&gt; 80% sustained</td><td style="text-align: left;">Add CPU or optimize handlers</td></tr><tr><td style="text-align: left;">RPC latency p99</td><td style="text-align: left;">&gt; 200ms sustained</td><td style="text-align: left;">Profile handlers, check DHT</td></tr><tr><td style="text-align: left;">Connection churn</td><td style="text-align: left;">&gt; 1000/min</td><td style="text-align: left;">Check client stability</td></tr></tbody></table><h3 id="horizontal-scaling" class="section-heading"><a href="#horizontal-scaling" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Horizontal Scaling</span></h3><p>Macula supports horizontal scaling via multiple gateway nodes:</p><pre><code class="makeup erlang" translate="no"><span class="w">                    </span><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">
                    </span><span class="err">│</span><span class="w">  </span><span class="n">Load</span><span class="w"> </span><span class="n">Balancer</span><span class="w">  </span><span class="err">│</span><span class="w">
                    </span><span class="err">│</span><span class="w">  </span><span class="p" data-group-id="8046727779-1">(</span><span class="n">DNS</span><span class="o">/</span><span class="n">HAProxy</span><span class="p" data-group-id="8046727779-1">)</span><span class="w">  </span><span class="err">│</span><span class="w">
                    </span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┬</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┘</span><span class="w">
                             </span><span class="err">│</span><span class="w">
        </span><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┼</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">
        </span><span class="err">│</span><span class="w">                    </span><span class="err">│</span><span class="w">                    </span><span class="err">│</span><span class="w">
        </span><span class="err">▼</span><span class="w">                    </span><span class="err">▼</span><span class="w">                    </span><span class="err">▼</span><span class="w">
</span><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">    </span><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">    </span><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">
</span><span class="err">│</span><span class="w">   </span><span class="n">Gateway</span><span class="w"> </span><span class="mi">1</span><span class="w">   </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="n">Gateway</span><span class="w"> </span><span class="mi">2</span><span class="w">   </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="n">Gateway</span><span class="w"> </span><span class="mi">3</span><span class="w">   </span><span class="err">│</span><span class="w">
</span><span class="err">│</span><span class="w">  </span><span class="mi">10</span><span class="ss">k</span><span class="w"> </span><span class="ss">clients</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">  </span><span class="mi">10</span><span class="ss">k</span><span class="w"> </span><span class="ss">clients</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">  </span><span class="mi">10</span><span class="ss">k</span><span class="w"> </span><span class="ss">clients</span><span class="w">  </span><span class="err">│</span><span class="w">
</span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┬</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┘</span><span class="w">    </span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┬</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┘</span><span class="w">    </span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┬</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┘</span><span class="w">
        </span><span class="err">│</span><span class="w">                    </span><span class="err">│</span><span class="w">                    </span><span class="err">│</span><span class="w">
        </span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┼</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┘</span><span class="w">
                             </span><span class="err">│</span><span class="w">
                    </span><span class="err">┌</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">▼</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┐</span><span class="w">
                    </span><span class="err">│</span><span class="w">   </span><span class="n">DHT</span><span class="w"> </span><span class="n">Network</span><span class="w">   </span><span class="err">│</span><span class="w">
                    </span><span class="err">│</span><span class="w">  </span><span class="p" data-group-id="8046727779-2">(</span><span class="n">Shared</span><span class="w"> </span><span class="n">State</span><span class="p" data-group-id="8046727779-2">)</span><span class="w"> </span><span class="err">│</span><span class="w">
                    </span><span class="err">└</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">─</span><span class="err">┘</span></code></pre><p>Each gateway operates independently with shared DHT for service discovery.</p><hr class="thin"/><h2 id="see-also" class="section-heading"><a href="#see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See Also</span></h2><ul><li><a href="performance_guide.html">Performance Guide</a> - Optimization techniques</li><li><a href="troubleshooting_guide.html">Troubleshooting Guide</a> - Common issues</li></ul>

</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="performance_guide.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Performance Guide
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="troubleshooting_guide.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Troubleshooting
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/macula/0.12.6" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/macula/0.12.6">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/macula/0.12.6/show/docs/operator/MONITORING_GUIDE.md">current file</a>)

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="macula.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.2) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
