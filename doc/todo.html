<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.2">
    <meta name="project" content="macula v0.12.6">


    <title>Known Issues — macula v0.12.6</title>

    <link rel="stylesheet" href="dist/html-erlang-DQDXQC7W.css" />

    <script defer src="dist/sidebar_items-969EFB48.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="overview.html" class="sidebar-projectImage">
          <img src="assets/logo.svg" alt="macula" />
        </a>

      <div>
        <a href="overview.html" class="sidebar-projectName" translate="no">
macula
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.12.6
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of macula</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>Macula TODO List</h1>


      <a href="https://github.com/macula-io/macula/blob/0.12.6/TODO.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


<blockquote><p><strong>Last Updated:</strong> 2025-11-28
<strong>Current Version:</strong> v0.10.1
<strong>Status:</strong> Prioritized based on source code analysis</p></blockquote><p>This document tracks known limitations and planned improvements, organized by priority.</p><hr class="thin"/><h2 id="critical-documentation-vs-reality-gaps" class="section-heading"><a href="#critical-documentation-vs-reality-gaps" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Critical: Documentation vs Reality Gaps</span></h2><p>These items represent features that are <strong>documented as working</strong> but are <strong>incomplete or single-node only</strong>:</p><table><thead><tr><th style="text-align: left;">Issue</th><th style="text-align: left;">Claimed</th><th style="text-align: left;">Actual</th><th style="text-align: left;">Priority</th></tr></thead><tbody><tr><td style="text-align: left;">Platform Layer</td><td style="text-align: left;">Distributed Raft</td><td style="text-align: left;">Single-node only</td><td style="text-align: left;"><strong>P0</strong></td></tr><tr><td style="text-align: left;">CRDTs</td><td style="text-align: left;">Replicated state</td><td style="text-align: left;">Local ETS only</td><td style="text-align: left;"><strong>P0</strong></td></tr><tr><td style="text-align: left;">TLS Verification</td><td style="text-align: left;">Secure transport</td><td style="text-align: left;"><code class="inline">{verify, none}</code></td><td style="text-align: left;"><strong>P0</strong></td></tr></tbody></table><hr class="thin"/><h2 id="v0-11-0-security-hardening" class="section-heading"><a href="#v0-11-0-security-hardening" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">v0.11.0 - Security Hardening</span></h2><blockquote><p><strong>Priority:</strong> TLS verification is more urgent than Platform Layer distribution.
The current Platform Layer works for demos; insecure TLS does not work for anything.</p></blockquote><h3 id="p0-tls-certificate-verification" class="section-heading"><a href="#p0-tls-certificate-verification" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">P0: TLS Certificate Verification</span></h3><p><strong>Locations:</strong></p><ul><li><code class="inline">src/macula_connection.erl:115</code> - <code class="inline">{verify, none}</code></li><li><code class="inline">src/macula_connection_pool.erl:88</code> - <code class="inline">{verify, none}</code></li><li><code class="inline">src/macula_dist_system/macula_dist.erl:381</code> - <code class="inline">{verify, none}</code></li></ul><p><strong>Problem:</strong> All TLS connections accept any certificate, vulnerable to MITM attacks.</p><p><strong>Required Changes:</strong></p><ul><li>[ ] Add CA bundle configuration option</li><li>[ ] Implement certificate chain verification</li><li>[ ] Add hostname verification</li><li>[ ] Provide self-signed cert generation for development</li><li>[ ] Document TLS configuration in operator guide</li></ul><p><strong>Files Affected:</strong></p><ul><li><code class="inline">src/macula_connection.erl</code></li><li><code class="inline">src/macula_connection_pool.erl</code></li><li><code class="inline">src/macula_peer_system/macula_peer_connector.erl</code></li><li><code class="inline">config/sys.config</code> (add TLS options)</li></ul><p><strong>Acceptance Criteria:</strong></p><ul><li>Production connections reject invalid certificates</li><li>Development mode allows self-signed with explicit opt-in</li><li>Expired certificates are rejected</li></ul><hr class="thin"/><h3 id="p1-realm-authentication" class="section-heading"><a href="#p1-realm-authentication" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">P1: Realm Authentication</span></h3><p><strong>Problem:</strong> Realms provide isolation but no authentication.</p><p><strong>Required Changes:</strong></p><ul><li>[ ] Add API key validation for realm access</li><li>[ ] Rate limiting per realm</li><li>[ ] Audit logging for authentication events</li></ul><p><strong>Acceptance Criteria:</strong></p><ul><li>Clients must provide valid API key to join realm</li><li>Failed auth attempts are logged</li><li>Rate limits prevent brute force</li></ul><hr class="thin"/><h2 id="v0-12-0-dht-improvements" class="section-heading"><a href="#v0-12-0-dht-improvements" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">v0.12.0 - DHT Improvements</span></h2><h3 id="p1-dht-request-response-pattern" class="section-heading"><a href="#p1-dht-request-response-pattern" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">P1: DHT Request/Response Pattern</span></h3><p><strong>Location:</strong> <code class="inline">src/macula_gateway_system/macula_gateway_dht.erl</code></p><p><strong>Current Behavior:</strong> Fire-and-forget DHT operations</p><p><strong>Required Changes:</strong></p><ul><li>[ ] Add correlation IDs to DHT queries</li><li>[ ] Implement timeout and retry logic</li><li>[ ] Add response tracking for observability</li></ul><hr class="thin"/><h3 id="p1-k-bucket-splitting" class="section-heading"><a href="#p1-k-bucket-splitting" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">P1: K-Bucket Splitting</span></h3><p><strong>Location:</strong> <code class="inline">src/macula_routing_system/macula_routing_table.erl</code></p><p><strong>Current Behavior:</strong> Buckets have max capacity but don't split</p><p><strong>Required Changes:</strong></p><ul><li>[ ] Implement bucket splitting when full</li><li>[ ] Maintain routing table invariants</li><li>[ ] Add routing table health metrics</li></ul><hr class="thin"/><h2 id="v0-13-0-nat-traversal-optional" class="section-heading"><a href="#v0-13-0-nat-traversal-optional" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">v0.13.0 - NAT Traversal (Optional)</span></h2><blockquote><p><strong>Note:</strong> Only implement if targeting edge deployment. Gateway relay works for cloud deployments.</p></blockquote><h3 id="p3-complete-nat-detection" class="section-heading"><a href="#p3-complete-nat-detection" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">P3: Complete NAT Detection</span></h3><p><strong>Location:</strong> <code class="inline">src/macula_peer_system/macula_nat_detector.erl</code></p><p><strong>Current:</strong> TODO stubs for NAT_PROBE message handling</p><p><strong>Required Changes:</strong></p><ul><li>[ ] Implement NAT_PROBE message handling</li><li>[ ] Detect NAT type (EI, HD, PP, PC, RD)</li><li>[ ] Cache NAT type per connection</li></ul><hr class="thin"/><h3 id="p3-stun-turn-support" class="section-heading"><a href="#p3-stun-turn-support" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">P3: STUN/TURN Support</span></h3><p><strong>Required Changes:</strong></p><ul><li>[ ] Add STUN client for address discovery</li><li>[ ] Integrate TURN relay as fallback</li><li>[ ] Hole punch coordination protocol</li></ul><p><strong>Acceptance Criteria:</strong></p><ul><li>80%+ success rate for EI/PP NAT types</li><li>Automatic fallback to relay for restrictive NAT</li></ul><hr class="thin"/><h2 id="v1-1-0-quic-distribution-deferred" class="section-heading"><a href="#v1-1-0-quic-distribution-deferred" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">v1.1.0+ - QUIC Distribution (Deferred)</span></h2><blockquote><p><strong>Note:</strong> This is a BEAM ecosystem contribution, not core Macula functionality. Only pursue after v1.0.0 is proven in production.</p></blockquote><p><strong>Location:</strong> <code class="inline">src/macula_dist_system/macula_dist.erl</code> (606 LOC, 31 tests passing)</p><p><strong>Current State:</strong> Standalone module, not integrated with mesh</p><p><strong>Why Defer:</strong></p><ol><li>Macula mesh works fine over HTTP/3 without this</li><li>Requires TLS verification to be complete first (v0.11.0)</li><li>Integration with Ra cluster requires multi-node Platform Layer (v0.14.0)</li><li>Better to contribute after proving the core works</li></ol><p><strong>When Ready:</strong></p><ul><li>[ ] Integrate with existing Macula discovery</li><li>[ ] Add libcluster strategy</li><li>[ ] Test with Horde, Mnesia, :pg</li><li>[ ] Publish as separate hex package</li><li>[ ] Submit to OTP for consideration</li></ul><hr class="thin"/><h2 id="low-priority-code-cleanup" class="section-heading"><a href="#low-priority-code-cleanup" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Low Priority: Code Cleanup</span></h2><h3 id="stub-todos-to-remove" class="section-heading"><a href="#stub-todos-to-remove" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Stub TODOs to Remove</span></h3><table><thead><tr><th style="text-align: left;">Location</th><th style="text-align: left;">Issue</th><th style="text-align: left;">Priority</th></tr></thead><tbody><tr><td style="text-align: left;"><code class="inline">macula_pubsub_qos.erl</code></td><td style="text-align: left;">Placeholder TODO comments</td><td style="text-align: left;">Low</td></tr><tr><td style="text-align: left;"><code class="inline">macula_pubsub_subscription.erl</code></td><td style="text-align: left;">Placeholder TODO comments</td><td style="text-align: left;">Low</td></tr><tr><td style="text-align: left;"><code class="inline">macula_rpc_handler.erl</code></td><td style="text-align: left;">Phase 6 refactoring notes</td><td style="text-align: left;">Low</td></tr></tbody></table><hr class="thin"/><h2 id="testing-debt" class="section-heading"><a href="#testing-debt" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Testing Debt</span></h2><table><thead><tr><th style="text-align: left;">Area</th><th style="text-align: left;">Current</th><th style="text-align: left;">Target</th></tr></thead><tbody><tr><td style="text-align: left;">Unit tests</td><td style="text-align: left;">44 passing (harness unstable)</td><td style="text-align: left;">100+ stable</td></tr><tr><td style="text-align: left;">Integration tests</td><td style="text-align: left;">Minimal</td><td style="text-align: left;">Multi-node scenarios</td></tr><tr><td style="text-align: left;">E2E tests</td><td style="text-align: left;">None</td><td style="text-align: left;">Full workflow tests</td></tr></tbody></table><p><strong>Known Issue:</strong> Test harness is unstable - tests sometimes get cancelled unexpectedly.</p><hr class="thin"/><h2 id="references" class="section-heading"><a href="#references" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">References</span></h2><ul><li><strong>Roadmap:</strong> <code class="inline">architecture/ROADMAP.md</code></li><li><strong>Source Analysis:</strong> 102 <code class="inline">.erl</code> files, 52 test files examined</li><li><strong>TODOs Found:</strong> ~10 critical, ~20 minor</li></ul><hr class="thin"/><h2 id="contributing" class="section-heading"><a href="#contributing" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Contributing</span></h2><p>When adding TODOs to code:</p><ol><li>Add entry to this document with priority level</li><li>Link to GitHub issue if exists</li><li>Specify target version</li><li>Include acceptance criteria</li></ol><hr class="thin"/><p><strong>Document Version:</strong> 2.0 (Reality-based)
<strong>Last Analysis:</strong> November 2025</p>

</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="roadmap.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Roadmap
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

  </div>
</div>
    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/macula/0.12.6" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/macula/0.12.6">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/macula/0.12.6/show/TODO.md">current file</a>)

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="macula.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.2) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
