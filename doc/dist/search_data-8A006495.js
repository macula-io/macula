searchData={"items":[{"type":"module","doc":"Advertisement manager GenServer - manages DHT service advertisements. Responsibilities: - Advertise services in DHT with periodic re-advertisement - Unadvertise services and cancel timers - Register handlers with local gateway - Manage service advertisement lifecycle - Periodic cleanup of expired local services (every 60s, TTL 300s default) Extracted from macula_connection.erl (Phase 6)","title":"macula_advertisement_manager","ref":"macula_advertisement_manager.html"},{"type":"function","doc":"Advertise a service in DHT and local registry","title":"macula_advertisement_manager.advertise_service/4","ref":"macula_advertisement_manager.html#advertise_service/4"},{"type":"function","doc":"Get list of actively advertised services","title":"macula_advertisement_manager.get_active_advertisements/1","ref":"macula_advertisement_manager.html#get_active_advertisements/1"},{"type":"function","doc":"","title":"macula_advertisement_manager.handle_call/3","ref":"macula_advertisement_manager.html#handle_call/3"},{"type":"function","doc":"","title":"macula_advertisement_manager.handle_cast/2","ref":"macula_advertisement_manager.html#handle_cast/2"},{"type":"function","doc":"Handle re-advertisement timer","title":"macula_advertisement_manager.handle_info/2","ref":"macula_advertisement_manager.html#handle_info/2"},{"type":"function","doc":"","title":"macula_advertisement_manager.init/1","ref":"macula_advertisement_manager.html#init/1"},{"type":"function","doc":"","title":"macula_advertisement_manager.start_link/1","ref":"macula_advertisement_manager.html#start_link/1"},{"type":"function","doc":"","title":"macula_advertisement_manager.terminate/2","ref":"macula_advertisement_manager.html#terminate/2"},{"type":"function","doc":"Stop advertising a service","title":"macula_advertisement_manager.unadvertise_service/2","ref":"macula_advertisement_manager.html#unadvertise_service/2"},{"type":"module","doc":"macula public API","title":"macula_app","ref":"macula_app.html"},{"type":"function","doc":"","title":"macula_app.start/2","ref":"macula_app.html#start/2"},{"type":"function","doc":"","title":"macula_app.stop/1","ref":"macula_app.html#stop/1"},{"type":"module","doc":"Bootstrap Health Monitor - Tracks system health metrics. Monitors: - Service registry size - DHT query rate - System uptime - Memory usage","title":"macula_bootstrap_health","ref":"macula_bootstrap_health.html"},{"type":"function","doc":"","title":"macula_bootstrap_health.code_change/3","ref":"macula_bootstrap_health.html#code_change/3"},{"type":"function","doc":"Get current health status","title":"macula_bootstrap_health.get_health/0","ref":"macula_bootstrap_health.html#get_health/0"},{"type":"function","doc":"","title":"macula_bootstrap_health.handle_call/3","ref":"macula_bootstrap_health.html#handle_call/3"},{"type":"function","doc":"","title":"macula_bootstrap_health.handle_cast/2","ref":"macula_bootstrap_health.html#handle_cast/2"},{"type":"function","doc":"","title":"macula_bootstrap_health.handle_info/2","ref":"macula_bootstrap_health.html#handle_info/2"},{"type":"function","doc":"","title":"macula_bootstrap_health.init/1","ref":"macula_bootstrap_health.html#init/1"},{"type":"function","doc":"Check if system is healthy","title":"macula_bootstrap_health.is_healthy/0","ref":"macula_bootstrap_health.html#is_healthy/0"},{"type":"function","doc":"","title":"macula_bootstrap_health.start_link/1","ref":"macula_bootstrap_health.html#start_link/1"},{"type":"function","doc":"","title":"macula_bootstrap_health.terminate/2","ref":"macula_bootstrap_health.html#terminate/2"},{"type":"module","doc":"Bootstrap Registry - Thin wrapper around macula_routing_server DHT. Delegates all storage/lookup operations to the DHT routing server. Bootstrap nodes use the DHT's built-in key-value storage for: 1. RPC Services - Advertised RPC endpoints 2. Pub/Sub Topics - Topic subscriptions The DHT routing_server handles storage, TTL, and cleanup internally.","title":"macula_bootstrap_registry","ref":"macula_bootstrap_registry.html"},{"type":"function","doc":"","title":"macula_bootstrap_registry.code_change/3","ref":"macula_bootstrap_registry.html#code_change/3"},{"type":"function","doc":"","title":"macula_bootstrap_registry.handle_call/3","ref":"macula_bootstrap_registry.html#handle_call/3"},{"type":"function","doc":"","title":"macula_bootstrap_registry.handle_cast/2","ref":"macula_bootstrap_registry.html#handle_cast/2"},{"type":"function","doc":"","title":"macula_bootstrap_registry.handle_info/2","ref":"macula_bootstrap_registry.html#handle_info/2"},{"type":"function","doc":"","title":"macula_bootstrap_registry.init/1","ref":"macula_bootstrap_registry.html#init/1"},{"type":"function","doc":"Generic lookup (delegates to DHT)","title":"macula_bootstrap_registry.lookup/1","ref":"macula_bootstrap_registry.html#lookup/1"},{"type":"function","doc":"Lookup RPC service by key (delegates to DHT)","title":"macula_bootstrap_registry.lookup_service/1","ref":"macula_bootstrap_registry.html#lookup_service/1"},{"type":"function","doc":"Lookup subscribers for a topic (delegates to DHT)","title":"macula_bootstrap_registry.lookup_topic/1","ref":"macula_bootstrap_registry.html#lookup_topic/1"},{"type":"function","doc":"","title":"macula_bootstrap_registry.start_link/1","ref":"macula_bootstrap_registry.html#start_link/1"},{"type":"function","doc":"Generic store (delegates to DHT)","title":"macula_bootstrap_registry.store/2","ref":"macula_bootstrap_registry.html#store/2"},{"type":"function","doc":"Store RPC service registration (delegates to DHT)","title":"macula_bootstrap_registry.store_service/2","ref":"macula_bootstrap_registry.html#store_service/2"},{"type":"function","doc":"Store pub/sub topic subscription (delegates to DHT)","title":"macula_bootstrap_registry.store_topic/2","ref":"macula_bootstrap_registry.html#store_topic/2"},{"type":"function","doc":"","title":"macula_bootstrap_registry.terminate/2","ref":"macula_bootstrap_registry.html#terminate/2"},{"type":"module","doc":"Bootstrap Server - Main GenServer for bootstrap node operations. Handles: - DHT queries (FIND_NODE, FIND_VALUE, STORE) - Peer registration and discovery - Statistics tracking","title":"macula_bootstrap_server","ref":"macula_bootstrap_server.html"},{"type":"function","doc":"","title":"macula_bootstrap_server.code_change/3","ref":"macula_bootstrap_server.html#code_change/3"},{"type":"function","doc":"Get bootstrap server statistics","title":"macula_bootstrap_server.get_stats/0","ref":"macula_bootstrap_server.html#get_stats/0"},{"type":"function","doc":"","title":"macula_bootstrap_server.handle_call/3","ref":"macula_bootstrap_server.html#handle_call/3"},{"type":"function","doc":"","title":"macula_bootstrap_server.handle_cast/2","ref":"macula_bootstrap_server.html#handle_cast/2"},{"type":"function","doc":"Handle DHT query from remote peer","title":"macula_bootstrap_server.handle_dht_query/2","ref":"macula_bootstrap_server.html#handle_dht_query/2"},{"type":"function","doc":"","title":"macula_bootstrap_server.handle_info/2","ref":"macula_bootstrap_server.html#handle_info/2"},{"type":"function","doc":"","title":"macula_bootstrap_server.init/1","ref":"macula_bootstrap_server.html#init/1"},{"type":"function","doc":"","title":"macula_bootstrap_server.start_link/1","ref":"macula_bootstrap_server.html#start_link/1"},{"type":"function","doc":"","title":"macula_bootstrap_server.terminate/2","ref":"macula_bootstrap_server.html#terminate/2"},{"type":"module","doc":"Macula Bootstrap System - Supervision tree for bootstrap nodes. Bootstrap nodes provide: - DHT bootstrap and peer discovery - Service registry (advertised RPC endpoints) - Health monitoring Bootstrap nodes do NOT: - Relay messages (that's macula_relay_system) - Bridge realms (that's macula_bridge_system)","title":"macula_bootstrap_system","ref":"macula_bootstrap_system.html"},{"type":"function","doc":"Get bootstrap server PID","title":"macula_bootstrap_system.get_server_pid/0","ref":"macula_bootstrap_system.html#get_server_pid/0"},{"type":"function","doc":"Get bootstrap system statistics","title":"macula_bootstrap_system.get_stats/0","ref":"macula_bootstrap_system.html#get_stats/0"},{"type":"function","doc":"","title":"macula_bootstrap_system.init/1","ref":"macula_bootstrap_system.html#init/1"},{"type":"function","doc":"Start bootstrap system supervisor","title":"macula_bootstrap_system.start_link/1","ref":"macula_bootstrap_system.html#start_link/1"},{"type":"module","doc":"Generic LRU cache implementation. Provides least-recently-used eviction with configurable max size.","title":"macula_cache","ref":"macula_cache.html"},{"type":"type","doc":"","title":"macula_cache.cache/0","ref":"macula_cache.html#t:cache/0"},{"type":"function","doc":"Clear all entries.","title":"macula_cache.clear/1","ref":"macula_cache.html#clear/1"},{"type":"type","doc":"","title":"macula_cache.entry/0","ref":"macula_cache.html#t:entry/0"},{"type":"function","doc":"Get entry from cache. Returns {ok, Value, UpdatedCache} or not_found. The updated cache has the entry moved to front (LRU).","title":"macula_cache.get/2","ref":"macula_cache.html#get/2"},{"type":"type","doc":"","title":"macula_cache.key/0","ref":"macula_cache.html#t:key/0"},{"type":"function","doc":"Get all keys in cache (most recent first).","title":"macula_cache.keys/1","ref":"macula_cache.html#keys/1"},{"type":"function","doc":"Get max size.","title":"macula_cache.max_size/1","ref":"macula_cache.html#max_size/1"},{"type":"function","doc":"Create new cache with max size.","title":"macula_cache.new/1","ref":"macula_cache.html#new/1"},{"type":"function","doc":"Put entry in cache with current timestamp.","title":"macula_cache.put/3","ref":"macula_cache.html#put/3"},{"type":"function","doc":"Put entry in cache with custom timestamp (for testing).","title":"macula_cache.put/4","ref":"macula_cache.html#put/4"},{"type":"function","doc":"Remove entry from cache.","title":"macula_cache.remove/2","ref":"macula_cache.html#remove/2"},{"type":"function","doc":"Get number of entries.","title":"macula_cache.size/1","ref":"macula_cache.html#size/1"},{"type":"type","doc":"","title":"macula_cache.timestamp/0","ref":"macula_cache.html#t:timestamp/0"},{"type":"type","doc":"","title":"macula_cache.value/0","ref":"macula_cache.html#t:value/0"},{"type":"module","doc":"Macula SDK - Main API module for HTTP/3 mesh client operations. This module provides the primary interface for applications to connect to Macula mesh networks and perform pub/sub and RPC operations over HTTP/3 (QUIC) transport. Quick Start Connect to a mesh, publish events, subscribe to topics, and make RPC calls. See individual function documentation for detailed examples with code. DHT Network Bootstrap (v0.8.7+) Macula v0.8.7+ implements platform-level DHT bootstrapping. Each macula node automatically joins the configured DHT network on startup via the  MACULA_BOOTSTRAP_PEERS` environment variable. <b>Platform Configuration (Recommended):</b> ``` # Bootstrap node (no peers configured) MACULA_BOOTSTRAP_PEERS= # empty - this IS a bootstrap peer # Other nodes (connect to bootstrap) MACULA_BOOTSTRAP_PEERS=https://bootstrap-node:4433 '' Client SDK Usage:  Applications connect to their LOCAL macula instance, which is already part of the DHT network: <span class=\"w\">   </span><span class=\"p\" data-group-id=\"6299190371-1\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Client</span><span class=\"p\" data-group-id=\"6299190371-1\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">connect</span><span class=\"p\" data-group-id=\"6299190371-2\">(</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;https://localhost:4433&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"6299190371-3\">#{</span><span class=\"w\">\n       </span><span class=\"ss\">realm</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;my.app&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"6299190371-3\">}</span><span class=\"p\" data-group-id=\"6299190371-2\">)</span><span class=\"p\">.</span> The platform handles DHT network formation - applications don't need to manage bootstrap peer URLs.","title":"macula_client","ref":"macula_client.html"},{"type":"function","doc":"Advertise a service that this client provides. Registers a handler function for the specified procedure and advertises it to the DHT so other clients can discover and call it. The handler function receives a map of arguments and must return  {ok, Result}  or  {error, Reason} . Options ttl  - Advertisement TTL in seconds (default: 300) metadata  - Custom metadata map (default: #{}) Examples <span class=\"w\">  </span><span class=\"c1\">%% Define a handler function</span><span class=\"w\">\n  </span><span class=\"n\">Handler</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">fun</span><span class=\"p\" data-group-id=\"1908810701-1\">(</span><span class=\"p\" data-group-id=\"1908810701-2\">#{</span><span class=\"ss\">user_id</span><span class=\"w\"> </span><span class=\"p\">:=</span><span class=\"w\"> </span><span class=\"n\">UserId</span><span class=\"p\" data-group-id=\"1908810701-2\">}</span><span class=\"p\" data-group-id=\"1908810701-1\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\">\n      </span><span class=\"p\" data-group-id=\"1908810701-3\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"1908810701-4\">#{</span><span class=\"ss\">user_id</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">UserId</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">name</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;Alice&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\" data-group-id=\"1908810701-4\">}</span><span class=\"p\" data-group-id=\"1908810701-3\">}</span><span class=\"w\">\n  </span><span class=\"k\">end</span><span class=\"p\">.</span><span class=\"w\">\n \n  </span><span class=\"c1\">%% Advertise the service</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"1908810701-5\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Ref</span><span class=\"p\" data-group-id=\"1908810701-5\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">advertise</span><span class=\"p\" data-group-id=\"1908810701-6\">(</span><span class=\"w\">\n      </span><span class=\"n\">Client</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;my.app.get_user&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"n\">Handler</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"1908810701-6\">)</span><span class=\"p\">.</span><span class=\"w\">\n \n  </span><span class=\"c1\">%% Other clients can now call:</span><span class=\"w\">\n  </span><span class=\"c1\">%% {ok, User} = macula_client:call(OtherClient, &amp;lt;&amp;lt;&quot;my.app.get_user&quot;&amp;gt;&amp;gt;,</span><span class=\"w\">\n  </span><span class=\"c1\">%%     #{user_id =&gt; &amp;lt;&amp;lt;&quot;user-123&quot;&amp;gt;&amp;gt;}).</span>","title":"macula_client.advertise/3","ref":"macula_client.html#advertise/3"},{"type":"function","doc":"Advertise a service with options.","title":"macula_client.advertise/4","ref":"macula_client.html#advertise/4"},{"type":"type","doc":"Arguments for RPC calls.","title":"macula_client.args/0","ref":"macula_client.html#t:args/0"},{"type":"function","doc":"Make a synchronous RPC call. Calls a remote procedure and waits for the result. Examples <span class=\"w\">  </span><span class=\"c1\">%% Simple RPC call</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"1549398383-1\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">User</span><span class=\"p\" data-group-id=\"1549398383-1\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">call</span><span class=\"p\" data-group-id=\"1549398383-2\">(</span><span class=\"n\">Client</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;my.app.get_user&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"1549398383-3\">#{</span><span class=\"w\">\n      </span><span class=\"ss\">user_id</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;user-123&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"1549398383-3\">}</span><span class=\"p\" data-group-id=\"1549398383-2\">)</span><span class=\"p\">.</span><span class=\"w\">\n \n  </span><span class=\"c1\">%% With timeout</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"1549398383-4\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Result</span><span class=\"p\" data-group-id=\"1549398383-4\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">call</span><span class=\"p\" data-group-id=\"1549398383-5\">(</span><span class=\"n\">Client</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;my.app.process&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"p\" data-group-id=\"1549398383-6\">#{</span><span class=\"ss\">data</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;large&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\" data-group-id=\"1549398383-6\">}</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"p\" data-group-id=\"1549398383-7\">#{</span><span class=\"ss\">timeout</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">30000</span><span class=\"p\" data-group-id=\"1549398383-7\">}</span><span class=\"p\" data-group-id=\"1549398383-5\">)</span><span class=\"p\">.</span>","title":"macula_client.call/3","ref":"macula_client.html#call/3"},{"type":"function","doc":"Make an RPC call with options.","title":"macula_client.call/4","ref":"macula_client.html#call/4"},{"type":"type","doc":"Reference to a connected Macula mesh client.","title":"macula_client.client/0","ref":"macula_client.html#t:client/0"},{"type":"function","doc":"Connect to a Macula mesh network. Creates a new HTTP/3 (QUIC) connection to the specified mesh endpoint. Options realm  - Required. Binary realm identifier (e.g.,  &lt;&lt;\"my.app.realm\"&gt;&gt; ) auth  - Optional. Authentication map with  api_key  or other auth methods timeout  - Optional. Connection timeout in milliseconds (default: 5000) node_id  - Optional. 32-byte node ID (generated if not provided) Examples <span class=\"w\">  </span><span class=\"c1\">%% Basic connection</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"9533370460-1\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Client</span><span class=\"p\" data-group-id=\"9533370460-1\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">connect</span><span class=\"p\" data-group-id=\"9533370460-2\">(</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;https://mesh.local:443&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9533370460-3\">#{</span><span class=\"w\">\n      </span><span class=\"ss\">realm</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;my.realm&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"9533370460-3\">}</span><span class=\"p\" data-group-id=\"9533370460-2\">)</span><span class=\"p\">.</span><span class=\"w\">\n \n  </span><span class=\"c1\">%% With API key authentication</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"9533370460-4\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Client</span><span class=\"p\" data-group-id=\"9533370460-4\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">connect</span><span class=\"p\" data-group-id=\"9533370460-5\">(</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;https://mesh.local:443&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9533370460-6\">#{</span><span class=\"w\">\n      </span><span class=\"ss\">realm</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;my.realm&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"ss\">auth</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9533370460-7\">#{</span><span class=\"ss\">api_key</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;secret-key&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\" data-group-id=\"9533370460-7\">}</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"9533370460-6\">}</span><span class=\"p\" data-group-id=\"9533370460-5\">)</span><span class=\"p\">.</span>","title":"macula_client.connect/2","ref":"macula_client.html#connect/2"},{"type":"function","doc":"Disconnect from the Macula mesh. Cleanly closes the HTTP/3 connection and cleans up all subscriptions.","title":"macula_client.disconnect/1","ref":"macula_client.html#disconnect/1"},{"type":"function","doc":"Discover subscribers to a topic via DHT query. Queries the DHT for all nodes subscribed to the given topic. Returns a list of subscriber nodes with their node IDs and endpoints. This is used for P2P discovery before sending direct messages.","title":"macula_client.discover_subscribers/2","ref":"macula_client.html#discover_subscribers/2"},{"type":"type","doc":"Event payload data. Typically a map that will be JSON-encoded.","title":"macula_client.event_data/0","ref":"macula_client.html#t:event_data/0"},{"type":"function","doc":"Get the node ID of this client. Returns the 32-byte node ID assigned to this client.","title":"macula_client.get_node_id/1","ref":"macula_client.html#get_node_id/1"},{"type":"type","doc":"Connection or operation options.","title":"macula_client.options/0","ref":"macula_client.html#t:options/0"},{"type":"type","doc":"RPC procedure name. Example:  \"my.app.get_user\" .","title":"macula_client.procedure/0","ref":"macula_client.html#t:procedure/0"},{"type":"function","doc":"Publish an event to a topic. Publishes data to the specified topic. All subscribers to this topic will receive the event. Topic Design Topics should describe EVENT TYPES, not entity instances: Good:  &lt;&lt;\"my.app.user.registered\"&gt;&gt;  (event type) Bad:  &lt;&lt;\"my.app.user.123.registered\"&gt;&gt;  (entity ID in topic) Entity IDs belong in the event payload, not the topic name. Examples <span class=\"w\">  </span><span class=\"c1\">%% Publish with default options</span><span class=\"w\">\n  </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">publish</span><span class=\"p\" data-group-id=\"9204772876-1\">(</span><span class=\"n\">Client</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;my.app.events&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9204772876-2\">#{</span><span class=\"w\">\n      </span><span class=\"ss\">type</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;user.registered&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"ss\">user_id</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;user-123&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"ss\">email</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;user@example.com&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"9204772876-2\">}</span><span class=\"p\" data-group-id=\"9204772876-1\">)</span><span class=\"p\">.</span><span class=\"w\">\n \n  </span><span class=\"c1\">%% Publish with options</span><span class=\"w\">\n  </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">publish</span><span class=\"p\" data-group-id=\"9204772876-3\">(</span><span class=\"n\">Client</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;my.app.events&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9204772876-4\">#{</span><span class=\"w\">\n      </span><span class=\"ss\">data</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;important&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"9204772876-4\">}</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9204772876-5\">#{</span><span class=\"ss\">acknowledge</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"ss\">true</span><span class=\"p\" data-group-id=\"9204772876-5\">}</span><span class=\"p\" data-group-id=\"9204772876-3\">)</span><span class=\"p\">.</span>","title":"macula_client.publish/3","ref":"macula_client.html#publish/3"},{"type":"function","doc":"Publish an event with options.","title":"macula_client.publish/4","ref":"macula_client.html#publish/4"},{"type":"function","doc":"Subscribe to a topic. Subscribes to events on the specified topic. The callback function will be invoked for each event received. Callback Function The callback receives the event data and should return  ok . Examples <span class=\"w\">  </span><span class=\"c1\">%% Simple subscription</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"9986309771-1\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">SubRef</span><span class=\"p\" data-group-id=\"9986309771-1\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">subscribe</span><span class=\"p\" data-group-id=\"9986309771-2\">(</span><span class=\"n\">Client</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;my.app.events&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nf\">fun</span><span class=\"p\" data-group-id=\"9986309771-3\">(</span><span class=\"n\">EventData</span><span class=\"p\" data-group-id=\"9986309771-3\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\">\n          </span><span class=\"nc\">io</span><span class=\"p\">:</span><span class=\"nf\">format</span><span class=\"p\" data-group-id=\"9986309771-4\">(</span><span class=\"s\">&quot;Event: </span><span class=\"si\">~p</span><span class=\"si\">~n</span><span class=\"s\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9986309771-5\">[</span><span class=\"n\">EventData</span><span class=\"p\" data-group-id=\"9986309771-5\">]</span><span class=\"p\" data-group-id=\"9986309771-4\">)</span><span class=\"p\">,</span><span class=\"w\">\n          </span><span class=\"ss\">ok</span><span class=\"w\">\n      </span><span class=\"k\">end</span><span class=\"p\" data-group-id=\"9986309771-2\">)</span><span class=\"p\">.</span><span class=\"w\">\n \n  </span><span class=\"c1\">%% Unsubscribe later</span><span class=\"w\">\n  </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">unsubscribe</span><span class=\"p\" data-group-id=\"9986309771-6\">(</span><span class=\"n\">Client</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">SubRef</span><span class=\"p\" data-group-id=\"9986309771-6\">)</span><span class=\"p\">.</span>","title":"macula_client.subscribe/3","ref":"macula_client.html#subscribe/3"},{"type":"type","doc":"Reference to an active subscription for unsubscribe operations.","title":"macula_client.subscription_ref/0","ref":"macula_client.html#t:subscription_ref/0"},{"type":"type","doc":"Topic name for pub/sub operations. Topics should describe event types, not entity IDs. Example:  \"my.app.user.registered\"  (good), not  \"my.app.user.123.registered\"  (bad - ID belongs in payload).","title":"macula_client.topic/0","ref":"macula_client.html#t:topic/0"},{"type":"function","doc":"Stop advertising a service. Removes the local handler and stops advertising to the DHT. Examples <span class=\"w\">  </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">unadvertise</span><span class=\"p\" data-group-id=\"7838863188-1\">(</span><span class=\"n\">Client</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;my.app.get_user&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\" data-group-id=\"7838863188-1\">)</span><span class=\"p\">.</span>","title":"macula_client.unadvertise/2","ref":"macula_client.html#unadvertise/2"},{"type":"function","doc":"Unsubscribe from a topic. Removes the subscription identified by the subscription reference.","title":"macula_client.unsubscribe/2","ref":"macula_client.html#unsubscribe/2"},{"type":"module","doc":"Macula Connection - QUIC Transport Layer (v0.7.0+). This module manages the low-level QUIC connection lifecycle and message transport for mesh participants. Responsibilities: - Establish and maintain QUIC connection - Send messages via QUIC stream - Receive and route incoming messages to handlers - Handle connection errors and reconnection - Message encoding/decoding and buffering Renamed from macula_connection in v0.7.0 for clarity: - macula_connection = QUIC transport (this module - low-level) - macula_peer = mesh participant (high-level API)","title":"macula_connection","ref":"macula_connection.html"},{"type":"function","doc":"Decode all complete messages from buffer.","title":"macula_connection.decode_messages/2","ref":"macula_connection.html#decode_messages/2"},{"type":"function","doc":"","title":"macula_connection.default_config/0","ref":"macula_connection.html#default_config/0"},{"type":"function","doc":"","title":"macula_connection.get_status/1","ref":"macula_connection.html#get_status/1"},{"type":"function","doc":"","title":"macula_connection.handle_call/3","ref":"macula_connection.html#handle_call/3"},{"type":"function","doc":"","title":"macula_connection.handle_cast/2","ref":"macula_connection.html#handle_cast/2"},{"type":"function","doc":"","title":"macula_connection.handle_info/2","ref":"macula_connection.html#handle_info/2"},{"type":"function","doc":"","title":"macula_connection.init/1","ref":"macula_connection.html#init/1"},{"type":"function","doc":"","title":"macula_connection.send_message/3","ref":"macula_connection.html#send_message/3"},{"type":"function","doc":"Start keep-alive timer if enabled in options.","title":"macula_connection.start_keepalive_timer/1","ref":"macula_connection.html#start_keepalive_timer/1"},{"type":"function","doc":"","title":"macula_connection.start_link/2","ref":"macula_connection.html#start_link/2"},{"type":"function","doc":"","title":"macula_connection.terminate/2","ref":"macula_connection.html#terminate/2"},{"type":"module","doc":"Connection pool manager for endpoint connections. Manages a pool of QUIC connections to remote endpoints, providing connection caching and reuse to avoid connection overhead for multi-endpoint RPC operations. Connection pool structure: #{Endpoint => #{connection => Conn, stream => Stream, last_used => Timestamp}}","title":"macula_connection_pool","ref":"macula_connection_pool.html"},{"type":"function","doc":"Close all connections in the pool.","title":"macula_connection_pool.close_all_connections/1","ref":"macula_connection_pool.html#close_all_connections/1"},{"type":"function","doc":"Create a new connection to an endpoint.","title":"macula_connection_pool.create_connection/4","ref":"macula_connection_pool.html#create_connection/4"},{"type":"function","doc":"Get or create a connection to an endpoint. Returns {ok, Conn, Stream, UpdatedPool} or {error, Reason, Pool}.","title":"macula_connection_pool.get_or_create_connection/4","ref":"macula_connection_pool.html#get_or_create_connection/4"},{"type":"module","doc":"Core type definitions and encoding/decoding for Macula. Provides fundamental types like node IDs, realm IDs, and addresses.","title":"macula_core_types","ref":"macula_core_types.html"},{"type":"type","doc":"","title":"macula_core_types.address/0","ref":"macula_core_types.html#t:address/0"},{"type":"function","doc":"Decode binary address format to {IP, Port} tuple.","title":"macula_core_types.decode_address/1","ref":"macula_core_types.html#decode_address/1"},{"type":"function","doc":"Encode an IP address and port to binary format. Format: - 1 byte: IP version (4 or 6) - 4 or 16 bytes: IP address - 2 bytes: port (big-endian)","title":"macula_core_types.encode_address/1","ref":"macula_core_types.html#encode_address/1"},{"type":"type","doc":"","title":"macula_core_types.ip_address/0","ref":"macula_core_types.html#t:ip_address/0"},{"type":"type","doc":"32-byte unique node identifier","title":"macula_core_types.node_id/0","ref":"macula_core_types.html#t:node_id/0"},{"type":"function","doc":"Generate a unique node ID. Uses cryptographically strong random bytes for uniqueness.","title":"macula_core_types.node_id/0","ref":"macula_core_types.html#node_id/0"},{"type":"type","doc":"","title":"macula_core_types.port_number/0","ref":"macula_core_types.html#t:port_number/0"},{"type":"type","doc":"32-byte realm identifier","title":"macula_core_types.realm_id/0","ref":"macula_core_types.html#t:realm_id/0"},{"type":"function","doc":"Generate a deterministic realm ID from a realm name. Same name always produces the same ID (uses SHA-256 hash).","title":"macula_core_types.realm_id/1","ref":"macula_core_types.html#realm_id/1"},{"type":"module","doc":"DHT RPC client for querying remote nodes. Provides callback functions for macula_routing_dht algorithms.","title":"macula_dht_rpc","ref":"macula_dht_rpc.html"},{"type":"function","doc":"Create a query_fn callback for DHT algorithms.","title":"macula_dht_rpc.make_query_fn/0","ref":"macula_dht_rpc.html#make_query_fn/0"},{"type":"function","doc":"Create a store_fn callback for DHT algorithms.","title":"macula_dht_rpc.make_store_fn/0","ref":"macula_dht_rpc.html#make_store_fn/0"},{"type":"function","doc":"Query remote node for closest nodes to target. Returns {ok, [NodeInfo]} or {error, Reason}.","title":"macula_dht_rpc.query_find_node/2","ref":"macula_dht_rpc.html#query_find_node/2"},{"type":"function","doc":"Query remote node for value by key. Returns {value, Value} if found, {nodes, [NodeInfo]} if not found, or {error, Reason}.","title":"macula_dht_rpc.query_find_value/2","ref":"macula_dht_rpc.html#query_find_value/2"},{"type":"function","doc":"Store key-value pair on remote node. Returns ok or {error, Reason}.","title":"macula_dht_rpc.query_store/3","ref":"macula_dht_rpc.html#query_store/3"},{"type":"module","doc":"Generic DHT-based service discovery. Provides cache-integrated lookup and announcement operations. Used by both pub/sub and RPC discovery layers.","title":"macula_discovery","ref":"macula_discovery.html"},{"type":"function","doc":"Announce value to DHT.","title":"macula_discovery.announce/2","ref":"macula_discovery.html#announce/2"},{"type":"function","doc":"Filter items by age based on last_seen timestamp and TTL. Items must have #{last_seen := integer()} in their structure.","title":"macula_discovery.filter_by_age/3","ref":"macula_discovery.html#filter_by_age/3"},{"type":"function","doc":"Find values for a key via DHT lookup.","title":"macula_discovery.find/2","ref":"macula_discovery.html#find/2"},{"type":"function","doc":"Find values with cache (default TTL: 300 seconds).","title":"macula_discovery.find_with_cache/3","ref":"macula_discovery.html#find_with_cache/3"},{"type":"function","doc":"Find values with cache and custom TTL.","title":"macula_discovery.find_with_cache/4","ref":"macula_discovery.html#find_with_cache/4"},{"type":"type","doc":"","title":"macula_discovery.key/0","ref":"macula_discovery.html#t:key/0"},{"type":"type","doc":"","title":"macula_discovery.lookup_fun/0","ref":"macula_discovery.html#t:lookup_fun/0"},{"type":"type","doc":"","title":"macula_discovery.publish_fun/0","ref":"macula_discovery.html#t:publish_fun/0"},{"type":"function","doc":"Remove value from DHT.","title":"macula_discovery.unannounce/2","ref":"macula_discovery.html#unannounce/2"},{"type":"type","doc":"","title":"macula_discovery.unpublish_fun/0","ref":"macula_discovery.html#t:unpublish_fun/0"},{"type":"type","doc":"","title":"macula_discovery.value/0","ref":"macula_discovery.html#t:value/0"},{"type":"module","doc":"Macula Gateway - HTTP/3 Message Router & Orchestrator Main API module and coordinator for the Macula Gateway. The gateway can be embedded in applications or run standalone as a relay node. Quick Start (Embedded Gateway) <span class=\"w\">   </span><span class=\"c1\">%% Start an embedded gateway</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"8233400586-1\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Gateway</span><span class=\"p\" data-group-id=\"8233400586-1\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_gateway</span><span class=\"p\">:</span><span class=\"nf\">start_link</span><span class=\"p\" data-group-id=\"8233400586-2\">(</span><span class=\"p\" data-group-id=\"8233400586-3\">[</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"8233400586-4\">{</span><span class=\"ss\">port</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">9443</span><span class=\"p\" data-group-id=\"8233400586-4\">}</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"8233400586-5\">{</span><span class=\"ss\">realm</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"8233400586-6\">&lt;&lt;</span><span class=\"s\">&quot;com.example.realm&quot;</span><span class=\"p\" data-group-id=\"8233400586-6\">&gt;&gt;</span><span class=\"p\" data-group-id=\"8233400586-5\">}</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"8233400586-7\">{</span><span class=\"ss\">cert_file</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;cert.pem&quot;</span><span class=\"p\" data-group-id=\"8233400586-7\">}</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"8233400586-8\">{</span><span class=\"ss\">key_file</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;key.pem&quot;</span><span class=\"p\" data-group-id=\"8233400586-8\">}</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"8233400586-3\">]</span><span class=\"p\" data-group-id=\"8233400586-2\">)</span><span class=\"p\">.</span><span class=\"w\">\n  \n   </span><span class=\"c1\">%% Register an RPC handler</span><span class=\"w\">\n   </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_gateway</span><span class=\"p\">:</span><span class=\"nf\">register_handler</span><span class=\"p\" data-group-id=\"8233400586-9\">(</span><span class=\"n\">Gateway</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"8233400586-10\">&lt;&lt;</span><span class=\"s\">&quot;calculator.add&quot;</span><span class=\"p\" data-group-id=\"8233400586-10\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nf\">fun</span><span class=\"p\" data-group-id=\"8233400586-11\">(</span><span class=\"n\">Args</span><span class=\"p\" data-group-id=\"8233400586-11\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\">\n       </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">maps</span><span class=\"p\">:</span><span class=\"nf\">get</span><span class=\"p\" data-group-id=\"8233400586-12\">(</span><span class=\"ss\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Args</span><span class=\"p\" data-group-id=\"8233400586-12\">)</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">maps</span><span class=\"p\">:</span><span class=\"nf\">get</span><span class=\"p\" data-group-id=\"8233400586-13\">(</span><span class=\"ss\">b</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Args</span><span class=\"p\" data-group-id=\"8233400586-13\">)</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"8233400586-14\">#{</span><span class=\"ss\">result</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"p\" data-group-id=\"8233400586-14\">}</span><span class=\"w\">\n   </span><span class=\"k\">end</span><span class=\"p\" data-group-id=\"8233400586-9\">)</span><span class=\"p\">.</span> Quick Start (Standalone Gateway) Configure  sys.config : <span class=\"w\">   </span><span class=\"p\" data-group-id=\"9702021471-1\">[</span><span class=\"w\">\n     </span><span class=\"p\" data-group-id=\"9702021471-2\">{</span><span class=\"ss\">macula</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9702021471-3\">[</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"9702021471-4\">{</span><span class=\"ss\">gateway_port</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">9443</span><span class=\"p\" data-group-id=\"9702021471-4\">}</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"9702021471-5\">{</span><span class=\"ss\">gateway_realm</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9702021471-6\">&lt;&lt;</span><span class=\"s\">&quot;com.example.realm&quot;</span><span class=\"p\" data-group-id=\"9702021471-6\">&gt;&gt;</span><span class=\"p\" data-group-id=\"9702021471-5\">}</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"9702021471-7\">{</span><span class=\"ss\">cert_file</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;/path/to/cert.pem&quot;</span><span class=\"p\" data-group-id=\"9702021471-7\">}</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"9702021471-8\">{</span><span class=\"ss\">key_file</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;/path/to/key.pem&quot;</span><span class=\"p\" data-group-id=\"9702021471-8\">}</span><span class=\"w\">\n     </span><span class=\"p\" data-group-id=\"9702021471-3\">]</span><span class=\"p\" data-group-id=\"9702021471-2\">}</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"9702021471-1\">]</span><span class=\"p\">.</span> Start application: <span class=\"w\">   </span><span class=\"nc\">application</span><span class=\"p\">:</span><span class=\"nf\">start</span><span class=\"p\" data-group-id=\"9065172951-1\">(</span><span class=\"ss\">macula</span><span class=\"p\" data-group-id=\"9065172951-1\">)</span><span class=\"p\">.</span> Architecture (Modular Design - Refactored Jan 2025) Gateway (this module): - QUIC Listener Management - Message Decoding & Routing - Supervisor Coordination - API Facade Child Modules (managed via macula_gateway_sup): -  macula_gateway_client_manager : Client lifecycle management -  macula_gateway_pubsub : Pub/Sub message routing with wildcards -  macula_gateway_rpc : RPC handler registration & invocation -  macula_gateway_mesh : Mesh connection pooling Stateless Delegation Modules: -  macula_gateway_dht : DHT query forwarding to routing server -  macula_gateway_rpc_router : Multi-hop RPC routing via DHT Single Responsibility Principle: Each module has one clear purpose and delegates to specialized child modules. Gateway acts as orchestrator, not implementer.","title":"macula_gateway","ref":"macula_gateway.html"},{"type":"function","doc":"Get gateway statistics.","title":"macula_gateway.get_stats/1","ref":"macula_gateway.html#get_stats/1"},{"type":"function","doc":"","title":"macula_gateway.handle_call/3","ref":"macula_gateway.html#handle_call/3"},{"type":"function","doc":"Handle rpc_route message forwarded from connection","title":"macula_gateway.handle_cast/2","ref":"macula_gateway.html#handle_cast/2"},{"type":"function","doc":"Wire gateway to siblings after init completes. This avoids initialization deadlock from calling supervisor:which_children/1 during init/1 before supervisor has finished starting all children.","title":"macula_gateway.handle_continue/2","ref":"macula_gateway.html#handle_continue/2"},{"type":"function","doc":"","title":"macula_gateway.handle_info/2","ref":"macula_gateway.html#handle_info/2"},{"type":"function","doc":"","title":"macula_gateway.init/1","ref":"macula_gateway.html#init/1"},{"type":"function","doc":"Register a handler for a procedure.","title":"macula_gateway.register_handler/2","ref":"macula_gateway.html#register_handler/2"},{"type":"function","doc":"Start the gateway with default options.","title":"macula_gateway.start_link/0","ref":"macula_gateway.html#start_link/0"},{"type":"function","doc":"Start the gateway with custom options. Options: {port, Port} - Listen port (default: 9443) {realm, Realm} - Default realm (default: \"macula.default\")","title":"macula_gateway.start_link/1","ref":"macula_gateway.html#start_link/1"},{"type":"function","doc":"Stop the gateway.","title":"macula_gateway.stop/1","ref":"macula_gateway.html#stop/1"},{"type":"function","doc":"","title":"macula_gateway.terminate/2","ref":"macula_gateway.html#terminate/2"},{"type":"function","doc":"Unregister a handler for a procedure.","title":"macula_gateway.unregister_handler/1","ref":"macula_gateway.html#unregister_handler/1"},{"type":"module","doc":"Clients Worker GenServer - tracks connected clients. Responsibilities: - Track connected clients with metadata (BOUNDED POOL) - Enforce max_clients limit with backpressure - Monitor client processes for automatic cleanup - Store bidirectional streams for client communication - Provide client query APIs Pattern: Bounded client pool with backpressure - Tracks clients with max_clients limit (default: 10,000) - Rejects new clients when pool is full (backpressure) - Allows updates to existing clients even when pool is full Configuration: - max_clients: Maximum concurrent clients (default: 10,000) Extracted from macula_gateway.erl (Phase 2) Renamed from macula_gateway_client_manager (Phase 2 QUIC refactoring)","title":"macula_gateway_clients","ref":"macula_gateway_clients.html"},{"type":"function","doc":"Register a connected client with metadata. Monitors the client process for automatic cleanup on death.","title":"macula_gateway_clients.client_connected/3","ref":"macula_gateway_clients.html#client_connected/3"},{"type":"function","doc":"Unregister a disconnected client.","title":"macula_gateway_clients.client_disconnected/2","ref":"macula_gateway_clients.html#client_disconnected/2"},{"type":"type","doc":"","title":"macula_gateway_clients.client_info/0","ref":"macula_gateway_clients.html#t:client_info/0"},{"type":"function","doc":"Get all connected clients.","title":"macula_gateway_clients.get_all_clients/1","ref":"macula_gateway_clients.html#get_all_clients/1"},{"type":"function","doc":"Get all node IDs with stored client streams (for debugging).","title":"macula_gateway_clients.get_all_node_ids/1","ref":"macula_gateway_clients.html#get_all_node_ids/1"},{"type":"function","doc":"Get information about a specific client.","title":"macula_gateway_clients.get_client_info/2","ref":"macula_gateway_clients.html#get_client_info/2"},{"type":"function","doc":"Get the stored stream for a client node.","title":"macula_gateway_clients.get_client_stream/2","ref":"macula_gateway_clients.html#get_client_stream/2"},{"type":"function","doc":"Get the stream PID for a given endpoint URL. Used for routing pub/sub messages to remote subscribers.","title":"macula_gateway_clients.get_stream_by_endpoint/2","ref":"macula_gateway_clients.html#get_stream_by_endpoint/2"},{"type":"function","doc":"","title":"macula_gateway_clients.handle_call/3","ref":"macula_gateway_clients.html#handle_call/3"},{"type":"function","doc":"","title":"macula_gateway_clients.handle_cast/2","ref":"macula_gateway_clients.html#handle_cast/2"},{"type":"function","doc":"Handle client process death - automatic cleanup.","title":"macula_gateway_clients.handle_info/2","ref":"macula_gateway_clients.html#handle_info/2"},{"type":"function","doc":"","title":"macula_gateway_clients.init/1","ref":"macula_gateway_clients.html#init/1"},{"type":"function","doc":"Check if a client is alive (process still running).","title":"macula_gateway_clients.is_client_alive/2","ref":"macula_gateway_clients.html#is_client_alive/2"},{"type":"function","doc":"Start the client manager with options.","title":"macula_gateway_clients.start_link/1","ref":"macula_gateway_clients.html#start_link/1"},{"type":"function","doc":"Stop the client manager.","title":"macula_gateway_clients.stop/1","ref":"macula_gateway_clients.html#stop/1"},{"type":"function","doc":"Store a bidirectional stream for a client node (legacy 3-arg version).","title":"macula_gateway_clients.store_client_stream/3","ref":"macula_gateway_clients.html#store_client_stream/3"},{"type":"function","doc":"","title":"macula_gateway_clients.terminate/2","ref":"macula_gateway_clients.html#terminate/2"},{"type":"module","doc":"DHT Query Handler Module - handles DHT message forwarding to routing server. Responsibilities: - Forward DHT STORE messages to routing server - Forward DHT FIND_VALUE messages to routing server, send encoded replies - Forward DHT FIND_NODE messages to routing server, send encoded replies - Handle DHT queries from process messages - Encode replies using protocol encoder - Handle errors gracefully Pattern: Stateless delegation module - No GenServer (no state to manage) - Pure functions forwarding to routing server - Consistent error handling ({ok, Result} | {error, Reason}) Extracted from macula_gateway.erl (Phase 10)","title":"macula_gateway_dht","ref":"macula_gateway_dht.html"},{"type":"function","doc":"Handle DHT FIND_NODE message. Forwards to routing server and sends encoded reply over stream. Crashes on routing server or encoding failures - exposes DHT/protocol bugs.","title":"macula_gateway_dht.handle_find_node/2","ref":"macula_gateway_dht.html#handle_find_node/2"},{"type":"function","doc":"Handle DHT FIND_VALUE message. Forwards to routing server and sends encoded reply over stream. Crashes on routing server or encoding failures - exposes DHT/protocol bugs.","title":"macula_gateway_dht.handle_find_value/2","ref":"macula_gateway_dht.html#handle_find_value/2"},{"type":"function","doc":"Handle DHT query from process message. Decodes query, forwards to routing server, encodes reply, sends to requesting process. Crashes on decode or routing failures - exposes protocol/DHT bugs.","title":"macula_gateway_dht.handle_query/3","ref":"macula_gateway_dht.html#handle_query/3"},{"type":"function","doc":"Handle DHT STORE message. Forwards to routing server (no reply sent back). Crashes on routing server failures - this exposes DHT issues immediately.","title":"macula_gateway_dht.handle_store/2","ref":"macula_gateway_dht.html#handle_store/2"},{"type":"function","doc":"Look up a value from the DHT by key. Synchronous lookup from local DHT storage. Returns list of subscribers for the given key.","title":"macula_gateway_dht.lookup_value/1","ref":"macula_gateway_dht.html#lookup_value/1"},{"type":"function","doc":"Query remote peer and wait for response. Used for FIND_NODE and FIND_VALUE operations.","title":"macula_gateway_dht.query_peer/3","ref":"macula_gateway_dht.html#query_peer/3"},{"type":"function","doc":"Send DHT message to remote peer (fire-and-forget). Used for STORE operations that don't need a response.","title":"macula_gateway_dht.send_to_peer/3","ref":"macula_gateway_dht.html#send_to_peer/3"},{"type":"module","doc":"Macula Gateway Diagnostics Service Provides simple diagnostic procedures that clients can call to verify connectivity and test the gateway's RPC functionality. Available procedures: - com.macula.diagnostics.hello - Returns a friendly greeting with gateway info - com.macula.diagnostics.echo - Echoes back the arguments sent by client - com.macula.diagnostics.info - Returns detailed gateway information Usage: The diagnostics service automatically registers when the gateway starts. Clients can call these procedures using the Macula SDK: Elixir: {:ok, result} = MaculaSdk.Client.call(client, \"com.macula.diagnostics.hello\", %{}) Result: %{ \"message\" => \"Hello from Macula Gateway!\", \"gateway\" => \"macula@127.0.0.1\", \"realm\" => \"com.example.realm\", \"uptime_seconds\" => 42, \"timestamp\" => 1699612800 }","title":"macula_gateway_diagnostics","ref":"macula_gateway_diagnostics.html"},{"type":"function","doc":"","title":"macula_gateway_diagnostics.handle_call/3","ref":"macula_gateway_diagnostics.html#handle_call/3"},{"type":"function","doc":"","title":"macula_gateway_diagnostics.handle_cast/2","ref":"macula_gateway_diagnostics.html#handle_cast/2"},{"type":"function","doc":"","title":"macula_gateway_diagnostics.handle_info/2","ref":"macula_gateway_diagnostics.html#handle_info/2"},{"type":"function","doc":"","title":"macula_gateway_diagnostics.init/1","ref":"macula_gateway_diagnostics.html#init/1"},{"type":"function","doc":"Register diagnostic procedures with the gateway","title":"macula_gateway_diagnostics.register_procedures/1","ref":"macula_gateway_diagnostics.html#register_procedures/1"},{"type":"function","doc":"Start the diagnostics service","title":"macula_gateway_diagnostics.start_link/1","ref":"macula_gateway_diagnostics.html#start_link/1"},{"type":"function","doc":"","title":"macula_gateway_diagnostics.terminate/2","ref":"macula_gateway_diagnostics.html#terminate/2"},{"type":"module","doc":"Macula Gateway Health Check Server Provides HTTP health endpoints for Kubernetes liveness and readiness probes. Runs on a separate port (8080) from the main QUIC gateway (9443). Endpoints: GET /health - Overall health status GET /ready - Readiness check (can accept traffic) GET /live - Liveness check (process is alive) GET /metrics - Basic metrics (optional)","title":"macula_gateway_health","ref":"macula_gateway_health.html"},{"type":"function","doc":"","title":"macula_gateway_health.handle_call/3","ref":"macula_gateway_health.html#handle_call/3"},{"type":"function","doc":"","title":"macula_gateway_health.handle_cast/2","ref":"macula_gateway_health.html#handle_cast/2"},{"type":"function","doc":"","title":"macula_gateway_health.handle_info/2","ref":"macula_gateway_health.html#handle_info/2"},{"type":"function","doc":"","title":"macula_gateway_health.init/1","ref":"macula_gateway_health.html#init/1"},{"type":"function","doc":"Check if the gateway is healthy.","title":"macula_gateway_health.is_healthy/0","ref":"macula_gateway_health.html#is_healthy/0"},{"type":"function","doc":"Set the readiness state.","title":"macula_gateway_health.set_ready/1","ref":"macula_gateway_health.html#set_ready/1"},{"type":"function","doc":"Start the health check server.","title":"macula_gateway_health.start_link/1","ref":"macula_gateway_health.html#start_link/1"},{"type":"function","doc":"Stop the health check server.","title":"macula_gateway_health.stop/0","ref":"macula_gateway_health.html#stop/0"},{"type":"function","doc":"","title":"macula_gateway_health.terminate/2","ref":"macula_gateway_health.html#terminate/2"},{"type":"module","doc":"Mesh Connection Manager GenServer - manages peer-to-peer QUIC connections. Responsibilities: - Pool QUIC connections to remote peers by node_id (BOUNDED POOL) - Enforce max_connections limit with LRU eviction - Check connection liveness before reuse - Open new streams on pooled connections - Monitor connection processes for automatic cleanup - Cache connection metadata with timestamps Pattern: Bounded connection pooling with LRU eviction - Cache connections by node_id (max: max_mesh_connections, default 1000) - Evict least recently used when pool is full - Verify liveness before reuse (open new stream) - Remove dead connections and recreate on demand Configuration: - max_mesh_connections: Maximum pooled connections (default: 1000) Extracted from macula_gateway.erl (Phase 9)","title":"macula_gateway_mesh","ref":"macula_gateway_mesh.html"},{"type":"type","doc":"","title":"macula_gateway_mesh.connection_info/0","ref":"macula_gateway_mesh.html#t:connection_info/0"},{"type":"function","doc":"Get connection metadata for a node.","title":"macula_gateway_mesh.get_connection_info/2","ref":"macula_gateway_mesh.html#get_connection_info/2"},{"type":"function","doc":"Get existing connection or create new one. Returns opened stream ready for use.","title":"macula_gateway_mesh.get_or_create_connection/3","ref":"macula_gateway_mesh.html#get_or_create_connection/3"},{"type":"function","doc":"","title":"macula_gateway_mesh.handle_call/3","ref":"macula_gateway_mesh.html#handle_call/3"},{"type":"function","doc":"","title":"macula_gateway_mesh.handle_cast/2","ref":"macula_gateway_mesh.html#handle_cast/2"},{"type":"function","doc":"","title":"macula_gateway_mesh.handle_info/2","ref":"macula_gateway_mesh.html#handle_info/2"},{"type":"function","doc":"","title":"macula_gateway_mesh.init/1","ref":"macula_gateway_mesh.html#init/1"},{"type":"function","doc":"List all cached connections.","title":"macula_gateway_mesh.list_connections/1","ref":"macula_gateway_mesh.html#list_connections/1"},{"type":"function","doc":"Explicitly remove connection from cache.","title":"macula_gateway_mesh.remove_connection/2","ref":"macula_gateway_mesh.html#remove_connection/2"},{"type":"function","doc":"Start the mesh connection manager with options. Options: - cert_file: Path to TLS certificate - key_file: Path to TLS private key","title":"macula_gateway_mesh.start_link/1","ref":"macula_gateway_mesh.html#start_link/1"},{"type":"function","doc":"Stop the mesh connection manager.","title":"macula_gateway_mesh.stop/1","ref":"macula_gateway_mesh.html#stop/1"},{"type":"function","doc":"","title":"macula_gateway_mesh.terminate/2","ref":"macula_gateway_mesh.html#terminate/2"},{"type":"module","doc":"Pub/Sub Handler GenServer - manages topic subscriptions and message routing. Responsibilities: - Subscribe/unsubscribe streams to topics - Route published messages to matching subscribers - Support wildcard topics (* single-level, ** multi-level) - Track bidirectional mapping (topic  stream) - Monitor stream processes for automatic cleanup Extracted from macula_gateway.erl (Phase 3)","title":"macula_gateway_pubsub","ref":"macula_gateway_pubsub.html"},{"type":"function","doc":"Get all topics a stream is subscribed to.","title":"macula_gateway_pubsub.get_stream_topics/2","ref":"macula_gateway_pubsub.html#get_stream_topics/2"},{"type":"function","doc":"Get all subscribers for a topic (exact and wildcard matches).","title":"macula_gateway_pubsub.get_subscribers/2","ref":"macula_gateway_pubsub.html#get_subscribers/2"},{"type":"function","doc":"","title":"macula_gateway_pubsub.handle_call/3","ref":"macula_gateway_pubsub.html#handle_call/3"},{"type":"function","doc":"","title":"macula_gateway_pubsub.handle_cast/2","ref":"macula_gateway_pubsub.html#handle_cast/2"},{"type":"function","doc":"Handle stream process death - automatic cleanup.","title":"macula_gateway_pubsub.handle_info/2","ref":"macula_gateway_pubsub.html#handle_info/2"},{"type":"function","doc":"","title":"macula_gateway_pubsub.init/1","ref":"macula_gateway_pubsub.html#init/1"},{"type":"function","doc":"Publish a message to a topic (routes to matching subscribers).","title":"macula_gateway_pubsub.publish/3","ref":"macula_gateway_pubsub.html#publish/3"},{"type":"function","doc":"Start the pub/sub handler with options.","title":"macula_gateway_pubsub.start_link/1","ref":"macula_gateway_pubsub.html#start_link/1"},{"type":"function","doc":"Stop the pub/sub handler.","title":"macula_gateway_pubsub.stop/1","ref":"macula_gateway_pubsub.html#stop/1"},{"type":"type","doc":"","title":"macula_gateway_pubsub.stream_handle/0","ref":"macula_gateway_pubsub.html#t:stream_handle/0"},{"type":"function","doc":"Subscribe a stream to a topic (supports wildcards).","title":"macula_gateway_pubsub.subscribe/3","ref":"macula_gateway_pubsub.html#subscribe/3"},{"type":"function","doc":"","title":"macula_gateway_pubsub.terminate/2","ref":"macula_gateway_pubsub.html#terminate/2"},{"type":"function","doc":"Unsubscribe a stream from a topic.","title":"macula_gateway_pubsub.unsubscribe/3","ref":"macula_gateway_pubsub.html#unsubscribe/3"},{"type":"module","doc":"Macula Gateway Pub/Sub Router - DHT-Routed Message Distribution Handles distribution of pub/sub messages to both local and remote subscribers using multi-hop Kademlia DHT routing (v0.7.8+). Responsibilities: - Deliver messages to local subscribers via QUIC streams - Query DHT for remote subscribers - Route messages via DHT multi-hop (pubsub_route protocol) - Wrap PUBLISH messages in pubsub_route envelopes Extracted from macula_gateway.erl (v0.7.9) for better separation of concerns.","title":"macula_gateway_pubsub_router","ref":"macula_gateway_pubsub_router.html"},{"type":"function","doc":"Distribute pub/sub message to both local and remote subscribers. Uses DHT routing for remote subscribers (multi-hop Kademlia). For connected clients, uses existing bidirectional streams instead of mesh connections.","title":"macula_gateway_pubsub_router.distribute/5","ref":"macula_gateway_pubsub_router.html#distribute/5"},{"type":"module","doc":"QUIC Transport Layer Gen_Server Handles all QUIC transport operations for the gateway: - Owns QUIC listener - Receives {quic, ...} events - Decodes protocol messages - Routes messages to gateway for business logic This separation follows proper OTP design: - One process, one responsibility (transport vs routing) - Clean fault isolation (QUIC crashes don't crash gateway) - Proper supervision (supervisor can restart independently) - Testability (can test transport in isolation)","title":"macula_gateway_quic_server","ref":"macula_gateway_quic_server.html"},{"type":"function","doc":"Handle synchronous calls. Set gateway PID for message routing","title":"macula_gateway_quic_server.handle_call/3","ref":"macula_gateway_quic_server.html#handle_call/3"},{"type":"function","doc":"Handle asynchronous casts.","title":"macula_gateway_quic_server.handle_cast/2","ref":"macula_gateway_quic_server.html#handle_cast/2"},{"type":"function","doc":"Handle QUIC event: new_stream (stream created by peer).","title":"macula_gateway_quic_server.handle_info/2","ref":"macula_gateway_quic_server.html#handle_info/2"},{"type":"function","doc":"Initialize the QUIC server and start QUIC listener.","title":"macula_gateway_quic_server.init/1","ref":"macula_gateway_quic_server.html#init/1"},{"type":"function","doc":"Set the gateway PID for message routing. Called by supervisor after both quic_server and gateway have started.","title":"macula_gateway_quic_server.set_gateway/2","ref":"macula_gateway_quic_server.html#set_gateway/2"},{"type":"function","doc":"Start the QUIC server gen_server.","title":"macula_gateway_quic_server.start_link/1","ref":"macula_gateway_quic_server.html#start_link/1"},{"type":"function","doc":"Cleanup on termination.","title":"macula_gateway_quic_server.terminate/2","ref":"macula_gateway_quic_server.html#terminate/2"},{"type":"module","doc":"RPC Handler GenServer - manages RPC handler registration and call routing. Responsibilities: - Register/unregister RPC handlers for procedures - Route RPC calls to registered handlers - Handle call/response matching - Monitor handler processes for automatic cleanup Extracted from macula_gateway.erl (Phase 4)","title":"macula_gateway_rpc","ref":"macula_gateway_rpc.html"},{"type":"function","doc":"Make an RPC call to a procedure.","title":"macula_gateway_rpc.call/4","ref":"macula_gateway_rpc.html#call/4"},{"type":"function","doc":"Get the handler for a procedure.","title":"macula_gateway_rpc.get_handler/2","ref":"macula_gateway_rpc.html#get_handler/2"},{"type":"function","doc":"","title":"macula_gateway_rpc.handle_call/3","ref":"macula_gateway_rpc.html#handle_call/3"},{"type":"function","doc":"","title":"macula_gateway_rpc.handle_cast/2","ref":"macula_gateway_rpc.html#handle_cast/2"},{"type":"function","doc":"Handle handler process death - automatic cleanup.","title":"macula_gateway_rpc.handle_info/2","ref":"macula_gateway_rpc.html#handle_info/2"},{"type":"function","doc":"","title":"macula_gateway_rpc.init/1","ref":"macula_gateway_rpc.html#init/1"},{"type":"function","doc":"List all registered handlers.","title":"macula_gateway_rpc.list_handlers/1","ref":"macula_gateway_rpc.html#list_handlers/1"},{"type":"function","doc":"Register a handler for an RPC procedure. Handler can be either a PID or a function.","title":"macula_gateway_rpc.register_handler/3","ref":"macula_gateway_rpc.html#register_handler/3"},{"type":"function","doc":"Start the RPC handler with options.","title":"macula_gateway_rpc.start_link/1","ref":"macula_gateway_rpc.html#start_link/1"},{"type":"function","doc":"Stop the RPC handler.","title":"macula_gateway_rpc.stop/1","ref":"macula_gateway_rpc.html#stop/1"},{"type":"function","doc":"","title":"macula_gateway_rpc.terminate/2","ref":"macula_gateway_rpc.html#terminate/2"},{"type":"function","doc":"Unregister a handler for an RPC procedure.","title":"macula_gateway_rpc.unregister_handler/2","ref":"macula_gateway_rpc.html#unregister_handler/2"},{"type":"module","doc":"RPC Router Module - handles routed RPC messages (CALL/REPLY). Responsibilities: - Process routed CALL messages delivered locally - Process routed REPLY messages delivered locally - Send REPLY back via routing path - Forward rpc_route messages to next hop - Coordinate between RPC handler, mesh, and routing modules Pattern: Stateless delegation module - No GenServer (no state to manage) - Pure functions coordinating between modules - Consistent error handling ({ok, Result} | {error, Reason}) Extracted from macula_gateway.erl (Phase 11)","title":"macula_gateway_rpc_router","ref":"macula_gateway_rpc_router.html"},{"type":"function","doc":"Forward rpc_route message to next hop. Gets mesh connection and sends encoded message. Crashes on connection/encoding failures - exposes mesh/protocol issues.","title":"macula_gateway_rpc_router.forward_rpc_route/3","ref":"macula_gateway_rpc_router.html#forward_rpc_route/3"},{"type":"function","doc":"Handle routed CALL message delivered locally. Looks up RPC handler, invokes it, sends reply via routing path.","title":"macula_gateway_rpc_router.handle_routed_call/5","ref":"macula_gateway_rpc_router.html#handle_routed_call/5"},{"type":"function","doc":"Handle routed REPLY message delivered locally. Routes to connection via gproc (local node) or to client stream (remote client).","title":"macula_gateway_rpc_router.handle_routed_reply/4","ref":"macula_gateway_rpc_router.html#handle_routed_reply/4"},{"type":"function","doc":"Send REPLY back via routing path. Wraps reply in rpc_route envelope and routes to destination. Crashes on routing failures - exposes mesh/routing issues immediately.","title":"macula_gateway_rpc_router.send_reply_via_routing/4","ref":"macula_gateway_rpc_router.html#send_reply_via_routing/4"},{"type":"module","doc":"Gateway Root Supervisor - top-level supervisor for gateway subsystem. Supervision Strategy: - rest_for_one: Dependency-based restart ordering - Child order reflects dependencies: 1. quic_server (owns QUIC listener, no dependencies) 2. gateway (depends on quic_server PID) 3. workers_sup (depends on gateway PID) Fault Isolation: - quic_server crash  restart quic_server, gateway, workers_sup - gateway crash  restart gateway, workers_sup (quic_server continues) - workers_sup crash  restart workers_sup only (quic_server and gateway continue) Architecture: <span class=\"w\">   </span><span class=\"nf\">macula_gateway_system</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9617959390-1\">(</span><span class=\"ss\">this</span><span class=\"w\"> </span><span class=\"ss\">module</span><span class=\"p\" data-group-id=\"9617959390-1\">)</span><span class=\"w\">\n   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_health</span><span class=\"w\">        </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Health</span><span class=\"w\"> </span><span class=\"ss\">check</span><span class=\"w\"> </span><span class=\"n\">HTTP</span><span class=\"w\"> </span><span class=\"ss\">server</span><span class=\"w\">\n   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_diagnostics</span><span class=\"w\">   </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Diagnostics</span><span class=\"w\"> </span><span class=\"ss\">service</span><span class=\"w\">\n   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_quic_server</span><span class=\"w\">   </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">QUIC</span><span class=\"w\"> </span><span class=\"ss\">transport</span><span class=\"w\"> </span><span class=\"ss\">layer</span><span class=\"w\">\n   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway</span><span class=\"w\">               </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Message</span><span class=\"w\"> </span><span class=\"ss\">routing</span><span class=\"w\"> </span><span class=\"ss\">coordinator</span><span class=\"w\">\n   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_workers_sup</span><span class=\"w\">   </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Business</span><span class=\"w\"> </span><span class=\"ss\">logic</span><span class=\"w\"> </span><span class=\"ss\">workers</span><span class=\"w\">\n       </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_clients</span><span class=\"w\">   </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Client</span><span class=\"w\"> </span><span class=\"ss\">tracking</span><span class=\"w\">\n       </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_pubsub</span><span class=\"w\">    </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Pub</span><span class=\"o\">/</span><span class=\"n\">Sub</span><span class=\"w\"> </span><span class=\"ss\">routing</span><span class=\"w\">\n       </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_rpc</span><span class=\"w\">       </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">RPC</span><span class=\"w\"> </span><span class=\"ss\">handling</span><span class=\"w\">\n       </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_mesh</span><span class=\"w\">      </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Mesh</span><span class=\"w\"> </span><span class=\"ss\">connections</span><span class=\"w\">\n   </span> Circular Dependency Resolution: - quic_server starts first (without gateway PID) - gateway starts second (receives quic_server PID) - Supervisor calls quic_server:set_gateway/1 to complete link - workers_sup starts last (receives gateway PID) Created during Phase 2 QUIC refactoring to enable proper OTP supervision.","title":"macula_gateway_system","ref":"macula_gateway_system.html"},{"type":"function","doc":"","title":"macula_gateway_system.init/1","ref":"macula_gateway_system.html#init/1"},{"type":"function","doc":"Start the root gateway supervisor with configuration.","title":"macula_gateway_system.start_link/1","ref":"macula_gateway_system.html#start_link/1"},{"type":"module","doc":"Gateway Workers Supervisor - supervises gateway worker processes. Supervision Strategy: - rest_for_one: If child N crashes, restart N and all children after N - Rationale: Only clients is foundational; pubsub/rpc/mesh depend on it but are independent of each other. This strategy provides fault isolation while maintaining consistency when clients restarts. Children (in dependency order): - macula_gateway_clients: Client tracking (foundational) - macula_gateway_pubsub: Pub/Sub message routing (depends on clients) - macula_gateway_rpc: RPC handler registration and routing (depends on clients) - macula_gateway_mesh: Mesh connection pooling and management (independent) Fault Isolation Examples: - mesh crash  only mesh restarts (0 clients disconnected) - rpc crash  rpc + mesh restart (0 clients disconnected) - pubsub crash  pubsub + rpc + mesh restart (0 clients disconnected) - clients crash  all restart (unavoidable - foundational) Extracted from macula_gateway.erl (Phase 6, 9) Renamed from macula_gateway_sup (Phase 2 QUIC refactoring)","title":"macula_gateway_workers_sup","ref":"macula_gateway_workers_sup.html"},{"type":"function","doc":"Get the clients worker child PID.","title":"macula_gateway_workers_sup.get_clients/1","ref":"macula_gateway_workers_sup.html#get_clients/1"},{"type":"function","doc":"Get the mesh connection manager child PID.","title":"macula_gateway_workers_sup.get_mesh/1","ref":"macula_gateway_workers_sup.html#get_mesh/1"},{"type":"function","doc":"Get the pubsub handler child PID.","title":"macula_gateway_workers_sup.get_pubsub/1","ref":"macula_gateway_workers_sup.html#get_pubsub/1"},{"type":"function","doc":"Get the RPC handler child PID.","title":"macula_gateway_workers_sup.get_rpc/1","ref":"macula_gateway_workers_sup.html#get_rpc/1"},{"type":"function","doc":"","title":"macula_gateway_workers_sup.init/1","ref":"macula_gateway_workers_sup.html#init/1"},{"type":"function","doc":"Start the gateway supervisor with configuration.","title":"macula_gateway_workers_sup.start_link/1","ref":"macula_gateway_workers_sup.html#start_link/1"},{"type":"module","doc":"ID generation utilities for Macula. Provides functions for generating various types of IDs.","title":"macula_id","ref":"macula_id.html"},{"type":"function","doc":"Convert hex string to binary. Crashes on invalid hex - exposes bugs in validation logic.","title":"macula_id.from_hex/1","ref":"macula_id.html#from_hex/1"},{"type":"function","doc":"Convert UUID string to 16-byte binary ID. Crashes on invalid UUID format - exposes bugs in validation logic.","title":"macula_id.from_uuid/1","ref":"macula_id.html#from_uuid/1"},{"type":"function","doc":"Generate deterministic 256-bit hash ID from data.","title":"macula_id.hash_id/1","ref":"macula_id.html#hash_id/1"},{"type":"function","doc":"Generate 128-bit (16-byte) random message ID.","title":"macula_id.message_id/0","ref":"macula_id.html#message_id/0"},{"type":"function","doc":"Generate 256-bit (32-byte) random node ID.","title":"macula_id.node_id/0","ref":"macula_id.html#node_id/0"},{"type":"function","doc":"Generate 128-bit (16-byte) random session ID.","title":"macula_id.session_id/0","ref":"macula_id.html#session_id/0"},{"type":"function","doc":"Convert binary to lowercase hex string.","title":"macula_id.to_hex/1","ref":"macula_id.html#to_hex/1"},{"type":"function","doc":"Convert 16-byte or 32-byte binary ID to UUID string format. For 16-byte: 8-4-4-4-12 (e.g., \"12345678-90ab-cdef-1234-567890abcdef\") For 32-byte: Uses first 16 bytes","title":"macula_id.to_uuid/1","ref":"macula_id.html#to_uuid/1"},{"type":"module","doc":"SWIM failure detector (pure logic, no GenServer). Orchestrates member list, gossip, and protocol timing.","title":"macula_membership_detector","ref":"macula_membership_detector.html"},{"type":"function","doc":"Add a member to the list.","title":"macula_membership_detector.add_member/2","ref":"macula_membership_detector.html#add_member/2"},{"type":"function","doc":"Apply received gossip updates.","title":"macula_membership_detector.apply_gossip_updates/2","ref":"macula_membership_detector.html#apply_gossip_updates/2"},{"type":"type","doc":"","title":"macula_membership_detector.detector_state/0","ref":"macula_membership_detector.html#t:detector_state/0"},{"type":"function","doc":"Get all alive members.","title":"macula_membership_detector.get_alive_members/1","ref":"macula_membership_detector.html#get_alive_members/1"},{"type":"function","doc":"Get gossip updates to piggyback on messages.","title":"macula_membership_detector.get_gossip_updates/2","ref":"macula_membership_detector.html#get_gossip_updates/2"},{"type":"function","doc":"Get a member by node ID.","title":"macula_membership_detector.get_member/2","ref":"macula_membership_detector.html#get_member/2"},{"type":"function","doc":"Get local node ID.","title":"macula_membership_detector.local_node_id/1","ref":"macula_membership_detector.html#local_node_id/1"},{"type":"function","doc":"Mark a member as dead.","title":"macula_membership_detector.mark_dead/2","ref":"macula_membership_detector.html#mark_dead/2"},{"type":"function","doc":"Mark a member as suspect.","title":"macula_membership_detector.mark_suspect/2","ref":"macula_membership_detector.html#mark_suspect/2"},{"type":"function","doc":"Create a new detector state.","title":"macula_membership_detector.new/2","ref":"macula_membership_detector.html#new/2"},{"type":"function","doc":"Get protocol period.","title":"macula_membership_detector.protocol_period/1","ref":"macula_membership_detector.html#protocol_period/1"},{"type":"function","doc":"Refute suspicion (increment local incarnation).","title":"macula_membership_detector.refute_suspicion/1","ref":"macula_membership_detector.html#refute_suspicion/1"},{"type":"function","doc":"Select a random member to probe (excluding self).","title":"macula_membership_detector.select_probe_target/1","ref":"macula_membership_detector.html#select_probe_target/1"},{"type":"module","doc":"Gossip dissemination for SWIM protocol. Tracks membership updates and provides them for piggybacking. Uses exponential decay: log(N) messages per update.","title":"macula_membership_gossip","ref":"macula_membership_gossip.html"},{"type":"function","doc":"Add a membership update to gossip. If a more recent update exists, it's replaced.","title":"macula_membership_gossip.add_update/4","ref":"macula_membership_gossip.html#add_update/4"},{"type":"function","doc":"Get updates to piggyback on messages. Returns most recent updates first, limited by max_updates.","title":"macula_membership_gossip.get_updates/2","ref":"macula_membership_gossip.html#get_updates/2"},{"type":"type","doc":"","title":"macula_membership_gossip.gossip_state/0","ref":"macula_membership_gossip.html#t:gossip_state/0"},{"type":"function","doc":"Mark an update as transmitted (increment transmit count).","title":"macula_membership_gossip.mark_transmitted/2","ref":"macula_membership_gossip.html#mark_transmitted/2"},{"type":"function","doc":"Merge received gossip updates into local state. Uses SWIM merge semantics (higher incarnation wins, etc.).","title":"macula_membership_gossip.merge_updates/2","ref":"macula_membership_gossip.html#merge_updates/2"},{"type":"function","doc":"Create a new gossip state.","title":"macula_membership_gossip.new/0","ref":"macula_membership_gossip.html#new/0"},{"type":"function","doc":"Prune updates that have been transmitted enough times. Target is typically log(N) where N is cluster size.","title":"macula_membership_gossip.prune/2","ref":"macula_membership_gossip.html#prune/2"},{"type":"type","doc":"","title":"macula_membership_gossip.update/0","ref":"macula_membership_gossip.html#t:update/0"},{"type":"module","doc":"Membership list for SWIM protocol. Maintains cluster membership view with fast concurrent access. Uses map-based storage (could be ETS in production).","title":"macula_membership_list","ref":"macula_membership_list.html"},{"type":"function","doc":"Add a new member to the list. If member already exists, this is a no-op (use update_member instead).","title":"macula_membership_list.add_member/2","ref":"macula_membership_list.html#add_member/2"},{"type":"function","doc":"Get all alive members.","title":"macula_membership_list.get_alive_members/1","ref":"macula_membership_list.html#get_alive_members/1"},{"type":"function","doc":"Get all members.","title":"macula_membership_list.get_all_members/1","ref":"macula_membership_list.html#get_all_members/1"},{"type":"function","doc":"Get a member by node ID.","title":"macula_membership_list.get_member/2","ref":"macula_membership_list.html#get_member/2"},{"type":"function","doc":"Get N random members from the list.","title":"macula_membership_list.get_random_members/2","ref":"macula_membership_list.html#get_random_members/2"},{"type":"function","doc":"Get N random members excluding specified node ID.","title":"macula_membership_list.get_random_members/3","ref":"macula_membership_list.html#get_random_members/3"},{"type":"function","doc":"Get all suspect members.","title":"macula_membership_list.get_suspect_members/1","ref":"macula_membership_list.html#get_suspect_members/1"},{"type":"type","doc":"","title":"macula_membership_list.member_list/0","ref":"macula_membership_list.html#t:member_list/0"},{"type":"function","doc":"Create a new membership list with the local node.","title":"macula_membership_list.new/1","ref":"macula_membership_list.html#new/1"},{"type":"function","doc":"Remove a member from the list.","title":"macula_membership_list.remove_member/2","ref":"macula_membership_list.html#remove_member/2"},{"type":"function","doc":"Get the number of members in the list.","title":"macula_membership_list.size/1","ref":"macula_membership_list.html#size/1"},{"type":"function","doc":"Update an existing member (or add if not present). Uses merge semantics to resolve conflicts.","title":"macula_membership_list.update_member/2","ref":"macula_membership_list.html#update_member/2"},{"type":"module","doc":"Member record and state transitions for SWIM protocol. Represents a single node in the membership list.","title":"macula_membership_member","ref":"macula_membership_member.html"},{"type":"function","doc":"Get address.","title":"macula_membership_member.address/1","ref":"macula_membership_member.html#address/1"},{"type":"function","doc":"Compare two members to determine which is more recent. Returns: gt (M1 is newer), lt (M1 is older), eq (same)","title":"macula_membership_member.compare/2","ref":"macula_membership_member.html#compare/2"},{"type":"function","doc":"Get incarnation number.","title":"macula_membership_member.incarnation/1","ref":"macula_membership_member.html#incarnation/1"},{"type":"function","doc":"Mark member as alive with new incarnation (refutation). Dead members cannot be revived.","title":"macula_membership_member.mark_alive/2","ref":"macula_membership_member.html#mark_alive/2"},{"type":"function","doc":"Mark member as dead (confirmed failure).","title":"macula_membership_member.mark_dead/1","ref":"macula_membership_member.html#mark_dead/1"},{"type":"function","doc":"Mark member as suspect (failed to respond to ping).","title":"macula_membership_member.mark_suspect/1","ref":"macula_membership_member.html#mark_suspect/1"},{"type":"type","doc":"","title":"macula_membership_member.member/0","ref":"macula_membership_member.html#t:member/0"},{"type":"function","doc":"Merge two member states, keeping the most recent information. Rules: 1. Dead always wins 2. Higher incarnation wins 3. Same incarnation: suspect > alive","title":"macula_membership_member.merge/2","ref":"macula_membership_member.html#merge/2"},{"type":"function","doc":"Get metadata.","title":"macula_membership_member.metadata/1","ref":"macula_membership_member.html#metadata/1"},{"type":"function","doc":"Create a new member with alive status and incarnation 0.","title":"macula_membership_member.new/2","ref":"macula_membership_member.html#new/2"},{"type":"function","doc":"Create a new member with custom metadata.","title":"macula_membership_member.new/3","ref":"macula_membership_member.html#new/3"},{"type":"function","doc":"Get node ID.","title":"macula_membership_member.node_id/1","ref":"macula_membership_member.html#node_id/1"},{"type":"type","doc":"","title":"macula_membership_member.status/0","ref":"macula_membership_member.html#t:status/0"},{"type":"function","doc":"Get status.","title":"macula_membership_member.status/1","ref":"macula_membership_member.html#status/1"},{"type":"module","doc":"Shared naming utilities for hierarchical dot-separated names. Used by both pub/sub topics and RPC procedure names. Supports DNS-style reverse notation: org.domain.service.method","title":"macula_names","ref":"macula_names.html"},{"type":"type","doc":"","title":"macula_names.name/0","ref":"macula_names.html#t:name/0"},{"type":"function","doc":"Extract namespace (first segment).","title":"macula_names.namespace/1","ref":"macula_names.html#namespace/1"},{"type":"function","doc":"Normalize name (lowercase, trim, remove double dots).","title":"macula_names.normalize/1","ref":"macula_names.html#normalize/1"},{"type":"type","doc":"","title":"macula_names.options/0","ref":"macula_names.html#t:options/0"},{"type":"function","doc":"Count number of segments in name.","title":"macula_names.segment_count/1","ref":"macula_names.html#segment_count/1"},{"type":"function","doc":"Validate name syntax with default options (no wildcards).","title":"macula_names.validate/1","ref":"macula_names.html#validate/1"},{"type":"function","doc":"Validate name syntax with options. Valid names: - Non-empty - Segments separated by dots - Segments contain alphanumeric, underscore, hyphen - Optionally allow wildcards (* and #) for patterns - No leading or trailing dots - No double dots","title":"macula_names.validate/2","ref":"macula_names.html#validate/2"},{"type":"module","doc":"Node identity and metadata management. Represents a single node in the Macula mesh.","title":"macula_node","ref":"macula_node.html"},{"type":"type","doc":"","title":"macula_node.address/0","ref":"macula_node.html#t:address/0"},{"type":"function","doc":"Check if two nodes are equal (by ID).","title":"macula_node.equals/2","ref":"macula_node.html#equals/2"},{"type":"function","doc":"Decode node from binary. Crashes on invalid binary or structure - exposes bugs in encoding/decoding logic.","title":"macula_node.from_binary/1","ref":"macula_node.html#from_binary/1"},{"type":"function","doc":"Get address.","title":"macula_node.get_address/1","ref":"macula_node.html#get_address/1"},{"type":"function","doc":"Get node ID.","title":"macula_node.get_id/1","ref":"macula_node.html#get_id/1"},{"type":"function","doc":"Get metadata.","title":"macula_node.get_metadata/1","ref":"macula_node.html#get_metadata/1"},{"type":"function","doc":"Get realm.","title":"macula_node.get_realm/1","ref":"macula_node.html#get_realm/1"},{"type":"type","doc":"","title":"macula_node.macula_node/0","ref":"macula_node.html#t:macula_node/0"},{"type":"type","doc":"","title":"macula_node.metadata/0","ref":"macula_node.html#t:metadata/0"},{"type":"function","doc":"Create new node with random ID.","title":"macula_node.new/1","ref":"macula_node.html#new/1"},{"type":"function","doc":"Create new node with random ID and metadata.","title":"macula_node.new/2","ref":"macula_node.html#new/2"},{"type":"type","doc":"32-byte unique identifier","title":"macula_node.node_id/0","ref":"macula_node.html#t:node_id/0"},{"type":"type","doc":"","title":"macula_node.realm/0","ref":"macula_node.html#t:realm/0"},{"type":"function","doc":"Set address.","title":"macula_node.set_address/2","ref":"macula_node.html#set_address/2"},{"type":"function","doc":"Set metadata (replaces existing).","title":"macula_node.set_metadata/2","ref":"macula_node.html#set_metadata/2"},{"type":"function","doc":"Encode node to binary.","title":"macula_node.to_binary/1","ref":"macula_node.html#to_binary/1"},{"type":"function","doc":"Update metadata (merges with existing).","title":"macula_node.update_metadata/2","ref":"macula_node.html#update_metadata/2"},{"type":"module","doc":"Macula Peer - Mesh Participant API (v0.7.0+). This module provides the high-level API for mesh participants. Use this module to connect to a Macula mesh and communicate via pub/sub or RPC. Quick Start <span class=\"w\">   </span><span class=\"c1\">%% 1. Connect to a gateway</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"1247747430-1\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Peer</span><span class=\"p\" data-group-id=\"1247747430-1\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peer</span><span class=\"p\">:</span><span class=\"nf\">start_link</span><span class=\"p\" data-group-id=\"1247747430-2\">(</span><span class=\"p\" data-group-id=\"1247747430-3\">&lt;&lt;</span><span class=\"s\">&quot;https://gateway.example.com:9443&quot;</span><span class=\"p\" data-group-id=\"1247747430-3\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"1247747430-4\">#{</span><span class=\"w\">\n       </span><span class=\"ss\">realm</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"1247747430-5\">&lt;&lt;</span><span class=\"s\">&quot;com.example.app&quot;</span><span class=\"p\" data-group-id=\"1247747430-5\">&gt;&gt;</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"1247747430-4\">}</span><span class=\"p\" data-group-id=\"1247747430-2\">)</span><span class=\"p\">.</span><span class=\"w\">\n  \n   </span><span class=\"c1\">%% 2. Subscribe to events</span><span class=\"w\">\n   </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peer</span><span class=\"p\">:</span><span class=\"nf\">subscribe</span><span class=\"p\" data-group-id=\"1247747430-6\">(</span><span class=\"n\">Peer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"1247747430-7\">&lt;&lt;</span><span class=\"s\">&quot;sensor.temperature&quot;</span><span class=\"p\" data-group-id=\"1247747430-7\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nf\">self</span><span class=\"p\" data-group-id=\"1247747430-8\">(</span><span class=\"p\" data-group-id=\"1247747430-8\">)</span><span class=\"p\" data-group-id=\"1247747430-6\">)</span><span class=\"p\">.</span><span class=\"w\">\n  \n   </span><span class=\"c1\">%% 3. Publish an event</span><span class=\"w\">\n   </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peer</span><span class=\"p\">:</span><span class=\"nf\">publish</span><span class=\"p\" data-group-id=\"1247747430-9\">(</span><span class=\"n\">Peer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"1247747430-10\">&lt;&lt;</span><span class=\"s\">&quot;sensor.temperature&quot;</span><span class=\"p\" data-group-id=\"1247747430-10\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"1247747430-11\">#{</span><span class=\"w\">\n       </span><span class=\"ss\">device_id</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"1247747430-12\">&lt;&lt;</span><span class=\"s\">&quot;sensor-001&quot;</span><span class=\"p\" data-group-id=\"1247747430-12\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"ss\">celsius</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"mf\">21.5</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"1247747430-11\">}</span><span class=\"p\" data-group-id=\"1247747430-9\">)</span><span class=\"p\">.</span><span class=\"w\">\n  \n   </span><span class=\"c1\">%% 4. Call a remote service</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"1247747430-13\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Result</span><span class=\"p\" data-group-id=\"1247747430-13\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peer</span><span class=\"p\">:</span><span class=\"nf\">call</span><span class=\"p\" data-group-id=\"1247747430-14\">(</span><span class=\"n\">Peer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"1247747430-15\">&lt;&lt;</span><span class=\"s\">&quot;calculator.add&quot;</span><span class=\"p\" data-group-id=\"1247747430-15\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"1247747430-16\">#{</span><span class=\"ss\">a</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">b</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\" data-group-id=\"1247747430-16\">}</span><span class=\"p\" data-group-id=\"1247747430-14\">)</span><span class=\"p\">.</span><span class=\"w\">\n  \n   </span><span class=\"c1\">%% 5. Advertise a service</span><span class=\"w\">\n   </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peer</span><span class=\"p\">:</span><span class=\"nf\">advertise</span><span class=\"p\" data-group-id=\"1247747430-17\">(</span><span class=\"n\">Peer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"1247747430-18\">&lt;&lt;</span><span class=\"s\">&quot;calculator.add&quot;</span><span class=\"p\" data-group-id=\"1247747430-18\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nf\">fun</span><span class=\"p\" data-group-id=\"1247747430-19\">(</span><span class=\"p\" data-group-id=\"1247747430-20\">#{</span><span class=\"ss\">a</span><span class=\"w\"> </span><span class=\"p\">:=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">b</span><span class=\"w\"> </span><span class=\"p\">:=</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"p\" data-group-id=\"1247747430-20\">}</span><span class=\"p\" data-group-id=\"1247747430-19\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"1247747430-21\">#{</span><span class=\"ss\">result</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"p\" data-group-id=\"1247747430-21\">}</span><span class=\"w\">\n   </span><span class=\"k\">end</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"1247747430-22\">#{</span><span class=\"ss\">ttl</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">300</span><span class=\"p\" data-group-id=\"1247747430-22\">}</span><span class=\"p\" data-group-id=\"1247747430-17\">)</span><span class=\"p\">.</span> Architecture The peer acts as a facade/coordinator, delegating to specialized child processes: -  macula_connection : QUIC transport layer (send/receive, encoding/decoding) -  macula_pubsub_handler : Pub/sub message routing -  macula_rpc_handler : RPC call/response handling -  macula_advertisement_manager : DHT service advertisements Renamed from macula_connection in v0.7.0 for clarity: -  macula_peer  = mesh participant (this module) -  macula_connection  = QUIC transport (low-level) Multi-Tenancy via Realms Realms provide logical isolation for different applications: <span class=\"w\">   </span><span class=\"c1\">%% App 1</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"4851411185-1\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Peer1</span><span class=\"p\" data-group-id=\"4851411185-1\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peer</span><span class=\"p\">:</span><span class=\"nf\">start_link</span><span class=\"p\" data-group-id=\"4851411185-2\">(</span><span class=\"n\">GatewayUrl</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"4851411185-3\">#{</span><span class=\"ss\">realm</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"4851411185-4\">&lt;&lt;</span><span class=\"s\">&quot;com.app1&quot;</span><span class=\"p\" data-group-id=\"4851411185-4\">&gt;&gt;</span><span class=\"p\" data-group-id=\"4851411185-3\">}</span><span class=\"p\" data-group-id=\"4851411185-2\">)</span><span class=\"p\">.</span><span class=\"w\">\n  \n   </span><span class=\"c1\">%% App 2 (completely isolated from App 1)</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"4851411185-5\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Peer2</span><span class=\"p\" data-group-id=\"4851411185-5\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peer</span><span class=\"p\">:</span><span class=\"nf\">start_link</span><span class=\"p\" data-group-id=\"4851411185-6\">(</span><span class=\"n\">GatewayUrl</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"4851411185-7\">#{</span><span class=\"ss\">realm</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"4851411185-8\">&lt;&lt;</span><span class=\"s\">&quot;com.app2&quot;</span><span class=\"p\" data-group-id=\"4851411185-8\">&gt;&gt;</span><span class=\"p\" data-group-id=\"4851411185-7\">}</span><span class=\"p\" data-group-id=\"4851411185-6\">)</span><span class=\"p\">.</span>","title":"macula_peer","ref":"macula_peer.html"},{"type":"function","doc":"Advertise a service handler for a procedure. This makes the local handler available to other mesh nodes via DHT. The handler will be periodically re-advertised based on TTL.","title":"macula_peer.advertise/4","ref":"macula_peer.html#advertise/4"},{"type":"function","doc":"Make an RPC call through this client (default timeout).","title":"macula_peer.call/3","ref":"macula_peer.html#call/3"},{"type":"function","doc":"Make an RPC call through this client with options.","title":"macula_peer.call/4","ref":"macula_peer.html#call/4"},{"type":"function","doc":"Discover subscribers to a topic via DHT query.","title":"macula_peer.discover_subscribers/2","ref":"macula_peer.html#discover_subscribers/2"},{"type":"function","doc":"Get the node ID of this peer.","title":"macula_peer.get_node_id/1","ref":"macula_peer.html#get_node_id/1"},{"type":"function","doc":"Publish an event through this client (no options).","title":"macula_peer.publish/3","ref":"macula_peer.html#publish/3"},{"type":"function","doc":"Publish an event through this client with options.","title":"macula_peer.publish/4","ref":"macula_peer.html#publish/4"},{"type":"function","doc":"Start a client connection to a Macula mesh.","title":"macula_peer.start_link/2","ref":"macula_peer.html#start_link/2"},{"type":"function","doc":"Stop the client connection.","title":"macula_peer.stop/1","ref":"macula_peer.html#stop/1"},{"type":"function","doc":"Subscribe to a topic through this client.","title":"macula_peer.subscribe/3","ref":"macula_peer.html#subscribe/3"},{"type":"function","doc":"Stop advertising a service. Removes the local handler and stops advertising to the DHT.","title":"macula_peer.unadvertise/2","ref":"macula_peer.html#unadvertise/2"},{"type":"function","doc":"Unsubscribe from a topic.","title":"macula_peer.unsubscribe/2","ref":"macula_peer.html#unsubscribe/2"},{"type":"module","doc":"Peer Connector - Establishes direct QUIC connections to remote peers (v0.8.0+). This module enables peer-to-peer communication by establishing outbound QUIC connections to arbitrary peers. Used by DHT for STORE/FIND_VALUE message propagation and by RPC/PubSub for direct delivery. Overview Pattern: Stateless utility module (no GenServer) - Direct QUIC connections using  macula_quic  - Fire-and-forget message sending - No connection pooling (future optimization for v0.9.0) Usage Used internally by: -  macula_pubsub_dht : Direct pub/sub delivery to discovered subscribers -  macula_service_registry : DHT STORE propagation to k=20 nodes - Future: Multi-hop RPC routing <span class=\"w\">   </span><span class=\"c1\">%% Send a DHT STORE message to a peer</span><span class=\"w\">\n   </span><span class=\"n\">Endpoint</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"8595223740-1\">&lt;&lt;</span><span class=\"s\">&quot;192.168.1.100:9443&quot;</span><span class=\"p\" data-group-id=\"8595223740-1\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\">\n   </span><span class=\"n\">Message</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"8595223740-2\">#{</span><span class=\"w\">\n       </span><span class=\"ss\">key</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"8595223740-3\">&lt;&lt;</span><span class=\"s\">&quot;service.calculator.add&quot;</span><span class=\"p\" data-group-id=\"8595223740-3\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"ss\">value</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"8595223740-4\">&lt;&lt;</span><span class=\"s\">&quot;192.168.1.50:9443&quot;</span><span class=\"p\" data-group-id=\"8595223740-4\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"ss\">ttl</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">300</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"8595223740-2\">}</span><span class=\"p\">,</span><span class=\"w\">\n   </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peer_connector</span><span class=\"p\">:</span><span class=\"nf\">send_message</span><span class=\"p\" data-group-id=\"8595223740-5\">(</span><span class=\"n\">Endpoint</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">dht_store</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Message</span><span class=\"p\" data-group-id=\"8595223740-5\">)</span><span class=\"p\">.</span> Performance Characteristics v0.8.0: Fire-and-forget pattern - Creates new connection per message - Simple but inefficient for high-frequency messaging v0.9.0 (planned): Connection pooling - Reuse existing connections - 10x performance improvement for repeated messaging","title":"macula_peer_connector","ref":"macula_peer_connector.html"},{"type":"function","doc":"Send a message to a remote peer (fire-and-forget). Establishes connection, sends message, closes connection. This is simple but creates a new connection per message.","title":"macula_peer_connector.send_message/3","ref":"macula_peer_connector.html#send_message/3"},{"type":"function","doc":"Send a message to a remote peer with custom timeout.","title":"macula_peer_connector.send_message/4","ref":"macula_peer_connector.html#send_message/4"},{"type":"module","doc":"Peer System Supervisor - supervises the peer subsystem. Supervision Strategy: - rest_for_one: If child N crashes, restart N and all children after N - Rationale: connection_manager is foundational; handlers depend on it but are independent of each other. This provides fault isolation while maintaining consistency when connection_manager restarts. Architecture: <span class=\"w\">   </span><span class=\"nf\">macula_peer_system</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"2654825667-1\">(</span><span class=\"ss\">this</span><span class=\"w\"> </span><span class=\"ss\">module</span><span class=\"p\" data-group-id=\"2654825667-1\">)</span><span class=\"w\">\n   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_connection</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">QUIC</span><span class=\"w\"> </span><span class=\"ss\">connection</span><span class=\"w\"> </span><span class=\"nf\">lifecycle</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"2654825667-2\">(</span><span class=\"ss\">transport</span><span class=\"w\"> </span><span class=\"ss\">layer</span><span class=\"p\" data-group-id=\"2654825667-2\">)</span><span class=\"w\">\n   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_pubsub_handler</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Pub</span><span class=\"o\">/</span><span class=\"ss\">sub</span><span class=\"w\"> </span><span class=\"ss\">operations</span><span class=\"w\">\n   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_rpc_handler</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">RPC</span><span class=\"w\"> </span><span class=\"ss\">operations</span><span class=\"w\">\n   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_advertisement_manager</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">DHT</span><span class=\"w\"> </span><span class=\"ss\">service</span><span class=\"w\"> </span><span class=\"ss\">advertisements</span><span class=\"w\">\n   </span> Children (in dependency order): - macula_connection: QUIC connection lifecycle (foundational) - macula_pubsub_handler: Pub/sub operations (depends on connection) - macula_rpc_handler: RPC operations (depends on connection) - macula_advertisement_manager: DHT advertisements (depends on connection) Fault Isolation: - advertisement_manager crash  only advertisement restarts - rpc_handler crash  rpc + advertisement restart - pubsub_handler crash  pubsub + rpc + advertisement restart - connection crash  all restart (unavoidable - foundational) Renamed from macula_connection_sup (v0.7.10) to align with macula_peer nomenclature and macula_gateway_system naming convention.","title":"macula_peer_system","ref":"macula_peer_system.html"},{"type":"function","doc":"Initialize the supervisor with child specifications.","title":"macula_peer_system.init/1","ref":"macula_peer_system.html#init/1"},{"type":"function","doc":"Start the peer system supervisor with given URL and options.","title":"macula_peer_system.start_link/2","ref":"macula_peer_system.html#start_link/2"},{"type":"function","doc":"Stop the peer system supervisor and all children.","title":"macula_peer_system.stop/1","ref":"macula_peer_system.html#stop/1"},{"type":"module","doc":"Macula Peers Supervisor. This supervisor manages dynamic peer connections using a simple_one_for_one strategy. Each peer connection gets its own macula_peer_system supervisor with dedicated handlers. Architecture (v0.8.5): - One macula_peers_sup instance per Macula node - Dynamically adds/removes macula_peer_system children - Each child = one peer connection - simple_one_for_one strategy for efficient scaling Usage: <span class=\"w\">  </span><span class=\"c1\">%% Start new peer connection</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"2366723181-1\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PeerPid</span><span class=\"p\" data-group-id=\"2366723181-1\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peers_sup</span><span class=\"p\">:</span><span class=\"nf\">start_peer</span><span class=\"p\" data-group-id=\"2366723181-2\">(</span><span class=\"n\">Url</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Opts</span><span class=\"p\" data-group-id=\"2366723181-2\">)</span><span class=\"p\">.</span><span class=\"w\">\n \n  </span><span class=\"c1\">%% List all active peers</span><span class=\"w\">\n  </span><span class=\"n\">Peers</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peers_sup</span><span class=\"p\">:</span><span class=\"nf\">list_peers</span><span class=\"p\" data-group-id=\"2366723181-3\">(</span><span class=\"p\" data-group-id=\"2366723181-3\">)</span><span class=\"p\">.</span><span class=\"w\">\n \n  </span><span class=\"c1\">%% Count active peers</span><span class=\"w\">\n  </span><span class=\"n\">Count</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peers_sup</span><span class=\"p\">:</span><span class=\"nf\">count_peers</span><span class=\"p\" data-group-id=\"2366723181-4\">(</span><span class=\"p\" data-group-id=\"2366723181-4\">)</span><span class=\"p\">.</span><span class=\"w\">\n \n  </span><span class=\"c1\">%% Stop peer connection</span><span class=\"w\">\n  </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peers_sup</span><span class=\"p\">:</span><span class=\"nf\">stop_peer</span><span class=\"p\" data-group-id=\"2366723181-5\">(</span><span class=\"n\">PeerPid</span><span class=\"p\" data-group-id=\"2366723181-5\">)</span><span class=\"p\">.</span><span class=\"w\">\n  </span>","title":"macula_peers_sup","ref":"macula_peers_sup.html"},{"type":"function","doc":"Count active peer connections. Returns the number of currently running macula_peer_system supervisors.","title":"macula_peers_sup.count_peers/0","ref":"macula_peers_sup.html#count_peers/0"},{"type":"function","doc":"Initialize the peers supervisor. Sets up a simple_one_for_one supervisor for macula_peer_system children. Each child will be started with dynamic arguments (Url, Opts). Strategy: simple_one_for_one - Efficient for managing many similar children - Children started/stopped dynamically - All children use same child spec template Restart Strategy: temporary - Peer connections don't auto-restart on crash - Application decides when to reconnect - Prevents reconnection storms","title":"macula_peers_sup.init/1","ref":"macula_peers_sup.html#init/1"},{"type":"function","doc":"List all active peer connections. Returns a list of PIDs for all currently running macula_peer_system supervisors.","title":"macula_peers_sup.list_peers/0","ref":"macula_peers_sup.html#list_peers/0"},{"type":"function","doc":"Start the peers supervisor. Called by macula_root during application startup. Registers the supervisor with the local name macula_peers_sup.","title":"macula_peers_sup.start_link/0","ref":"macula_peers_sup.html#start_link/0"},{"type":"function","doc":"Start a new peer connection. Creates a new macula_peer_system supervisor for the peer at the given URL. The peer system will manage the connection lifecycle and all peer-specific handlers (pubsub, rpc, advertisements).","title":"macula_peers_sup.start_peer/2","ref":"macula_peers_sup.html#start_peer/2"},{"type":"function","doc":"Stop a peer connection. Gracefully terminates the macula_peer_system supervisor for the given peer. This will clean up all peer handlers and close the connection.","title":"macula_peers_sup.stop_peer/1","ref":"macula_peers_sup.html#stop_peer/1"},{"type":"module","doc":"Protocol message decoder for Macula mesh. Decodes binary wire format to message maps.","title":"macula_protocol_decoder","ref":"macula_protocol_decoder.html"},{"type":"function","doc":"Decode a binary message to {Type, Msg} tuple. Returns {ok, {Type, Msg}} on success or {error, Reason} on failure.","title":"macula_protocol_decoder.decode/1","ref":"macula_protocol_decoder.html#decode/1"},{"type":"module","doc":"Protocol message encoder for Macula mesh. Encodes message maps to binary wire format. Frame Format (8-byte header + payload): - Version (1 byte): Protocol version (currently 0x01) - Type (1 byte): Message type ID - Flags (1 byte): Reserved for future use (0x00) - Reserved (1 byte): Must be 0x00 - Payload Length (4 bytes): Big-endian uint32 - Payload (N bytes): MessagePack-encoded message data","title":"macula_protocol_encoder","ref":"macula_protocol_encoder.html"},{"type":"function","doc":"Encode a message to binary format. Returns a binary with 8-byte header + MessagePack payload.","title":"macula_protocol_encoder.encode/2","ref":"macula_protocol_encoder.html#encode/2"},{"type":"module","doc":"Protocol message type definitions and constants for Macula mesh. Defines all message types that can be sent over QUIC streams.","title":"macula_protocol_types","ref":"macula_protocol_types.html"},{"type":"type","doc":"","title":"macula_protocol_types.call_msg/0","ref":"macula_protocol_types.html#t:call_msg/0"},{"type":"type","doc":"","title":"macula_protocol_types.cast_msg/0","ref":"macula_protocol_types.html#t:cast_msg/0"},{"type":"type","doc":"","title":"macula_protocol_types.connect_msg/0","ref":"macula_protocol_types.html#t:connect_msg/0"},{"type":"type","doc":"","title":"macula_protocol_types.disconnect_msg/0","ref":"macula_protocol_types.html#t:disconnect_msg/0"},{"type":"type","doc":"","title":"macula_protocol_types.message/0","ref":"macula_protocol_types.html#t:message/0"},{"type":"type","doc":"","title":"macula_protocol_types.message_type/0","ref":"macula_protocol_types.html#t:message_type/0"},{"type":"function","doc":"Get numeric ID for a message type.","title":"macula_protocol_types.message_type_id/1","ref":"macula_protocol_types.html#message_type_id/1"},{"type":"function","doc":"Get message type name from numeric ID.","title":"macula_protocol_types.message_type_name/1","ref":"macula_protocol_types.html#message_type_name/1"},{"type":"type","doc":"","title":"macula_protocol_types.ping_msg/0","ref":"macula_protocol_types.html#t:ping_msg/0"},{"type":"type","doc":"","title":"macula_protocol_types.pong_msg/0","ref":"macula_protocol_types.html#t:pong_msg/0"},{"type":"type","doc":"","title":"macula_protocol_types.publish_msg/0","ref":"macula_protocol_types.html#t:publish_msg/0"},{"type":"type","doc":"","title":"macula_protocol_types.pubsub_route_msg/0","ref":"macula_protocol_types.html#t:pubsub_route_msg/0"},{"type":"type","doc":"","title":"macula_protocol_types.reply_msg/0","ref":"macula_protocol_types.html#t:reply_msg/0"},{"type":"type","doc":"","title":"macula_protocol_types.rpc_route_msg/0","ref":"macula_protocol_types.html#t:rpc_route_msg/0"},{"type":"type","doc":"","title":"macula_protocol_types.subscribe_msg/0","ref":"macula_protocol_types.html#t:subscribe_msg/0"},{"type":"type","doc":"","title":"macula_protocol_types.unsubscribe_msg/0","ref":"macula_protocol_types.html#t:unsubscribe_msg/0"},{"type":"module","doc":"Provider selection strategies for multi-provider RPC load balancing. Supports multiple strategies for choosing which provider to use when multiple providers advertise the same service. Strategies: - round_robin: Distribute calls evenly across providers - random: Random provider selection - first: Always use first provider (default/simple)","title":"macula_provider_selector","ref":"macula_provider_selector.html"},{"type":"type","doc":"Provider information returned from DHT.","title":"macula_provider_selector.provider_info/0","ref":"macula_provider_selector.html#t:provider_info/0"},{"type":"function","doc":"Select a provider from a list using the default strategy (random). Returns the selected provider or error if list is empty.","title":"macula_provider_selector.select_provider/2","ref":"macula_provider_selector.html#select_provider/2"},{"type":"function","doc":"Select a provider from a list using a specific strategy. Strategies: - first: Always select the first provider (simple, no state) - random: Randomly select a provider - round_robin: Distribute calls evenly using a counter Examples: <span class=\"w\">  </span><span class=\"c1\">%% Random selection</span><span class=\"w\">\n  </span><span class=\"n\">State</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">new_state</span><span class=\"p\" data-group-id=\"9397424782-1\">(</span><span class=\"ss\">random</span><span class=\"p\" data-group-id=\"9397424782-1\">)</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"9397424782-2\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Provider</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">State2</span><span class=\"p\" data-group-id=\"9397424782-2\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">select_provider</span><span class=\"p\" data-group-id=\"9397424782-3\">(</span><span class=\"n\">Providers</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">random</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">State</span><span class=\"p\" data-group-id=\"9397424782-3\">)</span><span class=\"p\">.</span><span class=\"w\">\n \n  </span><span class=\"c1\">%% Round-robin selection</span><span class=\"w\">\n  </span><span class=\"n\">State</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">new_state</span><span class=\"p\" data-group-id=\"9397424782-4\">(</span><span class=\"ss\">round_robin</span><span class=\"p\" data-group-id=\"9397424782-4\">)</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"9397424782-5\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">P1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">State2</span><span class=\"p\" data-group-id=\"9397424782-5\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">select_provider</span><span class=\"p\" data-group-id=\"9397424782-6\">(</span><span class=\"n\">Providers</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">round_robin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">State</span><span class=\"p\" data-group-id=\"9397424782-6\">)</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"9397424782-7\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">P2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">State3</span><span class=\"p\" data-group-id=\"9397424782-7\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">select_provider</span><span class=\"p\" data-group-id=\"9397424782-8\">(</span><span class=\"n\">Providers</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">round_robin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">State2</span><span class=\"p\" data-group-id=\"9397424782-8\">)</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"c1\">%% P1 and P2 will be different providers (if multiple available)</span>","title":"macula_provider_selector.select_provider/3","ref":"macula_provider_selector.html#select_provider/3"},{"type":"type","doc":"","title":"macula_provider_selector.selection_state/0","ref":"macula_provider_selector.html#t:selection_state/0"},{"type":"type","doc":"Selection strategy for choosing a provider from multiple options.","title":"macula_provider_selector.strategy/0","ref":"macula_provider_selector.html#t:strategy/0"},{"type":"module","doc":"LRU cache for remote subscriber lists. Caches DHT query results to avoid repeated lookups. Wraps macula_cache with subscriber-specific logic.","title":"macula_pubsub_cache","ref":"macula_pubsub_cache.html"},{"type":"type","doc":"","title":"macula_pubsub_cache.cache/0","ref":"macula_pubsub_cache.html#t:cache/0"},{"type":"function","doc":"Clear all entries.","title":"macula_pubsub_cache.clear/1","ref":"macula_pubsub_cache.html#clear/1"},{"type":"function","doc":"Get entry from cache. Returns {ok, Subscribers, UpdatedCache} or not_found. The updated cache has the entry moved to front (LRU).","title":"macula_pubsub_cache.get/2","ref":"macula_pubsub_cache.html#get/2"},{"type":"function","doc":"Invalidate (remove) entry.","title":"macula_pubsub_cache.invalidate/2","ref":"macula_pubsub_cache.html#invalidate/2"},{"type":"function","doc":"Check if entry is expired based on TTL. This checks if entry exists and its age exceeds TTL.","title":"macula_pubsub_cache.is_expired/3","ref":"macula_pubsub_cache.html#is_expired/3"},{"type":"function","doc":"Get max size.","title":"macula_pubsub_cache.max_size/1","ref":"macula_pubsub_cache.html#max_size/1"},{"type":"function","doc":"Create new cache with max size.","title":"macula_pubsub_cache.new/1","ref":"macula_pubsub_cache.html#new/1"},{"type":"function","doc":"Put entry in cache.","title":"macula_pubsub_cache.put/3","ref":"macula_pubsub_cache.html#put/3"},{"type":"function","doc":"Put entry with custom timestamp (for testing).","title":"macula_pubsub_cache.put_with_timestamp/4","ref":"macula_pubsub_cache.html#put_with_timestamp/4"},{"type":"function","doc":"Get number of entries.","title":"macula_pubsub_cache.size/1","ref":"macula_pubsub_cache.html#size/1"},{"type":"module","doc":"Message routing and delivery to local and remote subscribers. Combines local registry and remote discovery for full fan-out.","title":"macula_pubsub_delivery","ref":"macula_pubsub_delivery.html"},{"type":"function","doc":"Deliver message to all matching local subscribers. Crashes if subscriber callback fails - indicates dead subscriber process.","title":"macula_pubsub_delivery.deliver_local/2","ref":"macula_pubsub_delivery.html#deliver_local/2"},{"type":"function","doc":"Deliver message to remote subscribers via QUIC.","title":"macula_pubsub_delivery.deliver_remote/3","ref":"macula_pubsub_delivery.html#deliver_remote/3"},{"type":"type","doc":"","title":"macula_pubsub_delivery.delivery_result/0","ref":"macula_pubsub_delivery.html#t:delivery_result/0"},{"type":"type","doc":"","title":"macula_pubsub_delivery.discovery_fun/0","ref":"macula_pubsub_delivery.html#t:discovery_fun/0"},{"type":"function","doc":"Get all unique patterns that match the topic. Used for remote subscriber discovery.","title":"macula_pubsub_delivery.get_matching_patterns/2","ref":"macula_pubsub_delivery.html#get_matching_patterns/2"},{"type":"type","doc":"","title":"macula_pubsub_delivery.message/0","ref":"macula_pubsub_delivery.html#t:message/0"},{"type":"function","doc":"Publish message to both local and remote subscribers. Returns {LocalResults, RemoteResults}.","title":"macula_pubsub_delivery.publish/4","ref":"macula_pubsub_delivery.html#publish/4"},{"type":"type","doc":"","title":"macula_pubsub_delivery.send_fun/0","ref":"macula_pubsub_delivery.html#t:send_fun/0"},{"type":"module","doc":"DHT operations for pub/sub - handles subscription advertisement and discovery. Responsibilities: - Advertise subscriptions in DHT with TTL - Schedule re-advertisement timers - Discover remote subscribers via DHT queries - Route messages to remote subscribers - Track pending DHT queries Extracted from macula_pubsub_handler.erl (Phase 3)","title":"macula_pubsub_dht","ref":"macula_pubsub_dht.html"},{"type":"function","doc":"Advertise a subscription in the DHT. Sends STORE message to DHT and schedules re-advertisement. Returns {ok, SubInfo}.","title":"macula_pubsub_dht.advertise_subscription/5","ref":"macula_pubsub_dht.html#advertise_subscription/5"},{"type":"type","doc":"","title":"macula_pubsub_dht.advertised_subscriptions/0","ref":"macula_pubsub_dht.html#t:advertised_subscriptions/0"},{"type":"function","doc":"Cancel advertisement for a topic. Cancels the re-advertisement timer. Returns updated advertised_subscriptions map.","title":"macula_pubsub_dht.cancel_advertisement/2","ref":"macula_pubsub_dht.html#cancel_advertisement/2"},{"type":"type","doc":"","title":"macula_pubsub_dht.connection_manager_pid/0","ref":"macula_pubsub_dht.html#t:connection_manager_pid/0"},{"type":"function","doc":"Discover remote subscribers for a topic. Checks cache first, queries DHT on cache miss. Returns {cached, Subscribers, Registry} | {query_sent, Pending, MsgId, Registry}.","title":"macula_pubsub_dht.discover_subscribers/6","ref":"macula_pubsub_dht.html#discover_subscribers/6"},{"type":"function","doc":"Handle DHT discovery response. Routes messages to discovered subscribers. Returns updated pending queries map.","title":"macula_pubsub_dht.handle_discovery_response/3","ref":"macula_pubsub_dht.html#handle_discovery_response/3"},{"type":"type","doc":"","title":"macula_pubsub_dht.node_id/0","ref":"macula_pubsub_dht.html#t:node_id/0"},{"type":"type","doc":"","title":"macula_pubsub_dht.payload/0","ref":"macula_pubsub_dht.html#t:payload/0"},{"type":"type","doc":"","title":"macula_pubsub_dht.pending_queries/0","ref":"macula_pubsub_dht.html#t:pending_queries/0"},{"type":"type","doc":"","title":"macula_pubsub_dht.qos/0","ref":"macula_pubsub_dht.html#t:qos/0"},{"type":"function","doc":"Route message to remote subscribers via direct P2P connections (v0.8.0+). Wraps publish in pubsub_route envelope and sends directly to each subscriber. Uses macula_peer_connector for direct QUIC connections to subscriber endpoints.","title":"macula_pubsub_dht.route_to_subscribers/5","ref":"macula_pubsub_dht.html#route_to_subscribers/5"},{"type":"type","doc":"","title":"macula_pubsub_dht.subscription_ref/0","ref":"macula_pubsub_dht.html#t:subscription_ref/0"},{"type":"type","doc":"","title":"macula_pubsub_dht.topic/0","ref":"macula_pubsub_dht.html#t:topic/0"},{"type":"type","doc":"","title":"macula_pubsub_dht.url/0","ref":"macula_pubsub_dht.html#t:url/0"},{"type":"module","doc":"DHT integration for finding remote subscribers. Uses Kademlia DHT to publish and discover subscriptions. Wraps macula_discovery with pub/sub-specific types.","title":"macula_pubsub_discovery","ref":"macula_pubsub_discovery.html"},{"type":"type","doc":"","title":"macula_pubsub_discovery.address/0","ref":"macula_pubsub_discovery.html#t:address/0"},{"type":"function","doc":"Announce local subscription to DHT.","title":"macula_pubsub_discovery.announce/4","ref":"macula_pubsub_discovery.html#announce/4"},{"type":"type","doc":"","title":"macula_pubsub_discovery.dht_lookup_fun/0","ref":"macula_pubsub_discovery.html#t:dht_lookup_fun/0"},{"type":"type","doc":"","title":"macula_pubsub_discovery.dht_publish_fun/0","ref":"macula_pubsub_discovery.html#t:dht_publish_fun/0"},{"type":"type","doc":"","title":"macula_pubsub_discovery.dht_unpublish_fun/0","ref":"macula_pubsub_discovery.html#t:dht_unpublish_fun/0"},{"type":"function","doc":"Find remote subscribers for a pattern via DHT.","title":"macula_pubsub_discovery.find_subscribers/2","ref":"macula_pubsub_discovery.html#find_subscribers/2"},{"type":"function","doc":"Find subscribers with cache (default TTL: 300 seconds).","title":"macula_pubsub_discovery.find_with_cache/3","ref":"macula_pubsub_discovery.html#find_with_cache/3"},{"type":"function","doc":"Find subscribers with cache and custom TTL.","title":"macula_pubsub_discovery.find_with_cache/4","ref":"macula_pubsub_discovery.html#find_with_cache/4"},{"type":"type","doc":"","title":"macula_pubsub_discovery.node_id/0","ref":"macula_pubsub_discovery.html#t:node_id/0"},{"type":"type","doc":"","title":"macula_pubsub_discovery.pattern/0","ref":"macula_pubsub_discovery.html#t:pattern/0"},{"type":"type","doc":"","title":"macula_pubsub_discovery.subscriber/0","ref":"macula_pubsub_discovery.html#t:subscriber/0"},{"type":"function","doc":"Remove local subscription from DHT.","title":"macula_pubsub_discovery.unannounce/3","ref":"macula_pubsub_discovery.html#unannounce/3"},{"type":"module","doc":"PubSub handler GenServer - facade that orchestrates pub/sub operations. This module acts as a facade/coordinator, delegating business logic to: - macula_pubsub_subscription: Subscription storage, pattern matching, callbacks - macula_pubsub_dht: DHT advertisement, discovery, routing - macula_pubsub_qos: QoS 1 tracking and retry logic Responsibilities: - API facade for subscribe/unsubscribe/publish operations - Message routing coordination between specialized modules - GenServer lifecycle management - State management (delegates actual operations to modules) Extracted from macula_connection.erl (Phase 4) Refactored using TDD to extract god module (Phase 5)","title":"macula_pubsub_handler","ref":"macula_pubsub_handler.html"},{"type":"function","doc":"","title":"macula_pubsub_handler.handle_call/3","ref":"macula_pubsub_handler.html#handle_call/3"},{"type":"function","doc":"","title":"macula_pubsub_handler.handle_cast/2","ref":"macula_pubsub_handler.html#handle_cast/2"},{"type":"function","doc":"","title":"macula_pubsub_handler.handle_incoming_publish/2","ref":"macula_pubsub_handler.html#handle_incoming_publish/2"},{"type":"function","doc":"","title":"macula_pubsub_handler.handle_info/2","ref":"macula_pubsub_handler.html#handle_info/2"},{"type":"function","doc":"","title":"macula_pubsub_handler.init/1","ref":"macula_pubsub_handler.html#init/1"},{"type":"function","doc":"","title":"macula_pubsub_handler.publish/4","ref":"macula_pubsub_handler.html#publish/4"},{"type":"function","doc":"","title":"macula_pubsub_handler.start_link/1","ref":"macula_pubsub_handler.html#start_link/1"},{"type":"function","doc":"","title":"macula_pubsub_handler.subscribe/3","ref":"macula_pubsub_handler.html#subscribe/3"},{"type":"function","doc":"","title":"macula_pubsub_handler.terminate/2","ref":"macula_pubsub_handler.html#terminate/2"},{"type":"function","doc":"","title":"macula_pubsub_handler.unsubscribe/2","ref":"macula_pubsub_handler.html#unsubscribe/2"},{"type":"module","doc":"QoS (Quality of Service) manager for pub/sub. Handles QoS 1 (at-least-once delivery) logic: - Message tracking with timeout timers - Automatic retry on timeout (up to max retries) - Acknowledgment handling Extracted from macula_pubsub_handler.erl (Phase 2)","title":"macula_pubsub_qos","ref":"macula_pubsub_qos.html"},{"type":"type","doc":"","title":"macula_pubsub_qos.connection_manager_pid/0","ref":"macula_pubsub_qos.html#t:connection_manager_pid/0"},{"type":"function","doc":"Get list of pending message IDs (for testing/debugging).","title":"macula_pubsub_qos.get_pending/1","ref":"macula_pubsub_qos.html#get_pending/1"},{"type":"function","doc":"Handle acknowledgment for a message. Cancels timer and removes message from pending map. Returns updated pending_pubacks map.","title":"macula_pubsub_qos.handle_ack/2","ref":"macula_pubsub_qos.html#handle_ack/2"},{"type":"function","doc":"Handle timeout for a pending message. Retries sending if under max retries, otherwise gives up. Returns {retry, UpdatedPending, PublishMsg} | {give_up, UpdatedPending}.","title":"macula_pubsub_qos.handle_timeout/3","ref":"macula_pubsub_qos.html#handle_timeout/3"},{"type":"type","doc":"","title":"macula_pubsub_qos.message_id/0","ref":"macula_pubsub_qos.html#t:message_id/0"},{"type":"type","doc":"","title":"macula_pubsub_qos.payload/0","ref":"macula_pubsub_qos.html#t:payload/0"},{"type":"type","doc":"","title":"macula_pubsub_qos.pending_pubacks/0","ref":"macula_pubsub_qos.html#t:pending_pubacks/0"},{"type":"type","doc":"","title":"macula_pubsub_qos.qos/0","ref":"macula_pubsub_qos.html#t:qos/0"},{"type":"type","doc":"","title":"macula_pubsub_qos.retry_count/0","ref":"macula_pubsub_qos.html#t:retry_count/0"},{"type":"type","doc":"","title":"macula_pubsub_qos.timer_ref/0","ref":"macula_pubsub_qos.html#t:timer_ref/0"},{"type":"type","doc":"","title":"macula_pubsub_qos.topic/0","ref":"macula_pubsub_qos.html#t:topic/0"},{"type":"function","doc":"Track a message for QoS 1 acknowledgment. Starts a timeout timer and stores message in pending map. Returns updated pending_pubacks map.","title":"macula_pubsub_qos.track_message/5","ref":"macula_pubsub_qos.html#track_message/5"},{"type":"module","doc":"Local subscription registry for pub/sub. Maps topic patterns to local subscribers (callback PIDs).","title":"macula_pubsub_registry","ref":"macula_pubsub_registry.html"},{"type":"function","doc":"Get specific subscription.","title":"macula_pubsub_registry.get_subscription/3","ref":"macula_pubsub_registry.html#get_subscription/3"},{"type":"function","doc":"List all unique patterns.","title":"macula_pubsub_registry.list_patterns/1","ref":"macula_pubsub_registry.html#list_patterns/1"},{"type":"function","doc":"Find subscriptions matching a topic.","title":"macula_pubsub_registry.match/2","ref":"macula_pubsub_registry.html#match/2"},{"type":"function","doc":"Create new empty registry.","title":"macula_pubsub_registry.new/0","ref":"macula_pubsub_registry.html#new/0"},{"type":"type","doc":"","title":"macula_pubsub_registry.registry/0","ref":"macula_pubsub_registry.html#t:registry/0"},{"type":"function","doc":"Get number of subscriptions.","title":"macula_pubsub_registry.size/1","ref":"macula_pubsub_registry.html#size/1"},{"type":"function","doc":"Subscribe to a pattern. If subscription already exists (same subscriber_id + pattern), updates callback.","title":"macula_pubsub_registry.subscribe/4","ref":"macula_pubsub_registry.html#subscribe/4"},{"type":"type","doc":"","title":"macula_pubsub_registry.subscription/0","ref":"macula_pubsub_registry.html#t:subscription/0"},{"type":"function","doc":"Unsubscribe from a pattern.","title":"macula_pubsub_registry.unsubscribe/3","ref":"macula_pubsub_registry.html#unsubscribe/3"},{"type":"module","doc":"Pub/Sub routing for multi-hop DHT-routed pub/sub. Handles wrapping, unwrapping, and routing of PUBLISH messages through the Kademlia DHT mesh. Pattern: Clone of macula_rpc_routing for pub/sub messages","title":"macula_pubsub_routing","ref":"macula_pubsub_routing.html"},{"type":"function","doc":"Route a pubsub_route message: either deliver locally or forward to next hop. Returns one of: {deliver, Topic, PublishMsg} - Message is for this node {forward, NextHopNodeInfo, UpdatedPubSubRouteMsg} - Forward to next hop {error, Reason} - Cannot route (TTL exceeded, no route, etc.)","title":"macula_pubsub_routing.route_or_deliver/3","ref":"macula_pubsub_routing.html#route_or_deliver/3"},{"type":"function","doc":"Determine if this node should deliver the message locally or forward it.","title":"macula_pubsub_routing.should_deliver_locally/2","ref":"macula_pubsub_routing.html#should_deliver_locally/2"},{"type":"function","doc":"Wrap a PUBLISH message in pubsub_route envelope for DHT routing.","title":"macula_pubsub_routing.wrap_publish/4","ref":"macula_pubsub_routing.html#wrap_publish/4"},{"type":"module","doc":"Pub/Sub GenServer - manages subscriptions and message delivery. Ties together registry, cache, discovery, and delivery layers.","title":"macula_pubsub_server","ref":"macula_pubsub_server.html"},{"type":"function","doc":"Get cache statistics.","title":"macula_pubsub_server.cache_stats/1","ref":"macula_pubsub_server.html#cache_stats/1"},{"type":"function","doc":"List all unique patterns.","title":"macula_pubsub_server.list_patterns/1","ref":"macula_pubsub_server.html#list_patterns/1"},{"type":"function","doc":"List all subscriptions.","title":"macula_pubsub_server.list_subscriptions/1","ref":"macula_pubsub_server.html#list_subscriptions/1"},{"type":"type","doc":"","title":"macula_pubsub_server.options/0","ref":"macula_pubsub_server.html#t:options/0"},{"type":"function","doc":"Publish message to all matching subscribers.","title":"macula_pubsub_server.publish/2","ref":"macula_pubsub_server.html#publish/2"},{"type":"function","doc":"Start server with default options.","title":"macula_pubsub_server.start_link/0","ref":"macula_pubsub_server.html#start_link/0"},{"type":"function","doc":"Start server with options.","title":"macula_pubsub_server.start_link/1","ref":"macula_pubsub_server.html#start_link/1"},{"type":"function","doc":"Stop server.","title":"macula_pubsub_server.stop/1","ref":"macula_pubsub_server.html#stop/1"},{"type":"function","doc":"Subscribe to a pattern.","title":"macula_pubsub_server.subscribe/4","ref":"macula_pubsub_server.html#subscribe/4"},{"type":"function","doc":"Get subscription count.","title":"macula_pubsub_server.subscription_count/1","ref":"macula_pubsub_server.html#subscription_count/1"},{"type":"function","doc":"Unsubscribe from a pattern.","title":"macula_pubsub_server.unsubscribe/3","ref":"macula_pubsub_server.html#unsubscribe/3"},{"type":"module","doc":"Subscription management for pub/sub. Responsibilities: - Store and retrieve subscriptions - Pattern matching with wildcards (*, **) - Find matching subscriptions for a topic - Invoke subscriber callbacks Extracted from macula_pubsub_handler.erl (Phase 4)","title":"macula_pubsub_subscription","ref":"macula_pubsub_subscription.html"},{"type":"function","doc":"Add a subscription. Returns {ok, UpdatedSubscriptions, SubRef}.","title":"macula_pubsub_subscription.add_subscription/4","ref":"macula_pubsub_subscription.html#add_subscription/4"},{"type":"type","doc":"","title":"macula_pubsub_subscription.callback/0","ref":"macula_pubsub_subscription.html#t:callback/0"},{"type":"function","doc":"Find matching subscriptions for a topic. Returns list of {SubRef, {Pattern, Callback}} tuples.","title":"macula_pubsub_subscription.find_matches/3","ref":"macula_pubsub_subscription.html#find_matches/3"},{"type":"function","doc":"Invoke callbacks for matching subscriptions. Spawns async tasks to invoke each callback.","title":"macula_pubsub_subscription.invoke_callbacks/4","ref":"macula_pubsub_subscription.html#invoke_callbacks/4"},{"type":"type","doc":"","title":"macula_pubsub_subscription.node_id/0","ref":"macula_pubsub_subscription.html#t:node_id/0"},{"type":"type","doc":"","title":"macula_pubsub_subscription.payload/0","ref":"macula_pubsub_subscription.html#t:payload/0"},{"type":"function","doc":"Remove a subscription. Returns {ok, UpdatedSubscriptions, Topic} | {error, not_found}.","title":"macula_pubsub_subscription.remove_subscription/2","ref":"macula_pubsub_subscription.html#remove_subscription/2"},{"type":"type","doc":"","title":"macula_pubsub_subscription.subscription_ref/0","ref":"macula_pubsub_subscription.html#t:subscription_ref/0"},{"type":"type","doc":"","title":"macula_pubsub_subscription.subscriptions/0","ref":"macula_pubsub_subscription.html#t:subscriptions/0"},{"type":"type","doc":"","title":"macula_pubsub_subscription.topic/0","ref":"macula_pubsub_subscription.html#t:topic/0"},{"type":"module","doc":"Topic utilities for pub/sub system. Handles topic validation, pattern matching, and normalization. Supports MQTT-style wildcards: * (single-level) and # (multi-level).","title":"macula_pubsub_topic","ref":"macula_pubsub_topic.html"},{"type":"function","doc":"Check if topic matches pattern. Patterns can contain: - * matches exactly one segment - # matches zero or more segments","title":"macula_pubsub_topic.matches/2","ref":"macula_pubsub_topic.html#matches/2"},{"type":"function","doc":"Extract namespace (first segment).","title":"macula_pubsub_topic.namespace/1","ref":"macula_pubsub_topic.html#namespace/1"},{"type":"function","doc":"Normalize topic (lowercase, trim, remove double dots).","title":"macula_pubsub_topic.normalize/1","ref":"macula_pubsub_topic.html#normalize/1"},{"type":"type","doc":"","title":"macula_pubsub_topic.pattern/0","ref":"macula_pubsub_topic.html#t:pattern/0"},{"type":"function","doc":"Count number of segments in topic.","title":"macula_pubsub_topic.segment_count/1","ref":"macula_pubsub_topic.html#segment_count/1"},{"type":"type","doc":"","title":"macula_pubsub_topic.topic/0","ref":"macula_pubsub_topic.html#t:topic/0"},{"type":"function","doc":"Validate topic syntax. Valid topics: - Non-empty - Segments separated by dots - Segments contain alphanumeric, underscore, hyphen, wildcards - No leading or trailing dots","title":"macula_pubsub_topic.validate/1","ref":"macula_pubsub_topic.html#validate/1"},{"type":"module","doc":"Main API module for Macula QUIC transport. Provides a simplified wrapper around the quicer library.","title":"macula_quic","ref":"macula_quic.html"},{"type":"function","doc":"Accept an incoming connection on a listener. After accepting, the connection needs handshake to complete.","title":"macula_quic.accept/2","ref":"macula_quic.html#accept/2"},{"type":"function","doc":"Accept an incoming stream on a connection.","title":"macula_quic.accept_stream/2","ref":"macula_quic.html#accept_stream/2"},{"type":"function","doc":"Send data on a stream asynchronously (non-blocking). This returns immediately without waiting for QUIC flow control.","title":"macula_quic.async_send/2","ref":"macula_quic.html#async_send/2"},{"type":"function","doc":"Close a listener, connection, or stream.","title":"macula_quic.close/1","ref":"macula_quic.html#close/1"},{"type":"function","doc":"Connect to a QUIC server. Options: {alpn, [Protocol]} - List of ALPN protocols {verify, none | verify_peer} - Certificate verification mode","title":"macula_quic.connect/4","ref":"macula_quic.html#connect/4"},{"type":"function","doc":"Start a QUIC listener on the specified port. Options: {cert, CertFile} - Path to PEM certificate file {key, KeyFile} - Path to PEM private key file {alpn, [Protocol]} - List of ALPN protocols (e.g., [\"macula\"]) {peer_unidi_stream_count, N} - Max unidirectional streams {peer_bidi_stream_count, N} - Max bidirectional streams","title":"macula_quic.listen/2","ref":"macula_quic.html#listen/2"},{"type":"function","doc":"Open a new bidirectional stream on a connection.","title":"macula_quic.open_stream/1","ref":"macula_quic.html#open_stream/1"},{"type":"function","doc":"Receive data from a stream (blocking).","title":"macula_quic.recv/2","ref":"macula_quic.html#recv/2"},{"type":"function","doc":"Send data on a stream (blocking).","title":"macula_quic.send/2","ref":"macula_quic.html#send/2"},{"type":"module","doc":"Macula QUIC certificate utilities. Provides functions for generating and validating self-signed certificates for QUIC connections via OpenSSL command-line tool.","title":"macula_quic_cert","ref":"macula_quic_cert.html"},{"type":"function","doc":"Generate a self-signed certificate and key in a temporary directory. Returns {ok, CertFile, KeyFile} with paths to generated files. The files are created in /tmp/macula_certs_PID for test isolation.","title":"macula_quic_cert.generate_self_signed/0","ref":"macula_quic_cert.html#generate_self_signed/0"},{"type":"function","doc":"Generate a self-signed certificate and key in the given directory. Returns {ok, {CertFile, KeyFile}} with paths to generated files.","title":"macula_quic_cert.generate_self_signed/1","ref":"macula_quic_cert.html#generate_self_signed/1"},{"type":"function","doc":"Generate a self-signed certificate with custom options. Options: subject - Certificate subject (default: \"/CN=macula.local\") validity_days - Validity period in days (default: 365)","title":"macula_quic_cert.generate_self_signed/2","ref":"macula_quic_cert.html#generate_self_signed/2"},{"type":"function","doc":"Validate that both certificate and key files exist and are readable.","title":"macula_quic_cert.validate_files/2","ref":"macula_quic_cert.html#validate_files/2"},{"type":"module","doc":"QUIC connection callback module for Macula. Implements quicer_connection behavior to handle connection lifecycle.","title":"macula_quic_conn_callback","ref":"macula_quic_conn_callback.html"},{"type":"function","doc":"Handle connection closed","title":"macula_quic_conn_callback.closed/3","ref":"macula_quic_conn_callback.html#closed/3"},{"type":"function","doc":"Handle connection established","title":"macula_quic_conn_callback.connected/3","ref":"macula_quic_conn_callback.html#connected/3"},{"type":"function","doc":"Handle other messages","title":"macula_quic_conn_callback.handle_info/2","ref":"macula_quic_conn_callback.html#handle_info/2"},{"type":"function","doc":"Initialize connection callback state","title":"macula_quic_conn_callback.init/1","ref":"macula_quic_conn_callback.html#init/1"},{"type":"function","doc":"Handle local address changed","title":"macula_quic_conn_callback.local_address_changed/3","ref":"macula_quic_conn_callback.html#local_address_changed/3"},{"type":"function","doc":"Handle new connection With quicer_server, streams are delivered automatically via new_stream/3","title":"macula_quic_conn_callback.new_conn/3","ref":"macula_quic_conn_callback.html#new_conn/3"},{"type":"function","doc":"Handle new stream With quicer_server, ALL streams are delivered here (not just orphans) Forward them to the gateway for processing","title":"macula_quic_conn_callback.new_stream/3","ref":"macula_quic_conn_callback.html#new_stream/3"},{"type":"function","doc":"Handle NST received (not used for server)","title":"macula_quic_conn_callback.nst_received/3","ref":"macula_quic_conn_callback.html#nst_received/3"},{"type":"function","doc":"Handle peer address changed","title":"macula_quic_conn_callback.peer_address_changed/3","ref":"macula_quic_conn_callback.html#peer_address_changed/3"},{"type":"function","doc":"Handle peer needs streams","title":"macula_quic_conn_callback.peer_needs_streams/3","ref":"macula_quic_conn_callback.html#peer_needs_streams/3"},{"type":"function","doc":"Handle connection resumed","title":"macula_quic_conn_callback.resumed/3","ref":"macula_quic_conn_callback.html#resumed/3"},{"type":"function","doc":"Handle connection shutdown","title":"macula_quic_conn_callback.shutdown/3","ref":"macula_quic_conn_callback.html#shutdown/3"},{"type":"function","doc":"Handle streams available","title":"macula_quic_conn_callback.streams_available/3","ref":"macula_quic_conn_callback.html#streams_available/3"},{"type":"function","doc":"Handle transport shutdown","title":"macula_quic_conn_callback.transport_shutdown/3","ref":"macula_quic_conn_callback.html#transport_shutdown/3"},{"type":"module","doc":"QUIC stream acceptor process. Dedicated process that waits for incoming streams on a connection and forwards them to the gateway for processing.","title":"macula_quic_stream_acceptor","ref":"macula_quic_stream_acceptor.html"},{"type":"function","doc":"","title":"macula_quic_stream_acceptor.handle_call/3","ref":"macula_quic_stream_acceptor.html#handle_call/3"},{"type":"function","doc":"","title":"macula_quic_stream_acceptor.handle_cast/2","ref":"macula_quic_stream_acceptor.html#handle_cast/2"},{"type":"function","doc":"Handle new stream from peer - THIS IS THE KEY MESSAGE!","title":"macula_quic_stream_acceptor.handle_info/2","ref":"macula_quic_stream_acceptor.html#handle_info/2"},{"type":"function","doc":"","title":"macula_quic_stream_acceptor.init/1","ref":"macula_quic_stream_acceptor.html#init/1"},{"type":"function","doc":"Start stream acceptor process","title":"macula_quic_stream_acceptor.start_link/2","ref":"macula_quic_stream_acceptor.html#start_link/2"},{"type":"function","doc":"","title":"macula_quic_stream_acceptor.terminate/2","ref":"macula_quic_stream_acceptor.html#terminate/2"},{"type":"module","doc":"Realm management and validation. Realms provide logical isolation boundaries in the mesh. Realm names follow reverse DNS notation (e.g., \"org.example.mesh\").","title":"macula_realm","ref":"macula_realm.html"},{"type":"function","doc":"Check if two realm names are equal.","title":"macula_realm.equals/2","ref":"macula_realm.html#equals/2"},{"type":"function","doc":"Decode realm name from binary.","title":"macula_realm.from_binary/1","ref":"macula_realm.html#from_binary/1"},{"type":"function","doc":"Generate deterministic realm ID from name. Uses SHA-256 hash for 256-bit realm IDs.","title":"macula_realm.id/1","ref":"macula_realm.html#id/1"},{"type":"function","doc":"Extract namespace (top-level domain) from realm name. Example: \"org.example.mesh\" -> \"org\"","title":"macula_realm.namespace/1","ref":"macula_realm.html#namespace/1"},{"type":"function","doc":"Normalize realm name (lowercase, trim).","title":"macula_realm.normalize/1","ref":"macula_realm.html#normalize/1"},{"type":"type","doc":"32-byte SHA-256 hash","title":"macula_realm.realm_id/0","ref":"macula_realm.html#t:realm_id/0"},{"type":"type","doc":"","title":"macula_realm.realm_name/0","ref":"macula_realm.html#t:realm_name/0"},{"type":"function","doc":"Encode realm name to binary.","title":"macula_realm.to_binary/1","ref":"macula_realm.html#to_binary/1"},{"type":"function","doc":"Validate realm name format. Rules: - Reverse DNS notation (org.example.mesh) - Lowercase alphanumeric, dots, hyphens, underscores - No leading/trailing dots - No consecutive dots","title":"macula_realm.validate/1","ref":"macula_realm.html#validate/1"},{"type":"module","doc":"Macula Application Root Supervisor. This is the top-level supervisor for the Macula application. It manages all Macula subsystems in an always-on architecture. Supervision Hierarchy (v0.8.5+): <span class=\"w\">  </span><span class=\"nf\">macula_root</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9482189242-1\">(</span><span class=\"ss\">this</span><span class=\"w\"> </span><span class=\"ss\">module</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"ss\">application</span><span class=\"w\"> </span><span class=\"ss\">root</span><span class=\"p\" data-group-id=\"9482189242-1\">)</span><span class=\"w\">\n  </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"nf\">macula_routing_server</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9482189242-2\">(</span><span class=\"ss\">core</span><span class=\"w\"> </span><span class=\"n\">DHT</span><span class=\"w\"> </span><span class=\"ss\">infrastructure</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"ss\">always</span><span class=\"w\"> </span><span class=\"ss\">on</span><span class=\"p\" data-group-id=\"9482189242-2\">)</span><span class=\"w\">\n  </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"nf\">macula_bootstrap_system</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9482189242-3\">(</span><span class=\"ss\">bootstrap</span><span class=\"w\"> </span><span class=\"ss\">services</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"ss\">always</span><span class=\"w\"> </span><span class=\"ss\">on</span><span class=\"p\" data-group-id=\"9482189242-3\">)</span><span class=\"w\">\n  </span><span class=\"err\"></span><span class=\"w\">   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_bootstrap_server</span><span class=\"w\">\n  </span><span class=\"err\"></span><span class=\"w\">   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_bootstrap_registry</span><span class=\"w\">\n  </span><span class=\"err\"></span><span class=\"w\">   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_bootstrap_health</span><span class=\"w\">\n  </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"nf\">macula_gateway_system</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9482189242-4\">(</span><span class=\"ss\">gateway</span><span class=\"w\"> </span><span class=\"ss\">services</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"ss\">always</span><span class=\"w\"> </span><span class=\"ss\">on</span><span class=\"p\" data-group-id=\"9482189242-4\">)</span><span class=\"w\">\n  </span><span class=\"err\"></span><span class=\"w\">   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_health</span><span class=\"w\">\n  </span><span class=\"err\"></span><span class=\"w\">   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_diagnostics</span><span class=\"w\">\n  </span><span class=\"err\"></span><span class=\"w\">   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_quic_server</span><span class=\"w\">\n  </span><span class=\"err\"></span><span class=\"w\">   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway</span><span class=\"w\">\n  </span><span class=\"err\"></span><span class=\"w\">   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_workers_sup</span><span class=\"w\">\n  </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"nf\">macula_peers_sup</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9482189242-5\">(</span><span class=\"ss\">dynamic</span><span class=\"w\"> </span><span class=\"ss\">peer</span><span class=\"w\"> </span><span class=\"ss\">connections</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"ss\">always</span><span class=\"w\"> </span><span class=\"ss\">on</span><span class=\"p\" data-group-id=\"9482189242-5\">)</span><span class=\"w\">\n  </span> Architecture Philosophy (v0.8.5): - All nodes have ALL capabilities (no mode selection) - Zero configuration required (TLS auto-generated) - Simplified deployment (every node is bootstrap + gateway + peer) - True P2P mesh (nodes connect on-demand based on capability discovery) Naming Convention (v0.7.10+): - _root: Application root supervisor (one per application) - _system: Subsystem root supervisors (gateway, peer, bootstrap, etc.) - _sup: Worker supervisors (workers_sup, peers_sup)","title":"macula_root","ref":"macula_root.html"},{"type":"function","doc":"","title":"macula_root.init/1","ref":"macula_root.html#init/1"},{"type":"function","doc":"","title":"macula_root.start_link/0","ref":"macula_root.html#start_link/0"},{"type":"module","doc":"K-bucket for Kademlia routing table. Stores up to k nodes with LRU eviction policy.","title":"macula_routing_bucket","ref":"macula_routing_bucket.html"},{"type":"function","doc":"Add a node to the bucket. If node exists, move to tail (most recent). If bucket full, return {error, bucket_full}.","title":"macula_routing_bucket.add_node/2","ref":"macula_routing_bucket.html#add_node/2"},{"type":"type","doc":"","title":"macula_routing_bucket.bucket/0","ref":"macula_routing_bucket.html#t:bucket/0"},{"type":"function","doc":"Get bucket capacity.","title":"macula_routing_bucket.capacity/1","ref":"macula_routing_bucket.html#capacity/1"},{"type":"function","doc":"Find n closest nodes to target (sorted by XOR distance).","title":"macula_routing_bucket.find_closest/3","ref":"macula_routing_bucket.html#find_closest/3"},{"type":"function","doc":"Find a node by ID.","title":"macula_routing_bucket.find_node/2","ref":"macula_routing_bucket.html#find_node/2"},{"type":"function","doc":"Get all nodes in the bucket (ordered: oldest first).","title":"macula_routing_bucket.get_nodes/1","ref":"macula_routing_bucket.html#get_nodes/1"},{"type":"function","doc":"Check if bucket contains node.","title":"macula_routing_bucket.has_node/2","ref":"macula_routing_bucket.html#has_node/2"},{"type":"function","doc":"Create a new bucket with capacity k.","title":"macula_routing_bucket.new/1","ref":"macula_routing_bucket.html#new/1"},{"type":"type","doc":"","title":"macula_routing_bucket.node_info/0","ref":"macula_routing_bucket.html#t:node_info/0"},{"type":"function","doc":"Remove a node from the bucket.","title":"macula_routing_bucket.remove_node/2","ref":"macula_routing_bucket.html#remove_node/2"},{"type":"function","doc":"Get number of nodes in bucket.","title":"macula_routing_bucket.size/1","ref":"macula_routing_bucket.html#size/1"},{"type":"function","doc":"Update node's last_seen timestamp (moves to tail).","title":"macula_routing_bucket.update_timestamp/2","ref":"macula_routing_bucket.html#update_timestamp/2"},{"type":"module","doc":"Core DHT algorithms for Kademlia routing. Implements iterative lookup, store, and find operations. Pure functions - no GenServer, designed to be called by macula_routing_server.","title":"macula_routing_dht","ref":"macula_routing_dht.html"},{"type":"function","doc":"Find value in DHT. Returns {ok, Value} if found, {nodes, [NodeInfo]} if not found.","title":"macula_routing_dht.find_value/4","ref":"macula_routing_dht.html#find_value/4"},{"type":"function","doc":"Iterative lookup to find k closest nodes to target. Uses alpha concurrent queries (default: 3).","title":"macula_routing_dht.iterative_find_node/4","ref":"macula_routing_dht.html#iterative_find_node/4"},{"type":"type","doc":"","title":"macula_routing_dht.query_fn/0","ref":"macula_routing_dht.html#t:query_fn/0"},{"type":"function","doc":"Select up to alpha unqueried nodes from closest set.","title":"macula_routing_dht.select_alpha/3","ref":"macula_routing_dht.html#select_alpha/3"},{"type":"type","doc":"","title":"macula_routing_dht.store_fn/0","ref":"macula_routing_dht.html#t:store_fn/0"},{"type":"function","doc":"Store value at k closest nodes to key.","title":"macula_routing_dht.store_value/6","ref":"macula_routing_dht.html#store_value/6"},{"type":"function","doc":"Update closest set with new nodes, maintaining k closest and removing duplicates.","title":"macula_routing_dht.update_closest/4","ref":"macula_routing_dht.html#update_closest/4"},{"type":"module","doc":"Node ID utilities for Kademlia DHT. 256-bit node identifiers with XOR distance metric.","title":"macula_routing_nodeid","ref":"macula_routing_nodeid.html"},{"type":"function","doc":"Calculate bucket index for a node relative to local node. Returns leading zero count of XOR distance (0..255). Special case: distance 0 (same node) returns 256. Normalizes inputs to 32 bytes if needed.","title":"macula_routing_nodeid.bucket_index/2","ref":"macula_routing_nodeid.html#bucket_index/2"},{"type":"function","doc":"Check if NodeA is closer to Target than NodeB. Normalizes inputs to 32 bytes if needed.","title":"macula_routing_nodeid.closer_to/3","ref":"macula_routing_nodeid.html#closer_to/3"},{"type":"function","doc":"Compare distances of NodeA and NodeB to Target. Returns: less (A closer), equal (same distance), greater (B closer). Normalizes inputs to 32 bytes if needed.","title":"macula_routing_nodeid.compare/3","ref":"macula_routing_nodeid.html#compare/3"},{"type":"function","doc":"Calculate XOR distance between two node IDs. Normalizes inputs to 32 bytes if needed.","title":"macula_routing_nodeid.distance/2","ref":"macula_routing_nodeid.html#distance/2"},{"type":"function","doc":"Create node ID from binary (validates size).","title":"macula_routing_nodeid.from_binary/1","ref":"macula_routing_nodeid.html#from_binary/1"},{"type":"function","doc":"Parse node ID from hex string. Crashes on invalid hex or wrong length - exposes bugs in validation logic.","title":"macula_routing_nodeid.from_hex/1","ref":"macula_routing_nodeid.html#from_hex/1"},{"type":"function","doc":"Generate a random 256-bit node ID.","title":"macula_routing_nodeid.generate/0","ref":"macula_routing_nodeid.html#generate/0"},{"type":"function","doc":"Count leading zero bits in binary.","title":"macula_routing_nodeid.leading_zeros/1","ref":"macula_routing_nodeid.html#leading_zeros/1"},{"type":"type","doc":"32 bytes (256 bits)","title":"macula_routing_nodeid.node_id/0","ref":"macula_routing_nodeid.html#t:node_id/0"},{"type":"function","doc":"Normalize any binary to a 32-byte node ID. If already 32 bytes, returns as-is. Otherwise, hashes with SHA-256.","title":"macula_routing_nodeid.normalize/1","ref":"macula_routing_nodeid.html#normalize/1"},{"type":"function","doc":"Convert node ID to hex string.","title":"macula_routing_nodeid.to_hex/1","ref":"macula_routing_nodeid.html#to_hex/1"},{"type":"module","doc":"DHT protocol message encoding/decoding. Maps DHT operations to/from message format.","title":"macula_routing_protocol","ref":"macula_routing_protocol.html"},{"type":"function","doc":"Decode FIND_NODE request.","title":"macula_routing_protocol.decode_find_node/1","ref":"macula_routing_protocol.html#decode_find_node/1"},{"type":"function","doc":"Decode FIND_NODE reply.","title":"macula_routing_protocol.decode_find_node_reply/1","ref":"macula_routing_protocol.html#decode_find_node_reply/1"},{"type":"function","doc":"Decode FIND_VALUE request.","title":"macula_routing_protocol.decode_find_value/1","ref":"macula_routing_protocol.html#decode_find_value/1"},{"type":"function","doc":"Decode FIND_VALUE reply.","title":"macula_routing_protocol.decode_find_value_reply/1","ref":"macula_routing_protocol.html#decode_find_value_reply/1"},{"type":"function","doc":"Decode node info.","title":"macula_routing_protocol.decode_node_info/1","ref":"macula_routing_protocol.html#decode_node_info/1"},{"type":"function","doc":"Decode STORE request.","title":"macula_routing_protocol.decode_store/1","ref":"macula_routing_protocol.html#decode_store/1"},{"type":"function","doc":"Encode FIND_NODE request.","title":"macula_routing_protocol.encode_find_node/1","ref":"macula_routing_protocol.html#encode_find_node/1"},{"type":"function","doc":"Encode FIND_NODE reply.","title":"macula_routing_protocol.encode_find_node_reply/1","ref":"macula_routing_protocol.html#encode_find_node_reply/1"},{"type":"function","doc":"Encode FIND_VALUE request.","title":"macula_routing_protocol.encode_find_value/1","ref":"macula_routing_protocol.html#encode_find_value/1"},{"type":"function","doc":"Encode FIND_VALUE reply.","title":"macula_routing_protocol.encode_find_value_reply/1","ref":"macula_routing_protocol.html#encode_find_value_reply/1"},{"type":"function","doc":"Encode node info (for transmission).","title":"macula_routing_protocol.encode_node_info/1","ref":"macula_routing_protocol.html#encode_node_info/1"},{"type":"function","doc":"Encode STORE request.","title":"macula_routing_protocol.encode_store/2","ref":"macula_routing_protocol.html#encode_store/2"},{"type":"function","doc":"Check if message is FIND_NODE.","title":"macula_routing_protocol.is_find_node/1","ref":"macula_routing_protocol.html#is_find_node/1"},{"type":"function","doc":"Check if message is FIND_VALUE.","title":"macula_routing_protocol.is_find_value/1","ref":"macula_routing_protocol.html#is_find_value/1"},{"type":"function","doc":"Check if message is STORE.","title":"macula_routing_protocol.is_store/1","ref":"macula_routing_protocol.html#is_store/1"},{"type":"type","doc":"","title":"macula_routing_protocol.message/0","ref":"macula_routing_protocol.html#t:message/0"},{"type":"module","doc":"GenServer managing Kademlia DHT routing table and operations. Integrates all routing components: table, DHT algorithms, protocol.","title":"macula_routing_server","ref":"macula_routing_server.html"},{"type":"function","doc":"Add node to routing table.","title":"macula_routing_server.add_node/2","ref":"macula_routing_server.html#add_node/2"},{"type":"function","doc":"Find k closest nodes to target.","title":"macula_routing_server.find_closest/3","ref":"macula_routing_server.html#find_closest/3"},{"type":"function","doc":"Find value in DHT using iterative lookup. Returns {ok, Value} if found, {nodes, Nodes} if not found.","title":"macula_routing_server.find_value/3","ref":"macula_routing_server.html#find_value/3"},{"type":"function","doc":"Get value from local storage.","title":"macula_routing_server.get_local/2","ref":"macula_routing_server.html#get_local/2"},{"type":"function","doc":"Get routing table snapshot.","title":"macula_routing_server.get_routing_table/1","ref":"macula_routing_server.html#get_routing_table/1"},{"type":"function","doc":"Handle incoming DHT message and return reply.","title":"macula_routing_server.handle_message/2","ref":"macula_routing_server.html#handle_message/2"},{"type":"function","doc":"Get number of nodes in routing table.","title":"macula_routing_server.size/1","ref":"macula_routing_server.html#size/1"},{"type":"function","doc":"Start routing server with registered name macula_routing_server.","title":"macula_routing_server.start_link/2","ref":"macula_routing_server.html#start_link/2"},{"type":"function","doc":"Store value in DHT by propagating to k closest nodes. Stores locally first, then sends STORE messages to k closest peers.","title":"macula_routing_server.store/3","ref":"macula_routing_server.html#store/3"},{"type":"function","doc":"Store value locally.","title":"macula_routing_server.store_local/3","ref":"macula_routing_server.html#store_local/3"},{"type":"module","doc":"Routing table for Kademlia DHT. Manages 256 k-buckets organized by XOR distance.","title":"macula_routing_table","ref":"macula_routing_table.html"},{"type":"function","doc":"Add a node to the routing table. Calculates bucket index and adds to appropriate bucket.","title":"macula_routing_table.add_node/2","ref":"macula_routing_table.html#add_node/2"},{"type":"function","doc":"Get size of a specific bucket.","title":"macula_routing_table.bucket_size/2","ref":"macula_routing_table.html#bucket_size/2"},{"type":"function","doc":"Find k closest nodes to target.","title":"macula_routing_table.find_closest/3","ref":"macula_routing_table.html#find_closest/3"},{"type":"function","doc":"Get all nodes from all buckets.","title":"macula_routing_table.get_all_nodes/1","ref":"macula_routing_table.html#get_all_nodes/1"},{"type":"function","doc":"Get bucket by index.","title":"macula_routing_table.get_bucket/2","ref":"macula_routing_table.html#get_bucket/2"},{"type":"function","doc":"Get k (bucket capacity).","title":"macula_routing_table.k/1","ref":"macula_routing_table.html#k/1"},{"type":"function","doc":"Get local node ID.","title":"macula_routing_table.local_node_id/1","ref":"macula_routing_table.html#local_node_id/1"},{"type":"function","doc":"Create a new routing table.","title":"macula_routing_table.new/2","ref":"macula_routing_table.html#new/2"},{"type":"function","doc":"Remove a node from the routing table.","title":"macula_routing_table.remove_node/2","ref":"macula_routing_table.html#remove_node/2"},{"type":"type","doc":"","title":"macula_routing_table.routing_table/0","ref":"macula_routing_table.html#t:routing_table/0"},{"type":"function","doc":"Get total number of nodes in routing table.","title":"macula_routing_table.size/1","ref":"macula_routing_table.html#size/1"},{"type":"function","doc":"Update timestamp for a node (moves to tail in its bucket).","title":"macula_routing_table.update_timestamp/2","ref":"macula_routing_table.html#update_timestamp/2"},{"type":"module","doc":"LRU cache for RPC procedure results. Caches results of idempotent procedures to avoid repeated execution. Wraps macula_cache with RPC-specific logic and TTL handling.","title":"macula_rpc_cache","ref":"macula_rpc_cache.html"},{"type":"type","doc":"","title":"macula_rpc_cache.cache/0","ref":"macula_rpc_cache.html#t:cache/0"},{"type":"function","doc":"Clear all entries.","title":"macula_rpc_cache.clear/1","ref":"macula_rpc_cache.html#clear/1"},{"type":"function","doc":"Get entry from cache. Returns {ok, Result, UpdatedCache} or not_found. The updated cache has the entry moved to front (LRU). Automatically removes expired entries.","title":"macula_rpc_cache.get/3","ref":"macula_rpc_cache.html#get/3"},{"type":"function","doc":"Invalidate (remove) entry.","title":"macula_rpc_cache.invalidate/3","ref":"macula_rpc_cache.html#invalidate/3"},{"type":"function","doc":"Check if entry is expired.","title":"macula_rpc_cache.is_expired/3","ref":"macula_rpc_cache.html#is_expired/3"},{"type":"function","doc":"Make cache key from URI and args. Uses hash of URI and args for consistent key generation.","title":"macula_rpc_cache.make_key/2","ref":"macula_rpc_cache.html#make_key/2"},{"type":"function","doc":"Get max size.","title":"macula_rpc_cache.max_size/1","ref":"macula_rpc_cache.html#max_size/1"},{"type":"function","doc":"Create new cache with max size.","title":"macula_rpc_cache.new/1","ref":"macula_rpc_cache.html#new/1"},{"type":"function","doc":"Put entry in cache.","title":"macula_rpc_cache.put/5","ref":"macula_rpc_cache.html#put/5"},{"type":"function","doc":"Put entry with custom timestamp (for testing).","title":"macula_rpc_cache.put_with_timestamp/6","ref":"macula_rpc_cache.html#put_with_timestamp/6"},{"type":"function","doc":"Get number of entries.","title":"macula_rpc_cache.size/1","ref":"macula_rpc_cache.html#size/1"},{"type":"module","doc":"DHT integration for finding RPC service providers. Uses Kademlia DHT to publish and discover RPC registrations. Wraps macula_discovery with RPC-specific types.","title":"macula_rpc_discovery","ref":"macula_rpc_discovery.html"},{"type":"type","doc":"","title":"macula_rpc_discovery.address/0","ref":"macula_rpc_discovery.html#t:address/0"},{"type":"function","doc":"Announce local registration to DHT.","title":"macula_rpc_discovery.announce/5","ref":"macula_rpc_discovery.html#announce/5"},{"type":"type","doc":"","title":"macula_rpc_discovery.dht_lookup_fun/0","ref":"macula_rpc_discovery.html#t:dht_lookup_fun/0"},{"type":"type","doc":"","title":"macula_rpc_discovery.dht_publish_fun/0","ref":"macula_rpc_discovery.html#t:dht_publish_fun/0"},{"type":"type","doc":"","title":"macula_rpc_discovery.dht_unpublish_fun/0","ref":"macula_rpc_discovery.html#t:dht_unpublish_fun/0"},{"type":"function","doc":"Filter providers to only available ones (based on last_seen TTL).","title":"macula_rpc_discovery.filter_available/2","ref":"macula_rpc_discovery.html#filter_available/2"},{"type":"function","doc":"Find service providers for a URI via DHT.","title":"macula_rpc_discovery.find_providers/2","ref":"macula_rpc_discovery.html#find_providers/2"},{"type":"function","doc":"Find providers with cache (default TTL: 300 seconds).","title":"macula_rpc_discovery.find_with_cache/3","ref":"macula_rpc_discovery.html#find_with_cache/3"},{"type":"function","doc":"Find providers with cache and custom TTL.","title":"macula_rpc_discovery.find_with_cache/4","ref":"macula_rpc_discovery.html#find_with_cache/4"},{"type":"type","doc":"","title":"macula_rpc_discovery.node_id/0","ref":"macula_rpc_discovery.html#t:node_id/0"},{"type":"type","doc":"","title":"macula_rpc_discovery.provider_info/0","ref":"macula_rpc_discovery.html#t:provider_info/0"},{"type":"function","doc":"Remove local registration from DHT.","title":"macula_rpc_discovery.unannounce/3","ref":"macula_rpc_discovery.html#unannounce/3"},{"type":"type","doc":"","title":"macula_rpc_discovery.uri/0","ref":"macula_rpc_discovery.html#t:uri/0"},{"type":"module","doc":"RPC call execution with timeout handling. Executes local handlers and remote calls via QUIC.","title":"macula_rpc_executor","ref":"macula_rpc_executor.html"},{"type":"type","doc":"","title":"macula_rpc_executor.address/0","ref":"macula_rpc_executor.html#t:address/0"},{"type":"function","doc":"Execute local handler with timeout.","title":"macula_rpc_executor.execute_local/3","ref":"macula_rpc_executor.html#execute_local/3"},{"type":"function","doc":"Execute remote call via QUIC with timeout.","title":"macula_rpc_executor.execute_remote/5","ref":"macula_rpc_executor.html#execute_remote/5"},{"type":"function","doc":"Generate unique call ID (16-byte UUID).","title":"macula_rpc_executor.generate_call_id/0","ref":"macula_rpc_executor.html#generate_call_id/0"},{"type":"type","doc":"","title":"macula_rpc_executor.handler_fn/0","ref":"macula_rpc_executor.html#t:handler_fn/0"},{"type":"type","doc":"","title":"macula_rpc_executor.provider_info/0","ref":"macula_rpc_executor.html#t:provider_info/0"},{"type":"type","doc":"","title":"macula_rpc_executor.send_fun/0","ref":"macula_rpc_executor.html#t:send_fun/0"},{"type":"module","doc":"RPC handler GenServer - manages RPC calls, replies, and failover. Responsibilities: - Execute RPC calls (local check first, then DHT discovery) - Handle incoming RPC replies from network - Manage call timeouts with automatic failover - Track pending calls with call IDs - Monitor caller processes for automatic cleanup - Provider selection strategies (random, round-robin, etc.) Memory Safety: - Monitors caller processes to prevent memory leaks - Cleans up immediately when caller dies (no waiting for timeout) - Cancels timers and removes pending entries on cleanup Extracted from macula_connection.erl (Phase 5)","title":"macula_rpc_handler","ref":"macula_rpc_handler.html"},{"type":"function","doc":"","title":"macula_rpc_handler.call/4","ref":"macula_rpc_handler.html#call/4"},{"type":"function","doc":"","title":"macula_rpc_handler.handle_call/3","ref":"macula_rpc_handler.html#handle_call/3"},{"type":"function","doc":"","title":"macula_rpc_handler.handle_cast/2","ref":"macula_rpc_handler.html#handle_cast/2"},{"type":"function","doc":"Handle FIND_VALUE_REPLY from DHT query","title":"macula_rpc_handler.handle_find_value_reply/2","ref":"macula_rpc_handler.html#handle_find_value_reply/2"},{"type":"function","doc":"","title":"macula_rpc_handler.handle_incoming_reply/2","ref":"macula_rpc_handler.html#handle_incoming_reply/2"},{"type":"function","doc":"","title":"macula_rpc_handler.handle_info/2","ref":"macula_rpc_handler.html#handle_info/2"},{"type":"function","doc":"","title":"macula_rpc_handler.init/1","ref":"macula_rpc_handler.html#init/1"},{"type":"function","doc":"","title":"macula_rpc_handler.register_handler/2","ref":"macula_rpc_handler.html#register_handler/2"},{"type":"function","doc":"","title":"macula_rpc_handler.start_link/1","ref":"macula_rpc_handler.html#start_link/1"},{"type":"function","doc":"","title":"macula_rpc_handler.terminate/2","ref":"macula_rpc_handler.html#terminate/2"},{"type":"function","doc":"","title":"macula_rpc_handler.unregister_handler/1","ref":"macula_rpc_handler.html#unregister_handler/1"},{"type":"module","doc":"Name validation and utilities for RPC procedures. Uses reverse DNS notation: org.domain.service.procedure","title":"macula_rpc_names","ref":"macula_rpc_names.html"},{"type":"function","doc":"Check if name matches pattern. For now, only exact matching (no wildcards). Future: Could add wildcard patterns if needed.","title":"macula_rpc_names.matches/2","ref":"macula_rpc_names.html#matches/2"},{"type":"type","doc":"","title":"macula_rpc_names.name/0","ref":"macula_rpc_names.html#t:name/0"},{"type":"function","doc":"Extract namespace (first segment).","title":"macula_rpc_names.namespace/1","ref":"macula_rpc_names.html#namespace/1"},{"type":"function","doc":"Normalize name (lowercase, trim, remove double dots).","title":"macula_rpc_names.normalize/1","ref":"macula_rpc_names.html#normalize/1"},{"type":"function","doc":"Count number of segments in name.","title":"macula_rpc_names.segment_count/1","ref":"macula_rpc_names.html#segment_count/1"},{"type":"function","doc":"Validate RPC procedure name syntax. Valid names: - Non-empty - Segments separated by dots - Segments contain alphanumeric, underscore, hyphen - No leading or trailing dots - No double dots - No wildcards allowed (unlike topics)","title":"macula_rpc_names.validate/1","ref":"macula_rpc_names.html#validate/1"},{"type":"module","doc":"Local RPC procedure registration registry. Maps URIs to handler functions. Supports multiple handlers per URI (for load balancing).","title":"macula_rpc_registry","ref":"macula_rpc_registry.html"},{"type":"function","doc":"Find all registrations for a URI.","title":"macula_rpc_registry.find/2","ref":"macula_rpc_registry.html#find/2"},{"type":"function","doc":"Find all handlers for a URI.","title":"macula_rpc_registry.find_handlers/2","ref":"macula_rpc_registry.html#find_handlers/2"},{"type":"type","doc":"","title":"macula_rpc_registry.handler_fn/0","ref":"macula_rpc_registry.html#t:handler_fn/0"},{"type":"type","doc":"","title":"macula_rpc_registry.invocation_strategy/0","ref":"macula_rpc_registry.html#t:invocation_strategy/0"},{"type":"function","doc":"List all registrations.","title":"macula_rpc_registry.list_registrations/1","ref":"macula_rpc_registry.html#list_registrations/1"},{"type":"function","doc":"List all unique URIs in registry.","title":"macula_rpc_registry.list_uris/1","ref":"macula_rpc_registry.html#list_uris/1"},{"type":"function","doc":"Create new empty registry with default strategy (round_robin).","title":"macula_rpc_registry.new/0","ref":"macula_rpc_registry.html#new/0"},{"type":"function","doc":"Create new empty registry with custom strategy.","title":"macula_rpc_registry.new/1","ref":"macula_rpc_registry.html#new/1"},{"type":"function","doc":"Register a procedure handler. Allows multiple handlers for the same URI (for load balancing).","title":"macula_rpc_registry.register/4","ref":"macula_rpc_registry.html#register/4"},{"type":"type","doc":"","title":"macula_rpc_registry.registration/0","ref":"macula_rpc_registry.html#t:registration/0"},{"type":"type","doc":"","title":"macula_rpc_registry.registry/0","ref":"macula_rpc_registry.html#t:registry/0"},{"type":"function","doc":"Get total number of registrations.","title":"macula_rpc_registry.size/1","ref":"macula_rpc_registry.html#size/1"},{"type":"function","doc":"Unregister a specific procedure handler. Only removes the exact handler function.","title":"macula_rpc_registry.unregister/3","ref":"macula_rpc_registry.html#unregister/3"},{"type":"module","doc":"RPC call routing strategies. Selects which provider to use for a call (local or remote).","title":"macula_rpc_router","ref":"macula_rpc_router.html"},{"type":"function","doc":"Create new router state.","title":"macula_rpc_router.new_state/1","ref":"macula_rpc_router.html#new_state/1"},{"type":"type","doc":"","title":"macula_rpc_router.provider_info/0","ref":"macula_rpc_router.html#t:provider_info/0"},{"type":"type","doc":"","title":"macula_rpc_router.registration/0","ref":"macula_rpc_router.html#t:registration/0"},{"type":"type","doc":"","title":"macula_rpc_router.router_state/0","ref":"macula_rpc_router.html#t:router_state/0"},{"type":"function","doc":"Select local handler (returns first one).","title":"macula_rpc_router.select_local/1","ref":"macula_rpc_router.html#select_local/1"},{"type":"function","doc":"Select provider using stateless strategy. For local_first, random, and closest strategies.","title":"macula_rpc_router.select_provider/3","ref":"macula_rpc_router.html#select_provider/3"},{"type":"function","doc":"Select provider using closest strategy (requires local node ID).","title":"macula_rpc_router.select_provider_closest/3","ref":"macula_rpc_router.html#select_provider_closest/3"},{"type":"function","doc":"Select provider using stateful strategy (for round_robin).","title":"macula_rpc_router.select_provider_stateful/3","ref":"macula_rpc_router.html#select_provider_stateful/3"},{"type":"function","doc":"Select random remote provider.","title":"macula_rpc_router.select_remote_random/1","ref":"macula_rpc_router.html#select_remote_random/1"},{"type":"type","doc":"","title":"macula_rpc_router.strategy/0","ref":"macula_rpc_router.html#t:strategy/0"},{"type":"module","doc":"RPC routing for multi-hop DHT-routed RPC. Handles wrapping, unwrapping, and routing of RPC messages through the Kademlia DHT mesh.","title":"macula_rpc_routing","ref":"macula_rpc_routing.html"},{"type":"function","doc":"Route an rpc_route message: either deliver locally or forward to next hop. Returns one of: {deliver, PayloadType, Payload} - Message is for this node {forward, NextHopNodeInfo, UpdatedRpcRouteMsg} - Forward to next hop {error, Reason} - Cannot route (TTL exceeded, no route, etc.)","title":"macula_rpc_routing.route_or_deliver/3","ref":"macula_rpc_routing.html#route_or_deliver/3"},{"type":"function","doc":"Determine if this node should deliver the message locally or forward it.","title":"macula_rpc_routing.should_deliver_locally/2","ref":"macula_rpc_routing.html#should_deliver_locally/2"},{"type":"function","doc":"Wrap a CALL message in rpc_route envelope for DHT routing.","title":"macula_rpc_routing.wrap_call/4","ref":"macula_rpc_routing.html#wrap_call/4"},{"type":"function","doc":"Wrap a REPLY message in rpc_route envelope for DHT routing back to caller.","title":"macula_rpc_routing.wrap_reply/4","ref":"macula_rpc_routing.html#wrap_reply/4"},{"type":"module","doc":"RPC server managing registrations and calls. GenServer that integrates registry, cache, discovery, router, and executor.","title":"macula_rpc_server","ref":"macula_rpc_server.html"},{"type":"function","doc":"Synchronous call to procedure.","title":"macula_rpc_server.call/4","ref":"macula_rpc_server.html#call/4"},{"type":"type","doc":"","title":"macula_rpc_server.config/0","ref":"macula_rpc_server.html#t:config/0"},{"type":"function","doc":"Handle synchronous calls.","title":"macula_rpc_server.handle_call/3","ref":"macula_rpc_server.html#handle_call/3"},{"type":"function","doc":"Handle asynchronous casts (none implemented).","title":"macula_rpc_server.handle_cast/2","ref":"macula_rpc_server.html#handle_cast/2"},{"type":"function","doc":"Handle info messages (none expected).","title":"macula_rpc_server.handle_info/2","ref":"macula_rpc_server.html#handle_info/2"},{"type":"function","doc":"Initialize server state.","title":"macula_rpc_server.init/1","ref":"macula_rpc_server.html#init/1"},{"type":"function","doc":"List local registrations.","title":"macula_rpc_server.list_registrations/1","ref":"macula_rpc_server.html#list_registrations/1"},{"type":"function","doc":"Register procedure.","title":"macula_rpc_server.register/4","ref":"macula_rpc_server.html#register/4"},{"type":"function","doc":"Start RPC server.","title":"macula_rpc_server.start_link/2","ref":"macula_rpc_server.html#start_link/2"},{"type":"type","doc":"","title":"macula_rpc_server.state/0","ref":"macula_rpc_server.html#t:state/0"},{"type":"function","doc":"Stop RPC server.","title":"macula_rpc_server.stop/1","ref":"macula_rpc_server.html#stop/1"},{"type":"function","doc":"Cleanup on termination.","title":"macula_rpc_server.terminate/2","ref":"macula_rpc_server.html#terminate/2"},{"type":"function","doc":"Unregister procedure.","title":"macula_rpc_server.unregister/3","ref":"macula_rpc_server.html#unregister/3"},{"type":"module","doc":"Decentralized service advertisement registry using DHT. Provides service discovery via Kademlia DHT instead of centralized registration. Services advertise their capabilities to the DHT, and clients discover providers by querying the DHT. Architecture - Services advertise: \"I provide procedure X\"  DHT stores node_id at key=hash(procedure) - Clients discover: \"Who provides procedure X?\"  DHT returns list of node_ids - Local cache: Recent discoveries cached with TTL for low-latency lookups - Re-advertisement: Periodic republish to DHT for TTL renewal (default: every 5 min) Features - Fully decentralized (no central authority) - Multiple providers supported (DHT returns list) - Load balancing (client picks from list) - Fault tolerant (try another provider if one fails) - Low latency after first lookup (local cache)","title":"macula_service_registry","ref":"macula_service_registry.html"},{"type":"function","doc":"Advertise a service locally (stores handler for incoming calls). This registers the service handler locally so this node can respond to incoming RPC calls. The actual DHT advertisement must be done separately (see  publish_to_dht/4 ).","title":"macula_service_registry.advertise_local/4","ref":"macula_service_registry.html#advertise_local/4"},{"type":"type","doc":"","title":"macula_service_registry.cache_entry/0","ref":"macula_service_registry.html#t:cache_entry/0"},{"type":"function","doc":"Cache discovered service providers. Stores providers in local cache with TTL. Subsequent  discover_service  calls will return cached results until TTL expires.","title":"macula_service_registry.cache_service/4","ref":"macula_service_registry.html#cache_service/4"},{"type":"function","doc":"Cache discovered subscribers for a topic. Stores subscribers in local cache with TTL. Subsequent discover_subscribers/2 calls will return cached results until TTL expires.","title":"macula_service_registry.cache_subscribers/4","ref":"macula_service_registry.html#cache_subscribers/4"},{"type":"function","doc":"Clear the entire discovery cache.","title":"macula_service_registry.clear_cache/1","ref":"macula_service_registry.html#clear_cache/1"},{"type":"function","doc":"Clear the entire subscriber cache.","title":"macula_service_registry.clear_subscriber_cache/1","ref":"macula_service_registry.html#clear_subscriber_cache/1"},{"type":"function","doc":"Discover service providers (checks cache first, returns cached if available).","title":"macula_service_registry.discover_service/2","ref":"macula_service_registry.html#discover_service/2"},{"type":"function","doc":"Discover service providers with options. Checks local cache first. If found and not expired, returns cached providers. If cache miss or expired, returns  {cache_miss, Registry}  so caller can query DHT. Options: -  force_refresh  - Skip cache, force DHT lookup (default: false)","title":"macula_service_registry.discover_service/3","ref":"macula_service_registry.html#discover_service/3"},{"type":"function","doc":"Discover subscribers for a topic (checks cache first). Similar to discover_service/2 but for pub/sub subscribers. Returns cached subscribers if found and not expired, otherwise cache_miss.","title":"macula_service_registry.discover_subscribers/2","ref":"macula_service_registry.html#discover_subscribers/2"},{"type":"function","doc":"Get handler function for a locally advertised service.","title":"macula_service_registry.get_local_handler/2","ref":"macula_service_registry.html#get_local_handler/2"},{"type":"type","doc":"Handler function for local service implementations.","title":"macula_service_registry.handler_fn/0","ref":"macula_service_registry.html#t:handler_fn/0"},{"type":"function","doc":"List all locally advertised services.","title":"macula_service_registry.list_local_services/1","ref":"macula_service_registry.html#list_local_services/1"},{"type":"type","doc":"","title":"macula_service_registry.local_service/0","ref":"macula_service_registry.html#t:local_service/0"},{"type":"function","doc":"Create new empty service registry with default settings.","title":"macula_service_registry.new/0","ref":"macula_service_registry.html#new/0"},{"type":"function","doc":"Create new service registry with custom options. Options: -  default_ttl  - Default TTL for DHT advertisements (default: 300s) -  cache_ttl  - How long to cache discovered services (default: 60s) -  service_ttl  - TTL for local services before cleanup (default: 300s, 5 minutes)","title":"macula_service_registry.new/1","ref":"macula_service_registry.html#new/1"},{"type":"type","doc":"32-byte node identifier.","title":"macula_service_registry.node_id/0","ref":"macula_service_registry.html#t:node_id/0"},{"type":"type","doc":"","title":"macula_service_registry.provider_info/0","ref":"macula_service_registry.html#t:provider_info/0"},{"type":"function","doc":"Remove expired entries from discovery cache. Should be called periodically to prevent memory leaks. Returns updated registry and count of removed entries.","title":"macula_service_registry.prune_expired/1","ref":"macula_service_registry.html#prune_expired/1"},{"type":"function","doc":"Remove expired local services. Should be called periodically to prevent memory leaks from stale service registrations. Returns updated registry and count of removed services.","title":"macula_service_registry.prune_expired_local_services/1","ref":"macula_service_registry.html#prune_expired_local_services/1"},{"type":"function","doc":"Remove expired subscriber cache entries. Should be called periodically to prevent memory leaks. Returns updated registry and count of removed entries.","title":"macula_service_registry.prune_expired_subscribers/1","ref":"macula_service_registry.html#prune_expired_subscribers/1"},{"type":"function","doc":"Publish a service advertisement to the DHT. This function publishes a service's provider information to the DHT so other nodes can discover it. The service_id is hashed to create a DHT key, and the provider information is stored at that key. Parameters: - DhtPid: Process ID or registered name of macula_routing_server - ServiceId: The service identifier (procedure URI) - ProviderInfo: Information about this provider (node_id, endpoint, metadata) - TTL: Time-to-live in seconds for this advertisement - K: Number of nodes to store at (typically 20 for Kademlia) Returns: - ok if successful - {error, Reason} if publication failed Example: <span class=\"w\">  </span><span class=\"n\">ProviderInfo</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"0320861484-1\">#{</span><span class=\"w\">\n      </span><span class=\"ss\">node_id</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"0320861484-2\">&lt;&lt;</span><span class=\"s\">&quot;my-node-123&quot;</span><span class=\"p\" data-group-id=\"0320861484-2\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"ss\">endpoint</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"0320861484-3\">&lt;&lt;</span><span class=\"s\">&quot;https://localhost:9443&quot;</span><span class=\"p\" data-group-id=\"0320861484-3\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"ss\">metadata</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"0320861484-4\">#{</span><span class=\"ss\">version</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"0320861484-5\">&lt;&lt;</span><span class=\"s\">&quot;1.0&quot;</span><span class=\"p\" data-group-id=\"0320861484-5\">&gt;&gt;</span><span class=\"p\" data-group-id=\"0320861484-4\">}</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"0320861484-1\">}</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">publish_to_dht</span><span class=\"p\" data-group-id=\"0320861484-6\">(</span><span class=\"n\">DhtPid</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;energy.home.get&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ProviderInfo</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">300</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"p\" data-group-id=\"0320861484-6\">)</span><span class=\"p\">.</span>","title":"macula_service_registry.publish_to_dht/5","ref":"macula_service_registry.html#publish_to_dht/5"},{"type":"function","doc":"Query the DHT for service providers. This function queries the DHT to find nodes that provide a given service. It returns a list of provider_info() maps, each containing node_id, endpoint, and metadata for a provider. Parameters: - DhtPid: Process ID or registered name of macula_routing_server - ServiceId: The service identifier to query for - K: Number of closest nodes to query (typically 20 for Kademlia) Returns: - {ok, [ProviderInfo]} if providers found - {ok, []} if no providers found - {error, Reason} if query failed Example: <span class=\"w\">  </span><span class=\"p\" data-group-id=\"3181899265-1\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Providers</span><span class=\"p\" data-group-id=\"3181899265-1\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">query_dht_for_service</span><span class=\"p\" data-group-id=\"3181899265-2\">(</span><span class=\"n\">DhtPid</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;energy.home.get&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"p\" data-group-id=\"3181899265-2\">)</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"c1\">%% Returns: [{ok, [#{node_id =&gt; ..., endpoint =&gt; ..., metadata =&gt; ...}]}]</span>","title":"macula_service_registry.query_dht_for_service/3","ref":"macula_service_registry.html#query_dht_for_service/3"},{"type":"type","doc":"","title":"macula_service_registry.registry/0","ref":"macula_service_registry.html#t:registry/0"},{"type":"function","doc":"Remove a service advertisement from the DHT. This function removes a service advertisement when unadvertising. Note: In practice, DHT entries expire naturally via TTL, so this is optional and mainly useful for immediate cleanup. Parameters: - DhtPid: Process ID or registered name of macula_routing_server - ServiceId: The service identifier to remove - NodeId: This node's identifier (to remove only this provider) Returns: - ok if successful or entry not found - {error, Reason} if removal failed","title":"macula_service_registry.remove_from_dht/3","ref":"macula_service_registry.html#remove_from_dht/3"},{"type":"type","doc":"Service identifier (procedure URI). Example: <<\"energy.home.get\">>.","title":"macula_service_registry.service_id/0","ref":"macula_service_registry.html#t:service_id/0"},{"type":"function","doc":"Remove a local service advertisement.","title":"macula_service_registry.unadvertise_local/2","ref":"macula_service_registry.html#unadvertise_local/2"},{"type":"module","doc":"Dedicated process for accepting QUIC streams on a connection. This process runs a blocking loop calling quicer:accept_stream/3, ensuring we're ready to accept streams before the client creates them.","title":"macula_stream_acceptor","ref":"macula_stream_acceptor.html"},{"type":"function","doc":"Initialize the stream acceptor loop.","title":"macula_stream_acceptor.init/2","ref":"macula_stream_acceptor.html#init/2"},{"type":"function","doc":"Start a stream acceptor for a connection. Gateway is the process that should receive stream data events.","title":"macula_stream_acceptor.start_link/2","ref":"macula_stream_acceptor.html#start_link/2"},{"type":"module","doc":"Time utilities for Macula. Provides functions for timestamps, durations, and timeouts.","title":"macula_time","ref":"macula_time.html"},{"type":"function","doc":"Calculate duration in milliseconds between two timestamps.","title":"macula_time.duration_ms/2","ref":"macula_time.html#duration_ms/2"},{"type":"function","doc":"Format duration in milliseconds to human-readable string.","title":"macula_time.format_duration_ms/1","ref":"macula_time.html#format_duration_ms/1"},{"type":"function","doc":"Format timestamp to ISO 8601 string.","title":"macula_time.format_timestamp/1","ref":"macula_time.html#format_timestamp/1"},{"type":"function","doc":"Check if timeout has expired.","title":"macula_time.is_expired/2","ref":"macula_time.html#is_expired/2"},{"type":"function","doc":"Convert minutes to milliseconds.","title":"macula_time.minutes_to_ms/1","ref":"macula_time.html#minutes_to_ms/1"},{"type":"function","doc":"Convert milliseconds to seconds (truncates).","title":"macula_time.ms_to_seconds/1","ref":"macula_time.html#ms_to_seconds/1"},{"type":"function","doc":"Convert seconds to milliseconds.","title":"macula_time.seconds_to_ms/1","ref":"macula_time.html#seconds_to_ms/1"},{"type":"function","doc":"Calculate remaining time before timeout (in milliseconds). Returns 0 if already expired.","title":"macula_time.time_remaining/2","ref":"macula_time.html#time_remaining/2"},{"type":"function","doc":"Get current timestamp in milliseconds since epoch.","title":"macula_time.timestamp/0","ref":"macula_time.html#timestamp/0"},{"type":"function","doc":"Get current timestamp in microseconds since epoch.","title":"macula_time.timestamp_microseconds/0","ref":"macula_time.html#timestamp_microseconds/0"},{"type":"module","doc":"TLS Certificate Auto-Generation Module This module provides zero-config TLS certificate management for Macula nodes. Certificates are auto-generated on first boot and persisted to disk for stable node identity across restarts. Key Features: - Auto-generate self-signed certificates on first boot - Derive stable Node ID from public key (SHA-256 hash) - Persist certificates to disk (survives restarts) - Proper file permissions (0600 for private key)","title":"macula_tls","ref":"macula_tls.html"},{"type":"function","doc":"Derive Node ID from certificate public key. Extracts the public key from the PEM-encoded certificate and computes SHA-256 hash to create a stable, cryptographically-derived Node ID.","title":"macula_tls.derive_node_id/1","ref":"macula_tls.html#derive_node_id/1"},{"type":"function","doc":"Ensure TLS certificate exists, generate if missing. Checks if certificate and key files exist at the specified paths. If they don't exist, generates new self-signed certificate and saves to disk. Returns the paths and derived Node ID.","title":"macula_tls.ensure_cert_exists/2","ref":"macula_tls.html#ensure_cert_exists/2"},{"type":"function","doc":"Generate self-signed TLS certificate using OpenSSL. Creates a new RSA key pair and self-signed X.509 certificate with: - RSA 2048-bit key - 10-year validity period - Subject: CN=macula-node - Self-signed (issuer = subject)","title":"macula_tls.generate_self_signed_cert/1","ref":"macula_tls.html#generate_self_signed_cert/1"},{"type":"function","doc":"Get default certificate paths from application environment.","title":"macula_tls.get_cert_paths/0","ref":"macula_tls.html#get_cert_paths/0"},{"type":"module","doc":"Macula URI parsing and construction. Format: macula://realm/node_id Example: macula://org.example.mesh/0123456789abcdef...","title":"macula_uri","ref":"macula_uri.html"},{"type":"function","doc":"Check if two URIs are equal.","title":"macula_uri.equals/2","ref":"macula_uri.html#equals/2"},{"type":"function","doc":"Extract node ID from URI.","title":"macula_uri.get_node_id/1","ref":"macula_uri.html#get_node_id/1"},{"type":"function","doc":"Extract realm from URI.","title":"macula_uri.get_realm/1","ref":"macula_uri.html#get_realm/1"},{"type":"function","doc":"Check if URI is valid.","title":"macula_uri.is_valid/1","ref":"macula_uri.html#is_valid/1"},{"type":"function","doc":"Construct Macula URI from realm and node ID.","title":"macula_uri.new/2","ref":"macula_uri.html#new/2"},{"type":"type","doc":"","title":"macula_uri.node_id/0","ref":"macula_uri.html#t:node_id/0"},{"type":"function","doc":"Parse Macula URI to extract realm and node ID.","title":"macula_uri.parse/1","ref":"macula_uri.html#parse/1"},{"type":"type","doc":"","title":"macula_uri.realm/0","ref":"macula_uri.html#t:realm/0"},{"type":"type","doc":"","title":"macula_uri.uri/0","ref":"macula_uri.html#t:uri/0"},{"type":"module","doc":"Common utility functions for Macula. This module contains pure utility functions used across the Macula codebase to improve testability and eliminate duplication. All functions in this module are pure (no side effects) and can be tested independently.","title":"macula_utils","ref":"macula_utils.html"},{"type":"function","doc":"Decode JSON binary to map/list.","title":"macula_utils.decode_json/1","ref":"macula_utils.html#decode_json/1"},{"type":"function","doc":"Encode map/list to JSON binary.","title":"macula_utils.encode_json/1","ref":"macula_utils.html#encode_json/1"},{"type":"function","doc":"Ensure value is binary.","title":"macula_utils.ensure_binary/1","ref":"macula_utils.html#ensure_binary/1"},{"type":"function","doc":"Generate a random node ID.","title":"macula_utils.generate_node_id/0","ref":"macula_utils.html#generate_node_id/0"},{"type":"function","doc":"Get next message ID from counter. Returns {MessageId, NewCounter}.","title":"macula_utils.next_message_id/1","ref":"macula_utils.html#next_message_id/1"},{"type":"function","doc":"Normalize provider map from binary keys to atom keys.","title":"macula_utils.normalize_provider/1","ref":"macula_utils.html#normalize_provider/1"},{"type":"function","doc":"Parse host:port string with default port.","title":"macula_utils.parse_host_port/2","ref":"macula_utils.html#parse_host_port/2"},{"type":"function","doc":"Parse URL to extract host and port.","title":"macula_utils.parse_url/1","ref":"macula_utils.html#parse_url/1"},{"type":"function","doc":"Check if a published topic matches a subscription topic pattern. Supports configurable wildcards (defaults: dot-separated with * and **): - WildcardSingle (e.g., '*') matches a single segment - WildcardMulti (e.g., '**') matches multiple segments - Separator (e.g., '.') splits topic into segments - exact match otherwise","title":"macula_utils.topic_matches/5","ref":"macula_utils.html#topic_matches/5"},{"type":"extras","doc":"Macula HTTP/3 Mesh \n    Self-organizing distributed mesh for decentralized applications  \n\n   \n       \n       \n       \n   \n \n\n---\n\n \n   \n \n\n \n    BEAM-Native  HTTP/3 (QUIC)  Kademlia DHT  Direct P2P  Multi-Tenant  50% Faster (v0.8.0)  \n \n\n---","title":"Overview","ref":"readme.html"},{"type":"extras","doc":"-  **[Getting Started](GETTING_STARTED.md)** - Installation, quick start, code examples\n-  **[Architecture Guide](ARCHITECTURE.md)** - Visual guide with C4 diagrams, deployment topologies\n-  **[Changelog](CHANGELOG.md)** - Version history and migration guides\n-  **[Development Guide](docs/DEVELOPMENT.md)** - Contributing and testing\n-  **[Kademlia DHT](docs/KADEMLIA_DHT_ARCHITECTURE.md)** - DHT implementation details\n\n---","title":"Documentation - Overview","ref":"readme.html#documentation"},{"type":"extras","doc":"**Major features from v0.8.0:**\n-  Direct P2P QUIC connections (50% latency improvement)\n-  DHT propagation to k=20 closest nodes\n-  RPC and PubSub via direct P2P\n-  Production-ready memory management\n\n---","title":"Latest Release: v0.8.4 (2025-11-17) - Overview","ref":"readme.html#latest-release-v0-8-4-2025-11-17"},{"type":"extras","doc":"- **Hex**: [hex.pm/packages/macula](https://hex.pm/packages/macula)\n- **GitHub**: [github.com/macula-io/macula](https://github.com/macula-io/macula)\n- **Issues**: [github.com/macula-io/macula/issues](https://github.com/macula-io/macula/issues)\n\n---\n\n**Built with  for the BEAM community**","title":"Community - Overview","ref":"readme.html#community"},{"type":"extras","doc":"# Macula Platform Vision\n\n**Macula has evolved from a library to a distributed application platform.**\n\nThis document describes the architectural vision of Macula as a **platform** that hosts Line-of-Business, IoT, and TWEANN workloads in a decentralized mesh network.\n\n---","title":"Platform Vision","ref":"platform_vision.html"},{"type":"extras","doc":"---","title":"Platform Architecture Overview - Platform Vision","ref":"platform_vision.html#platform-architecture-overview"},{"type":"extras","doc":"","title":"Platform vs Library: The Evolution - Platform Vision","ref":"platform_vision.html#platform-vs-library-the-evolution"},{"type":"extras","doc":"In the early days, Macula was conceived as a **library** that applications would import and use directly:\n\n```erlang\n%% Application directly uses Macula internals\n-module(my_app).\n\nstart() ->\n    %% App manages connection lifecycle\n    {ok, Conn} = macula_connection:start_link(Url, Opts),\n\n    %% App deals with low-level primitives\n    macula_connection:publish(Conn, Topic, Payload),\n    macula_gateway:route_message(Msg, Recipients),\n    macula_routing_bucket:find_closest_nodes(NodeID).\n```\n\n**Problems with the library approach:**\n\n- **Tight coupling** - Applications depend on Macula internals\n- **Duplication** - Each app manages connections, handles failures\n- **Complexity** - Business logic mixed with mesh infrastructure\n- **Versioning** - Hard to upgrade Macula without breaking apps\n- **Testing** - Apps need to mock mesh internals","title":"Library Approach (Legacy) - Platform Vision","ref":"platform_vision.html#library-approach-legacy"},{"type":"extras","doc":"Macula v0.8.5+ operates as a **standalone OTP application** that provides services to workloads:\n\n```erlang\n%% Application uses clean SDK API\n-module(my_app).\n\nstart() ->\n    %% Platform handles all mesh infrastructure\n    %% App just uses high-level operations\n\n    %% Publish events\n    macula:publish(<<\"orders.created\">>, OrderData),\n\n    %% Subscribe to topics\n    macula:subscribe(<<\"inventory.*\">>, fun handle_inventory/1),\n\n    %% RPC to services\n    {ok, Price} = macula:call(<<\"pricing.calculate\">>, Request),\n\n    %% Advertise services\n    macula:advertise(<<\"orders.process\">>, fun process_order/1).\n```\n\n**Benefits of the platform approach:**\n\n- **Clean separation** - Business logic isolated from infrastructure\n- **Simple API** - High-level operations, no internals exposed\n- **Independent deployment** - Upgrade platform without touching apps\n- **Shared infrastructure** - Multiple apps share one Macula instance\n- **Testability** - Apps test business logic, not mesh behavior\n\n---","title":"Platform Approach (Current Vision) - Platform Vision","ref":"platform_vision.html#platform-approach-current-vision"},{"type":"extras","doc":"Macula supports three primary workload categories:","title":"Workload Types - Platform Vision","ref":"platform_vision.html#workload-types"},{"type":"extras","doc":"Traditional business applications that require distributed communication:\n\n**Examples:**\n- Order management systems\n- Inventory tracking\n- Customer relationship management\n- Financial transaction processing\n- Supply chain coordination\n\n**Characteristics:**\n- Request/response patterns (RPC)\n- Event-driven workflows (pub/sub)\n- Multi-service orchestration\n- Data consistency requirements\n\n**Architecture Pattern:**\n```\n\n   Order Service                 \n      \n     Business Logic            \n     - Validate order          \n     - Check inventory         \n     - Process payment         \n      \n                 SDK            \n\n                 \n         [Macula Platform]\n                 \n    \n                            \n[Inventory]  [Payment]  [Shipping]\n```","title":"1. Line-of-Business (LoB) Applications - Platform Vision","ref":"platform_vision.html#1-line-of-business-lob-applications"},{"type":"extras","doc":"Edge computing and sensor network applications:\n\n**Examples:**\n- Smart home controllers\n- Industrial sensor networks\n- Agricultural monitoring\n- Fleet management\n- Environmental sensors\n\n**Characteristics:**\n- High-frequency data streams\n- Low-latency requirements\n- Resource-constrained devices\n- Local-first processing\n- Eventual consistency\n\n**Architecture Pattern:**\n```\n\n   Smart Home Hub                \n      \n     Device Controller         \n     - Aggregate sensors       \n     - Control actuators       \n     - Local automation        \n      \n                 SDK            \n\n                 \n         [Macula Platform]\n                 \n    \n                            \n[Sensors]   [Actuators]  [Cloud]\n```","title":"2. IoT (Internet of Things) Workloads - Platform Vision","ref":"platform_vision.html#2-iot-internet-of-things-workloads"},{"type":"extras","doc":"Distributed evolutionary computation and neural network training:\n\n**Examples:**\n- NEAT (NeuroEvolution of Augmenting Topologies)\n- Genetic algorithm populations\n- Distributed machine learning\n- Hyperparameter optimization\n- Swarm intelligence\n\n**Characteristics:**\n- Parallel evaluation\n- Population distribution\n- Fitness aggregation\n- Genome broadcasting\n- Generation synchronization\n\n**Architecture Pattern:**\n```\n\n   NEAT Coordinator              \n      \n     Evolution Engine          \n     - Select parents          \n     - Crossover/mutate        \n     - Aggregate fitness       \n      \n                 SDK            \n\n                 \n         [Macula Platform]\n                 \n    \n                            \n[Evaluator] [Evaluator] [Evaluator]\n   Node 1      Node 2      Node N\n```\n\n---","title":"3. TWEANN (Topology & Weight Evolving Artificial Neural Networks) - Platform Vision","ref":"platform_vision.html#3-tweann-topology-weight-evolving-artificial-neural-networks"},{"type":"extras","doc":"","title":"Platform Components - Platform Vision","ref":"platform_vision.html#platform-components"},{"type":"extras","doc":"These components start automatically when Macula boots:\n\n| Component | Purpose | Process Count |\n|-----------|---------|---------------|\n| `macula_routing_server` | Kademlia DHT routing | 1 |\n| `macula_bootstrap_system` | Peer discovery, service registry | 3 |\n| `macula_gateway_system` | QUIC transport, message routing | 9 |\n| `macula_peers_sup` | Dynamic peer connections | 1 + 4/peer |\n\n**Total base processes:** 17 (v0.8.5+)","title":"Core Infrastructure (Always Running) - Platform Vision","ref":"platform_vision.html#core-infrastructure-always-running"},{"type":"extras","doc":"The SDK provides the public API for applications:\n\n```erlang\n%% Core Operations\nmacula:publish(Topic, Payload) -> ok | {error, Reason}.\nmacula:subscribe(Pattern, Handler) -> {ok, SubId} | {error, Reason}.\nmacula:unsubscribe(SubId) -> ok.\nmacula:call(Service, Request) -> {ok, Response} | {error, Reason}.\nmacula:call(Service, Request, Timeout) -> {ok, Response} | {error, Reason}.\nmacula:advertise(Service, Handler) -> {ok, AdvId} | {error, Reason}.\nmacula:unadvertise(AdvId) -> ok.\n\n%% Discovery\nmacula:discover(ServicePattern) -> {ok, [Service]} | {error, Reason}.\nmacula:node_id() -> NodeId.\nmacula:peers() -> [PeerId].\n\n%% Health\nmacula:health() -> #{status => ok | degraded, ...}.\n```","title":"SDK Layer - Platform Vision","ref":"platform_vision.html#sdk-layer"},{"type":"extras","doc":"Realms provide isolation between different applications or environments:\n\n```\nRealm: com.example.production\n Order Service\n Inventory Service\n Payment Service\n\nRealm: com.example.staging\n Order Service (test)\n Inventory Service (test)\n Payment Service (test)\n\nRealm: com.acme.iot\n Sensor Network\n Control Hub\n Analytics\n```\n\n**Isolation guarantees:**\n- Messages don't cross realm boundaries\n- Services only visible within their realm\n- DHT routing scoped to realm\n- Connection pooling per realm\n\n---","title":"Multi-Tenancy via Realms - Platform Vision","ref":"platform_vision.html#multi-tenancy-via-realms"},{"type":"extras","doc":"","title":"Deployment Models - Platform Vision","ref":"platform_vision.html#deployment-models"},{"type":"extras","doc":"Macula and application in the same BEAM VM:\n\n```erlang\n%% sys.config\n[\n  {macula, [\n    {quic_port, 4433},\n    {realm, <<\"com.example.dev\">>}\n  ]},\n  {my_app, [\n    %% app config\n  ]}\n].\n```\n\n**Use cases:**\n- Local development\n- Testing\n- Single-node deployments","title":"Model 1: Embedded (Development) - Platform Vision","ref":"platform_vision.html#model-1-embedded-development"},{"type":"extras","doc":"Macula runs as a sidecar container:\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: order-service\nspec:\n  containers:\n  - name: macula\n    image: macula:0.8.5\n    ports:\n    - containerPort: 4433\n      protocol: UDP\n    env:\n    - name: MACULA_QUIC_PORT\n      value: \"4433\"\n    - name: MACULA_REALM\n      value: \"com.example.production\"\n    volumeMounts:\n    - name: certs\n      mountPath: /var/lib/macula\n\n  - name: order-service\n    image: order-service:latest\n    env:\n    - name: MACULA_URL\n      value: \"https://localhost:4433\"\n\n  volumes:\n  - name: certs\n    persistentVolumeClaim:\n      claimName: macula-certs\n```\n\n**Use cases:**\n- Kubernetes deployments\n- Microservices architectures\n- Language-agnostic applications","title":"Model 2: Sidecar (Production) - Platform Vision","ref":"platform_vision.html#model-2-sidecar-production"},{"type":"extras","doc":"Dedicated Macula nodes forming mesh backbone:\n\n```\n          \n  Macula       Macula       Macula     \n  Node 1       Node 2       Node 3     \n          \n                                             \n                                             \n   [IoT Devices]      [LoB Apps]         [TWEANN Workers]\n```\n\n**Use cases:**\n- Edge computing\n- IoT gateways\n- Distributed AI training\n\n---","title":"Model 3: Mesh Node (Edge) - Platform Vision","ref":"platform_vision.html#model-3-mesh-node-edge"},{"type":"extras","doc":"","title":"Communication Patterns - Platform Vision","ref":"platform_vision.html#communication-patterns"},{"type":"extras","doc":"Asynchronous event broadcasting:\n\n```erlang\n%% Publisher\nhandle_order_created(Order) ->\n    macula:publish(<<\"orders.created\">>, #{\n        order_id => Order#order.id,\n        customer => Order#order.customer,\n        items => Order#order.items,\n        total => Order#order.total\n    }).\n\n%% Subscriber\ninit([]) ->\n    {ok, _} = macula:subscribe(<<\"orders.*\">>, fun handle_order_event/1),\n    {ok, #state{}}.\n\nhandle_order_event(#{topic := <<\"orders.created\">>, payload := Order}) ->\n    update_inventory(Order);\nhandle_order_event(#{topic := <<\"orders.shipped\">>, payload := Shipment}) ->\n    notify_customer(Shipment).\n```\n\n**Topic patterns:**\n- `orders.created` - Exact match\n- `orders.*` - Single-level wildcard\n- `orders.>` - Multi-level wildcard (future)","title":"Pattern 1: Event-Driven (Pub/Sub) - Platform Vision","ref":"platform_vision.html#pattern-1-event-driven-pub-sub"},{"type":"extras","doc":"Synchronous service calls:\n\n```erlang\n%% Service provider\ninit([]) ->\n    {ok, _} = macula:advertise(<<\"pricing.calculate\">>, fun calculate_price/1),\n    {ok, #state{}}.\n\ncalculate_price(#{items := Items, customer := Customer}) ->\n    BasePrice = sum_items(Items),\n    Discount = get_discount(Customer),\n    {ok, #{price => BasePrice * (1 - Discount)}}.\n\n%% Service consumer\nget_order_total(Items, Customer) ->\n    Request = #{items => Items, customer => Customer},\n    case macula:call(<<\"pricing.calculate\">>, Request, 5000) of\n        {ok, #{price := Price}} -> {ok, Price};\n        {error, timeout} -> {error, pricing_unavailable}\n    end.\n```\n\n**Routing strategies:**\n- DHT-based service discovery\n- Load balancing across providers\n- Automatic failover","title":"Pattern 2: Request/Response (RPC) - Platform Vision","ref":"platform_vision.html#pattern-2-request-response-rpc"},{"type":"extras","doc":"Dynamic service and peer discovery:\n\n```erlang\n%% Find services\n{ok, Services} = macula:discover(<<\"pricing.*\">>),\n%% Returns: [<<\"pricing.calculate\">>, <<\"pricing.convert\">>]\n\n%% Find peers\nPeers = macula:peers(),\n%% Returns: [<<\"abc123...\">>, <<\"def456...\">>]\n\n%% Get local node ID\nNodeId = macula:node_id(),\n%% Returns: <<\"789xyz...\">>\n```\n\n---","title":"Pattern 3: Discovery - Platform Vision","ref":"platform_vision.html#pattern-3-discovery"},{"type":"extras","doc":"","title":"Best Practices - Platform Vision","ref":"platform_vision.html#best-practices"},{"type":"extras","doc":"```erlang\n%% Good: Handle failures gracefully\nprocess_order(Order) ->\n    case macula:call(<<\"inventory.check\">>, Order, 3000) of\n        {ok, Available} when Available ->\n            proceed_with_order(Order);\n        {ok, _NotAvailable} ->\n            {error, out_of_stock};\n        {error, timeout} ->\n            %% Retry or use cached data\n            check_cached_inventory(Order)\n    end.\n\n%% Bad: Assume success\nprocess_order(Order) ->\n    {ok, Available} = macula:call(<<\"inventory.check\">>, Order),\n    proceed_with_order(Order).\n```","title":"1. Design for Failure - Platform Vision","ref":"platform_vision.html#1-design-for-failure"},{"type":"extras","doc":"```erlang\n%% Good: Business-meaningful topics\nmacula:publish(<<\"orders.confirmed\">>, Order),\nmacula:publish(<<\"inventory.depleted\">>, Item),\nmacula:publish(<<\"payment.captured\">>, Payment).\n\n%% Bad: Generic/technical topics\nmacula:publish(<<\"event\">>, #{type => order_confirmed, ...}),\nmacula:publish(<<\"update\">>, #{entity => inventory, ...}).\n```","title":"2. Use Meaningful Topics - Platform Vision","ref":"platform_vision.html#2-use-meaningful-topics"},{"type":"extras","doc":"```erlang\n%% Good: Reference large data\nmacula:publish(<<\"documents.uploaded\">>, #{\n    document_id => DocId,\n    storage_url => Url,\n    size_bytes => Size\n}).\n\n%% Bad: Embed large data\nmacula:publish(<<\"documents.uploaded\">>, #{\n    document_id => DocId,\n    content => LargeBinaryData  %% Don't do this!\n}).\n```","title":"3. Keep Payloads Small - Platform Vision","ref":"platform_vision.html#3-keep-payloads-small"},{"type":"extras","doc":"```erlang\n%% Production\n{macula, [{realm, <<\"com.example.prod\">>}]}\n\n%% Staging\n{macula, [{realm, <<\"com.example.staging\">>}]}\n\n%% Development\n{macula, [{realm, <<\"com.example.dev\">>}]}\n```","title":"4. Scope by Realm - Platform Vision","ref":"platform_vision.html#4-scope-by-realm"},{"type":"extras","doc":"```erlang\n%% Periodic health check\ncheck_platform_health() ->\n    case macula:health() of\n        #{status := ok} -> ok;\n        #{status := degraded, reason := Reason} ->\n            logger:warning(\"Macula degraded: ~p\", [Reason]),\n            alert_ops(Reason)\n    end.\n```\n\n---","title":"5. Monitor Health - Platform Vision","ref":"platform_vision.html#5-monitor-health"},{"type":"extras","doc":"Here's a complete example of an order processing service:\n\n```erlang\n-module(order_service).\n-behaviour(gen_server).\n\n%% API\n-export([start_link/0, create_order/1]).\n\n%% gen_server callbacks\n-export([init/1, handle_call/3, handle_cast/2, handle_info/2]).\n\n-record(state, {\n    pending_orders = #{}\n}).\n\n%%====================================================================\n%% API\n%%====================================================================\n\nstart_link() ->\n    gen_server:start_link({local, ?MODULE}, ?MODULE, [], []).\n\ncreate_order(OrderData) ->\n    gen_server:call(?MODULE, {create_order, OrderData}).\n\n%%====================================================================\n%% gen_server callbacks\n%%====================================================================\n\ninit([]) ->\n    %% Subscribe to relevant events\n    {ok, _} = macula:subscribe(<<\"payments.captured\">>,\n                               fun(Msg) -> ?MODULE ! {payment, Msg} end),\n    {ok, _} = macula:subscribe(<<\"inventory.reserved\">>,\n                               fun(Msg) -> ?MODULE ! {inventory, Msg} end),\n\n    %% Advertise our services\n    {ok, _} = macula:advertise(<<\"orders.create\">>, fun handle_create/1),\n    {ok, _} = macula:advertise(<<\"orders.status\">>, fun handle_status/1),\n\n    {ok, #state{}}.\n\nhandle_call({create_order, OrderData}, _From, State) ->\n    %% Validate order\n    case validate_order(OrderData) of\n        {ok, Order} ->\n            %% Check inventory via RPC\n            case macula:call(<<\"inventory.check\">>, Order, 5000) of\n                {ok, #{available := true}} ->\n                    %% Reserve inventory\n                    {ok, _} = macula:call(<<\"inventory.reserve\">>, Order, 5000),\n\n                    %% Process payment\n                    {ok, _} = macula:call(<<\"payments.charge\">>, Order, 10000),\n\n                    %% Publish order created event\n                    macula:publish(<<\"orders.created\">>, Order),\n\n                    %% Store pending order\n                    NewState = store_pending(Order, State),\n                    {reply, {ok, Order#order.id}, NewState};\n\n                {ok, #{available := false}} ->\n                    {reply, {error, out_of_stock}, State};\n\n                {error, Reason} ->\n                    {reply, {error, Reason}, State}\n            end;\n\n        {error, Reason} ->\n            {reply, {error, Reason}, State}\n    end;\n\nhandle_call(_Request, _From, State) ->\n    {reply, {error, unknown_request}, State}.\n\nhandle_cast(_Msg, State) ->\n    {noreply, State}.\n\nhandle_info({payment, #{payload := Payment}}, State) ->\n    %% Payment captured, confirm order\n    OrderId = maps:get(order_id, Payment),\n    case get_pending(OrderId, State) of\n        {ok, Order} ->\n            %% Publish confirmed event\n            macula:publish(<<\"orders.confirmed\">>, Order),\n\n            %% Request shipment\n            macula:call(<<\"shipping.schedule\">>, Order, 5000),\n\n            NewState = remove_pending(OrderId, State),\n            {noreply, NewState};\n\n        not_found ->\n            {noreply, State}\n    end;\n\nhandle_info({inventory, #{payload := Reservation}}, State) ->\n    %% Inventory reserved, continue processing\n    logger:info(\"Inventory reserved: ~p\", [Reservation]),\n    {noreply, State};\n\nhandle_info(_Info, State) ->\n    {noreply, State}.\n\n%%====================================================================\n%% Internal functions\n%%====================================================================\n\nhandle_create(Request) ->\n    gen_server:call(?MODULE, {create_order, Request}).\n\nhandle_status(#{order_id := OrderId}) ->\n    %% Return order status\n    case get_order(OrderId) of\n        {ok, Order} -> {ok, Order};\n        not_found -> {error, not_found}\n    end.\n\nvalidate_order(Data) ->\n    %% Validation logic\n    {ok, #order{id = generate_id(), data = Data}}.\n\nstore_pending(Order, #state{pending_orders = Pending} = State) ->\n    State#state{pending_orders = Pending#{Order#order.id => Order}}.\n\nget_pending(OrderId, #state{pending_orders = Pending}) ->\n    case maps:get(OrderId, Pending, not_found) of\n        not_found -> not_found;\n        Order -> {ok, Order}\n    end.\n\nremove_pending(OrderId, #state{pending_orders = Pending} = State) ->\n    State#state{pending_orders = maps:remove(OrderId, Pending)}.\n\nget_order(OrderId) ->\n    %% Database lookup\n    {ok, #order{id = OrderId}}.\n\ngenerate_id() ->\n    base64:encode(crypto:strong_rand_bytes(16)).\n```\n\n---","title":"Example: Complete LoB Application - Platform Vision","ref":"platform_vision.html#example-complete-lob-application"},{"type":"extras","doc":"","title":"Future Directions - Platform Vision","ref":"platform_vision.html#future-directions"},{"type":"extras","doc":"Direct P2P connections between peers behind NAT:\n- STUN/TURN/ICE-like connectivity\n- 95% direct connections\n- 5% relay fallback","title":"v0.9.0: NAT Traversal - Platform Vision","ref":"platform_vision.html#v0-9-0-nat-traversal"},{"type":"extras","doc":"Full platform stability:\n- Comprehensive monitoring\n- Horizontal scaling\n- Geographic distribution\n- Enterprise features","title":"v1.0.0: Production Ready - Platform Vision","ref":"platform_vision.html#v1-0-0-production-ready"},{"type":"extras","doc":"- **Persistent streams** - Long-lived data channels\n- **Consensus** - Distributed agreement protocols\n- **Storage** - Integrated distributed storage\n- **Compute** - Edge function execution\n\n---","title":"Beyond v1.0.0 - Platform Vision","ref":"platform_vision.html#beyond-v1-0-0"},{"type":"extras","doc":"Macula is a **distributed application platform** that provides:\n\n| Capability | Description |\n|------------|-------------|\n| **Mesh Networking** | HTTP/3 (QUIC) transport with DHT routing |\n| **Pub/Sub** | Event-driven messaging with wildcards |\n| **RPC** | Service discovery and remote calls |\n| **Multi-Tenancy** | Realm-based isolation |\n| **Zero-Config** | Auto TLS, stable Node IDs |\n| **Fault Tolerance** | OTP supervision, automatic recovery |\n\n**Platform Benefits:**\n- Clean separation between infrastructure and business logic\n- Simple SDK API for applications\n- Independent deployment and scaling\n- Support for LoB, IoT, and TWEANN workloads\n\n**Vision:** A decentralized, self-organizing mesh that enables distributed applications to communicate seamlessly across network boundaries.\n\n---","title":"Summary - Platform Vision","ref":"platform_vision.html#summary"},{"type":"extras","doc":"- [Getting Started](../GETTING_STARTED.md) - Quick start guide\n- [Architecture Overview](../ARCHITECTURE.md) - Technical architecture\n- [Supervision Tree](FULL_SUPERVISION_TREE.md) - OTP process hierarchy\n- [Memory Management](memory_management/README.md) - Resource management\n- [v0.8.5 Release](../CHANGELOG.md) - Latest release notes","title":"Related Documents - Platform Vision","ref":"platform_vision.html#related-documents"},{"type":"extras","doc":"Macula HTTP/3 Mesh \n    Self-organizing distributed mesh for decentralized applications  \n\n   \n       \n       \n       \n   \n \n\n---\n\n \n   \n \n\n \n    BEAM-Native  HTTP/3 (QUIC)  Kademlia DHT  Direct P2P  Multi-Tenant  50% Faster (v0.8.0)  \n \n\n---","title":"Getting Started","ref":"getting_started.html"},{"type":"extras","doc":"-  [Architecture Overview](ARCHITECTURE.md) - **Visual guide with diagrams** (C4, supervision trees, deployment topologies)\n-  [Quick Start](#quick-start) - Get started in minutes\n-  [What's New in v0.8.0](#whats-new-in-v080) - Latest features\n-  [Core Concepts](#core-concepts) - Understanding the mesh\n-  [API Overview](#api-overview) - Using Macula in your application\n-  [Changelog](CHANGELOG.md) - Version history and migration guides\n-  [Issues](https://github.com/macula-io/macula/issues) - Report bugs and request features\n\n---","title":"Table of Contents - Getting Started","ref":"getting_started.html#table-of-contents"},{"type":"extras","doc":"Macula is infrastructure for building **decentralized applications and services** that operate autonomously at the edge, without dependency on centralized cloud infrastructure.\n\n**Key Features:**\n\n **BEAM-native** (Erlang/Elixir OTP supervision and fault tolerance)\n **HTTP/3 (QUIC)** transport (modern, encrypted, NAT-friendly)\n **Edge-first design** (works through firewalls and NAT)\n **Built-in pub/sub & RPC** (no external message broker needed)\n **Multi-tenancy** (realm isolation for SaaS and shared infrastructure)\n **Self-organizing mesh** (DHT-based service discovery, O(log N) routing)\n **Production-ready patterns** (OTP behaviors, comprehensive testing, memory management)\n\n---","title":"What is Macula? - Getting Started","ref":"getting_started.html#what-is-macula"},{"type":"extras","doc":"**System Context** - How your application uses Macula:\n\n```\n\n     Your     \n Application  \n\n        macula_peer API\n       \n     QUIC/HTTP3      \n Macula Peer     Gateway    \n (Local Node)     Or Direct P2P     (Relay Node) \n                     \n                                           \n        DHT \n                 (Service Discovery)\n```\n\n**Message Flow** (v0.8.0 Direct P2P):\n\n```\nClient 1. Query DHT DHT (Find Service)\nClient 2. Endpoint DHT Returns \"192.168.1.50:9443\"\nClient 3. Direct Provider (1-hop, 50ms)\nClient 4. Response Provider (50% faster than relay!)\n```\n\n** [See Full Architecture Guide](ARCHITECTURE.md)** with:\n- C4 diagrams (context, container views)\n- Deployment topologies (edge, microservices, hybrid)\n- Supervision trees (OTP fault tolerance)\n- DHT architecture (Kademlia routing)\n- Performance characteristics\n- When to use Macula\n\n---","title":"Architecture at a Glance - Getting Started","ref":"getting_started.html#architecture-at-a-glance"},{"type":"extras","doc":"**Elixir (mix.exs):**\n\n```elixir\ndef deps do\n  [\n    {:macula, \"~> 0.8\"}\n  ]\nend\n```\n\n**Erlang (rebar.config):**\n\n```erlang\n{deps, [\n    {macula, \"0.8.4\"}\n]}.\n```\n\n**Latest Release**: v0.8.4 (2025-11-17) - Fixed hex docs landing page redirect (v0.8.0: Direct P2P with DHT propagation)\n\n---\n\n##  What's New in v0.8.0\n\n**Major Features:**\n-  Direct P2P QUIC connections via `macula_peer_connector`\n-  DHT propagation to k=20 closest nodes (Kademlia-based)\n-  RPC via direct P2P (50% latency improvement)\n-  PubSub via direct P2P (50% latency improvement)\n-  21/21 integration tests passing (100% coverage)\n\n**Performance:**\n- 1-hop direct connections vs 2+ hop relay routing\n- Reduced gateway load\n- Better scalability for large meshes\n\n**Breaking Changes:** None - fully backward compatible with v0.7.x\n\n---","title":"Installation - Getting Started","ref":"getting_started.html#installation"},{"type":"extras","doc":"","title":"Quick Start - Getting Started","ref":"getting_started.html#quick-start"},{"type":"extras","doc":"```erlang\n%% Start a peer connection\n{ok, Peer} = macula_peer:start_link(<<\"https://gateway.example.com:9443\">>, #{\n    realm => <<\"com.example.app\">>\n}).\n```","title":"1. Connect to a Gateway - Getting Started","ref":"getting_started.html#1-connect-to-a-gateway"},{"type":"extras","doc":"```erlang\n%% Subscribe to events\nok = macula_peer:subscribe(Peer, <<\"sensor.temperature\">>, self()).\n\n%% Publish an event\nok = macula_peer:publish(Peer, <<\"sensor.temperature\">>, #{\n    device_id => <<\"sensor-001\">>,\n    celsius => 21.5,\n    timestamp => erlang:system_time(millisecond)\n}).\n\n%% Receive events\nreceive\n    {macula_event, <<\"sensor.temperature\">>, Payload} ->\n        io:format(\"Temperature: ~pC~n\", [maps:get(celsius, Payload)])\nend.\n```","title":"2. Publish/Subscribe - Getting Started","ref":"getting_started.html#2-publish-subscribe"},{"type":"extras","doc":"```erlang\n%% Call a remote service\n{ok, Result} = macula_peer:call(Peer, <<\"calculator.add\">>, #{\n    a => 5,\n    b => 3\n}).\n%% Result: #{result => 8}\n```","title":"3. RPC (Remote Procedure Calls) - Getting Started","ref":"getting_started.html#3-rpc-remote-procedure-calls"},{"type":"extras","doc":"```erlang\n%% Advertise a service handler\nok = macula_peer:advertise(Peer, <<\"calculator.add\">>, fun(Args) ->\n    A = maps:get(a, Args),\n    B = maps:get(b, Args),\n    #{result => A + B}\nend, #{ttl => 300}).\n```\n\n---","title":"4. Advertise Services (Providers) - Getting Started","ref":"getting_started.html#4-advertise-services-providers"},{"type":"extras","doc":"","title":"Core Concepts - Getting Started","ref":"getting_started.html#core-concepts"},{"type":"extras","doc":"Macula creates a self-organizing mesh network where nodes communicate over HTTP/3 (QUIC). Each node can act as:\n- **Peer** - Application client/server participating in the mesh\n- **Gateway** - Relay node for NAT-traversed peers (optional)\n- **Registry** - DHT participant storing service advertisements","title":"Mesh Architecture - Getting Started","ref":"getting_started.html#mesh-architecture"},{"type":"extras","doc":"Realms provide logical isolation for different applications sharing the same physical mesh:\n```erlang\n%% App 1\n{ok, Peer1} = macula_peer:start_link(GatewayUrl, #{realm => <<\"com.app1\">>}).\n\n%% App 2 (completely isolated from App 1)\n{ok, Peer2} = macula_peer:start_link(GatewayUrl, #{realm => <<\"com.app2\">>}).\n```","title":"Multi-Tenancy via Realms - Getting Started","ref":"getting_started.html#multi-tenancy-via-realms"},{"type":"extras","doc":"Services are discovered via a Kademlia DHT with k=20 replication:\n1. Provider advertises: `advertise(<<\"my.service\">>, Handler)`\n2. DHT propagates to k=20 closest nodes\n3. Consumer discovers: `call(<<\"my.service\">>, Args)`\n4. Direct P2P connection established (v0.8.0+)","title":"DHT-Based Service Discovery - Getting Started","ref":"getting_started.html#dht-based-service-discovery"},{"type":"extras","doc":"Instead of relaying through gateways, v0.8.0 establishes direct QUIC connections:\n- Discovered endpoint  Direct connection\n- 50% latency reduction (1-hop vs 2+ hops)\n- Reduced gateway load\n\n---","title":"Direct P2P Connections (v0.8.0) - Getting Started","ref":"getting_started.html#direct-p2p-connections-v0-8-0"},{"type":"extras","doc":"","title":"API Overview - Getting Started","ref":"getting_started.html#api-overview"},{"type":"extras","doc":"**`macula_peer`** - High-level mesh participant API\n- `start_link/2` - Connect to gateway\n- `publish/3`, `subscribe/3` - Pub/sub messaging\n- `call/3`, `advertise/4` - RPC and service registration\n\n**`macula_gateway`** - Gateway/relay node\n- Embedded or standalone gateway deployment\n- Client lifecycle management\n- Message routing and forwarding\n\n**`macula_peer_connector`** - Direct P2P connections (v0.8.0)\n- Establishes outbound QUIC connections\n- Fire-and-forget message delivery","title":"Main Modules - Getting Started","ref":"getting_started.html#main-modules"},{"type":"extras","doc":"```erlang\nOpts = #{\n    realm => <<\"com.example.app\">>,        %% Required: Realm for isolation\n    node_id => <<\"my-node-001\">>,         %% Optional: Custom node ID\n    cert_file => \"cert.pem\",               %% Optional: TLS certificate\n    key_file => \"key.pem\"                  %% Optional: TLS private key\n}\n```\n\n---","title":"Configuration Options - Getting Started","ref":"getting_started.html#configuration-options"},{"type":"extras","doc":"```bash\n# Clone the repository\ngit clone https://github.com/macula-io/macula.git\ncd macula\n\n# Fetch dependencies\nrebar3 get-deps\n\n# Compile\nrebar3 compile\n\n# Run tests\nrebar3 eunit\n\n# Start a shell with Macula loaded\nrebar3 shell\n```\n\n---","title":"Development Setup - Getting Started","ref":"getting_started.html#development-setup"},{"type":"extras","doc":"```bash\n# Run unit tests\nrebar3 eunit\n\n# Run integration tests (requires Docker)\nrebar3 ct --suite=test/integration/multi_hop_rpc_SUITE\nrebar3 ct --suite=test/integration/multi_hop_pubsub_SUITE\n```\n\n---","title":"Testing - Getting Started","ref":"getting_started.html#testing"},{"type":"extras","doc":"Macula is licensed under the Apache License 2.0. See [LICENSE](LICENSE) for details.\n\n---","title":"License - Getting Started","ref":"getting_started.html#license"},{"type":"extras","doc":"- **Issues**: [GitHub Issues](https://github.com/macula-io/macula/issues)\n- **Hex Package**: [hex.pm/packages/macula](https://hex.pm/packages/macula)\n- **Source Code**: [github.com/macula-io/macula](https://github.com/macula-io/macula)\n\n---\n\n**Built with  for the BEAM community**","title":"Community & Support - Getting Started","ref":"getting_started.html#community-support"},{"type":"extras","doc":"# Macula Architecture Overview\n\n> **Visual guide to understanding Macula's distributed mesh architecture**\n\n---","title":"Architecture Guide","ref":"architecture.html"},{"type":"extras","doc":"1. [System Context (C4)](#system-context-c4)\n2. [Container View (C4)](#container-view-c4)\n3. [Deployment Topologies](#deployment-topologies)\n4. [Supervision Trees](#supervision-trees)\n5. [Message Flow Patterns](#message-flow-patterns)\n6. [DHT Architecture](#dht-architecture)\n7. [Direct P2P Connections (v0.8.0)](#direct-p2p-connections-v080)\n\n---","title":"Table of Contents - Architecture Guide","ref":"architecture.html#table-of-contents"},{"type":"extras","doc":"**How applications use Macula to build distributed systems**\n\n```mermaid\ngraph TB\n    subgraph \"Your Application\"\n        App[Elixir/Erlang Application]\n    end\n\n    subgraph \"Macula Platform\"\n        Peer[macula_peer Mesh Participant API]\n        Gateway[macula_gateway Relay Node]\n        DHT[Distributed Hash Table Service Discovery]\n    end\n\n    subgraph \"Other Nodes\"\n        Remote1[Remote Service 1]\n        Remote2[Remote Service 2]\n        Remote3[Remote Subscriber]\n    end\n\n    App -->|start_link publish subscribe call advertise| Peer\n    Peer -->|QUIC/HTTP3| Gateway\n    Peer -.->|Direct P2P| Remote1\n    Peer -.->|Direct P2P| Remote2\n    Gateway -->|Relay| Remote3\n\n    Peer <-->|Query| DHT\n    Gateway <-->|Store/Find| DHT\n\n    style Peer fill:#4CAF50\n    style Gateway fill:#2196F3\n    style DHT fill:#FF9800\n    style App fill:#9C27B0\n```\n\n**Key Concepts:**\n- **macula_peer**: Your application's interface to the mesh\n- **macula_gateway**: Relay node for NAT-traversed peers (optional)\n- **DHT**: Kademlia-based distributed service registry (k=20 replication)\n- **Direct P2P**: v0.8.0+ establishes direct QUIC connections (50% latency improvement)\n\n---","title":"System Context (C4) - Architecture Guide","ref":"architecture.html#system-context-c4"},{"type":"extras","doc":"**Internal architecture of a Macula node**\n\n```mermaid\ngraph TB\n    subgraph \"Application Layer\"\n        App[Your Application Code]\n    end\n\n    subgraph \"Macula Peer (High-Level API)\"\n        Peer[macula_peer Facade/Coordinator]\n\n        subgraph \"Supervised Children\"\n            Conn[macula_connection QUIC Transport]\n            PSH[macula_pubsub_handler Pub/Sub Logic]\n            RPC[macula_rpc_handler RPC Logic]\n            ADV[macula_advertisement_manager DHT Ads]\n        end\n    end\n\n    subgraph \"Gateway (Optional Relay)\"\n        GW[macula_gateway Coordinator]\n\n        subgraph \"Gateway Workers\"\n            Clients[macula_gateway_client_manager Client Lifecycle]\n            GWPS[macula_gateway_pubsub Message Routing]\n            GWRPC[macula_gateway_rpc Handler Registry]\n            Mesh[macula_gateway_mesh Connection Pool]\n        end\n    end\n\n    subgraph \"Core Services\"\n        Routing[macula_routing_server DHT Node]\n        Service[macula_service_registry Service Store]\n        PubSubDHT[macula_pubsub_dht Subscriber Discovery]\n    end\n\n    App -->|API Calls| Peer\n    Peer --> Conn\n    Peer --> PSH\n    Peer --> RPC\n    Peer --> ADV\n\n    Conn -.->|QUIC| GW\n    GW --> Clients\n    GW --> GWPS\n    GW --> GWRPC\n    GW --> Mesh\n\n    PSH --> PubSubDHT\n    RPC --> Service\n    ADV --> Service\n    Service --> Routing\n    PubSubDHT --> Routing\n\n    style Peer fill:#4CAF50\n    style GW fill:#2196F3\n    style Routing fill:#FF9800\n```\n\n**Architecture Principles:**\n- **Single Responsibility**: Each module has one clear purpose\n- **OTP Supervision**: Automatic fault recovery at all levels\n- **Stateless Utilities**: DHT operations don't hold state\n- **Connection Pooling**: Gateway reuses QUIC connections (v0.9.0+)\n\n---","title":"Container View (C4) - Architecture Guide","ref":"architecture.html#container-view-c4"},{"type":"extras","doc":"","title":"Deployment Topologies - Architecture Guide","ref":"architecture.html#deployment-topologies"},{"type":"extras","doc":"```\n\n                     Cloud / Data Center                      \n                  \n    Bootstrap   Bootstrap   Bootstrap     \n      Node              Node              Node        \n   (DHT Seed)        (DHT Seed)        (DHT Seed)     \n                  \n                                                           \n\n                                                 \n                       \n     Gateway             Gateway          Gateway \n      Node     Node     Node   \n    (Relay+             (Relay+          (Relay+  \n     DHT)                DHT)             DHT)    \n                       \n                                                 \n                       \n      Edge                Edge             Edge   \n      Peer     Peer     Peer   \n    (Behind    Direct   (Behind   Direct (Behind  \n      NAT)       P2P      NAT)     P2P     NAT)   \n      (v0.8.0)  (v0.8.0)\n                                                 \n                       \n     Sensor              Sensor           Sensor  \n     Device              Device           Device  \n                       \n```\n\n**Use Cases:**\n- IoT networks with edge processing\n- Distributed sensor networks\n- Edge computing platforms\n- Multi-site deployments\n\n**Features:**\n- Bootstrap nodes: DHT seeds (always available)\n- Gateway nodes: Relay for NAT-traversed peers\n- Edge peers: Application logic at the edge\n- Direct P2P: v0.8.0+ bypasses relay when possible\n\n---","title":"1. Edge-First Mesh (IoT, Distributed Systems) - Architecture Guide","ref":"architecture.html#1-edge-first-mesh-iot-distributed-systems"},{"type":"extras","doc":"```\n\n                    Kubernetes Cluster                        \n                                                               \n     \n                Namespace: macula-system                    \n                                                             \n                      \n    Bootstrap   Bootstrap   Bootstrap               \n       Pod         Pod         Pod                  \n    (Headless   (Headless   (Headless               \n     Service)    Service)    Service)               \n                      \n                             \n     \n                                                              \n     \n                Namespace: app-services                      \n                                                            \n                   \n            Service A (3 replicas)                       \n                       \n        Pod A1    Pod A2    Pod A3                \n      (macula   (macula   (macula                 \n       peer)     peer)     peer)                  \n                       \n                   \n                                                        \n                                  \n                                                          \n                   \n            Service B (2 replicas)                       \n                                  \n        Pod B1   Pod B2                       \n      (macula  Direct(macula                        \n       peer)     P2P  peer)                         \n      (v0.8)                      \n                    \n     \n\n```\n\n**Use Cases:**\n- Microservices communication\n- Service mesh alternative\n- Event-driven architectures\n- Multi-tenant platforms\n\n**Features:**\n- No external message broker needed\n- Built-in service discovery via DHT\n- Realm-based multi-tenancy\n- Direct P2P between pods (v0.8.0+)\n\n---","title":"2. Microservices Mesh (Kubernetes, Cloud) - Architecture Guide","ref":"architecture.html#2-microservices-mesh-kubernetes-cloud"},{"type":"extras","doc":"```\n\n                         Cloud Region                         \n                  \n    Gateway     Gateway     Gateway       \n   (Public IP)       (Public IP)       (Public IP)    \n                  \n\n                                                 \n    Internet/WAN          Internet/WAN        Internet/WAN\n                                                 \n\n                                                           \n                           \n    Factory              Retail           Office      \n      Site                Site             Site       \n                                                      \n                                 \n    Edge              Edge           Edge       \n    Peer              Peer           Peer       \n                                 \n                                                   \n                                 \n    Equip              POS            App       \n                                 \n                           \n                     Edge Locations                           \n\n```\n\n**Use Cases:**\n- Retail chains with local processing\n- Manufacturing with edge analytics\n- Distributed branch offices\n- Multi-region applications\n\n**Features:**\n- Cloud gateways for global reach\n- Edge peers for local processing\n- Automatic failover (relay  direct P2P)\n- Low latency via direct connections\n\n---","title":"3. Hybrid Cloud-Edge (Best of Both Worlds) - Architecture Guide","ref":"architecture.html#3-hybrid-cloud-edge-best-of-both-worlds"},{"type":"extras","doc":"","title":"Supervision Trees - Architecture Guide","ref":"architecture.html#supervision-trees"},{"type":"extras","doc":"```\n                    macula_peer_sup\n                          \n        \n                                          \n                                          \nmacula_connection  macula_pubsub_handler  macula_rpc_handler\n  (QUIC Layer)      (Pub/Sub Logic)       (RPC Logic)\n        \n        \nmacula_advertisement_manager\n  (Service Ads)\n```\n\n**Strategy**: `one_for_all`\n- If any child crashes, restart all (coordinated state)\n- Connection is the foundation; handlers depend on it\n\n---","title":"Peer Supervision Tree - Architecture Guide","ref":"architecture.html#peer-supervision-tree"},{"type":"extras","doc":"```\n                    macula_gateway_sup (Root)\n                            \n        \n                                              \n                                              \nmacula_gateway_    macula_gateway    macula_gateway_workers_sup\n  quic_server                               (Supervisor)\n (QUIC Listener)   (Coordinator)                \n                                    \n                                                          \n                                                          \n                          client_manager  pubsub_router  rpc_handler\n                            (Lifecycle)    (Routing)     (Registry)\n                                    \n                                    \n                              mesh_connection_manager\n                                 (Pool)\n```\n\n**Strategy**: `rest_for_one` (top-level)\n- QUIC server starts first\n- Gateway coordinates\n- Workers handle business logic\n- If QUIC crashes, restart everything\n- If worker crashes, only restart later siblings\n\n**Strategy**: `one_for_one` (workers)\n- Each worker independent\n- Failures isolated to single worker\n\n---","title":"Gateway Supervision Tree - Architecture Guide","ref":"architecture.html#gateway-supervision-tree"},{"type":"extras","doc":"","title":"Message Flow Patterns - Architecture Guide","ref":"architecture.html#message-flow-patterns"},{"type":"extras","doc":"```\n                                         \n Client                                           Provider \n  Peer                                              Peer   \n                                         \n                                                         \n      1. call(\"service.add\", #{a=>5, b=>3})            \n                      \n                                                       \n                                                       \n                                            \n                                   DHT                \n                                 (Find                \n                                 Service)             \n                                            \n                                                       \n      2. Returns: \"192.168.1.50:9443\"                  \n                      \n                                                        \n      3. Direct QUIC Connection                        \n     \n        RPC_REQUEST: service.add, {a:5, b:3}           \n                                                        \n                                       4. Execute Handler\n                                          Result = 8    \n                                                        \n      5. RPC_RESPONSE: {result: 8}                     \n     \n                                                        \n                                                        \n  Returns                                            Handler\n{ok, #{result=>8}}                                   Executed\n```\n\n**Performance**: 1-hop (direct), ~10-50ms latency\n**Fallback**: If direct fails, relay via gateway (2-3 hops)\n\n---","title":"RPC Flow (v0.8.0 Direct P2P) - Architecture Guide","ref":"architecture.html#rpc-flow-v0-8-0-direct-p2p"},{"type":"extras","doc":"```\n                                      \nPublisher                                       Subscriber\n   Peer                                            Peer   \n                                      \n                                                      \n      1. subscribe(\"sensor.temp\")                    \n                                         \n                                      DHT          \n                                     Store:  \n                                   \"sensor.\"       \n                                   \"temp\" ->       \n                                   192.1.1.X       \n                                         \n                                                      \n      2. publish(\"sensor.temp\", {celsius: 21.5})     \n                                   \n                                                     \n                                                     \n                                          \n                    DHT                             \n                  Find:                             \n                 \"sensor.\"                          \n                   \"temp\"                           \n                                          \n                                                     \n      3. Returns: \"192.168.1.X:9443\"                 \n                                   \n                                                      \n      4. Direct QUIC Connection                      \n     \n        PUBLISH: sensor.temp, {celsius: 21.5}        \n                                                      \n                                       5. Deliver to  \n                                          Subscriber  \n                                                      \n                                             receive {macula_event,\n                                                      \"sensor.temp\",\n                                                      #{celsius=>21.5}}\n```\n\n**Performance**: 1-hop (direct), ~10-50ms latency\n**Wildcard Support**: `sensor.*` matches `sensor.temp`, `sensor.pressure`\n**Fanout**: One DHT query finds all subscribers\n\n---","title":"PubSub Flow (v0.8.0 Direct P2P) - Architecture Guide","ref":"architecture.html#pubsub-flow-v0-8-0-direct-p2p"},{"type":"extras","doc":"","title":"DHT Architecture - Architecture Guide","ref":"architecture.html#dht-architecture"},{"type":"extras","doc":"```\nNode ID Space (160-bit):\n\n    0                                              2^160\n    \n\n    Distance(A, B) = A XOR B\n\n    Example:\n    Node A: 1010...\n    Node B: 1100...\n    XOR:    0110... (closer = smaller distance)\n```","title":"Kademlia XOR Distance - Architecture Guide","ref":"architecture.html#kademlia-xor-distance"},{"type":"extras","doc":"```\nEach node maintains:\n\nBucket 0:  Nodes 2^0    distance away  [0-1 bits different]\nBucket 1:  Nodes 2^1    distance away  [1-2 bits different]\nBucket 2:  Nodes 2^2    distance away  [2-4 bits different]\n...\nBucket 159: Nodes 2^159 distance away  [159-160 bits different]\n\nEach bucket holds up to k=20 nodes (sorted by last-seen time)\n```","title":"Routing Table (K-Buckets) - Architecture Guide","ref":"architecture.html#routing-table-k-buckets"},{"type":"extras","doc":"#### STORE Operation (k=20 Propagation)\n\n```\n1. Hash key: hash(\"service.calculator.add\") = node_id\n2. Find k=20 closest nodes via iterative lookup\n3. Send STORE to all k nodes\n4. Each node stores: {key, value, ttl}\n\n  STORE   \n  Node   Node 1  (closest)\n  (You)  Node 2 \n         Node 3 \n           ...  \n        Node 20 \n          \n```\n\n#### FIND_VALUE Operation\n\n```\n1. Hash key: hash(\"service.calculator.add\") = target_id\n2. Query closest known nodes\n3. If found, return value\n4. If not found, return closer nodes\n5. Repeat until value found or no closer nodes\n\n  FIND    \n  Node   Node A \n  (You)           \"Not found,\n          Closer     try Node B\"\n           Nodes              \n                              \n          FIND    \n         Node B \n                 \"Found! Here's\n          Value     the value\"\n\n```\n\n**Complexity**: O(log N) hops to find any key\n**Redundancy**: k=20 replication for fault tolerance\n\n---","title":"DHT Operations - Architecture Guide","ref":"architecture.html#dht-operations"},{"type":"extras","doc":"","title":"Direct P2P Connections (v0.8.0) - Architecture Guide","ref":"architecture.html#direct-p2p-connections-v0-8-0"},{"type":"extras","doc":"```\n\n                    Connection Decision Flow                  \n\n\n        \n          Need to send message   \n          (RPC or PubSub)        \n        \n                    \n                    \n        \n          Query DHT for endpoint \n          (IP:Port discovered)   \n        \n                    \n                    \n        \n          Attempt Direct P2P     \n          via peer_connector     \n        \n                    \n            \n                           \n       Success           Failure\n                           \n                           \n       \n       Message        Fallback   \n      Delivered       to Gateway \n       (1-hop)         Relay     \n                      (2-3 hops) \n       \n                             \n        \n                   \n                   \n          \n           100% Reliability\n            Guaranteed     \n          \n```\n\n**Benefits**:\n- 50% latency reduction when direct succeeds\n- Automatic fallback ensures reliability\n- Gateway load reduced (more direct connections = less relay traffic)\n\n---","title":"Connection Strategy - Architecture Guide","ref":"architecture.html#connection-strategy"},{"type":"extras","doc":"```\n\n              Message Delivery Latency (ms)                   \n\n\nv0.7.x (Relay-Only):\n    50ms        50ms    \nClient  Gateway Server \n                        \nTotal: ~100ms (2-hop minimum)\n\n\nv0.8.0 (Direct P2P):\n           50ms              \nClient Server \n                             \nTotal: ~50ms (1-hop direct)\n\n50% Improvement! \n```\n\n---","title":"Performance Comparison - Architecture Guide","ref":"architecture.html#performance-comparison"},{"type":"extras","doc":"```\nApplication Layer\n       \n       \n\n              macula_peer (API Facade)               \n\n                                   \n     \n    macula_connection     macula_pubsub_   \n     (QUIC Transport)        handler       \n     \n                                   \n     \n     macula_quic          macula_pubsub_   \n      (MsQuic FFI)             dht         \n     \n                                    \n   \n         macula_routing_server (DHT)         \n       (Kademlia, k=20 replication)          \n   \n             \n   \n    macula_routing_    \n         table         \n     (K-buckets)       \n   \n```\n\n**Layered Architecture**:\n1. **API Layer**: High-level user-facing API\n2. **Business Logic**: Pub/sub, RPC, advertisements\n3. **Transport Layer**: QUIC connections and streams\n4. **Discovery Layer**: DHT for service/subscriber lookup\n5. **Routing Layer**: Kademlia routing table\n\n---","title":"Module Dependencies - Architecture Guide","ref":"architecture.html#module-dependencies"},{"type":"extras","doc":"","title":"Key Takeaways for Architects - Architecture Guide","ref":"architecture.html#key-takeaways-for-architects"},{"type":"extras","doc":"1. **BEAM-Native**\n   - OTP supervision for automatic fault recovery\n   - Process-per-connection scalability\n   - Erlang's proven distributed systems DNA\n\n2. **Modern Transport**\n   - HTTP/3 (QUIC) instead of TCP\n   - Built-in encryption (TLS 1.3)\n   - NAT/firewall friendly\n   - Multiplexed streams\n\n3. **Self-Organizing**\n   - No centralized message broker\n   - DHT-based service discovery (Kademlia)\n   - Automatic replication (k=20)\n   - O(log N) lookup complexity\n\n4. **Direct P2P (v0.8.0)**\n   - 50% latency improvement\n   - Bypasses relay when possible\n   - Automatic fallback for reliability\n   - Scales better (less gateway load)\n\n5. **Multi-Tenancy**\n   - Realm-based isolation\n   - Share infrastructure, isolate traffic\n   - Perfect for SaaS platforms\n\n---","title":" What Makes Macula Unique - Architecture Guide","ref":"architecture.html#what-makes-macula-unique"},{"type":"extras","doc":"| Metric | Value | Notes |\n|--------|-------|-------|\n| **Message Latency** | ~50ms | Direct P2P (v0.8.0) |\n| | ~100ms | Relay via gateway |\n| **DHT Lookup** | O(log N) | Kademlia routing |\n| **Replication** | k=20 | Fault tolerance |\n| **Throughput** | 500-2K msg/s | Gateway (v0.8.0) |\n| | 10K+ msg/s | Planned (v0.9.0 pooling) |\n| **Connections** | 100K+ | Per gateway node |\n\n---","title":" Performance Characteristics - Architecture Guide","ref":"architecture.html#performance-characteristics"},{"type":"extras","doc":"** Great Fit:**\n- Distributed IoT systems\n- Microservices mesh\n- Edge computing platforms\n- Real-time event streaming\n- Multi-region applications\n- Multi-tenant SaaS\n\n** Consider Alternatives:**\n- Single-region monoliths (RabbitMQ simpler)\n- Ultra-high-frequency trading (direct TCP faster)\n- Batch processing (Kafka better)\n- Web browser clients (use gateway as WebSocket bridge)\n\n---\n\n**Next Steps**: See [README.md](README.md) for Quick Start and [v0.8.0-OVERVIEW.md](architecture/v0.8.0-OVERVIEW.md) for latest features.","title":" When to Use Macula - Architecture Guide","ref":"architecture.html#when-to-use-macula"},{"type":"extras","doc":"# Changelog\n\nAll notable changes to this project will be documented in this file.\n\nThe format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),\nand this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).\n\n---\n\n## [0.8.7] - 2025-01-21","title":"Changelog","ref":"changelog.html"},{"type":"extras","doc":"This release implements automatic DHT network joining at the platform level, eliminating the need for applications to manually manage bootstrap peer connections.\n\n**Motivation**: Previously, applications using the macula SDK had to manage bootstrap peer URLs themselves, leading to potential DHT network partitioning if different applications connected to different bootstrap peers. v0.8.7 moves this responsibility to the platform level.","title":" Platform-Level DHT Bootstrapping Release - Changelog","ref":"changelog.html#platform-level-dht-bootstrapping-release"},{"type":"extras","doc":"#### Platform-Level Bootstrap Configuration\n- **NEW: `MACULA_BOOTSTRAP_PEERS` environment variable**\n  - Comma-separated list of bootstrap peer URLs\n  - Example: `MACULA_BOOTSTRAP_PEERS=https://bootstrap1:4433,https://bootstrap2:4433`\n  - If NOT set: Node acts as a bootstrap peer (existing behavior)\n  - If set: Node automatically connects to specified peers on startup to join their DHT network\n  - Connections initiated 2 seconds after supervision tree starts\n  - **Implementation**: `macula_root.erl` - `get_bootstrap_peers/0`, `connect_to_bootstrap_peers/2`\n\n#### Automatic DHT Network Joining\n- Platform automatically connects to configured bootstrap peers via `macula_peers_sup`\n- Eliminates application-level bootstrap peer management\n- Ensures all nodes in a deployment join the same DHT network\n- Detailed logging of bootstrap connection attempts and results","title":"Added - Changelog","ref":"changelog.html#added"},{"type":"extras","doc":"- **Enhanced startup logging**: Displays configured bootstrap peers in startup banner\n- **No breaking changes**: Fully backward compatible with v0.8.6\n- **No API changes**: Applications can still use `macula_client:connect/2` as before","title":"Changed - Changelog","ref":"changelog.html#changed"},{"type":"extras","doc":"- **Platform pattern**: Set `MACULA_BOOTSTRAP_PEERS` at deployment level (Docker, Kubernetes, etc.)\n- **Application pattern**: Applications no longer need to manage bootstrap URLs\n- **DHT network integrity**: Platform ensures all nodes join the same DHT network","title":"Documentation - Changelog","ref":"changelog.html#documentation"},{"type":"extras","doc":"- **44/44 tests passing** (100% pass rate)\n- All existing unit tests continue to pass\n- No regression introduced","title":"Test Results - Changelog","ref":"changelog.html#test-results"},{"type":"extras","doc":"**No code changes required** - This is a purely additive feature.\n\n**To enable platform-level DHT bootstrapping:**\n```bash\n# Set environment variable for non-bootstrap nodes\nMACULA_BOOTSTRAP_PEERS=https://bootstrap-node:4433\n\n# Bootstrap node (no variable set)\n#   - node acts as bootstrap peer\n```\n\n**Application code remains unchanged:**\n```erlang\n%% Still works - for client connections to local macula instance\n{ok, Client} = macula_client:connect(<<\"https://localhost:4433\">>, #{\n    realm => <<\"my.realm\">>\n}).\n```\n\n---\n\n## [0.8.5] - 2025-11-18","title":"Migration from v0.8.6 - Changelog","ref":"changelog.html#migration-from-v0-8-6"},{"type":"extras","doc":"This release lays the groundwork for a **zero-configuration, always-on mesh architecture**. Every Macula node now has ALL capabilities enabled (bootstrap + gateway + peer), with automatic TLS certificate generation for cryptographic Node IDs.\n\n**Motivation**: v0.8.4 required users to choose between bootstrap/edge/gateway/hybrid modes and manually manage certificates. This complexity prevented mass deployment and confused new users. v0.8.5 eliminates ALL configuration barriers.","title":" Architectural Foundations Release - Changelog","ref":"changelog.html#architectural-foundations-release"},{"type":"extras","doc":"#### Zero-Config TLS Auto-Generation\n- **NEW MODULE: `macula_tls.erl`** - Automatic TLS certificate management\n  - Auto-generates self-signed certificates on first boot using OpenSSL\n  - RSA 2048-bit keys with 10-year validity\n  - Derives stable Node ID from SHA-256 of public key\n  - File permissions: 0600 for private key (security best practice)\n  - Default paths: `/var/lib/macula/cert.pem`, `/var/lib/macula/key.pem`\n  - Override via `MACULA_CERT_PATH` and `MACULA_KEY_PATH` env vars\n  - **15 comprehensive tests** covering generation, persistence, Node ID derivation, error cases\n\n#### Dynamic Peer Connection Management\n- **NEW MODULE: `macula_peers_sup.erl`** - simple_one_for_one supervisor for peer connections\n  - Dynamic peer spawning via `start_peer/2` API\n  - Each peer gets own supervision tree (macula_peer_system)\n  - API: `list_peers/0`, `count_peers/0`, `stop_peer/1`\n  - Temporary restart strategy (no auto-reconnect storms)\n  - **11 comprehensive tests** covering supervisor structure, API, documentation","title":"Added - Changelog","ref":"changelog.html#added-1"},{"type":"extras","doc":"#### Always-On Architecture\n- **BREAKING: Removed mode-based configuration** (bootstrap/edge/gateway/hybrid modes)\n  - Every node now runs ALL subsystems unconditionally\n  - `macula_root.erl` simplified - no more mode checks\n  - Beautiful startup banner shows configuration\n  - Base process count: **17 processes** (was 16 in hybrid mode)\n  - Per-peer overhead: **4 processes** (unchanged)\n\n#### Environment Variables\n- **NEW: `MACULA_QUIC_PORT`** (replaces `GATEWAY_PORT`, backward compatible)\n- **NEW: `MACULA_CERT_PATH`** (optional, auto-generated if missing)\n- **NEW: `MACULA_KEY_PATH`** (optional, auto-generated if missing)\n- **DEPRECATED: `GATEWAY_PORT`** (still works, falls back to `MACULA_QUIC_PORT`)\n- **DEPRECATED: `MACULA_MODE`** (ignored, all nodes always-on)\n\n#### Supervision Tree Updates\n- Added `macula_peers_sup` as 4th root child (after routing, bootstrap, gateway)\n- Integration with `macula_root` startup sequence\n- Updated documentation: `architecture/FULL_SUPERVISION_TREE.md`","title":"Changed - Changelog","ref":"changelog.html#changed-1"},{"type":"extras","doc":"- **Updated**: `architecture/FULL_SUPERVISION_TREE.md` for v0.8.5 always-on architecture\n- **Updated**: `rebar.config` version to 0.8.5\n- **Updated**: `src/macula.app.src` version to 0.8.5\n- **Updated**: Hex package description reflects v0.8.5 features","title":"Documentation - Changelog","ref":"changelog.html#documentation-1"},{"type":"extras","doc":"**Good News**: v0.8.5 is **fully backward compatible** for existing deployments.\n\n- **Mode configuration ignored**: If you set `MACULA_MODE=hybrid`, it's silently ignored (all nodes are now hybrid)\n- **Environment variables**: Old `GATEWAY_PORT` still works (falls back to `MACULA_QUIC_PORT`)\n- **TLS certificates**: Existing certificates automatically reused, Node ID preserved\n- **No config changes needed**: Just update and redeploy\n\n**See**: `architecture/MIGRATION_V0.8.4_TO_V0.8.5.md` for detailed migration guide","title":"Migration from v0.8.4 - Changelog","ref":"changelog.html#migration-from-v0-8-4"},{"type":"extras","doc":"- **44/44 tests passing** (100% pass rate)\n- **No regressions** - All existing tests continue to pass\n- **26 new tests** (15 TLS + 11 peers_sup)\n- **Code quality**: Idiomatic Erlang (pattern matching, guards, no deep nesting)","title":"Test Results - Changelog","ref":"changelog.html#test-results-1"},{"type":"extras","doc":"- **Zero configuration required** - TLS auto-generated, no mode selection\n- **Simplified deployment** - One node type does everything\n- **Stable identities** - Cryptographic Node IDs survive IP changes\n- **NAT-friendly** - DHT separates identity (Node ID) from location (address)\n- **Production-ready** - Comprehensive test coverage, no breaking changes\n\n**Platform Status**: v0.8.5 completes the architectural foundations for the v0.9.0 NAT traversal release. The mesh is now ready for direct P2P connectivity features.\n\n---\n\n## [0.8.4] - 2025-11-17","title":"Result - Changelog","ref":"changelog.html#result"},{"type":"extras","doc":"- **Hex docs landing page redirect** - Fixed broken redirect with compact README\n  - **Root cause 1**: README too large (303 lines) - ex_doc splits into readme-1.html, readme-2.html\n  - **Root cause 2**: docs/README.md in extras - content merged with root README, making it larger\n  - **Solution 1**: Compacted README to 55 lines (SVG diagram + TOC only)\n  - **Solution 2**: Moved detailed content to GETTING_STARTED.md\n  - **Solution 3**: Removed docs/README.md from hex extras\n  - **Solution 4**: Set `{main, \"readme\"}` to redirect to single readme.html\n  - Result: Single readme.html (8KB) with SVG diagram prominently displayed","title":"Fixed - Changelog","ref":"changelog.html#fixed"},{"type":"extras","doc":"- **GETTING_STARTED.md** - Complete getting started guide with all examples, code samples, API overview\n  - Moved from README.md to keep landing page compact\n  - Full installation instructions\n  - Comprehensive code examples\n  - Core concepts explained\n  - API reference overview","title":"Added - Changelog","ref":"changelog.html#added-2"},{"type":"extras","doc":"- **README.md** - Compacted from 303 lines to 55 lines\n  - SVG architecture diagram prominently displayed\n  - Clean table of contents linking to detailed guides\n  - Quick start code example\n  - Latest release info\n  - Community links","title":"Changed - Changelog","ref":"changelog.html#changed-2"},{"type":"extras","doc":"- Hex docs at https://hexdocs.pm/macula now properly load readme.html\n- Professional SVG architecture diagram visible immediately on landing page\n- No more \"PAGE NOT FOUND\" error (was redirecting to hello_world.html)\n- Clean navigation to detailed guides\n\n**No functional changes** - This is a documentation deployment fix.\n\n---\n\n## [0.8.3] - 2025-11-17","title":"Result - Changelog","ref":"changelog.html#result-1"},{"type":"extras","doc":" **This version had a broken hex docs redirect** - superseded by v0.8.4","title":"Note - Changelog","ref":"changelog.html#note"},{"type":"extras","doc":"- **Hex docs landing page redirect** - Fixed broken redirect to non-existent page\n  - Changed `{main, \"Overview\"}` to `{main, \"readme-1\"}` in rebar.config\n  - Hex docs now properly redirect to README with SVG architecture diagram\n  - Issue: v0.8.2 redirected to non-existent `hello_world.html` causing \"PAGE NOT FOUND\"\n  - Root cause: ex_doc splits long README into multiple pages (readme-1.html, readme-2.html)\n  - Solution: Configure main page to point to actual generated file (readme-1.html)","title":"Fixed - Changelog","ref":"changelog.html#fixed-1"},{"type":"extras","doc":"- Hex docs at https://hexdocs.pm/macula now properly load landing page\n- Professional SVG architecture diagram visible immediately\n- No more \"PAGE NOT FOUND\" error\n\n**No functional changes** - This is a documentation deployment fix.\n\n---\n\n## [0.8.2] - 2025-11-17","title":"Result - Changelog","ref":"changelog.html#result-2"},{"type":"extras","doc":"- **NEW: Professional SVG Architecture Diagram** - Compelling visual on hex docs landing page\n  - Created `artwork/macula-architecture-overview.svg` (5KB, scalable)\n  - System overview showing App  Peer  Gateway/DHT  Remote Services\n  - Color-coded components (purple=app, green=peer, blue=gateway, orange=DHT)\n  - Direct P2P connections highlighted with green dashed arrows\n  - Key features listed (6 bullet points)\n  - Performance metric: \"50% Latency Improvement (v0.8.0)\"\n- **README.md landing page enhanced**:\n  - SVG diagram prominently displayed immediately after logo\n  - Added hex.pm version badge\n  - Enhanced subtitle: \"Self-organizing distributed mesh for decentralized applications\"\n  - Feature tagline: BEAM-Native  HTTP/3  DHT  Direct P2P  Multi-Tenant  50% Faster","title":"Documentation - Changelog","ref":"changelog.html#documentation-2"},{"type":"extras","doc":"- Hex docs now open with compelling architecture diagram\n- Immediate visual understanding without reading text\n- Professional, polished first impression\n- Sparks interest of developers and architects\n- v0.8.0 Direct P2P feature prominently showcased\n\n**No functional changes** - This is purely a documentation/visual improvement release.\n\n---\n\n## [0.8.1] - 2025-11-17","title":"Result - Changelog","ref":"changelog.html#result-3"},{"type":"extras","doc":"- **Hex docs completely redesigned** - Professional, comprehensive documentation for hex.pm\n- **NEW: Comprehensive Architecture Guide** (`ARCHITECTURE.md`):\n  - C4 diagrams (system context, container views) with Mermaid\n  - 3 deployment topologies (edge-first, microservices, hybrid cloud-edge)\n  - Supervision tree diagrams (peer, gateway)\n  - Message flow diagrams (RPC, PubSub with direct P2P)\n  - DHT architecture (Kademlia routing, k-buckets, STORE/FIND_VALUE)\n  - Performance comparison (v0.7.x vs v0.8.0)\n  - Module dependency graph\n  - \"When to use Macula\" decision guide\n- **README.md improvements**:\n  - Added \"Architecture at a Glance\" section with ASCII diagrams\n  - Prominent link to Architecture Guide as first ToC item\n  - Added comprehensive Quick Start section with practical code examples\n  - Added \"What's New in v0.8.0\" section highlighting key features\n  - Added Core Concepts section (mesh architecture, realms, DHT, direct P2P)\n  - Added API Overview section with main modules and configuration\n  - Removed all broken links to non-existent files\n  - Replaced broken table of contents with working internal links\n- **Enhanced module documentation**:\n  - `macula_peer`: Added comprehensive examples for pub/sub and RPC usage\n  - `macula_gateway`: Added embedded and standalone gateway configuration examples\n  - `macula_peer_connector`: Added usage examples and performance characteristics\n- **rebar.config cleanup**:\n  - Removed references to non-existent files (HELLO_WORLD.md, EXECUTIVE_SUMMARY.md, etc.)\n  - Added ARCHITECTURE.md to hex docs (prominently featured)\n  - Added v0.8.0 documentation files (OVERVIEW, CHANGELOG, ROADMAP)\n  - Added TODO.md to hex docs\n  - Updated hex package description to mention v0.8.0 features\n  - Changed main page to \"readme\" for better landing experience","title":"Documentation - Changelog","ref":"changelog.html#documentation-3"},{"type":"extras","doc":"- Hex docs now render professionally on hex.pm with compelling visuals\n- Architecture diagrams showcase system design to developers and architects\n- Clear navigation and documentation structure\n- v0.8.0 features prominently showcased\n- Code examples visible and practical\n- Warnings reduced from 100+ to ~30 (mostly future docs references)\n\n**No functional changes** - This is purely a documentation release to fix the hex.pm documentation quality.\n\n---\n\n## [0.8.0] - 2025-11-17","title":"Result - Changelog","ref":"changelog.html#result-4"},{"type":"extras","doc":"- **Direct P2P QUIC connections** via new `macula_peer_connector` module (112 LOC)\n- **DHT STORE propagation** to k=20 closest nodes for service registrations\n- **RPC via direct P2P** - Service discovery + direct connection (11/11 tests passing)\n- **PubSub via direct P2P** - Subscription discovery + direct messaging (10/10 tests passing)\n- **Gateway on all node types** - Bootstrap, Gateway, and Edge nodes all run QUIC listeners\n- **Comprehensive integration tests** - 21/21 tests passing (100% success rate)\n  - `test/integration/multi_hop_rpc_SUITE.erl` (11 RPC tests)\n  - `test/integration/multi_hop_pubsub_SUITE.erl` (10 PubSub tests)\n- **TODO tracking** - Created `TODO.md` for known limitations and planned improvements","title":"Added - Changelog","ref":"changelog.html#added-3"},{"type":"extras","doc":"- **RPC architecture** - Now uses direct P2P instead of multi-hop routing (50% latency improvement)\n- **PubSub architecture** - Now uses direct P2P for message delivery (50% latency improvement)\n- **DHT operations** - Service registry now uses `store/3` with k-node propagation\n- **Node configuration** - All node types expose port 9443 for P2P connections\n- **Version** - Updated to 0.8.0 in `macula.app.src`","title":"Changed - Changelog","ref":"changelog.html#changed-3"},{"type":"extras","doc":"- Edge nodes can now send messages (via peer_connector, no gateway required)\n- Edge nodes can now receive messages (gateway enabled on all node types)\n- QUIC connection errors properly handled (transport_down 3-tuple)\n- Stream closing race condition fixed (100ms delay added)\n- Docker configuration now respects environment variables","title":"Fixed - Changelog","ref":"changelog.html#fixed-2"},{"type":"extras","doc":"- `macula_dht_rpc` module - Superseded by `macula_peer_connector` (moved to `src/archive/`)","title":"Deprecated - Changelog","ref":"changelog.html#deprecated"},{"type":"extras","doc":"- Created comprehensive v0.8.0 documentation:\n  - `architecture/v0.8.0-OVERVIEW.md` - Release overview and achievements\n  - `architecture/v0.8.0-CHANGELOG.md` - Detailed changes\n  - `architecture/v0.8.0-ROADMAP.md` - Future plans (v0.9.0)\n  - `architecture/INDEX.md` - Master architecture documentation index\n- Archived development documentation to `architecture/archive/v0.8.0-development/`\n- Updated `README.md` for v0.8.0","title":"Documentation - Changelog","ref":"changelog.html#documentation-4"},{"type":"extras","doc":"None - Fully backward compatible with v0.7.x\n\n**Upgrade Guide**: Simply update dependency version - no code changes required.\n\n**Full Details**: See [`architecture/v0.8.0-OVERVIEW.md`](architecture/v0.8.0-OVERVIEW.md) and [`architecture/v0.8.0-CHANGELOG.md`](architecture/v0.8.0-CHANGELOG.md)\n\n---\n\n## [0.7.9] - 2025-11-16","title":"Breaking Changes - Changelog","ref":"changelog.html#breaking-changes"},{"type":"extras","doc":"- **Gateway Supervision Refactoring**: Implemented proper OTP supervision tree\n  - New 3-tier architecture: `macula_gateway_sup` (root) supervises `macula_gateway_quic_server`, `macula_gateway`, `macula_gateway_workers_sup`\n  - Added `macula_gateway_quic_server.erl` - Dedicated QUIC transport layer (248 LOC, 17 tests)\n  - Added `macula_gateway_workers_sup.erl` - Supervises business logic workers (152 LOC, 24 tests)\n  - Added `macula_gateway_clients.erl` - Renamed from `macula_gateway_client_manager` (clearer naming)\n  - Circular dependency resolution via `set_gateway/2` callback pattern\n  - `rest_for_one` supervision strategy for controlled fault isolation","title":"Added - Changelog","ref":"changelog.html#added-4"},{"type":"extras","doc":"- **Gateway Architecture**: Refactored from manual process management to supervised architecture\n  - Gateway now finds siblings via supervisor instead of starting them manually\n  - Simplified `macula_gateway` init/1 - uses `find_parent_supervisor/0` and `find_sibling/2`\n  - Removed manual lifecycle management - supervisor handles cleanup\n  - Updated `macula_gateway_sup.erl` to be root supervisor (was workers supervisor)\n  - All gateway tests updated for new supervision tree (106 tests, 0 failures)","title":"Changed - Changelog","ref":"changelog.html#changed-4"},{"type":"extras","doc":"- **CRITICAL**: Gateway now actually USES DHT-routed pub/sub (v0.7.8 had the code but wasn't calling it!)\n  - Bug: Gateway's `handle_publish` was still using v0.7.7 endpoint-based routing\n  - Impact: v0.7.8 protocol infrastructure existed but gateway bypassed it entirely\n  - Root cause: `handle_publish` (macula_gateway.erl:885-943) never called `macula_pubsub_routing`\n  - Solution: Rewrote `handle_publish` to use `macula_pubsub_routing:wrap_publish` and send via `pubsub_route` messages\n  - Flow: Gateway now queries DHT for `node_id` (not endpoint), wraps PUBLISH in `pubsub_route`, sends via mesh connection manager\n  - Result: Messages now actually route via multi-hop Kademlia DHT to remote subscribers\n- Fixed test failures in `macula_connection_tests` - replaced invalid `connected` message type with `subscribe`\n- Fixed edoc warning in `macula_gateway_sup.erl` - replaced markdown code fence with HTML pre tags for proper documentation generation","title":"Fixed - Changelog","ref":"changelog.html#fixed-3"},{"type":"extras","doc":"- **Fault Tolerance**: Automatic recovery from gateway/QUIC/worker crashes\n- **Production Stability**: Proper OTP supervision with configurable restart strategies\n- **Code Organization**: Clean separation between transport (QUIC), coordination (gateway), and business logic (workers)\n- **Testability**: Each module tested independently with comprehensive coverage","title":"Improved - Changelog","ref":"changelog.html#improved"},{"type":"extras","doc":"- v0.7.8 added `pubsub_route` protocol + routing modules but gateway never used them\n- v0.7.9 integrates the v0.7.8 infrastructure into gateway's publish flow\n- This completes the DHT-routed pub/sub implementation started in v0.7.8\n- Supervision refactoring provides +2/10 scalability improvement (foundational infrastructure)\n- Enables future optimizations: process pools, connection pooling, horizontal scaling\n\n## [0.7.8] - 2025-11-16","title":"Technical Details - Changelog","ref":"changelog.html#technical-details"},{"type":"extras","doc":"- **CRITICAL**: Implemented multi-hop DHT routing for pub/sub to fix matchmaking\n  - Bug: v0.7.7 gateway queried DHT but routed to endpoints, which failed for NAT peers\n  - Impact: Matchmaking still broken - messages couldn't reach subscribers behind NAT\n  - Root cause: Split-brain architecture - subscribers register locally but routing via gateway\n  - Solution: Multi-hop Kademlia DHT routing (same pattern as RPC routing)","title":"Fixed - Changelog","ref":"changelog.html#fixed-4"},{"type":"extras","doc":"- **Protocol Layer**: New `pubsub_route` message type (0x13)\n  - Wraps PUBLISH messages for multi-hop routing through mesh\n  - Fields: `destination_node_id`, `source_node_id`, `hop_count`, `max_hops`, `topic`, `payload`\n  - Protocol encoder/decoder support with validation\n  - 8 encoder tests + 3 decoder tests added\n\n- **Routing Module**: `macula_pubsub_routing.erl` (NEW - 115 LOC)\n  - Stateless routing logic for pub/sub messages\n  - `wrap_publish/4` - Wraps PUBLISH in routing envelope\n  - `route_or_deliver/3` - Routes to next hop or delivers locally\n  - `should_deliver_locally/2` - Checks if destination matches\n  - TTL protection via `max_hops` (default: 10)\n  - 14 comprehensive tests (all passing)\n\n- **Gateway Integration**: Enhanced `macula_gateway.erl`\n  - Added `handle_decoded_message` clause for `pubsub_route` messages\n  - Routes via XOR distance to next hop OR delivers locally\n  - `handle_pubsub_route_deliver/2` - Unwraps and delivers to local subscribers\n  - `forward_pubsub_route/3` - Forwards to next hop through mesh\n\n- **Pub/Sub Handler**: Updated `macula_pubsub_dht.erl`\n  - `route_to_subscribers/5` now uses actual DHT routing (was TODO stub)\n  - Extracts subscriber `node_id` (not endpoint) from DHT results\n  - Wraps PUBLISH in `pubsub_route` envelope\n  - Sends via connection manager which routes through gateway","title":"Added - Changelog","ref":"changelog.html#added-5"},{"type":"extras","doc":"**v0.7.7 Architecture (BROKEN):**\n-  Publisher queries DHT for subscriber endpoints\n-  Tries to route directly to endpoints\n-  Fails for NAT peers (can't accept connections)\n-  Matchmaking stuck on \"Looking for opponent...\"\n\n**v0.7.8 Architecture (FIXED):**\n-  Publisher queries DHT for subscriber node IDs\n-  Wraps PUBLISH in `pubsub_route` envelope\n-  Routes via multi-hop Kademlia (same as RPC)\n-  Works with relay OR direct connections\n-  Matchmaking succeeds across NAT peers\n\n**Message Flow:**\n```\nPublisher                Gateway              Node A               Subscriber\n  |                         |                    |                      |\n  |--pubsub_route---------->|                    |                      |\n  |  dest: Subscriber       |--pubsub_route----->|                      |\n  |  topic: \"matchmaking\"   |  (forward closer)  |--pubsub_route------->|\n  |  payload: {msg}         |                    |                      |\n  |                         |                    |                      | Deliver locally\n```","title":"Technical Details - Changelog","ref":"changelog.html#technical-details-1"},{"type":"extras","doc":"- Protocol encoder: 49 tests (8 new for pubsub_route)\n- Protocol decoder: 35 tests (3 new for pubsub_route)\n- Pub/sub routing: 14 tests (all passing)\n  - wrap_publish envelope creation\n  - should_deliver_locally checks\n  - route_or_deliver decision logic\n  - TTL exhaustion handling\n  - No-route error handling","title":"Tests - Changelog","ref":"changelog.html#tests"},{"type":"extras","doc":"- Added `architecture/dht_routed_pubsub.md` with complete design\n- Future refactoring note: Consider unifying RPC and pub/sub routing modules (nearly identical logic)\n\n**This completes the DHT-routed pub/sub implementation and should enable working matchmaking.**\n\n---\n\n## [0.7.7] - 2025-11-15","title":"Architecture Documentation - Changelog","ref":"changelog.html#architecture-documentation"},{"type":"extras","doc":"- **CRITICAL**: Gateway pub/sub now queries DHT for remote subscribers\n  - Bug: Gateway only checked local subscriptions, never queried DHT for remote subscribers\n  - Impact: Distributed pub/sub and matchmaking completely broken - remote peers couldn't receive messages\n  - Root cause: `handle_publish` only called `macula_gateway_pubsub:get_subscribers` (local streams only)\n  - Fix Phase 1: Added endpoint  stream PID tracking in `macula_gateway_client_manager`\n    - New state field: `endpoint_to_stream :: #{binary() => pid()}`\n    - New API: `get_stream_by_endpoint/2`\n    - Updated `store_client_stream/4` to track endpoints\n    - Updated `remove_client/2` to clean up endpoint mappings\n  - Fix Phase 2: Modified `handle_publish` to query DHT\n    - Queries local subscribers (existing behavior)\n    - Queries DHT for remote subscribers via `crypto:hash(sha256, Topic)`\n    - Converts remote endpoints to stream PIDs using client_manager\n    - Combines local + remote and delivers to all\n  - Fix Phase 3: Added `macula_gateway_dht:lookup_value/1`\n    - Synchronous lookup from local DHT storage\n    - Calls `macula_routing_server:find_value/3` with K=20\n    - Returns `{ok, [Subscriber]}` or `{error, not_found}`\n  - Tests: 90 tests passing (39 client_manager + 49 gateway + 7 endpoint + 5 pub/sub DHT)\n\n**This completes the distributed pub/sub fix and enables working matchmaking across multiple peer containers.**","title":"Fixed - Changelog","ref":"changelog.html#fixed-5"},{"type":"extras","doc":"Before v0.7.7:\n-  Gateway only queried `macula_gateway_pubsub` (local subscriptions)\n-  Remote subscribers stored in DHT but never looked up\n-  Pub/sub messages only delivered to local streams\n-  Multi-peer matchmaking broken\n\nAfter v0.7.7:\n-  Gateway queries both local + DHT for subscribers\n-  Remote endpoints resolved to stream PIDs via endpoint tracking\n-  Messages delivered to all subscribers (local + remote)\n-  Multi-peer matchmaking works correctly\n\nThe architecture remains hub-and-spoke (v0.7.x):\n- All peers connect to gateway\n- Gateway routes all pub/sub messages\n- Subscriptions stored in DHT for discovery\n- Gateway has stream PIDs for all connected peers\n\n---\n\n## [0.8.0] - TBD (Q2 2025)","title":"Technical Details - Changelog","ref":"changelog.html#technical-details-2"},{"type":"extras","doc":"- **BREAKING**: Opportunistic NAT hole punching for direct peer-to-peer connections\n  - 80% direct P2P connections (cone NAT, no firewall)\n  - 20% gateway relay fallback (symmetric NAT, strict firewalls)\n  - True mesh topology (no single point of failure)\n  - New modules: `macula_nat_discovery`, `macula_hole_punch`, `macula_connection_upgrade`\n  - Backward compatible with v0.7.x gateway relay architecture\n\n**This will transform Macula from hub-and-spoke (star topology) to true decentralized mesh.**\n\nSee `architecture/NAT_TRAVERSAL_ROADMAP.md` for complete design.\n\n---\n\n## [0.7.6] - 2025-11-15","title":"Planned - True Mesh Architecture - Changelog","ref":"changelog.html#planned-true-mesh-architecture"},{"type":"extras","doc":"- **CRITICAL**: Disabled QUIC transport-layer idle timeout causing connection closures\n  - Root cause: MsQuic default idle timeout of 30 seconds (2x = 60s to closure)\n  - v0.7.4-0.7.5 application-level PING/PONG worked but didn't reset QUIC transport timer\n  - Added `idle_timeout_ms => 0` to both client connection and gateway listener options\n  - Setting to 0 disables QUIC idle timeout entirely\n  - Connections now stay alive indefinitely (application PING/PONG provides health checks)\n  - Modified: `macula_quic:connect/4` and `macula_quic:listen/2`\n\n**This completes the connection stability fix started in v0.7.4-0.7.5.**","title":"Fixed - Changelog","ref":"changelog.html#fixed-6"},{"type":"extras","doc":"- Added `test/macula_quic_idle_timeout_tests.erl` with 7 tests\n  - Client connection idle timeout configuration\n  - Gateway listener idle timeout configuration\n  - Option structure and value validation\n  - Defense-in-depth architecture documentation","title":"Tests - Changelog","ref":"changelog.html#tests-1"},{"type":"extras","doc":"**Defense in Depth** approach:\n1. **Transport Layer** (v0.7.6): QUIC idle timeout disabled (`idle_timeout_ms => 0`)\n2. **Application Layer** (v0.7.4-0.7.5): PING/PONG keep-alive every 30 seconds\n3. **Result**: Connections stay alive + health monitoring\n\nPrevious versions had application keep-alive but QUIC transport still enforced 30s idle timeout independently.\n\n---\n\n## [0.7.5] - 2025-11-15","title":"Technical Details - Changelog","ref":"changelog.html#technical-details-3"},{"type":"extras","doc":"- **CRITICAL**: Gateway PING message handler missing, preventing keep-alive from working\n  - v0.7.4 implemented keep-alive on edge peer side only\n  - Gateway had no handler for incoming PING messages\n  - Result: PINGs sent but never acknowledged, connections still timed out after 2 minutes\n  - Added `handle_decoded_message({ok, {ping, PingMsg}}, ...)` to gateway\n  - Gateway now responds with PONG to all incoming PING messages\n  - Keep-alive now works bidirectionally (edge peer  gateway)\n  - Also added PONG message handler to gateway for completeness\n\n**This completes the keep-alive implementation started in v0.7.4.**","title":"Fixed - Changelog","ref":"changelog.html#fixed-7"},{"type":"extras","doc":"The keep-alive flow now works correctly:\n1. Edge peer timer fires every 30 seconds (configurable)\n2. Edge peer sends PING to gateway\n3. **Gateway receives PING and responds with PONG** (new in v0.7.5)\n4. Edge peer receives PONG confirmation\n5. QUIC connection stays alive (no idle timeout)\n\nWithout this fix, PINGs were sent but ignored, causing connections to timeout despite v0.7.4's implementation.\n\n---\n\n## [0.7.4] - 2025-11-15","title":"Technical Details - Changelog","ref":"changelog.html#technical-details-4"},{"type":"extras","doc":"- **CRITICAL**: Configurable keep-alive mechanism to prevent QUIC connection timeouts\n  - PING/PONG message support in `macula_connection`\n  - Default keep-alive interval: 30 seconds (configurable)\n  - Keep-alive enabled by default (can be disabled via options)\n  - Automatic PONG response to incoming PING messages\n  - Configuration via `macula_connection:default_config/0`\n  - Prevents 2-minute connection timeout that broke distributed matchmaking\n  - Added 6 tests for keep-alive functionality (all passing)\n\n**This is a critical fix for production deployments where QUIC connections timeout after ~2 minutes of inactivity, breaking pub/sub and matchmaking.**","title":"Fixed - Changelog","ref":"changelog.html#fixed-8"},{"type":"extras","doc":"Enable/disable keep-alive:\n```erlang\n%% Enable with custom interval (milliseconds)\nOpts = #{\n    keepalive_enabled => true,\n    keepalive_interval => 30000  %% 30 seconds\n}.\n\n%% Disable keep-alive\nOpts = #{\n    keepalive_enabled => false\n}.\n\n%% Use defaults (enabled, 30 second interval)\nDefaultConfig = macula_connection:default_config().\n```","title":"Configuration - Changelog","ref":"changelog.html#configuration"},{"type":"extras","doc":"**v0.7.4 maintains hub-and-spoke (star) topology**:\n- Edge peers connect to gateway (not each other)\n- Gateway routes all messages (relay architecture)\n- Gateway is single point of failure (by design for now)\n- DHT routing table exists but routing happens at gateway\n- True peer-to-peer mesh deferred to v0.8.0 (NAT traversal required)\n\n## [0.7.3] - 2025-11-15","title":"Architecture Note - Changelog","ref":"changelog.html#architecture-note"},{"type":"extras","doc":"- **CRITICAL**: Fixed DHT routing table address serialization crash in `macula_gateway_dht`\n  - Bug: Gateway stored parsed address **tuples** `{{127,0,0,1}, 9443}` in DHT instead of binary strings\n  - Impact: When FIND_VALUE replies tried to serialize node addresses, msgpack returned error `{:error, {:badarg, {{127,0,0,1}, 9443}}}`\n  - Root cause: `macula_gateway.erl:522` used `Address` (tuple from `parse_endpoint/1`) instead of `Endpoint` (binary string)\n  - Error chain: DHT stored tuples  encode_node_info extracted tuples  msgpack:pack failed  byte_size crashed\n  - Symptoms: Gateway crashed with \"ArgumentError: 1st argument not a bitstring\" when peers queried DHT\n  - Fix: Store original `Endpoint` binary string in DHT routing table instead of parsed tuple\n  - Added test: `dht_address_serialization_test` documents bug and validates fix\n\n**This is a critical fix for distributed matchmaking and service discovery. Without it, DHT queries crash the gateway.**\n\n## [0.7.2] - 2025-11-15","title":"Fixed - Changelog","ref":"changelog.html#fixed-9"},{"type":"extras","doc":"- **CRITICAL**: Fixed gateway crash in `parse_endpoint/1` when DNS resolution fails\n  - Bug: `inet:getaddr/2` error tuple was not handled, causing ArgumentError when passed to `byte_size/1`\n  - Impact: Gateway crashed repeatedly, closing all client connections and preventing pub/sub communication\n  - Symptoms: \"Failed to publish to topic: :closed\", \"Failed to send STORE for subscription: :closed\"\n  - Fix: Added proper error handling with localhost fallback when DNS resolution fails\n  - Now returns `{{127,0,0,1}, Port}` fallback instead of crashing\n\n**This is a critical fix for production deployments where endpoint DNS resolution may fail.**\n\n## [0.7.1] - 2025-11-15","title":"Fixed - Changelog","ref":"changelog.html#fixed-10"},{"type":"extras","doc":"- **CRITICAL**: Fixed ArithmeticError in `macula_pubsub_handler` message ID handling\n  - Bug: Was assigning binary MsgId to counter instead of integer NewCounter\n  - Impact: Caused pub/sub to crash on second publish attempt with \"bad argument in arithmetic expression\"\n  - Fix: Corrected destructuring in line 300 to use `{_MsgId, NewCounter}` instead of `{MsgIdCounter, _}`\n  - Now properly increments integer counter instead of trying to do arithmetic on binary\n\n**This is a critical fix for anyone using pub/sub functionality in v0.7.0.**\n\n## [0.7.0] - 2025-11-15","title":"Fixed - Changelog","ref":"changelog.html#fixed-11"},{"type":"extras","doc":"- **BREAKING**: Major nomenclature refactoring for clarity and industry alignment\n  - Renamed `macula_connection`  `macula_peer` (mesh participant facade - high-level API)\n  - Renamed `macula_connection_manager`  `macula_connection` (QUIC transport layer - low-level)\n  - Follows industry standards used by libp2p, IPFS, and BitTorrent\n  - Clear separation: `macula_peer` = mesh participant, `macula_connection` = transport","title":"Changed - Changelog","ref":"changelog.html#changed-5"},{"type":"extras","doc":"- Comprehensive transport layer test coverage (36 tests total)\n  - 11 new tests for message decoding, buffering, URL parsing, and realm normalization\n  - All tests passing with zero regressions\n- Complete v0.7.0 documentation in CLAUDE.md\n  - Migration guide with specific API examples\n  - Architecture rationale and benefits\n  - Status tracking for implementation phases","title":"Added - Changelog","ref":"changelog.html#added-6"},{"type":"extras","doc":"**API Changes:**\n\nAll high-level mesh operations now use `macula_peer` instead of `macula_connection`:\n\n```erlang\n%% Before (0.6.x)\n{ok, Client} = macula_connection:start_link(Url, Opts).\nok = macula_connection:publish(Client, Topic, Data).\n{ok, SubRef} = macula_connection:subscribe(Client, Topic, Callback).\n{ok, Result} = macula_connection:call(Client, Procedure, Args).\n\n%% After (0.7.0)\n{ok, Client} = macula_peer:start_link(Url, Opts).\nok = macula_peer:publish(Client, Topic, Data).\n{ok, SubRef} = macula_peer:subscribe(Client, Topic, Callback).\n{ok, Result} = macula_peer:call(Client, Procedure, Args).\n```\n\n**Why This Change?**\n\nThe original naming was confusing:\n-  `macula_connection` served both facade AND transport roles\n-  Mixed high-level mesh operations with low-level QUIC handling\n-  Not aligned with P2P industry standards\n\nAfter v0.7.0:\n-  `macula_peer` = mesh participant (clear high-level API for pub/sub, RPC, DHT)\n-  `macula_connection` = QUIC transport (clear low-level transport layer)\n-  Follows libp2p/IPFS/BitTorrent naming conventions\n\n**Note:** The `macula_client` wrapper module has been updated to use `macula_peer` internally, so if you're using `macula_client`, no changes are required.\n\n## [0.6.7] - 2025-11-15","title":"Migration Guide (0.6.x  0.7.0) - Changelog","ref":"changelog.html#migration-guide-0-6-x-0-7-0"},{"type":"extras","doc":"- **CRITICAL:** Fixed all installation examples to use Hex package references instead of git dependencies\n  - README.md: Changed from git-based to `{:macula, \"~> 0.6\"}` (Elixir) and `{macula, \"0.6.7\"}` (Erlang)\n  - HELLO_WORLD.md: Updated to use proper Hex package format\n  - architecture/macula_http3_mesh_hello_world.md: Fixed tutorial installation examples\n  - architecture/macula_http3_mesh_rpc_guide.md: Fixed migration guide examples\n  - All code examples now show proper Hex.pm installation for published package\n\n## [0.6.6] - 2025-11-15","title":"Fixed - Changelog","ref":"changelog.html#fixed-12"},{"type":"extras","doc":"- Fixed navigation links in documentation guides to use ex_doc HTML filenames\n  - Changed GitHub-style relative paths (`../README.md`) to ex_doc HTML references (`readme.html`)\n  - Fixed all navigation links in EXECUTIVE_SUMMARY.md, COMPARISONS.md, USE_CASES.md, and DEVELOPMENT.md\n  - Links now work correctly in published Hexdocs without \"page not found\" errors\n\n## [0.6.5] - 2025-11-15","title":"Fixed - Changelog","ref":"changelog.html#fixed-13"},{"type":"extras","doc":"- Updated to modern alternative logo (macula-alt-logo.svg) in both README.md and ex_doc\n- Changed tutorial greeting to brand-specific \"Hello, Macula!\" instead of generic greeting","title":"Changed - Changelog","ref":"changelog.html#changed-6"},{"type":"extras","doc":"- Replaced old color logo with cleaner, more modern alternative logo for better visual appeal\n\n## [0.6.4] - 2025-11-15","title":"Fixed - Changelog","ref":"changelog.html#fixed-14"},{"type":"extras","doc":"- **Documentation restructuring** - Split README.md into focused landing page with table of contents\n  - Created `docs/EXECUTIVE_SUMMARY.md` - Why Macula and the case for decentralization\n  - Created `docs/COMPARISONS.md` - How Macula compares to libp2p, Distributed Erlang, Akka, etc.\n  - Created `docs/USE_CASES.md` - Real-world applications across business, IoT, and AI domains\n  - Created `docs/DEVELOPMENT.md` - Complete development guide and coding standards\n  - README.md now serves as concise landing page (119 lines vs 372 lines)\n  - All detailed content accessible via clear table of contents\n  - Removed Mermaid diagram from README.md (ex_doc doesn't support Mermaid - works on GitHub)","title":"Changed - Changelog","ref":"changelog.html#changed-7"},{"type":"extras","doc":"- ex_doc landing page uses HELLO_WORLD.md (tutorial-first approach, no multi-page split)\n- Documentation properly links to all new guide documents\n- Better first impression for Hex.pm users (logo, quick navigation)\n\n## [0.6.3] - 2025-11-15","title":"Fixed - Changelog","ref":"changelog.html#fixed-15"},{"type":"extras","doc":"- Removed README.md from ex_doc extras to prevent multi-page split and broken landing page\n- Documentation now correctly redirects to API reference page\n\n## [0.6.2] - 2025-11-15","title":"Fixed - Changelog","ref":"changelog.html#fixed-16"},{"type":"extras","doc":"- ex_doc landing page configuration (`{main, \"api-reference\"}`) - resolved \"readme.html not found\" error\n\n## [0.6.1] - 2025-11-15","title":"Fixed - Changelog","ref":"changelog.html#fixed-17"},{"type":"extras","doc":"- Professional documentation structure for Hex publication\n  - Architecture diagram in README.md (Mermaid format) showing mesh topology\n  - Organized documentation: moved 50+ files from root to docs/archive/, docs/development/, docs/planning/\n  - Created docs/README.md navigation index\n  - Logo and assets configuration for ex_doc\n  - Comprehensive Hex package file list (artwork/, docs/, architecture/)","title":"Added - Changelog","ref":"changelog.html#added-7"},{"type":"extras","doc":"- README.md badge rendering (moved badges outside ` ` tag for proper GitHub display)\n- ex_doc assets configuration (deprecated warning resolved)\n- ex_doc landing page configuration (changed `{main, \"readme\"}` to `{main, \"api-reference\"}` to fix \"readme.html not found\" error)\n- Hex package configuration to include all necessary assets and documentation\n- Documentation organization for professional first impression\n\n## [0.6.0] - 2025-11-15","title":"Fixed - Changelog","ref":"changelog.html#fixed-18"},{"type":"extras","doc":"- **BREAKING**: Renamed environment variable from `GATEWAY_REALM` to `MACULA_REALM` for better API consistency\n  - All `MACULA_*` environment variables now follow consistent naming\n  - Applies to both gateway mode and edge peer mode\n  - Update your deployment configurations to use `MACULA_REALM` instead of `GATEWAY_REALM`","title":"Changed - Changelog","ref":"changelog.html#changed-8"},{"type":"extras","doc":"- Comprehensive Kademlia DHT architecture documentation (`docs/KADEMLIA_DHT_ARCHITECTURE.md`)\n  - XOR distance metric explanation\n  - K-bucket routing table details\n  - DHT operations (PING, STORE, FIND_NODE, FIND_VALUE)\n  - Iterative lookup algorithm\n  - Macula-specific adaptations (realm-scoped DHT, HTTP/3 transport)\n  - Performance characteristics and comparisons","title":"Added - Changelog","ref":"changelog.html#added-8"},{"type":"extras","doc":"- Updated documentation to reflect `MACULA_REALM` environment variable usage\n- Updated `entrypoint.sh`, `Dockerfile.gateway`, and `config/sys.config` to use `MACULA_REALM`","title":"Fixed - Changelog","ref":"changelog.html#fixed-19"},{"type":"extras","doc":"- Architecture improvement: Separation of `macula_connection` into `macula_peer` (high-level mesh API) and `macula_connection` (low-level QUIC transport)\n- See `docs/NOMENCLATURE_PROPOSAL_CONNECTION_TO_PEER.md` and `docs/PEER_CONNECTION_SEPARATION_PLAN.md` for details\n- Expected timeline: 4-5 weeks after v0.6.0 release","title":"Upcoming in v0.7.0 - Changelog","ref":"changelog.html#upcoming-in-v0-7-0"},{"type":"extras","doc":"If you're using Macula in gateway mode or configuring realm multi-tenancy:\n\n**Before (0.5.0):**\n```bash\nexport GATEWAY_REALM=my-app\n```\n\n**After (0.6.0):**\n```bash\nexport MACULA_REALM=my-app\n```\n\n**Elixir/Phoenix runtime.exs:**\n```elixir\n# Before (0.5.0)\nSystem.put_env(\"GATEWAY_REALM\", realm)\n\n# After (0.6.0)\nSystem.put_env(\"MACULA_REALM\", realm)\n```\n\n## [0.5.0] - 2025-11-14","title":"Migration Guide (0.5.0  0.6.0) - Changelog","ref":"changelog.html#migration-guide-0-5-0-0-6-0"},{"type":"extras","doc":"- Initial public release\n- HTTP/3 (QUIC) mesh networking platform\n- Gateway mode for accepting incoming connections\n- Edge peer mode for mesh participation\n- Multi-tenancy via realm isolation\n- Pub/Sub messaging with wildcard support\n- RPC (request/response) patterns\n- Service discovery and advertisement\n- mDNS local discovery support\n- Process registry via gproc\n- Comprehensive documentation","title":"Added - Changelog","ref":"changelog.html#added-9"},{"type":"extras","doc":"- Gateway mode requires proper TLS certificate configuration\n- Certificates must have Subject Alternative Name (SAN) extension\n- Docker deployments require proper file ownership (`--chown=app:app`)\n\n---\n\n[0.7.0]: https://github.com/macula-io/macula/compare/v0.6.7...v0.7.0\n[0.6.7]: https://github.com/macula-io/macula/compare/v0.6.6...v0.6.7\n[0.6.0]: https://github.com/macula-io/macula/compare/v0.5.0...v0.6.0\n[0.5.0]: https://github.com/macula-io/macula/releases/tag/v0.5.0","title":"Known Issues - Changelog","ref":"changelog.html#known-issues"},{"type":"extras","doc":"# Migration Guide: v0.8.4 to v0.8.5\n\n**Date:** 2025-11-18\n**Status:** Production-Ready\n**Breaking Changes:** None (fully backward compatible)\n\n---","title":"Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html"},{"type":"extras","doc":"v0.8.5 introduces a **zero-configuration, always-on architecture** that eliminates mode-based configuration and automates TLS certificate management. This migration guide helps you understand the changes and upgrade smoothly.\n\n**Good News**: v0.8.5 is **fully backward compatible**. Existing deployments continue to work without any configuration changes.\n\n---","title":"Overview - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#overview"},{"type":"extras","doc":"","title":"What's New in v0.8.5 - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#what-s-new-in-v0-8-5"},{"type":"extras","doc":"**Before (v0.8.4):**\n```bash\n# You had to choose a mode\nMACULA_MODE=bootstrap    # Bootstrap node\nMACULA_MODE=edge         # Edge peer (no incoming connections)\nMACULA_MODE=gateway      # Gateway only\nMACULA_MODE=hybrid       # All capabilities\n```\n\n**After (v0.8.5):**\n```bash\n# No mode configuration needed\n# Every node has ALL capabilities (bootstrap + gateway + peer)\n# MACULA_MODE is ignored (all nodes are always-on)\n```\n\n**Why?** Mode selection confused users and prevented mass deployment. v0.8.5 simplifies this: every node does everything.","title":"1. Always-On Architecture - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#1-always-on-architecture"},{"type":"extras","doc":"**Before (v0.8.4):**\n- Manual certificate generation required\n- No stable Node ID without certificates\n- Complex deployment setup\n\n**After (v0.8.5):**\n```bash\n# Certificates auto-generated on first boot\n# Node ID derived from public key (SHA-256)\n# Files: /var/lib/macula/cert.pem, /var/lib/macula/key.pem\n```\n\n**Override paths (optional):**\n```bash\nMACULA_CERT_PATH=/custom/path/cert.pem\nMACULA_KEY_PATH=/custom/path/key.pem\n```","title":"2. TLS Auto-Generation - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#2-tls-auto-generation"},{"type":"extras","doc":"**New Variables:**\n```bash\nMACULA_QUIC_PORT=4433              # Replaces GATEWAY_PORT\nMACULA_CERT_PATH=/path/to/cert.pem  # Optional (auto-generated)\nMACULA_KEY_PATH=/path/to/key.pem    # Optional (auto-generated)\n```\n\n**Deprecated (still work):**\n```bash\nGATEWAY_PORT=4433    # Falls back to MACULA_QUIC_PORT\nMACULA_MODE=hybrid   # Ignored (all nodes always-on)\n```\n\n---","title":"3. Environment Variable Changes - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#3-environment-variable-changes"},{"type":"extras","doc":"","title":"Migration Scenarios - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#migration-scenarios"},{"type":"extras","doc":"**Your Current Setup (v0.8.4):**\n```bash\nMACULA_MODE=hybrid\nGATEWAY_PORT=4433\nMACULA_REALM=com.example.realm\n```\n\n**Migration Steps:**\n1. Update to v0.8.5 (no config changes needed)\n2. Redeploy\n3. Done!\n\n**What Happens:**\n- `MACULA_MODE=hybrid` is silently ignored (all nodes are hybrid now)\n- `GATEWAY_PORT` still works (backward compatible)\n- If TLS certificates exist, they're reused (Node ID preserved)\n- If no certificates, they're auto-generated on first boot\n\n**Optional Cleanup:**\n```bash\n# You can remove these (but not required)\n# MACULA_MODE=hybrid  # Not needed anymore\n# Use new variable names (but old ones still work)\nMACULA_QUIC_PORT=4433  # Replaces GATEWAY_PORT\n```","title":"Scenario 1: Existing Hybrid Mode Deployment - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#scenario-1-existing-hybrid-mode-deployment"},{"type":"extras","doc":"**Your Current Setup (v0.8.4):**\n```bash\nMACULA_MODE=bootstrap\nHEALTH_PORT=8080\nMACULA_REALM=com.example.realm\n```\n\n**Migration Steps:**\n1. Update to v0.8.5\n2. **Important**: Bootstrap node will now also run gateway (QUIC listener)\n3. Ensure port 4433 (or custom `MACULA_QUIC_PORT`) is available\n4. Redeploy\n\n**What Happens:**\n- Bootstrap node now has gateway + peer capabilities\n- QUIC listener starts on port 4433 (default) or `MACULA_QUIC_PORT`\n- If certificates don't exist, auto-generated\n- Node can now accept peer connections (not just DHT queries)\n\n**Configuration After Migration:**\n```bash\n# MACULA_MODE=bootstrap  # Not needed anymore\nMACULA_QUIC_PORT=4433     # Explicitly set if needed\nHEALTH_PORT=8080          # Unchanged\nMACULA_REALM=com.example.realm\n```","title":"Scenario 2: Existing Bootstrap-Only Deployment - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#scenario-2-existing-bootstrap-only-deployment"},{"type":"extras","doc":"**Your Current Setup (v0.8.4):**\n```bash\nMACULA_MODE=edge\nMACULA_BOOTSTRAP_URL=https://bootstrap:4433\nMACULA_REALM=com.example.realm\n```\n\n**Migration Steps:**\n1. Update to v0.8.5\n2. **Important**: Edge node will now run bootstrap + gateway\n3. Ensure port 4433 (or custom `MACULA_QUIC_PORT`) is available\n4. Redeploy\n\n**What Happens:**\n- Edge node now has bootstrap + gateway capabilities\n- Can accept incoming connections (was edge-only before)\n- Can help with DHT queries (was edge-only before)\n- Can accept peer connections (was edge-only before)\n\n**Configuration After Migration:**\n```bash\n# MACULA_MODE=edge  # Not needed anymore\nMACULA_QUIC_PORT=4433  # Set if needed\nMACULA_BOOTSTRAP_URL=https://bootstrap:4433  # Still works\nMACULA_REALM=com.example.realm\n```","title":"Scenario 3: Existing Edge-Only Deployment - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#scenario-3-existing-edge-only-deployment"},{"type":"extras","doc":"**Your Current docker-compose.yml (v0.8.4):**\n```yaml\nservices:\n  macula-gateway:\n    image: registry.local/macula:0.8.4\n    environment:\n      - MACULA_MODE=hybrid\n      - GATEWAY_PORT=4433\n      - MACULA_REALM=com.example.realm\n    ports:\n      - \"4433:4433/udp\"\n```\n\n**Migration Steps:**\n1. Update image tag to v0.8.5\n2. (Optional) Update environment variables to new names\n3. Deploy\n\n**Updated docker-compose.yml (v0.8.5):**\n```yaml\nservices:\n  macula-gateway:\n    image: registry.local/macula:0.8.5\n    environment:\n      # MACULA_MODE removed (not needed)\n      - MACULA_QUIC_PORT=4433\n      - MACULA_REALM=com.example.realm\n      # TLS certs auto-generated in container\n    ports:\n      - \"4433:4433/udp\"\n    volumes:\n      # Optional: Persist TLS certificates for stable Node ID\n      - macula-certs:/var/lib/macula\n\nvolumes:\n  macula-certs:\n```\n\n**What Changed:**\n- Removed `MACULA_MODE` (all nodes always-on)\n- Changed `GATEWAY_PORT` to `MACULA_QUIC_PORT` (optional)\n- Added volume mount for TLS certificate persistence (recommended)\n\n---","title":"Scenario 4: Docker/Kubernetes Deployment - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#scenario-4-docker-kubernetes-deployment"},{"type":"extras","doc":"","title":"TLS Certificate Management - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#tls-certificate-management"},{"type":"extras","doc":"v0.8.5 auto-generates TLS certificates on first boot if missing:\n\n**Default Paths:**\n```bash\n/var/lib/macula/cert.pem  # Certificate (public)\n/var/lib/macula/key.pem   # Private key (0600 permissions)\n```\n\n**Node ID Derivation:**\n```\nNode ID = SHA-256(Public Key from cert.pem)\n```\n\n**Certificate Properties:**\n- RSA 2048-bit key\n- 10-year validity (3650 days)\n- Self-signed\n- Subject: CN=macula-node","title":"Automatic Certificate Generation - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#automatic-certificate-generation"},{"type":"extras","doc":"**Problem**: Node ID changes if certificates regenerate on every deployment.\n\n**Solution**: Persist certificates using volume mounts.\n\n**Docker Example:**\n```yaml\nservices:\n  macula:\n    image: registry.local/macula:0.8.5\n    volumes:\n      - macula-certs:/var/lib/macula  # Persist certificates\n    environment:\n      - MACULA_QUIC_PORT=4433\n\nvolumes:\n  macula-certs:  # Named volume preserves certs\n```\n\n**Kubernetes Example:**\n```yaml\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: macula-certs-pvc\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 1Mi  # Certificates are tiny\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: macula-gateway\nspec:\n  template:\n    spec:\n      containers:\n      - name: macula\n        image: registry.local/macula:0.8.5\n        volumeMounts:\n        - name: certs\n          mountPath: /var/lib/macula\n      volumes:\n      - name: certs\n        persistentVolumeClaim:\n          claimName: macula-certs-pvc\n```","title":"Preserving Node ID Across Deployments - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#preserving-node-id-across-deployments"},{"type":"extras","doc":"If you want to use your own certificates (e.g., from a CA or cert-manager):\n\n```bash\nMACULA_CERT_PATH=/custom/path/cert.pem\nMACULA_KEY_PATH=/custom/path/key.pem\n```\n\n**Requirements:**\n- Must be valid X.509 certificates in PEM format\n- Private key must be RSA (2048-bit or higher)\n- Certificate and key must match\n\n---","title":"Using Custom Certificates - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#using-custom-certificates"},{"type":"extras","doc":"After migrating to v0.8.5, verify everything works:","title":"Verification - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#verification"},{"type":"extras","doc":"```bash\ndocker logs   | head -20\n```\n\n**Expected Output:**\n```\n\n  Starting Macula v0.8.5 (Always-On Architecture)\n  All capabilities enabled: Bootstrap + Gateway + Peer\n\n\n TLS Certificate: /var/lib/macula/cert.pem\n Private Key: /var/lib/macula/key.pem\n Node ID: a1b2c3d4e5f6...\n\nConfiguration:\n  QUIC Port: 4433\n  Realm: com.example.realm\n  Health Port: 8080\n  Bootstrap Health Interval: 60000ms\n\nStarting subsystems:\n  [1/4] Core DHT Routing\n  [2/4] Bootstrap System\n  [3/4] Gateway System\n  [4/4] Peers Supervisor\n```","title":"1. Check Startup Banner - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#1-check-startup-banner"},{"type":"extras","doc":"```bash\n# Connect to running node\ndocker exec -it   rebar3 shell\n\n# List supervisor tree\n1> observer:start().  % Graphical observer (if X11 available)\n2> supervisor:which_children(macula_root).\n```\n\n**Expected Output:**\n```erlang\n[\n {macula_peers_sup, <0.123.0>, supervisor, [macula_peers_sup]},\n {macula_gateway_system, <0.122.0>, supervisor, [macula_gateway_system]},\n {macula_bootstrap_system, <0.121.0>, supervisor, [macula_bootstrap_system]},\n {macula_routing_server, <0.120.0>, worker, [macula_routing_server]}\n]\n```","title":"2. Check Processes - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#2-check-processes"},{"type":"extras","doc":"```bash\ncurl http://localhost:8080/health\n```\n\n**Expected Output:**\n```json\n{\n  \"status\": \"ok\",\n  \"node_id\": \"a1b2c3d4e5f6...\",\n  \"version\": \"0.8.5\",\n  \"realm\": \"com.example.realm\",\n  \"uptime_seconds\": 123\n}\n```","title":"3. Check Health Endpoint - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#3-check-health-endpoint"},{"type":"extras","doc":"```bash\n# Check certificate exists\ndocker exec   ls -lh /var/lib/macula/\n```\n\n**Expected Output:**\n```\n-rw-r--r-- 1 root root 1.2K Nov 18 12:34 cert.pem\n-rw------- 1 root root 1.7K Nov 18 12:34 key.pem\n```\n\n**Note**: Private key has 0600 permissions (read/write owner only)","title":"4. Verify TLS Certificate - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#4-verify-tls-certificate"},{"type":"extras","doc":"```bash\n# Extract public key from certificate\ndocker exec   openssl x509 -in /var/lib/macula/cert.pem -pubkey -noout > pubkey.pem\n\n# Compute SHA-256\ndocker exec   openssl pkey -pubin -in pubkey.pem -outform DER | sha256sum\n```\n\n**Result**: Should match Node ID shown in startup banner\n\n---","title":"5. Derive Node ID Manually - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#5-derive-node-id-manually"},{"type":"extras","doc":"","title":"Troubleshooting - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#troubleshooting"},{"type":"extras","doc":"**Error:**\n```\n{error, eaddrinuse}\n```\n\n**Solution:**\n```bash\n# Option 1: Use different port\nMACULA_QUIC_PORT=4434\n\n# Option 2: Stop conflicting service\nsudo lsof -i :4433\nsudo kill  \n```","title":"Issue 1: Port 4433 Already in Use - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#issue-1-port-4433-already-in-use"},{"type":"extras","doc":"**Error:**\n```\n{error, {openssl_failed, \"openssl: command not found\"}}\n```\n\n**Solution:**\n```bash\n# Install OpenSSL in container\napt-get update && apt-get install -y openssl\n\n# Or rebuild Docker image with OpenSSL\n```","title":"Issue 2: TLS Certificate Generation Fails - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#issue-2-tls-certificate-generation-fails"},{"type":"extras","doc":"**Problem**: Certificates regenerate on every restart.\n\n**Solution**: Persist certificates using volume mounts (see \"Preserving Node ID\" above)","title":"Issue 3: Node ID Changes on Every Restart - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#issue-3-node-id-changes-on-every-restart"},{"type":"extras","doc":"**Problem**: `GATEWAY_PORT` not recognized.\n\n**Solution**: Check you're running v0.8.5:\n```bash\ndocker exec   rebar3 shell\n1> application:get_key(macula, vsn).\n{ok, \"0.8.5\"}\n```\n\nIf version is correct and `GATEWAY_PORT` still doesn't work, use `MACULA_QUIC_PORT` instead.\n\n---","title":"Issue 4: Old Environment Variables Not Working - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#issue-4-old-environment-variables-not-working"},{"type":"extras","doc":"If you encounter issues with v0.8.5 and need to rollback:","title":"Rollback Plan - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#rollback-plan"},{"type":"extras","doc":"```bash\n# Docker\ndocker pull registry.local/macula:0.8.4\n\n# Kubernetes\nkubectl set image deployment/macula macula=registry.local/macula:0.8.4\n```","title":"Step 1: Revert to v0.8.4 - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#step-1-revert-to-v0-8-4"},{"type":"extras","doc":"```bash\n# Re-add mode configuration (required in v0.8.4)\nMACULA_MODE=hybrid  # Or bootstrap/edge/gateway\nGATEWAY_PORT=4433   # v0.8.4 uses GATEWAY_PORT\n```","title":"Step 2: Restore Configuration - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#step-2-restore-configuration"},{"type":"extras","doc":"```bash\n# Remove v0.8.5 environment variables\n# MACULA_QUIC_PORT  # Not in v0.8.4\n# MACULA_CERT_PATH  # Not in v0.8.4\n# MACULA_KEY_PATH   # Not in v0.8.4\n```","title":"Step 3: Remove v0.8.5 Features - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#step-3-remove-v0-8-5-features"},{"type":"extras","doc":"```bash\ndocker-compose down\ndocker-compose up -d\n```\n\n**Note**: If you persisted TLS certificates, Node ID will remain stable across rollback/upgrade.\n\n---","title":"Step 4: Redeploy - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#step-4-redeploy"},{"type":"extras","doc":"","title":"FAQ - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#faq"},{"type":"extras","doc":"**A**: No, if you have existing TLS certificates. v0.8.5 reuses existing certificates.\n\n**B**: Yes, if you don't have certificates AND don't persist them. Use volume mounts to persist.","title":"Q1: Will my Node ID change after upgrade? - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#q1-will-my-node-id-change-after-upgrade"},{"type":"extras","doc":"**A**: No. v0.8.5 is fully backward compatible. Old configuration continues to work.\n\n**B**: Optional: Update to new variable names (`MACULA_QUIC_PORT` instead of `GATEWAY_PORT`)","title":"Q2: Do I need to update my configuration? - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#q2-do-i-need-to-update-my-configuration"},{"type":"extras","doc":"**A**: v0.8.5 doesn't support edge-only mode. All nodes run gateway (QUIC listener).\n\n**Workaround**: Use firewall rules to block incoming connections on port 4433.\n\n```bash\n# Block incoming connections (but allow outgoing)\niptables -A INPUT -p udp --dport 4433 -j DROP\n```","title":"Q3: What if I want edge-only nodes (no incoming connections)? - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#q3-what-if-i-want-edge-only-nodes-no-incoming-connections"},{"type":"extras","doc":"**A**: Yes. Set `MACULA_CERT_PATH` and `MACULA_KEY_PATH` to your certificate paths.","title":"Q4: Can I use my own TLS certificates? - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#q4-can-i-use-my-own-tls-certificates"},{"type":"extras","doc":"**A**: Auto-generated certificates have 10-year validity. Check expiration:\n\n```bash\nopenssl x509 -in /var/lib/macula/cert.pem -noout -dates\n```\n\n**Output:**\n```\nnotBefore=Nov 18 12:34:56 2025 GMT\nnotAfter=Nov 16 12:34:56 2035 GMT\n```","title":"Q5: How do I monitor TLS certificate expiration? - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#q5-how-do-i-monitor-tls-certificate-expiration"},{"type":"extras","doc":"**A**: Certificate files are tiny (~3KB total). Disk space is not a concern.","title":"Q6: What happens if I run out of disk space for certificates? - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#q6-what-happens-if-i-run-out-of-disk-space-for-certificates"},{"type":"extras","doc":"**A**: Yes. v0.8.5 is wire-compatible with v0.8.4. You can have mixed versions in the mesh.\n\n---","title":"Q7: Can I deploy v0.8.5 alongside v0.8.4 nodes? - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#q7-can-i-deploy-v0-8-5-alongside-v0-8-4-nodes"},{"type":"extras","doc":"v0.8.5 simplifies deployment with:\n-  **Zero configuration** - No mode selection needed\n-  **TLS auto-generation** - Certificates created on first boot\n-  **Backward compatibility** - Existing configs continue to work\n-  **Stable Node IDs** - Derived from public key (SHA-256)\n-  **Production-ready** - 44/44 tests passing, no regressions\n\n**Recommended Migration Path**:\n1. Update to v0.8.5\n2. Add volume mounts for TLS certificate persistence\n3. (Optional) Update environment variable names\n4. Redeploy\n5. Verify startup banner shows v0.8.5\n6. Done!\n\n**No configuration changes required** - just update and redeploy.\n\n---","title":"Summary - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#summary"},{"type":"extras","doc":"If you encounter issues during migration:\n\n- **GitHub Issues**: https://github.com/macula-io/macula/issues\n- **Documentation**: `architecture/FULL_SUPERVISION_TREE.md`\n- **Changelog**: `CHANGELOG.md`\n- **Test Coverage**: Run `rebar3 eunit` to verify everything works\n\n**Remember**: v0.8.5 is fully backward compatible. Your existing deployment will continue to work without any changes.","title":"Support - Migration Guide v0.8.5","ref":"migration_v0-8-4_to_v0-8-5.html#support"},{"type":"extras","doc":"# Macula TODO List\n\nThis document tracks known limitations and planned improvements.","title":"Known Issues & Roadmap","ref":"todo.html"},{"type":"extras","doc":"","title":"v0.9.0 - Security & Production Hardening - Known Issues & Roadmap","ref":"todo.html#v0-9-0-security-production-hardening"},{"type":"extras","doc":"**Status**: Deferred to v0.9.0\n**Modules Affected**:\n- `macula_connection.erl:115` - QUIC connection TLS verification\n- `macula_connection_pool.erl:88` - Connection pool TLS verification\n- `macula_peer_connector.erl:82` - Peer connector certificate verification\n\n**Current Behavior**: `{verify, none}` - accepts any certificate\n**Planned Fix**: Implement proper certificate validation with CA bundle\n**Priority**: High (security)","title":"TLS Certificate Verification - Known Issues & Roadmap","ref":"todo.html#tls-certificate-verification"},{"type":"extras","doc":"**Status**: Deferred to v0.9.0\n**Module**: `macula_gateway_dht.erl:various`\n\n**Current Behavior**: Fire-and-forget DHT operations\n**Planned Fix**: Implement request/response with timeout and correlation IDs\n**Priority**: Medium (observability)","title":"DHT Request/Response Pattern - Known Issues & Roadmap","ref":"todo.html#dht-request-response-pattern"},{"type":"extras","doc":"**Status**: Deferred to v0.9.0\n**Module**: `macula_routing_table.erl:various`\n\n**Current Behavior**: Buckets don't split when full\n**Limitation**: Documented in code - buckets have max capacity\n**Planned Fix**: Implement k-bucket splitting algorithm\n**Priority**: Low (scalability improvement)","title":"DHT Routing Table Bucket Management - Known Issues & Roadmap","ref":"todo.html#dht-routing-table-bucket-management"},{"type":"extras","doc":"**Status**: Documented limitation\n**Module**: `macula_routing_server.erl:various`\n\n**Current Behavior**: Cannot directly query remote nodes without connection\n**Workaround**: Use gateway relay for remote queries\n**Planned Fix**: Implement direct peer-to-peer DHT queries\n**Priority**: Medium (performance)\n\n---","title":"Remote DHT Node Queries - Known Issues & Roadmap","ref":"todo.html#remote-dht-node-queries"},{"type":"extras","doc":"","title":"v0.8.1 - Quality of Life Improvements - Known Issues & Roadmap","ref":"todo.html#v0-8-1-quality-of-life-improvements"},{"type":"extras","doc":"**Module**: `macula_pubsub_qos.erl`, `macula_pubsub_subscription.erl`\n\n**Status**: Stub TODOs to remove\n**Action**: Add internal helper functions or remove placeholder comments\n**Priority**: Low (cleanup)","title":"PubSub Helper Functions - Known Issues & Roadmap","ref":"todo.html#pubsub-helper-functions"},{"type":"extras","doc":"**Module**: `macula_rpc_handler.erl`\n\n**Status**: Phase 6 notes from old refactoring\n**Action**: Remove obsolete Phase 6 comments\n**Priority**: Low (cleanup)\n\n---","title":"RPC Handler Advertisement Manager - Known Issues & Roadmap","ref":"todo.html#rpc-handler-advertisement-manager"},{"type":"extras","doc":"- **v0.8.0**: Direct P2P with DHT propagation, RPC and PubSub via peer_connector\n- **v0.7.x**: Gateway relay architecture, nomenclature refactoring\n- **v0.6.x**: Initial DHT implementation\n\n---","title":"Version History - Known Issues & Roadmap","ref":"todo.html#version-history"},{"type":"extras","doc":"When adding TODOs to code:\n1. Add entry to this document\n2. Link to GitHub issue if exists\n3. Specify target version\n4. Include priority level","title":"Contributing - Known Issues & Roadmap","ref":"todo.html#contributing"},{"type":"extras","doc":"MIT License\n\nCopyright (c) 2025 macula.io\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.","title":"License","ref":"license.html"},{"type":"extras","doc":"# Macula Full Supervision Tree","title":"Supervision Tree","ref":"full_supervision_tree.html"},{"type":"extras","doc":"**Date:** 2025-11-18\n**Version:** v0.8.5+\n**Architecture:** Always-On (all capabilities enabled on every node)\n**Based on:** v0.8.5 architectural foundations release\n\n---","title":"Complete Supervision Hierarchy (v0.8.5 Always-On Architecture) - Supervision Tree","ref":"full_supervision_tree.html#complete-supervision-hierarchy-v0-8-5-always-on-architecture"},{"type":"extras","doc":"```\nmacula (OTP application)\n macula_root [one_for_one]\n    \n     macula_routing_server (worker)\n        Core DHT infrastructure (always on)\n    \n     macula_bootstrap_system [one_for_one] (always on)\n        macula_bootstrap_server (worker)\n           DHT queries, routing table storage\n       \n        macula_bootstrap_registry (worker)\n           Service registry (advertised RPC endpoints)\n       \n        macula_bootstrap_health (worker)\n            System health monitoring\n    \n     macula_gateway_system [rest_for_one] (always on)\n        macula_gateway_health (worker)\n           Health check HTTP server\n       \n        macula_gateway_diagnostics (worker)\n           Diagnostics service\n       \n        macula_gateway_quic_server (worker)\n           QUIC transport layer (UDP listener)\n       \n        macula_gateway (worker)\n           Message routing coordinator\n       \n        macula_gateway_workers_sup [rest_for_one]\n            macula_gateway_clients (worker)\n               Client connection tracking and stream management\n           \n            macula_gateway_pubsub (worker)\n               Pub/Sub message routing with wildcards\n           \n            macula_gateway_rpc (worker)\n               RPC handler registration and management\n           \n            macula_gateway_mesh (worker)\n                Mesh connection pooling (LRU, max 1000 connections)\n    \n     macula_peers_sup [simple_one_for_one] (always on)\n         (dynamically spawned macula_peer_system instances)\n```\n\n---","title":"Visual Tree - Supervision Tree","ref":"full_supervision_tree.html#visual-tree"},{"type":"extras","doc":"When a peer connects (either as client to gateway, or peer-to-peer), it gets its own supervision tree:\n\n```\nmacula_peer_system [rest_for_one] (per connection)\n macula_connection (worker)\n    QUIC connection lifecycle (transport layer)\n\n macula_pubsub_handler (worker)\n    Pub/sub operations for this peer\n\n macula_rpc_handler (worker)\n    RPC operations for this peer\n\n macula_advertisement_manager (worker)\n     DHT service advertisements for this peer\n```\n\n**Note:** Each peer connection gets its own `macula_peer_system` supervisor with dedicated handlers.\n\n---","title":"Peer Connections (Per Client/Peer) - Supervision Tree","ref":"full_supervision_tree.html#peer-connections-per-client-peer"},{"type":"extras","doc":"","title":"Detailed Component Breakdown - Supervision Tree","ref":"full_supervision_tree.html#detailed-component-breakdown"},{"type":"extras","doc":"**Strategy:** `one_for_one`\n**Intensity:** 10 restarts in 5 seconds\n\n**Children (v0.8.5 - always-on):**\n1. `macula_routing_server` - Core DHT infrastructure (always on)\n2. `macula_bootstrap_system` - Bootstrap services (always on)\n3. `macula_gateway_system` - Gateway services (always on)\n4. `macula_peers_sup` - Dynamic peer connections supervisor (always on)\n\n**Startup Sequence:**\n- TLS certificates auto-generated if missing (stable Node ID)\n- All subsystems start unconditionally\n- Beautiful startup banner displays configuration\n- Node ready for P2P mesh participation\n\n**Fault Isolation:**\n- Routing server crash  Only routing restarts\n- Bootstrap system crash  Only bootstrap restarts\n- Gateway system crash  Only gateway restarts\n- Peers supervisor crash  Only peers supervisor restarts (existing connections preserved)\n- Each subsystem is isolated\n\n---","title":"1. Application Root (macula_root) - Supervision Tree","ref":"full_supervision_tree.html#1-application-root-macula_root"},{"type":"extras","doc":"**Strategy:** `one_for_one`\n**Intensity:** 10 restarts in 60 seconds\n**Started when:** `mode  {bootstrap, hybrid}`\n\n**Children (all workers):**\n1. **macula_bootstrap_server**\n   - Handles DHT queries (FIND_NODE, FIND_VALUE, STORE)\n   - Stores routing table entries\n   - Tracks query statistics\n\n2. **macula_bootstrap_registry**\n   - Service registry for advertised RPC endpoints\n   - Generic key/value store for DHT\n   - Provides lookup API\n\n3. **macula_bootstrap_health**\n   - System health monitoring\n   - Periodic health checks\n   - Unhealthy service detection\n\n**Purpose:**\n- Provides DHT bootstrap for new peers joining the mesh\n- Acts as initial contact point (well-known peer)\n- Does NOT route messages (that's gateway's job if enabled)\n\n---","title":"2. Bootstrap System (macula_bootstrap_system) - Supervision Tree","ref":"full_supervision_tree.html#2-bootstrap-system-macula_bootstrap_system"},{"type":"extras","doc":"**Strategy:** `rest_for_one`\n**Intensity:** 10 restarts in 60 seconds\n**Started when:** `mode  {gateway, hybrid}` AND `start_gateway = true`\n\n**Children (in dependency order):**\n\n#### Child 1: macula_gateway_health\n- **Type:** Worker\n- **Purpose:** Health check HTTP server\n- **Port:** Configurable (default 8080)\n- **Endpoint:** `/health`\n- **Crash impact:** Restarts health + diagnostics + quic_server + gateway + workers_sup\n\n#### Child 2: macula_gateway_diagnostics\n- **Type:** Worker\n- **Purpose:** Diagnostics service\n- **Provides:** System metrics, debugging info\n- **Crash impact:** Restarts diagnostics + quic_server + gateway + workers_sup\n\n#### Child 3: macula_gateway_quic_server\n- **Type:** Worker\n- **Purpose:** QUIC transport layer (UDP listener)\n- **Port:** Configurable (default 9443, or MACULA_QUIC_PORT)\n- **Protocol:** HTTP/3 over QUIC\n- **TLS:** Required (cert/key files)\n- **Crash impact:** Restarts quic_server + gateway + workers_sup\n\n#### Child 4: macula_gateway\n- **Type:** Worker\n- **Purpose:** Message routing coordinator\n- **Role:** Facade/orchestrator that delegates to worker children\n- **Crash impact:** Restarts gateway + workers_sup\n\n#### Child 5: macula_gateway_workers_sup\n- **Type:** Supervisor\n- **Strategy:** `rest_for_one`\n- **Purpose:** Supervises business logic workers\n- **Crash impact:** Restarts workers_sup only (quic_server and gateway continue)\n\n---","title":"3. Gateway System (macula_gateway_system) - Supervision Tree","ref":"full_supervision_tree.html#3-gateway-system-macula_gateway_system"},{"type":"extras","doc":"**Strategy:** `rest_for_one`\n**Intensity:** 10 restarts in 60 seconds\n\n**Children (in dependency order):**\n\n#### Child 1: macula_gateway_clients\n- **Type:** Worker\n- **Purpose:** Client connection and stream tracking\n- **Max clients:** 10,000 (configurable, with backpressure)\n- **Tracks:** ClientID  {ConnPid, Streams, LastSeen}\n- **Stream cleanup:** Coordinated map cleanup on disconnect\n- **Crash impact:** Restarts all workers (foundational)\n\n#### Child 2: macula_gateway_pubsub\n- **Type:** Worker\n- **Purpose:** Pub/Sub message routing with wildcards\n- **Supports:** Topic hierarchies (e.g., `game.events.*`)\n- **Wildcard matching:** Prefix matching for subscriptions\n- **Crash impact:** Restarts pubsub + rpc + mesh\n\n#### Child 3: macula_gateway_rpc\n- **Type:** Worker\n- **Purpose:** RPC handler registration and management\n- **Registry:** Procedure  HandlerPid mapping\n- **Routing:** Local handlers + DHT discovery for remote\n- **Crash impact:** Restarts rpc + mesh\n\n#### Child 4: macula_gateway_mesh\n- **Type:** Worker\n- **Purpose:** Mesh connection pooling and management\n- **Pool size:** Max 1,000 connections (LRU eviction)\n- **Connects to:** Other gateways/peers in the mesh\n- **Purpose:** Efficient connection reuse for multi-hop routing\n- **Crash impact:** Restarts mesh only\n\n---","title":"4. Gateway Workers (macula_gateway_workers_sup) - Supervision Tree","ref":"full_supervision_tree.html#4-gateway-workers-macula_gateway_workers_sup"},{"type":"extras","doc":"**Strategy:** `rest_for_one`\n**Intensity:** 10 restarts in 60 seconds\n**Instantiation:** One per peer connection (client or P2P peer)\n\n**Children (in dependency order):**\n\n#### Child 1: macula_connection\n- **Type:** Worker\n- **Purpose:** QUIC connection lifecycle (transport layer)\n- **Role:** Low-level QUIC send/receive, stream management\n- **Crash impact:** Restarts all peer handlers (foundational)\n\n#### Child 2: macula_pubsub_handler\n- **Type:** Worker\n- **Purpose:** Pub/sub operations for this specific peer\n- **Operations:** Subscribe, unsubscribe, publish\n- **Crash impact:** Restarts pubsub + rpc + advertisement\n\n#### Child 3: macula_rpc_handler\n- **Type:** Worker\n- **Purpose:** RPC operations for this specific peer\n- **Operations:** Register handler, call RPC, handle requests\n- **Pending calls:** Tracked with correlation IDs and timeouts\n- **Caller monitoring:** Immediate cleanup on caller death\n- **Crash impact:** Restarts rpc + advertisement\n\n#### Child 4: macula_advertisement_manager\n- **Type:** Worker\n- **Purpose:** DHT service advertisements for this peer\n- **Operations:** Advertise service, unadvertise, list active\n- **TTL:** 5 minutes (configurable)\n- **Cleanup:** Automatic removal of expired advertisements\n- **Crash impact:** Restarts advertisement only\n\n---","title":"5. Peer System (macula_peer_system) - Supervision Tree","ref":"full_supervision_tree.html#5-peer-system-macula_peer_system"},{"type":"extras","doc":"","title":"Supervision Strategies Explained - Supervision Tree","ref":"full_supervision_tree.html#supervision-strategies-explained"},{"type":"extras","doc":"- **Crash:** Child N crashes\n- **Restart:** Only child N restarts\n- **Use case:** Independent children, no dependencies\n\n**Used by:**\n- `macula_root` - Core subsystems are independent\n- `macula_bootstrap_system` - Bootstrap workers are independent","title":"one_for_one - Supervision Tree","ref":"full_supervision_tree.html#one_for_one"},{"type":"extras","doc":"- **Crash:** Child N crashes\n- **Restart:** Child N + all children after N restart\n- **Use case:** Ordered dependencies (later children depend on earlier ones)\n\n**Used by:**\n- `macula_gateway_system` - Dependency chain: health  diagnostics  quic  gateway  workers\n- `macula_gateway_workers_sup` - clients is foundational, others depend on it\n- `macula_peer_system` - connection is foundational, handlers depend on it","title":"rest_for_one - Supervision Tree","ref":"full_supervision_tree.html#rest_for_one"},{"type":"extras","doc":"- **Purpose:** Template-based dynamic child spawning\n- **Restart:** Each child has its own restart strategy (not collective)\n- **Use case:** Managing many similar children (peer connections)\n\n**Used by:**\n- `macula_peers_sup` - Dynamic peer connections (v0.8.5+)\n\n---","title":"simple_one_for_one - Supervision Tree","ref":"full_supervision_tree.html#simple_one_for_one"},{"type":"extras","doc":"**As of v0.8.5, mode-based configuration has been removed.**","title":"v0.8.5 Always-On Architecture - Supervision Tree","ref":"full_supervision_tree.html#v0-8-5-always-on-architecture"},{"type":"extras","doc":"```erlang\nmacula_root [one_for_one]\n macula_routing_server (always on)\n macula_bootstrap_system (always on)\n macula_gateway_system (always on)\n macula_peers_sup (always on)\n```\n\n**Every node has ALL capabilities:**\n-  DHT routing (core infrastructure)\n-  Bootstrap service (helps new peers join)\n-  Gateway with QUIC listener (accepts connections)\n-  Dynamic peer management (on-demand connections)\n\n**Benefits:**\n- Zero configuration required\n- Simplified deployment (no mode selection)\n- True P2P mesh (nodes connect on-demand)\n- TLS auto-generated (stable Node ID)\n\n**Environment Variables (v0.8.5+):**\n```bash\nMACULA_QUIC_PORT=4433                  # QUIC listener port\nMACULA_REALM=my.realm                  # Realm name\nMACULA_BOOTSTRAP_URL=https://...       # Optional bootstrap peer\nHEALTH_PORT=8080                       # Health check port\nMACULA_CERT_PATH=/path/to/cert.pem    # Optional (auto-generated)\nMACULA_KEY_PATH=/path/to/key.pem      # Optional (auto-generated)\n```","title":"Always-On Configuration - Supervision Tree","ref":"full_supervision_tree.html#always-on-configuration"},{"type":"extras","doc":"**DEPRECATED:** Mode-based configuration was removed in v0.8.5.\n\nFor historical reference, v0.8.4 supported these modes:\n- `bootstrap` - DHT bootstrap only\n- `edge` - Peer-only (no incoming connections)\n- `gateway` - Gateway routing only\n- `hybrid` - All capabilities (equivalent to v0.8.5 default)\n\n---","title":"Legacy Mode Configuration (v0.8.4 and earlier) - Supervision Tree","ref":"full_supervision_tree.html#legacy-mode-configuration-v0-8-4-and-earlier"},{"type":"extras","doc":"","title":"Process Count Estimation - Supervision Tree","ref":"full_supervision_tree.html#process-count-estimation"},{"type":"extras","doc":"```\n1   macula_root\n1   macula_routing_server\n1   macula_bootstrap_system\n3   bootstrap workers (server, registry, health)\n1   macula_gateway_system\n5   gateway workers (health, diagnostics, quic, gateway, workers_sup)\n4   business logic workers (clients, pubsub, rpc, mesh)\n1   macula_peers_sup\n---\n17  processes (base)\n\n+ 4 per peer connection (peer_system with 4 handlers)\n```\n\n**Example:** Node with 10 peer connections = 17 + (10  4) = **57 processes**\n\n**Example:** Node with 100 peer connections = 17 + (100  4) = **417 processes**","title":"v0.8.5 Always-On Architecture: - Supervision Tree","ref":"full_supervision_tree.html#v0-8-5-always-on-architecture-1"},{"type":"extras","doc":"**Minimal (edge mode):** 2 processes\n**Bootstrap only:** 6 processes\n**Gateway only:** 12 processes\n**Hybrid:** 16 + (4  peers) processes\n\n---","title":"Legacy v0.8.4 (for reference): - Supervision Tree","ref":"full_supervision_tree.html#legacy-v0-8-4-for-reference"},{"type":"extras","doc":"","title":"Fault Tolerance Examples - Supervision Tree","ref":"full_supervision_tree.html#fault-tolerance-examples"},{"type":"extras","doc":"```\n1. macula_gateway_pubsub crashes\n2. rest_for_one restarts: pubsub + rpc + mesh\n3. Clients continue (no disconnection)\n4. quic_server continues (no listening disruption)\n5. Recovery: ~100ms (restart + state rebuild)\n```","title":"Scenario 1: Gateway worker crashes - Supervision Tree","ref":"full_supervision_tree.html#scenario-1-gateway-worker-crashes"},{"type":"extras","doc":"```\n1. macula_gateway_quic_server crashes\n2. rest_for_one restarts: quic_server + gateway + workers_sup\n3. All workers restart\n4. New QUIC listener started\n5. Clients must reconnect (UDP listener changed)\n6. Recovery: ~500ms (full gateway restart)\n```","title":"Scenario 2: QUIC server crashes - Supervision Tree","ref":"full_supervision_tree.html#scenario-2-quic-server-crashes"},{"type":"extras","doc":"```\n1. macula_bootstrap_system crashes\n2. one_for_one restarts: bootstrap_system only\n3. Gateway continues (independent)\n4. Routing server continues (independent)\n5. Recovery: ~200ms (restart 3 bootstrap workers)\n```","title":"Scenario 3: Bootstrap system crashes - Supervision Tree","ref":"full_supervision_tree.html#scenario-3-bootstrap-system-crashes"},{"type":"extras","doc":"```\n1. macula_rpc_handler (for peer X) crashes\n2. rest_for_one restarts: rpc_handler + advertisement_manager\n3. Peer X's connection and pubsub_handler continue\n4. Peer X doesn't need to reconnect\n5. Recovery: ~50ms (restart 2 handlers)\n```\n\n---","title":"Scenario 4: Peer connection handler crashes - Supervision Tree","ref":"full_supervision_tree.html#scenario-4-peer-connection-handler-crashes"},{"type":"extras","doc":"Each subsystem implements bounded data structures:\n\n1. **Gateway mesh pool:** Max 1,000 connections (LRU eviction)\n2. **Gateway clients:** Max 10,000 clients (backpressure)\n3. **Service registry:** 5-min TTL with automatic cleanup every 60s\n4. **RPC pending calls:** Monitored caller PIDs (cleanup on death)\n5. **Stream tracking:** Coordinated cleanup on client disconnect\n\n**See:** `architecture/memory_management/` for comprehensive details\n\n---","title":"Memory Management - Supervision Tree","ref":"full_supervision_tree.html#memory-management"},{"type":"extras","doc":"","title":"Configuration - Supervision Tree","ref":"full_supervision_tree.html#configuration"},{"type":"extras","doc":"```bash\n# QUIC configuration\nMACULA_QUIC_PORT=4433                 # QUIC listener port\nMACULA_REALM=macula.arcade            # Realm name\nHEALTH_PORT=8080                      # Health check HTTP port\n\n# TLS certificates (auto-generated if not provided)\nMACULA_CERT_PATH=/var/lib/macula/cert.pem    # Optional\nMACULA_KEY_PATH=/var/lib/macula/key.pem      # Optional\n\n# Bootstrap (optional - for joining existing mesh)\nMACULA_BOOTSTRAP_URL=https://bootstrap:4433\n\n# Legacy support (v0.8.4 compatibility)\nGATEWAY_PORT=4433                     # Falls back to MACULA_QUIC_PORT\n```","title":"Environment Variables (v0.8.5+) - Supervision Tree","ref":"full_supervision_tree.html#environment-variables-v0-8-5"},{"type":"extras","doc":"```erlang\n{macula, [\n    {quic_port, 4433},                 % QUIC listener\n    {realm, <<\"macula.arcade\">>},      % Realm name\n    {health_port, 8080},               % Health check port\n    {bootstrap_health_interval, 60000}, % Health check interval (ms)\n\n    % TLS configuration (optional - auto-generated if missing)\n    {cert_path, \"/var/lib/macula/cert.pem\"},\n    {key_path, \"/var/lib/macula/key.pem\"},\n    {cert_validity_days, 3650},        % 10 years\n    {cert_key_bits, 2048}              % RSA key size\n]}\n```","title":"Application Config (sys.config) - v0.8.5+ - Supervision Tree","ref":"full_supervision_tree.html#application-config-sys-config-v0-8-5"},{"type":"extras","doc":"```erlang\n{macula, [\n    {mode, hybrid},                    % DEPRECATED in v0.8.5\n    {start_gateway, true},             % DEPRECATED in v0.8.5\n    {gateway_port, 4433},              % Use quic_port in v0.8.5\n    {gateway_realm, <<\"macula.arcade\">>} % Use realm in v0.8.5\n]}\n```\n\n---","title":"Legacy Configuration (v0.8.4) - Supervision Tree","ref":"full_supervision_tree.html#legacy-configuration-v0-8-4"},{"type":"extras","doc":"- `architecture/memory_management/` - Memory leak prevention and bounded data structures\n- `architecture/dht_routed_rpc.md` - DHT-routed RPC design\n- `architecture/NAT_TRAVERSAL_ROADMAP.md` - v0.8.0/v0.9.0 P2P connectivity\n- `architecture/v0.9.0-CONSISTENCY-CONCERNS.md` - Correlation and consistency patterns\n- `CODE_REVIEW_REPORT.md` - Code quality and health score\n\n---","title":"Related Documents - Supervision Tree","ref":"full_supervision_tree.html#related-documents"},{"type":"extras","doc":"**v0.8.5 Always-On Architecture - Every node runs:**\n-  Core DHT routing (always on)\n-  Bootstrap service (helps new peers join)\n-  Gateway with QUIC listener (accepts connections)\n-  Pub/Sub routing (message forwarding)\n-  RPC handling (service registry + routing)\n-  Mesh connections (connection pooling)\n-  Per-peer handlers (connection + pubsub + rpc + advertisements)\n\n**Total processes:** 17 base + 4 per connected peer\n\n**Zero configuration:**\n- TLS certificates auto-generated on first boot\n- Stable Node ID derived from public key (SHA-256)\n- No mode selection needed\n\n**Fault tolerance:** Proper OTP supervision with `one_for_one` and `rest_for_one` strategies\n\n**Scalability:** Bounded pools prevent unbounded memory growth (see memory management docs)","title":"Summary - Supervision Tree","ref":"full_supervision_tree.html#summary"},{"type":"extras","doc":"# Macula v0.8.0 - Direct P2P with DHT Propagation\n\n**Release Date**: 2025-11-17\n**Status**:  Production Ready\n**Test Coverage**: 21/21 integration tests passing (100%)\n\n---","title":"v0.8.0 Release Overview","ref":"v0-8-0-overview.html"},{"type":"extras","doc":"Macula v0.8.0 introduces **direct peer-to-peer communication** with **DHT propagation**, eliminating the need for multi-hop routing. This release represents a fundamental architectural improvement over v0.7.x, enabling true distributed mesh networking with comprehensive test coverage.","title":"Executive Summary - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#executive-summary"},{"type":"extras","doc":"1. **Direct P2P QUIC Connections** - Messages delivered directly to destination without intermediary hops\n2. **DHT Propagation** - Service registrations and subscriptions propagate to k=20 closest nodes\n3. **Unified Architecture** - All node types (bootstrap, gateway, edge) run QUIC listeners\n4. **RPC via Direct P2P** - Service discovery + direct connection (11/11 tests passing)\n5. **PubSub via Direct P2P** - Subscription discovery + direct messaging (10/10 tests passing)\n\n---","title":"Key Achievements - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#key-achievements"},{"type":"extras","doc":"","title":"What's New in v0.8.0 - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#what-s-new-in-v0-8-0"},{"type":"extras","doc":"**Before (v0.7.x)**: Multi-hop relay through gateway\n```\nPublisher  Gateway Connection  Multi-hop Routing  Subscriber\n```\n\n**After (v0.8.0)**: Direct QUIC connection\n```\nPublisher  DHT Lookup  Direct QUIC Connection  Subscriber\n```\n\n**Benefits**:\n- Lower latency (1 hop instead of 2+)\n- Reduced gateway load\n- Better scalability\n- Simpler message flow","title":"1. Direct Peer-to-Peer Messaging - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#1-direct-peer-to-peer-messaging"},{"type":"extras","doc":"Fire-and-forget P2P QUIC connections (112 LOC):\n\n```erlang\n%% Send message directly to peer\nmacula_peer_connector:send_message(Endpoint, MessageType, Message).\n```\n\n**Features**:\n- Handles transport_down errors gracefully\n- 100ms delay before closing (prevents race condition)\n- Simple endpoint parsing (host:port format)\n- Direct quicer integration with ALPN [\"macula\"]","title":"2. New Module: macula_peer_connector - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#2-new-module-macula_peer_connector"},{"type":"extras","doc":"Service registrations now propagate to k closest nodes:\n\n```erlang\n%% Register service - automatically propagates\nmacula_routing_server:store(Pid, Key, Value)\n```\n\n**Propagation**:\n- Stores locally\n- Finds k=20 closest nodes via XOR distance\n- Sends STORE message to each node\n- Eventual consistency across mesh","title":"3. DHT STORE Propagation - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#3-dht-store-propagation"},{"type":"extras","doc":"**All nodes now run QUIC listeners on port 9443**:\n- Bootstrap nodes - Accept P2P connections\n- Gateway nodes - Accept P2P connections\n- Edge nodes - Accept P2P connections\n\n**Why**: Edge nodes must receive incoming DHT STORE messages and direct P2P messages. Without a listener, they cannot participate fully in the mesh.","title":"4. Gateway on All Node Types - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#4-gateway-on-all-node-types"},{"type":"extras","doc":"RPC now uses direct P2P instead of multi-hop routing:\n\n1. Client queries DHT for service provider\n2. DHT returns provider endpoint\n3. Client connects directly via `macula_peer_connector`\n4. RPC message delivered in single hop\n\n**Test Coverage**: 11/11 integration tests passing\n- Service registration/discovery\n- Multi-node RPC calls\n- Timeout handling\n- Error scenarios","title":"5. Updated RPC Architecture - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#5-updated-rpc-architecture"},{"type":"extras","doc":"PubSub now uses direct P2P for message delivery:\n\n1. Subscriber advertises subscription in DHT\n2. Publisher queries DHT for subscribers\n3. Publisher connects directly to each subscriber\n4. Message delivered via pubsub_route envelope\n\n**Test Coverage**: 10/10 integration tests passing\n- Subscription advertisement\n- Subscriber discovery\n- Multi-hop topology\n- Multiple subscribers\n\n---","title":"6. Updated PubSub Architecture - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#6-updated-pubsub-architecture"},{"type":"extras","doc":"","title":"Architecture Changes - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#architecture-changes"},{"type":"extras","doc":"All node types now have identical P2P capabilities:\n\n| Node Type | v0.7.x | v0.8.0 |\n|-----------|--------|--------|\n| **Bootstrap** | DHT only | DHT + QUIC listener |\n| **Gateway** | DHT + listener | DHT + QUIC listener |\n| **Edge** | DHT only | DHT + QUIC listener |","title":"Node Types - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#node-types"},{"type":"extras","doc":"#### RPC Message Flow (v0.8.0)\n```\n1. Client queries DHT for service \"calculator\"\n2. DHT returns: {node_id, endpoint: \"172.21.0.33:9443\"}\n3. Client  peer_connector  QUIC connection  Provider\n4. Provider executes RPC, returns result\n5. Result  peer_connector  Client\n```\n\n#### PubSub Message Flow (v0.8.0)\n```\n1. Edge1 advertises subscription to \"sensor.data\" in DHT\n2. DHT propagates to k=20 nodes\n3. Publisher queries DHT for \"sensor.data\" subscribers\n4. DHT returns: [{node_id, endpoint: \"172.21.0.31:9443\"}]\n5. Publisher  peer_connector  QUIC  Subscriber\n6. Message delivered wrapped in pubsub_route envelope\n```","title":"Message Flow - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#message-flow"},{"type":"extras","doc":"```\nEdge3 registers service \"calculator\"\n  \nmacula_routing_server:store(Key, Value)\n  \nStore locally + Find k=20 closest nodes\n  \nFor each of k nodes:\n  \nmacula_gateway_dht:send_to_peer(Node, store, Message)\n  \nmacula_peer_connector:send_message(Endpoint, store, Message)\n  \nEstablish QUIC connection\n  \nSend MessagePack-encoded STORE\n  \nWait 100ms for transmission\n  \nGracefully close stream and connection\n  \nRemote node receives STORE message\n  \nStores value locally in DHT\n```\n\n---","title":"DHT Propagation Flow - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#dht-propagation-flow"},{"type":"extras","doc":"","title":"Performance Characteristics - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#performance-characteristics"},{"type":"extras","doc":"- **Fire-and-forget**: New connection per DHT message\n- **Connection lifetime**: ~100-200ms (connect + send + delay + close)\n- **No connection pooling**: Simple but creates overhead","title":"Connection Pattern - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#connection-pattern"},{"type":"extras","doc":"- **DHT STORE**: ~5-10 operations/sec per node\n- **RPC calls**: Limited by DHT discovery latency (~100-200ms first call, then cached)\n- **PubSub messages**: Direct delivery, ~10-50ms latency","title":"Throughput - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#throughput"},{"type":"extras","doc":"1. **Connection pooling** - Reuse connections to frequently-contacted peers\n2. **Persistent streams** - Keep streams open for multiple messages\n3. **Batch sending** - Combine multiple DHT operations\n4. **Adaptive delay** - Tune delay based on network conditions\n\n---","title":"Optimization Opportunities (v0.9.0) - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#optimization-opportunities-v0-9-0"},{"type":"extras","doc":"","title":"Breaking Changes - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#breaking-changes"},{"type":"extras","doc":"v0.8.0 is fully compatible with v0.7.x. The internal architecture changed but the external API remains the same.\n\n**Migration**: Simply upgrade - no code changes required.\n\n---","title":"None (Fully Backward Compatible) - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#none-fully-backward-compatible"},{"type":"extras","doc":"","title":"Files Created - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#files-created"},{"type":"extras","doc":"- `src/macula_peer_connector.erl` (112 LOC) - Direct P2P QUIC connections","title":"New Modules - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#new-modules"},{"type":"extras","doc":"- `test/integration/multi_hop_rpc_SUITE.erl` (11 tests) - RPC integration tests\n- `test/integration/multi_hop_pubsub_SUITE.erl` (10 tests) - PubSub integration tests","title":"New Tests - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#new-tests"},{"type":"extras","doc":"- `architecture/v0.8.0-OVERVIEW.md` - This document\n- `architecture/v0.8.0-ARCHITECTURE.md` - Technical architecture\n- `architecture/v0.8.0-DECISIONS.md` - Architecture Decision Records\n- `architecture/v0.8.0-CHANGELOG.md` - Detailed changes\n- `architecture/v0.8.0-ROADMAP.md` - Future plans (v0.9.0)\n- `architecture/v0.8.0-HISTORY.md` - Development history\n\n---","title":"Documentation - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#documentation"},{"type":"extras","doc":"","title":"Files Modified - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#files-modified"},{"type":"extras","doc":"- `src/macula_routing_server.erl` - Added `store/3` with k-node propagation\n- `src/macula_gateway_dht.erl` - Updated to use peer_connector\n- `src/macula_service_registry.erl` - Changed to use `store/3` instead of `store_local/3`\n- `src/macula_pubsub_dht.erl` - Updated RPC and PubSub to use peer_connector","title":"Core Implementation - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#core-implementation"},{"type":"extras","doc":"- `docker/Dockerfile.bootstrap` - Enabled gateway, added certs, exposed 9443\n- `docker/Dockerfile.edge` - Enabled gateway, added certs, exposed 9443\n- `docker/docker-compose.multi-mode.yml` - Added TLS volumes, gateway env vars","title":"Docker Infrastructure - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#docker-infrastructure"},{"type":"extras","doc":"- `test/integration/test_helpers.erl` - Updated to use DHT APIs\n- Added routing table seeding for reproducible integration tests\n\n---","title":"Test Infrastructure - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#test-infrastructure"},{"type":"extras","doc":"","title":"Upgrade Guide - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#upgrade-guide"},{"type":"extras","doc":"**Step 1**: Update dependency\n```erlang\n{deps, [\n    {macula, \"0.8.0\"}\n]}.\n```\n\n**Step 2**: Rebuild\n```bash\nrebar3 upgrade macula\nrebar3 compile\n```\n\n**Step 3**: Update Docker images (if using)\n```bash\ndocker build -f docker/Dockerfile.edge -t macula-edge:0.8.0 .\n```\n\n**Step 4**: Verify\n```bash\nrebar3 eunit\nrebar3 ct\n```\n\n**No configuration changes required!**\n\n---","title":"From v0.7.x to v0.8.0 - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#from-v0-7-x-to-v0-8-0"},{"type":"extras","doc":"","title":"Known Limitations - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#known-limitations"},{"type":"extras","doc":"**Status**: Deferred to v0.9.0\n**Impact**: Low (works but less secure)\n**Workaround**: Run on trusted networks\n\nCurrent implementation uses `{verify, none}` for QUIC connections. This works but doesn't validate peer certificates.\n\n**Modules affected**:\n- `macula_connection.erl`\n- `macula_connection_pool.erl`\n- `macula_peer_connector.erl`\n\n**Planned fix (v0.9.0)**: Implement proper certificate validation with CA bundle.","title":"TLS Certificate Verification - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#tls-certificate-verification"},{"type":"extras","doc":"**Status**: By design\n**Impact**: Low (works well for DHT)\n**Workaround**: None needed\n\nThe peer connector uses fire-and-forget pattern:\n- No confirmation of delivery\n- No feedback if remote node processed message\n- Good for DHT (eventual consistency)\n- May need request/response pattern for other use cases (v0.9.0)","title":"Fire-and-Forget Pattern Limitations - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#fire-and-forget-pattern-limitations"},{"type":"extras","doc":"**Status**: Optimization opportunity\n**Impact**: Medium (creates overhead)\n**Workaround**: Acceptable for current workloads\n\nNew connection per message creates overhead:\n- ~100-200ms per operation\n- No connection reuse\n- Good enough for service discovery use case\n- Connection pooling planned for v0.9.0\n\n---","title":"Connection Overhead - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#connection-overhead"},{"type":"extras","doc":"See `architecture/v0.8.0-ROADMAP.md` for detailed planning.\n\n**High Priority**:\n1. **Connection Pooling** - Reuse connections to frequently-contacted peers\n2. **TLS Certificate Validation** - Proper certificate verification\n3. **Request/Response Pattern** - DHT queries with timeout and correlation IDs\n\n**Medium Priority**:\n4. **NAT Traversal** - Hole punching for direct P2P behind NAT\n5. **Performance Tuning** - Optimize delay parameter, batch operations\n6. **Subsystem Refactoring** - Extract bootstrap and relay systems\n\n---","title":"What's Next (v0.9.0) - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#what-s-next-v0-9-0"},{"type":"extras","doc":"- **Source Code**: https://github.com/macula-io/macula\n- **Architecture Docs**: `architecture/v0.8.0-ARCHITECTURE.md`\n- **Changelog**: `architecture/v0.8.0-CHANGELOG.md`\n- **Roadmap**: `architecture/v0.8.0-ROADMAP.md`\n- **Integration Tests**: `test/integration/`\n\n---","title":"References - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#references"},{"type":"extras","doc":"- Architecture design and implementation\n- Comprehensive integration test coverage\n- Documentation and release preparation\n\n---\n\n**Document Version**: 1.0\n**Last Updated**: 2025-11-17\n**Status**: Final","title":"Contributors - v0.8.0 Release Overview","ref":"v0-8-0-overview.html#contributors"},{"type":"extras","doc":"# Macula v0.8.0 Changelog\n\n**Release Date**: 2025-11-17\n\n---","title":"v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html"},{"type":"extras","doc":"","title":"New Features - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#new-features"},{"type":"extras","doc":"**New Module**: `macula_peer_connector` (112 LOC)\n- Fire-and-forget QUIC connections\n- Handles transport_down errors gracefully\n- 100ms delay before closing to prevent race conditions\n- Simple endpoint parsing\n\n**API**:\n```erlang\nmacula_peer_connector:send_message(Endpoint, MessageType, Message).\nmacula_peer_connector:send_message(Endpoint, MessageType, Message, Timeout).\n```","title":"Direct Peer-to-Peer Messaging - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#direct-peer-to-peer-messaging"},{"type":"extras","doc":"**Enhanced**: `macula_routing_server:store/3`\n- Now propagates to k=20 closest nodes\n- Automatic replication across mesh\n- Eventual consistency model\n\n**Before**:\n```erlang\n%% Only stored locally\nmacula_routing_server:store_local(Pid, Key, Value).\n```\n\n**After**:\n```erlang\n%% Stores locally + propagates to k closest nodes\nmacula_routing_server:store(Pid, Key, Value).\n```","title":"DHT STORE Propagation - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#dht-store-propagation"},{"type":"extras","doc":"**Changed**: All node types now run QUIC listeners\n\n- Bootstrap nodes: Now accept P2P connections on port 9443\n- Gateway nodes: (unchanged) Accept P2P connections on port 9443\n- Edge nodes: Now accept P2P connections on port 9443\n\n**Why**: Enables edge nodes to receive incoming DHT messages and participate fully in P2P mesh.","title":"Gateway on All Node Types - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#gateway-on-all-node-types"},{"type":"extras","doc":"**Updated**: `src/macula_pubsub_dht.erl` (RPC functions)\n- Service discovery via DHT\n- Direct connection to provider endpoint\n- No multi-hop routing needed\n\n**Message Flow**:\n1. Query DHT for service  Get endpoint\n2. Connect directly via peer_connector\n3. Deliver RPC message\n4. Return result directly\n\n**Test Coverage**: 11/11 integration tests passing","title":"RPC via Direct P2P - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#rpc-via-direct-p2p"},{"type":"extras","doc":"**Updated**: `src/macula_pubsub_dht.erl` (PubSub functions)\n- Subscription advertisement in DHT\n- Subscriber discovery via DHT queries\n- Direct message delivery to subscribers\n\n**Message Flow**:\n1. Subscriber advertises in DHT\n2. Publisher queries DHT for subscribers\n3. Publisher connects directly to each subscriber\n4. Delivers message wrapped in pubsub_route envelope\n\n**Test Coverage**: 10/10 integration tests passing\n\n---","title":"PubSub via Direct P2P - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#pubsub-via-direct-p2p"},{"type":"extras","doc":"","title":"Improvements - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#improvements"},{"type":"extras","doc":"**Improved**: QUIC connection error handling\n- Added pattern match for 3-tuple errors: `{error, transport_down, Details}`\n- Graceful handling of connection failures\n- Better error messages","title":"Error Handling - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#error-handling"},{"type":"extras","doc":"**Fixed**: Race condition in stream closing\n- Added 100ms delay after send before closing stream\n- Allows QUIC to flush send buffer\n- Prevents \"Failed to set stream active: closed\" errors\n- Graceful shutdown with proper ACKs","title":"Stream Lifecycle Management - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#stream-lifecycle-management"},{"type":"extras","doc":"**Fixed**: Gateway configuration in Dockerfiles\n- Changed hardcoded `start_gateway` to environment-driven\n- All node types now expose port 9443\n- TLS certificates properly mounted\n\n**Files Modified**:\n- `docker/Dockerfile.bootstrap`\n- `docker/Dockerfile.edge`\n- `docker/docker-compose.multi-mode.yml`","title":"Docker Configuration - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#docker-configuration"},{"type":"extras","doc":"**New**: Integration test suites\n- `test/integration/multi_hop_rpc_SUITE.erl` - 11 RPC tests\n- `test/integration/multi_hop_pubsub_SUITE.erl` - 10 PubSub tests\n- Routing table seeding for reproducible tests\n- Docker-based multi-node testing\n\n**New**: Test helpers\n- `test/integration/test_helpers.erl` - DHT operations, Docker exec, health checks\n\n---","title":"Test Infrastructure - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#test-infrastructure"},{"type":"extras","doc":"","title":"Bug Fixes - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#bug-fixes"},{"type":"extras","doc":"**Problem**: Edge nodes don't run gateway, so `whereis(macula_gateway)` returned `undefined`.\n\n**Solution**: Implemented `macula_peer_connector` for direct QUIC connections without requiring local gateway.","title":"Fixed: Edge Nodes Cannot Send Messages - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#fixed-edge-nodes-cannot-send-messages"},{"type":"extras","doc":"**Problem**: Edge nodes without QUIC listener cannot accept incoming connections.\n\n**Solution**: Enabled gateway on all node types so every node can receive P2P connections.","title":"Fixed: Edge Nodes Cannot Receive Messages - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#fixed-edge-nodes-cannot-receive-messages"},{"type":"extras","doc":"**Problem**: `quicer:connect` returns `{error, transport_down, Details}` (3-tuple) but code only handled 2-tuple errors.\n\n**Solution**: Added pattern match for 3-tuple error.","title":"Fixed: QUIC Error Handling - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#fixed-quic-error-handling"},{"type":"extras","doc":"**Problem**: Sender closed stream immediately after `quicer:send/2`, receiver got \"Failed to set stream active: closed\".\n\n**Solution**: Added 100ms delay after send before closing.","title":"Fixed: Stream Closing Race Condition - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#fixed-stream-closing-race-condition"},{"type":"extras","doc":"**Problem**: `docker-compose.yml` environment variables didn't override Dockerfile CMD arguments.\n\n**Solution**: Changed Dockerfiles to enable gateway by default with proper ENV vars.\n\n---","title":"Fixed: Dockerfile Configuration Override - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#fixed-dockerfile-configuration-override"},{"type":"extras","doc":"","title":"Deprecated - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#deprecated"},{"type":"extras","doc":"**Status**: Moved to `src/archive/`\n**Reason**: Superseded by `macula_peer_connector`\n**Migration**: Use `macula_peer_connector:send_message/3` instead\n\n---","title":"Deprecated: macula_dht_rpc module - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#deprecated-macula_dht_rpc-module"},{"type":"extras","doc":"","title":"API Changes - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#api-changes"},{"type":"extras","doc":"All v0.7.x APIs remain functional. New functionality is additive.","title":"No Breaking Changes - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#no-breaking-changes"},{"type":"extras","doc":"```erlang\n%% macula_peer_connector (NEW)\n-spec send_message(binary(), atom(), map()) -> ok | {error, term()}.\n-spec send_message(binary(), atom(), map(), timeout()) -> ok | {error, term()}.\n\n%% macula_routing_server (ENHANCED)\n-spec store(pid(), binary(), term()) -> ok.  % Now propagates to k nodes\n```","title":"New APIs - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#new-apis"},{"type":"extras","doc":"```erlang\n%% macula_pubsub_dht (UPDATED)\n%% Now uses peer_connector for direct P2P delivery\nroute_to_subscribers(Topic, Payload, Qos, Subscribers, SourceNodeId).\nadvertise_subscription(Topic, SubRef, NodeId, Url, ConnMgrPid).\nquery_dht_async(Topic, Payload, Qos, MsgId, ConnMgrPid).\n```\n\n---","title":"Enhanced APIs - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#enhanced-apis"},{"type":"extras","doc":"","title":"Configuration Changes - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#configuration-changes"},{"type":"extras","doc":"v0.8.0 is fully backward compatible. No configuration changes required.","title":"No Required Changes - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#no-required-changes"},{"type":"extras","doc":"```erlang\n%% Future: Connection pooling (v0.9.0)\n{macula, [\n    {peer_connector, #{\n        pool_size => 100,\n        connection_ttl => 300000  % 5 minutes\n    }}\n]}.\n\n%% Future: TLS verification (v0.9.0)\n{macula, [\n    {tls, #{\n        verify => verify_peer,\n        cacertfile => \"/path/to/ca.pem\"\n    }}\n]}.\n```\n\n---","title":"New Optional Configuration - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#new-optional-configuration"},{"type":"extras","doc":"","title":"Performance - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#performance"},{"type":"extras","doc":"- **RPC calls**: 1-hop direct vs 2+ hop relay (~50% latency reduction)\n- **PubSub messages**: Direct delivery vs gateway relay (~50% latency reduction)\n- **DHT queries**: Local + remote queries (~100-200ms for remote)","title":"Latency Improvements - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#latency-improvements"},{"type":"extras","doc":"- **DHT STORE**: ~5-10 operations/sec per node\n- **RPC calls**: Limited by DHT discovery (~100-200ms first call, cached after)\n- **PubSub**: Direct delivery, ~10-50ms latency","title":"Throughput - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#throughput"},{"type":"extras","doc":"- **Connection overhead**: New connection per message (~100-200ms)\n- **Memory**: Minimal increase (peer_connector is stateless)\n- **CPU**: Slightly higher due to connection establishment overhead\n\n---","title":"Resource Usage - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#resource-usage"},{"type":"extras","doc":"","title":"Testing - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#testing"},{"type":"extras","doc":"**RPC Integration Tests** (`test/integration/multi_hop_rpc_SUITE.erl`):\n-  test_bootstrap_node_healthy\n-  test_gateway_node_healthy\n-  test_edge_nodes_healthy\n-  test_dht_peer_discovery\n-  test_service_registration_in_dht\n-  test_service_discovery_via_dht\n-  test_single_hop_rpc_call\n-  test_multi_hop_rpc_call\n-  test_rpc_timeout_handling\n-  test_rpc_provider_not_found\n-  test_rpc_max_hops_exceeded\n\n**PubSub Integration Tests** (`test/integration/multi_hop_pubsub_SUITE.erl`):\n-  test_bootstrap_node_healthy\n-  test_gateway_node_healthy\n-  test_edge_nodes_healthy\n-  test_dht_peer_discovery\n-  test_subscription_advertisement_in_dht\n-  test_subscriber_discovery_via_dht\n-  test_single_hop_pubsub\n-  test_multi_hop_pubsub\n-  test_wildcard_subscriptions\n-  test_multiple_subscribers\n\n**Total**: 21/21 integration tests passing (100%)\n\n---","title":"New Test Suites - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#new-test-suites"},{"type":"extras","doc":"","title":"Known Issues - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#known-issues"},{"type":"extras","doc":"**Impact**: Security concern for production\n**Workaround**: Run on trusted networks\n**Fix**: Planned for v0.9.0\n\nCurrently using `{verify, none}` in QUIC connections. This works but doesn't validate peer certificates.","title":"TLS Certificate Verification Disabled - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#tls-certificate-verification-disabled"},{"type":"extras","doc":"**Impact**: No delivery confirmation\n**Workaround**: Use eventual consistency model\n**Enhancement**: Request/response pattern planned for v0.9.0\n\nThe peer connector doesn't confirm delivery or provide feedback. This is by design for DHT operations but may need enhancement for other use cases.","title":"Fire-and-Forget Pattern Limitations - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#fire-and-forget-pattern-limitations"},{"type":"extras","doc":"**Impact**: New connection per message\n**Workaround**: Acceptable for current workloads\n**Optimization**: Connection pooling planned for v0.9.0\n\nCreating new connection for each message adds overhead. Connection pooling will significantly improve performance.\n\n---","title":"Connection Overhead - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#connection-overhead"},{"type":"extras","doc":"","title":"Documentation - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#documentation"},{"type":"extras","doc":"- `architecture/v0.8.0-OVERVIEW.md` - Release overview\n- `architecture/v0.8.0-ARCHITECTURE.md` - Technical architecture\n- `architecture/v0.8.0-DECISIONS.md` - Architecture Decision Records\n- `architecture/v0.8.0-CHANGELOG.md` - This document\n- `architecture/v0.8.0-ROADMAP.md` - Future plans\n- `architecture/v0.8.0-HISTORY.md` - Development history\n- `TODO.md` - Tracked limitations and planned improvements","title":"New Documents - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#new-documents"},{"type":"extras","doc":"- `README.md` - Updated for v0.8.0\n- Module @doc comments - Enhanced documentation\n- Integration test documentation","title":"Updated Documents - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#updated-documents"},{"type":"extras","doc":"Moved to `architecture/archive/v0.8.0-development/`:\n- Development session summaries\n- Implementation progress tracking\n- Work breakdown documents\n- Phase completion reports\n\n---","title":"Archived Documents - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#archived-documents"},{"type":"extras","doc":"","title":"Upgrade Instructions - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#upgrade-instructions"},{"type":"extras","doc":"**Step 1**: Update dependency\n```erlang\n%% In rebar.config\n{deps, [\n    {macula, \"0.8.0\"}\n]}.\n```\n\n**Step 2**: Rebuild\n```bash\nrebar3 upgrade macula\nrebar3 compile\n```\n\n**Step 3**: Update Docker images (optional)\n```bash\n# Rebuild with v0.8.0\ndocker build -f docker/Dockerfile.bootstrap -t macula-bootstrap:0.8.0 .\ndocker build -f docker/Dockerfile.gateway -t macula-gateway:0.8.0 .\ndocker build -f docker/Dockerfile.edge -t macula-edge:0.8.0 .\n```\n\n**Step 4**: Test\n```bash\nrebar3 eunit\nrebar3 ct\n```\n\n**No configuration changes required!**\n\n---","title":"From v0.7.x - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#from-v0-7-x"},{"type":"extras","doc":"Development, testing, documentation, and release preparation.\n\n---","title":"Contributors - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#contributors"},{"type":"extras","doc":"- **Source**: GitHub tag `v0.8.0`\n- **Hex Package**: `macula` v0.8.0\n- **Docker Images**:\n  - `macula-bootstrap:0.8.0`\n  - `macula-gateway:0.8.0`\n  - `macula-edge:0.8.0`\n\n---\n\n**Document Version**: 1.0\n**Last Updated**: 2025-11-17","title":"Release Assets - v0.8.0 Detailed Changelog","ref":"v0-8-0-changelog.html#release-assets"},{"type":"extras","doc":"# Macula v0.8.0 Roadmap - What's Next\n\n**Current Version**: v0.8.0\n**Next Release**: v0.9.0 (Planned Q2 2025)\n\n---","title":"v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html"},{"type":"extras","doc":" **COMPLETE** - All features implemented and tested\n\n-  Direct P2P QUIC connections\n-  DHT propagation (k=20 replication)\n-  Gateway on all node types\n-  RPC via direct P2P (11/11 tests)\n-  PubSub via direct P2P (10/10 tests)\n-  Comprehensive integration tests\n\n**Test Coverage**: 21/21 integration tests passing (100%)\n\n---","title":"v0.8.0 Status - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#v0-8-0-status"},{"type":"extras","doc":"**Target Release**: Q2 2025 (4-6 months)\n**Focus**: Security, Performance, NAT Traversal","title":"v0.9.0 Planning - Production Hardening - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#v0-9-0-planning-production-hardening"},{"type":"extras","doc":"v0.8.0 provides the foundation. v0.9.0 makes it production-grade with security hardening, performance optimization, and NAT traversal.\n\n---","title":"Theme: Production-Ready Infrastructure - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#theme-production-ready-infrastructure"},{"type":"extras","doc":"","title":"High Priority Features - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#high-priority-features"},{"type":"extras","doc":"**Problem**: New connection per message creates overhead\n**Impact**: Performance (100-200ms per operation)\n**Effort**: 2-3 weeks\n\n**Implementation**:\n- Create `macula_connection_pool` enhancement\n- LRU eviction policy\n- Max 100 connections per pool\n- TTL-based cleanup (5-minute idle timeout)\n- Automatic reconnection on failure\n\n**Benefits**:\n- 10x performance improvement for repeated operations\n- Reduced connection establishment overhead\n- Better resource utilization\n- Lower latency for frequent P2P operations\n\n**API**:\n```erlang\n%% Get connection from pool (or create new)\n{ok, Conn} = macula_connection_pool:get_connection(Endpoint).\n\n%% Send via pooled connection\nok = macula_connection_pool:send_message(Conn, MessageType, Message).\n\n%% Return to pool (automatic via monitoring)\n```","title":"1. Connection Pooling - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#1-connection-pooling"},{"type":"extras","doc":"**Problem**: Currently using `{verify, none}` (security risk)\n**Impact**: Security (high)\n**Effort**: 1-2 weeks\n\n**Implementation**:\n- Add CA certificate bundle support\n- Implement certificate validation\n- Support custom CA paths\n- Add certificate pinning option\n\n**Configuration**:\n```erlang\n{macula, [\n    {tls, #{\n        verify => verify_peer,\n        cacertfile => \"/etc/macula/ca-bundle.pem\",\n        certfile => \"/etc/macula/node-cert.pem\",\n        keyfile => \"/etc/macula/node-key.pem\",\n        %% Optional: Pin specific certificates\n        pinned_certs => [\n            <<...>>  % SHA256 fingerprint\n        ]\n    }}\n]}.\n```\n\n**Modules to Update**:\n- `macula_connection.erl`\n- `macula_connection_pool.erl`\n- `macula_peer_connector.erl`\n- `macula_quic.erl`","title":"2. TLS Certificate Verification - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#2-tls-certificate-verification"},{"type":"extras","doc":"**Problem**: Fire-and-forget provides no feedback\n**Impact**: Observability (medium)\n**Effort**: 2-3 weeks\n\n**Implementation**:\n- Add correlation IDs to DHT messages\n- Implement response tracking with timeout\n- Return query results to caller\n- Add retry logic for failed queries\n\n**API**:\n```erlang\n%% Query with response\n{ok, Result} = macula_routing_server:query_with_response(\n    Pid, Key, Timeout\n).\n\n%% Store with confirmation\n{ok, StoredNodes} = macula_routing_server:store_with_confirmation(\n    Pid, Key, Value, Timeout\n).\n```\n\n**Benefits**:\n- Confirm DHT operations succeeded\n- Monitor propagation success rate\n- Better debugging and observability\n- Retry failed operations\n\n---","title":"3. Request/Response Pattern for DHT - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#3-request-response-pattern-for-dht"},{"type":"extras","doc":"","title":"Medium Priority Features - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#medium-priority-features"},{"type":"extras","doc":"**Problem**: Edge nodes behind NAT cannot accept connections\n**Impact**: Connectivity (medium)\n**Effort**: 6-8 weeks\n\n**Strategy**: Attempt direct connection while keeping relay fallback\n\n**Implementation Phases**:\n\n#### Phase A: NAT Discovery (2 weeks)\n- Create `macula_nat_discovery.erl`\n- Detect public IP/port via gateway\n- Detect NAT type (cone, symmetric, etc.)\n- Cache NAT type and public address\n\n#### Phase B: Hole Punching (3 weeks)\n- Create `macula_hole_punch.erl`\n- Coordinate simultaneous connection attempts\n- Exchange addresses via gateway\n- Timeout and fallback to relay\n\n#### Phase C: Connection Upgrade (2 weeks)\n- Create `macula_connection_upgrade.erl`\n- Migrate active streams from relay to direct\n- Handle graceful transition\n- Update routing tables\n\n#### Phase D: Testing (1 week)\n- Docker-based NAT simulation\n- Test various NAT types\n- Verify fallback behavior\n- Integration tests\n\n**Success Metrics**:\n- 80%+ direct P2P success (non-symmetric NAT)\n- 100% connectivity (with relay fallback)\n- <100ms upgrade time (relay  direct)\n- No message loss during upgrade\n\n**See**: `architecture/NAT_TRAVERSAL_ROADMAP.md` for detailed design","title":"4. NAT Traversal - Opportunistic Hole Punching - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#4-nat-traversal-opportunistic-hole-punching"},{"type":"extras","doc":"**Problem**: Various performance bottlenecks\n**Impact**: Performance (medium)\n**Effort**: 2-3 weeks\n\n**Optimizations**:\n\n#### 5.1. Adaptive Delay Tuning\n- Currently 100ms fixed delay before closing streams\n- Implement adaptive delay based on network conditions\n- Measure actual transmission time\n- Tune per-connection\n\n#### 5.2. Batch DHT Operations\n- Combine multiple STORE operations\n- Batch FIND_VALUE queries\n- Reduce connection overhead\n- Better throughput\n\n#### 5.3. DHT Cache Tuning\n- Optimize cache TTL values\n- Implement cache warming\n- Add cache statistics\n- Monitor hit rates\n\n#### 5.4. Message Batching\n- Batch multiple messages to same peer\n- Reduce per-message overhead\n- Improve throughput\n\n**Target Improvements**:\n- 2-3x throughput increase\n- 30-50% latency reduction\n- 50% reduction in connection overhead","title":"5. Performance Tuning - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#5-performance-tuning"},{"type":"extras","doc":"**Problem**: Limited visibility into mesh operations\n**Impact**: Operations (medium)\n**Effort**: 2 weeks\n\n**Implementation**:\n- Add telemetry events for DHT operations\n- Track connection pool statistics\n- Monitor P2P connection success rates\n- Add health check endpoints\n- Integration with Prometheus/Grafana\n\n**Metrics**:\n```erlang\n%% DHT metrics\ndht_store_operations_total\ndht_store_propagation_success_rate\ndht_query_latency_milliseconds\ndht_cache_hit_rate\n\n%% Connection metrics\np2p_connections_total\np2p_connection_duration_seconds\np2p_connection_pool_size\np2p_connection_errors_total\n\n%% RPC/PubSub metrics\nrpc_calls_total\nrpc_call_latency_milliseconds\npubsub_messages_total\npubsub_delivery_latency_milliseconds\n```\n\n---","title":"6. Observability & Metrics - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#6-observability-metrics"},{"type":"extras","doc":"","title":"Low Priority / Future Considerations - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#low-priority-future-considerations"},{"type":"extras","doc":"**Problem**: Gateway module mixes bootstrap and relay concerns\n**Impact**: Architecture (low)\n**Effort**: 4 weeks\n\n**Deferred Reason**: Current architecture works well. Refactoring is architectural cleanup, not critical for production.\n\n**When to Reconsider**:\n- If deploying dedicated bootstrap nodes\n- If relay logic becomes complex\n- If separation of concerns becomes important\n\n**See**: `architecture/V0.8.0_IMPLEMENTATION_ROADMAP.md` for original plan","title":"7. Subsystem Refactoring - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#7-subsystem-refactoring"},{"type":"extras","doc":"**Problem**: Symmetric NAT requires TURN relay\n**Impact**: Connectivity (low - already have relay fallback)\n**Effort**: 8-10 weeks + infrastructure costs\n\n**Deferred Reason**: v0.8.0 relay fallback works for 100% connectivity. STUN/TURN improves from 80% direct to 95% direct, but requires external infrastructure.\n\n**When to Reconsider**:\n- If 80% direct P2P isn't sufficient\n- If relay costs become prohibitive\n- If symmetric NAT is common in target deployment\n\n**See**: `architecture/NAT_TRAVERSAL_ROADMAP.md` Phase 3\n\n---","title":"8. STUN/TURN Infrastructure - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#8-stun-turn-infrastructure"},{"type":"extras","doc":"","title":"Version Roadmap - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#version-roadmap"},{"type":"extras","doc":"Quick quality-of-life improvements:\n- Remove remaining empty TODOs\n- Add more integration tests\n- Improve error messages\n- Documentation polish\n\n**Effort**: 1 week","title":"v0.8.1 (Optional - Q1 2025) - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#v0-8-1-optional-q1-2025"},{"type":"extras","doc":"Production hardening:\n-  Connection pooling (High Priority)\n-  TLS certificate verification (High Priority)\n-  Request/response DHT pattern (High Priority)\n-  NAT hole punching (Medium Priority)\n-  Performance tuning (Medium Priority)\n-  Observability & metrics (Medium Priority)\n\n**Effort**: 18-24 weeks (4-6 months)","title":"v0.9.0 (Target - Q2 2025) - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#v0-9-0-target-q2-2025"},{"type":"extras","doc":"Advanced features:\n- STUN/TURN infrastructure (if needed)\n- Subsystem refactoring (if needed)\n- Advanced routing strategies\n- Multi-datacenter support\n\n**Effort**: TBD\n\n---","title":"v0.10.0 (Future - Q3 2025) - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#v0-10-0-future-q3-2025"},{"type":"extras","doc":"","title":"Development Priorities - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#development-priorities"},{"type":"extras","doc":"1. TLS certificate verification\n2. Certificate pinning\n3. Security audit","title":"Phase 1: Security (Weeks 1-3) - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#phase-1-security-weeks-1-3"},{"type":"extras","doc":"1. Connection pooling\n2. Adaptive delay tuning\n3. Batch operations\n4. Performance benchmarking","title":"Phase 2: Performance (Weeks 4-9) - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#phase-2-performance-weeks-4-9"},{"type":"extras","doc":"1. Request/response DHT pattern\n2. Retry logic\n3. Error handling improvements","title":"Phase 3: Reliability (Weeks 10-12) - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#phase-3-reliability-weeks-10-12"},{"type":"extras","doc":"1. NAT discovery\n2. Hole punching\n3. Connection upgrade\n4. NAT traversal testing","title":"Phase 4: Connectivity (Weeks 13-20) - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#phase-4-connectivity-weeks-13-20"},{"type":"extras","doc":"1. Telemetry integration\n2. Metrics endpoints\n3. Dashboards\n4. Monitoring","title":"Phase 5: Observability (Weeks 21-22) - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#phase-5-observability-weeks-21-22"},{"type":"extras","doc":"1. Documentation\n2. Tutorial updates\n3. Integration testing\n4. Release preparation\n\n---","title":"Phase 6: Polish (Weeks 23-24) - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#phase-6-polish-weeks-23-24"},{"type":"extras","doc":"","title":"Success Criteria (v0.9.0) - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#success-criteria-v0-9-0"},{"type":"extras","doc":"-  10x improvement in repeated P2P operations (via connection pooling)\n-  <50ms P2P message delivery (cached routes)\n-  2-3x throughput increase (batching + tuning)","title":"Performance - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#performance"},{"type":"extras","doc":"-  TLS certificate verification enabled by default\n-  Certificate pinning option available\n-  Security audit passed","title":"Security - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#security"},{"type":"extras","doc":"-  100% test coverage maintained\n-  DHT operation confirmation available\n-  Retry logic for failed operations","title":"Reliability - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#reliability"},{"type":"extras","doc":"-  80%+ direct P2P connections (NAT hole punching)\n-  100% connectivity maintained (relay fallback)\n-  Graceful connection upgrade","title":"Connectivity - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#connectivity"},{"type":"extras","doc":"-  Comprehensive metrics available\n-  Integration with Prometheus\n-  Sample Grafana dashboards\n\n---","title":"Observability - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#observability"},{"type":"extras","doc":"","title":"Breaking Changes (v0.9.0) - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#breaking-changes-v0-9-0"},{"type":"extras","doc":"**Possible**:\n- TLS verification enabled by default (may require configuration)\n- Connection pool configuration (optional)\n- Metrics endpoint (new feature)\n\n**Mitigation**:\n- Feature flags for gradual rollout\n- Backward compatibility mode\n- Clear migration guide\n\n---","title":"Minimal Breaking Changes Expected - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#minimal-breaking-changes-expected"},{"type":"extras","doc":"We welcome feedback on this roadmap!\n\n**High Priority Questions**:\n- Is NAT traversal critical for your use case?\n- What performance metrics matter most?\n- What observability features do you need?\n\n**How to Provide Feedback**:\n- GitHub Issues: https://github.com/macula-io/macula/issues\n- GitHub Discussions: https://github.com/macula-io/macula/discussions\n\n---","title":"Community Feedback - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#community-feedback"},{"type":"extras","doc":"- **NAT Traversal Design**: `architecture/NAT_TRAVERSAL_ROADMAP.md`\n- **Original v0.8.0 Roadmap**: `architecture/V0.8.0_IMPLEMENTATION_ROADMAP.md`\n- **Current Architecture**: `architecture/v0.8.0-ARCHITECTURE.md`\n- **Known Issues**: `TODO.md`\n\n---\n\n**Document Version**: 1.0\n**Last Updated**: 2025-11-17\n**Next Review**: After v0.8.0 release","title":"References - v0.9.0 Roadmap","ref":"v0-8-0-roadmap.html#references"},{"type":"extras","doc":"# Macula v1.0.0 Roadmap - Production Ready Platform\n\n**Target Release**: Q4 2025\n**Theme**: Production-Ready Distributed Application Platform\n**Dependencies**: v0.9.0 (NAT Traversal)\n\n---","title":"v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html"},{"type":"extras","doc":"v1.0.0 marks Macula's transition from **development framework** to **production-ready platform**. This release focuses on the operational capabilities needed to run Macula in production: mesh-wide hot upgrades, comprehensive monitoring, enterprise security, and horizontal scaling.\n\n---","title":"Vision - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#vision"},{"type":"extras","doc":"Before v1.0.0 development:\n\n| Dependency | Status | Target |\n|------------|--------|--------|\n| v0.8.5 - Architectural Foundations | Done | Nov 2025 |\n| v0.9.0 - NAT Traversal | Planned | Q2 2025 |\n\n---","title":"Release Prerequisites - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#release-prerequisites"},{"type":"extras","doc":"","title":"Core Features - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#core-features"},{"type":"extras","doc":"**Priority**: Critical\n**Effort**: 5 weeks\n**Design**: [MESH_HOT_UPGRADE.md](MESH_HOT_UPGRADE.md)\n\nCoordinated rolling upgrades across the entire mesh using OTP release mechanisms:\n\n```erlang\n%% Upgrade workload across all nodes\nmacula:upgrade(snake_game, \"1.1.0\", #{\n    strategy => rolling,\n    batch_size => 3,\n    health_check => true,\n    rollback_on_fail => true\n}).\n```\n\n**Components**:\n- `macula_upgrade` - Mesh-wide coordinator\n- `macula_upgrade_agent` - Per-node execution\n- `macula_upgrade_planner` - Upgrade strategies\n- `macula_upgrade_health` - Health check framework\n\n**Capabilities**:\n- Rolling, canary, and all-at-once strategies\n- Automatic rollback on failure\n- Health verification between batches\n- Release distribution via URL or mesh storage\n- Upgrade history and audit trail\n\n**Why Critical**: Enables BEAM-native deployment without external orchestration. True platform capability.\n\n---","title":"1. Mesh-Wide Hot Code Upgrade (Flagship Feature) - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#1-mesh-wide-hot-code-upgrade-flagship-feature"},{"type":"extras","doc":"**Priority**: High\n**Effort**: 3 weeks\n\nProduction systems need visibility into mesh health and performance.\n\n**Metrics Export**:\n```erlang\n%% Prometheus/OpenTelemetry metrics\nmacula_connections_total{node=\"...\", status=\"active\"}\nmacula_messages_total{type=\"pubsub\", topic=\"...\"}\nmacula_rpc_duration_seconds{service=\"...\", quantile=\"0.99\"}\nmacula_dht_routing_hops{bucket=\"...\"}\n```\n\n**Distributed Tracing**:\n```erlang\n%% Trace ID propagated through mesh\nmacula:call(Service, Request, #{\n    trace_id => <<\"abc123\">>,\n    span_id => <<\"def456\">>\n}).\n```\n\n**Health Dashboard**:\n- Mesh topology visualization\n- Node health status\n- Connection graph\n- Message flow rates\n- DHT routing efficiency\n\n**Components**:\n- `macula_metrics` - Metrics collection and export\n- `macula_tracing` - Distributed trace propagation\n- `macula_dashboard` - Web-based monitoring UI\n\n---","title":"2. Comprehensive Monitoring & Observability - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#2-comprehensive-monitoring-observability"},{"type":"extras","doc":"**Priority**: High\n**Effort**: 4 weeks\n\nProduction deployments require robust security controls.\n\n**Authentication**:\n```erlang\n%% Mutual TLS authentication\n{macula, [\n    {auth_mode, mtls},\n    {ca_cert, \"/path/to/ca.pem\"},\n    {verify_peer, true}\n]}.\n```\n\n**Authorization**:\n```erlang\n%% Role-based access control\nmacula:authorize(#{\n    principal => <<\"service:order-processor\">>,\n    action => publish,\n    resource => <<\"orders.*\">>\n}).\n```\n\n**Encryption**:\n- End-to-end payload encryption (beyond TLS)\n- Key rotation support\n- Secrets management integration\n\n**Audit**:\n- All operations logged with principal\n- Tamper-evident audit trail\n- Compliance reporting\n\n**Components**:\n- `macula_auth` - Authentication framework\n- `macula_authz` - Authorization policies\n- `macula_audit` - Audit logging\n- `macula_crypto` - Cryptographic operations\n\n---","title":"3. Enterprise Security - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#3-enterprise-security"},{"type":"extras","doc":"**Priority**: Medium\n**Effort**: 3 weeks\n\nSupport for large-scale mesh deployments.\n\n**Auto-Scaling Hooks**:\n```erlang\n%% Notify external systems of scaling needs\nmacula:set_scaling_callback(fun(Event) ->\n    case Event of\n        {high_load, Metrics} ->\n            request_scale_up(Metrics);\n        {low_load, Metrics} ->\n            request_scale_down(Metrics)\n    end\nend).\n```\n\n**Connection Sharding**:\n- Distribute connections across multiple gateway workers\n- Consistent hashing for topic/service affinity\n- Graceful rebalancing on node join/leave\n\n**DHT Optimization**:\n- Parallel lookups with alpha tuning\n- Caching of frequently accessed routes\n- Bloom filters for negative lookups\n\n**Load Balancing**:\n- Weighted RPC routing\n- Circuit breaker pattern\n- Retry with exponential backoff\n\n---","title":"4. Horizontal Scaling - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#4-horizontal-scaling"},{"type":"extras","doc":"**Priority**: Medium\n**Effort**: 4 weeks\n\nDurable storage for mesh state and messages.\n\n**Message Persistence**:\n```erlang\n%% Persist messages for replay\nmacula:publish(Topic, Payload, #{\n    persist => true,\n    ttl => 86400  % 24 hours\n}).\n\n%% Replay from offset\nmacula:subscribe(Topic, Handler, #{\n    from => {offset, 12345}\n}).\n```\n\n**State Snapshots**:\n- DHT routing table snapshots\n- Service registry persistence\n- Fast recovery on restart\n\n**Storage Backends**:\n- Local disk (default)\n- Distributed storage (future)\n- Pluggable adapters\n\n**Components**:\n- `macula_persistence` - Storage abstraction\n- `macula_message_store` - Message persistence\n- `macula_snapshot` - State snapshots\n\n---","title":"5. Persistence Layer - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#5-persistence-layer"},{"type":"extras","doc":"","title":"Secondary Features - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#secondary-features"},{"type":"extras","doc":"**Priority**: Low\n**Effort**: 2 weeks\n\nConnect multiple realms for cross-organization communication.\n\n```erlang\n%% Federate with partner realm\nmacula:federate(<<\"partner.realm\">>, #{\n    gateway => <<\"https://partner.example.com:4433\">>,\n    auth => #{type => oauth2, ...}\n}).\n\n%% Publish to federated realm\nmacula:publish(<<\"partner.realm/events.shared\">>, Payload).\n```\n\n---","title":"6. Multi-Realm Federation - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#6-multi-realm-federation"},{"type":"extras","doc":"**Priority**: Low\n**Effort**: 3 weeks\n\nOptimizations for resource-constrained devices.\n\n**Features**:\n- Lightweight client mode (minimal memory)\n- Message batching and compression\n- Offline operation with sync\n- Power-aware connectivity\n\n---","title":"7. Edge Computing Support - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#7-edge-computing-support"},{"type":"extras","doc":"**Priority**: Medium\n**Effort**: 2 weeks\n\nTools to improve developer productivity.\n\n**CLI Tool**:\n```bash\n# Cluster management\nmacula cluster status\nmacula cluster nodes\nmacula cluster upgrade snake_game 1.1.0\n\n# Debugging\nmacula trace subscribe \"orders.*\"\nmacula rpc call pricing.calculate '{\"items\": [...]}'\n\n# Monitoring\nmacula metrics\nmacula health\n```\n\n**Interactive Shell**:\n```erlang\n%% Enhanced REPL with mesh awareness\n1> macula:help().\n2> macula:nodes().\n3> macula:services().\n```\n\n**Documentation**:\n- API reference with examples\n- Architecture deep-dives\n- Deployment guides\n- Troubleshooting runbooks\n\n---","title":"8. Developer Experience - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#8-developer-experience"},{"type":"extras","doc":"","title":"Implementation Timeline - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#implementation-timeline"},{"type":"extras","doc":"| Week | Feature | Deliverable |\n|------|---------|-------------|\n| 1-2 | Hot Upgrade Core | `macula_upgrade`, `macula_upgrade_agent` |\n| 3 | Upgrade Strategies | `macula_upgrade_planner`, health checks |\n| 4 | Upgrade Resilience | Rollback, partial failure handling |\n| 5 | Monitoring Core | `macula_metrics`, Prometheus export |\n| 6 | Distributed Tracing | `macula_tracing`, trace propagation |\n| 7-8 | Security Auth | `macula_auth`, mTLS, RBAC |","title":"Phase 1: Core Operations (Weeks 1-8) - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#phase-1-core-operations-weeks-1-8"},{"type":"extras","doc":"| Week | Feature | Deliverable |\n|------|---------|-------------|\n| 9-10 | Security Authz | `macula_authz`, policies, audit |\n| 11-12 | Horizontal Scaling | Sharding, load balancing |\n| 13-14 | Persistence | Message store, snapshots |","title":"Phase 2: Scaling & Persistence (Weeks 9-14) - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#phase-2-scaling-persistence-weeks-9-14"},{"type":"extras","doc":"| Week | Feature | Deliverable |\n|------|---------|-------------|\n| 15 | CLI & DevEx | Command-line tools |\n| 16 | Documentation | Complete docs and guides |\n| 17 | Testing | Integration, chaos, performance |\n| 18 | Release | v1.0.0 release |\n\n**Total Timeline**: 18 weeks (~4.5 months)\n\n---","title":"Phase 3: Polish & Release (Weeks 15-18) - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#phase-3-polish-release-weeks-15-18"},{"type":"extras","doc":"","title":"Success Criteria - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#success-criteria"},{"type":"extras","doc":"- [ ] Mesh-wide rolling upgrades with <1% failure rate\n- [ ] Zero-downtime upgrades for workloads\n- [ ] Automatic rollback on upgrade failure\n- [ ] Complete metrics export (Prometheus, OpenTelemetry)\n- [ ] Distributed tracing across mesh\n- [ ] mTLS authentication\n- [ ] Role-based authorization\n- [ ] Audit trail for all operations\n- [ ] Message persistence with replay\n- [ ] Fast recovery from snapshots","title":"Functional Requirements - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#functional-requirements"},{"type":"extras","doc":"- [ ] 10,000+ concurrent connections per node\n- [ ] <10ms p99 for local pub/sub\n- [ ] <50ms p99 for RPC (mesh routing)\n- [ ] <1 minute mesh convergence (1000 nodes)\n- [ ] <100MB memory for 1000 connections","title":"Performance Requirements - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#performance-requirements"},{"type":"extras","doc":"- [ ] 99.9% mesh availability\n- [ ] Graceful degradation under load\n- [ ] Automatic failover\n- [ ] No message loss (persisted messages)\n- [ ] Idempotent operations\n\n---","title":"Reliability Requirements - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#reliability-requirements"},{"type":"extras","doc":"| Risk | Impact | Probability | Mitigation |\n|------|--------|-------------|------------|\n| Hot upgrade complexity | High | Medium | Extensive testing, phased rollout |\n| Security vulnerabilities | High | Low | Security audit, penetration testing |\n| Performance regression | Medium | Medium | Continuous benchmarking |\n| Backward compatibility | Medium | Low | Semantic versioning, deprecation warnings |\n| Documentation gaps | Low | Medium | Dedicated doc sprint |\n\n---","title":"Risk Assessment - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#risk-assessment"},{"type":"extras","doc":"","title":"Dependencies - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#dependencies"},{"type":"extras","doc":"- **OTP 27+**: Required for modern release_handler features\n- **OpenSSL 3.0+**: Required for TLS 1.3 and modern crypto\n- **Prometheus client**: Metrics export\n- **OpenTelemetry**: Distributed tracing","title":"External Dependencies - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#external-dependencies"},{"type":"extras","doc":"- **v0.9.0 complete**: NAT traversal for reliable connectivity\n- **Test infrastructure**: Multi-node test clusters\n- **CI/CD pipeline**: Automated testing and release\n\n---","title":"Internal Dependencies - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#internal-dependencies"},{"type":"extras","doc":"","title":"Resource Requirements - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#resource-requirements"},{"type":"extras","doc":"- 2 core developers (full-time)\n- 1 security specialist (part-time, weeks 7-10)\n- 1 technical writer (part-time, weeks 15-16)","title":"Team - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#team"},{"type":"extras","doc":"- 10-node test cluster for integration tests\n- Performance testing environment\n- Security scanning tools\n\n---","title":"Infrastructure - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#infrastructure"},{"type":"extras","doc":"","title":"Post-Release Plans - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#post-release-plans"},{"type":"extras","doc":"- Mesh-based release storage\n- Differential updates (delta releases)\n- Scheduled upgrades\n- Multi-app atomic upgrades\n- Geographic routing optimization","title":"v1.1.0 - Platform Enhancements - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#v1-1-0-platform-enhancements"},{"type":"extras","doc":"- Multi-tenancy enhancements\n- Advanced RBAC policies\n- Compliance certifications (SOC2, ISO27001)\n- SLA monitoring and alerting\n- Capacity planning tools\n\n---","title":"v1.2.0 - Enterprise Features - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#v1-2-0-enterprise-features"},{"type":"extras","doc":"- [MESH_HOT_UPGRADE.md](MESH_HOT_UPGRADE.md) - Hot upgrade design\n- [PLATFORM_VISION.md](PLATFORM_VISION.md) - Platform architecture\n- [FULL_SUPERVISION_TREE.md](FULL_SUPERVISION_TREE.md) - Process hierarchy\n- [v0.8.0-ROADMAP.md](v0.8.0-ROADMAP.md) - v0.9.0 planning\n- [NAT_TRAVERSAL_ROADMAP.md](NAT_TRAVERSAL_ROADMAP.md) - v0.9.0 details\n\n---","title":"Related Documents - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#related-documents"},{"type":"extras","doc":"v1.0.0 transforms Macula from a development framework into a **production-ready distributed application platform** with:\n\n| Capability | Description | Priority |\n|------------|-------------|----------|\n| **Hot Upgrade** | Mesh-wide rolling upgrades | Critical |\n| **Monitoring** | Metrics, tracing, dashboards | High |\n| **Security** | mTLS, RBAC, audit | High |\n| **Scaling** | Connection sharding, load balancing | Medium |\n| **Persistence** | Message store, snapshots | Medium |\n\n**Key Milestone**: Mesh-wide hot code upgrade enables BEAM-native deployment without external orchestration - a true platform capability that sets Macula apart.\n\n**Timeline**: 18 weeks (Q4 2025)\n**Status**: Design Phase","title":"Summary - v1.0.0 Roadmap","ref":"v1-0-0-roadmap.html#summary"},{"type":"extras","doc":"# Mesh-Wide Hot Code Upgrade\n\n**Target Release:** v1.0.0\n**Status:** Design Phase\n**Priority:** High (Core Platform Feature)\n\n---","title":"Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html"},{"type":"extras","doc":"Macula's clear separation between platform and workloads enables a powerful capability: **coordinated mesh-wide hot code upgrades** without service interruption. This document describes the design for upgrading workload applications across all nodes in the mesh using standard OTP release mechanisms coordinated through Macula's RPC layer.\n\n---","title":"Overview - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#overview"},{"type":"extras","doc":"","title":"Problem Statement - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#problem-statement"},{"type":"extras","doc":"Individual nodes can perform hot code upgrades using standard OTP mechanisms:\n- `code:load_file/1` for simple module reloads\n- `release_handler` for full release upgrades\n- `appup` and `relup` files for state migration\n\n**Limitation**: Each node must be upgraded manually or via external orchestration (Ansible, Kubernetes rolling updates, etc.).","title":"Current State - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#current-state"},{"type":"extras","doc":"Mesh-wide coordinated upgrades from any node:\n\n```erlang\n%% Upgrade snake_game to v1.1.0 across entire mesh\nmacula:upgrade(snake_game, \"1.1.0\", #{\n    strategy => rolling,\n    batch_size => 3,\n    health_check => true\n}).\n```\n\n**Benefits**:\n- Zero external orchestration required\n- BEAM-native upgrade path (OTP release_handler)\n- Rolling upgrades with automatic rollback\n- Health verification between batches\n- Audit trail of upgrades across mesh\n\n---","title":"Desired State - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#desired-state"},{"type":"extras","doc":"","title":"Architecture - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#architecture"},{"type":"extras","doc":"```\n\n  macula_upgrade (Coordinator)                           \n  - Discovers nodes with target app                      \n  - Plans upgrade batches                                \n  - Coordinates execution                                \n  - Monitors health                                      \n  - Handles rollback                                     \n\n                          Macula RPC\n                         \n\n  macula_upgrade_agent (Per-Node)                        \n  - Receives upgrade commands                            \n  - Executes release_handler operations                  \n  - Reports status back to coordinator                   \n  - Performs local health checks                         \n\n```","title":"Component Overview - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#component-overview"},{"type":"extras","doc":"| Module | Purpose | LOC (est) |\n|--------|---------|-----------|\n| `macula_upgrade` | Mesh-wide coordination | ~400 |\n| `macula_upgrade_agent` | Per-node execution | ~250 |\n| `macula_upgrade_planner` | Batch planning strategies | ~200 |\n| `macula_upgrade_health` | Health check framework | ~150 |\n\n**Total estimated**: ~1,000 LOC\n\n---","title":"New Modules - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#new-modules"},{"type":"extras","doc":"","title":"API Design - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#api-design"},{"type":"extras","doc":"```erlang\n-module(macula).\n\n%% Mesh-wide upgrade\n-spec upgrade(App, Version, Opts) -> {ok, UpgradeResult} | {error, Reason}\n    when App :: atom(),\n         Version :: string(),\n         Opts :: upgrade_opts(),\n         UpgradeResult :: #{\n             total := non_neg_integer(),\n             upgraded := non_neg_integer(),\n             failed := non_neg_integer(),\n             details := [node_result()]\n         }.\n\n%% Check upgrade status\n-spec upgrade_status(UpgradeId) -> {ok, Status} | {error, not_found}.\n\n%% Cancel in-progress upgrade\n-spec upgrade_cancel(UpgradeId) -> ok | {error, Reason}.\n\n%% List available versions for an app\n-spec upgrade_versions(App) -> {ok, [Version]} | {error, Reason}.\n```","title":"Primary API - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#primary-api"},{"type":"extras","doc":"```erlang\n-type upgrade_opts() :: #{\n    %% Upgrade strategy\n    strategy => rolling | all_at_once | canary,\n\n    %% Nodes per batch (for rolling)\n    batch_size => pos_integer(),\n\n    %% Delay between batches (ms)\n    batch_delay => non_neg_integer(),\n\n    %% Health check configuration\n    health_check => boolean() | health_opts(),\n\n    %% Automatic rollback on failure\n    rollback_on_fail => boolean(),\n\n    %% Target specific nodes (default: all nodes with app)\n    nodes => [node_id()] | all,\n\n    %% Timeout per node (ms)\n    node_timeout => pos_integer(),\n\n    %% Release tarball location\n    release_url => binary()  % URL to fetch release from\n}.\n\n-type health_opts() :: #{\n    %% Health check endpoint\n    endpoint => binary(),  % e.g., <<\"system.health\">>\n\n    %% Required health status\n    required_status => ok | degraded,\n\n    %% Retries before declaring failure\n    retries => pos_integer(),\n\n    %% Delay between retries (ms)\n    retry_delay => non_neg_integer()\n}.\n```","title":"Options - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#options"},{"type":"extras","doc":"```erlang\n%% Simple rolling upgrade\nmacula:upgrade(snake_game, \"1.1.0\", #{\n    strategy => rolling,\n    batch_size => 2\n}).\n\n%% Careful production upgrade\nmacula:upgrade(payment_service, \"2.0.0\", #{\n    strategy => canary,\n    batch_size => 1,\n    batch_delay => 30000,  % 30 second delay\n    health_check => #{\n        endpoint => <<\"payment.health\">>,\n        required_status => ok,\n        retries => 3,\n        retry_delay => 5000\n    },\n    rollback_on_fail => true\n}).\n\n%% Upgrade specific nodes only\nmacula:upgrade(analytics, \"1.5.0\", #{\n    nodes => [<<\"node-eu-1\">>, <<\"node-eu-2\">>],\n    strategy => all_at_once\n}).\n```\n\n---","title":"Example Usage - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#example-usage"},{"type":"extras","doc":"","title":"Upgrade Strategies - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#upgrade-strategies"},{"type":"extras","doc":"Upgrades nodes in batches, waiting for health confirmation between batches.\n\n```\nBatch 1: [node1, node2]  upgrade  health check  OK\nBatch 2: [node3, node4]  upgrade  health check  OK\nBatch 3: [node5, node6]  upgrade  health check  OK\nComplete: 6/6 nodes upgraded\n```\n\n**Use case**: Production systems requiring zero downtime","title":"1. Rolling Upgrade (Default) - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#1-rolling-upgrade-default"},{"type":"extras","doc":"Upgrades a small subset first, waits for extended monitoring, then proceeds.\n\n```\nCanary: [node1]  upgrade  monitor 5 minutes  OK\nBatch 1: [node2, node3, node4]  upgrade  health check  OK\nBatch 2: [node5, node6]  upgrade  health check  OK\nComplete: 6/6 nodes upgraded\n```\n\n**Use case**: High-risk upgrades requiring validation","title":"2. Canary Upgrade - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#2-canary-upgrade"},{"type":"extras","doc":"Upgrades all nodes simultaneously.\n\n```\nAll: [node1, node2, node3, node4, node5, node6]  upgrade\nComplete: 6/6 nodes upgraded\n```\n\n**Use case**: Development/staging or when rolling isn't feasible\n\n---","title":"3. All-at-Once - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#3-all-at-once"},{"type":"extras","doc":"","title":"Implementation Details - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#implementation-details"},{"type":"extras","doc":"```erlang\n-module(macula_upgrade).\n-behaviour(gen_statem).\n\n-export([\n    upgrade/3,\n    status/1,\n    cancel/1\n]).\n\n%% State machine states\n-type state() :: idle | discovering | planning | upgrading | verifying | complete | failed.\n\n%% Upgrade record\n-record(upgrade, {\n    id :: binary(),\n    app :: atom(),\n    version :: string(),\n    opts :: map(),\n    nodes :: [node_id()],\n    batches :: [[node_id()]],\n    current_batch :: non_neg_integer(),\n    results :: #{node_id() => result()},\n    started_at :: integer(),\n    completed_at :: integer() | undefined\n}).\n\n%%====================================================================\n%% API\n%%====================================================================\n\nupgrade(App, Version, Opts) ->\n    UpgradeId = generate_id(),\n    case gen_statem:call(?MODULE, {start_upgrade, UpgradeId, App, Version, Opts}) of\n        {ok, started} ->\n            %% Wait for completion or return immediately based on opts\n            case maps:get(async, Opts, false) of\n                true -> {ok, #{upgrade_id => UpgradeId}};\n                false -> wait_for_completion(UpgradeId)\n            end;\n        {error, Reason} ->\n            {error, Reason}\n    end.\n\n%%====================================================================\n%% State Machine\n%%====================================================================\n\ninit([]) ->\n    %% Register upgrade agent on this node\n    macula:advertise(<<\"system.upgrade\">>, fun handle_upgrade_request/1),\n    {ok, idle, #{}}.\n\n%% State: idle -> discovering\nhandle_event({call, From}, {start_upgrade, Id, App, Version, Opts}, idle, Data) ->\n    Upgrade = #upgrade{\n        id = Id,\n        app = App,\n        version = Version,\n        opts = Opts,\n        started_at = erlang:system_time(millisecond)\n    },\n    {next_state, discovering, Data#{Id => Upgrade},\n     [{reply, From, {ok, started}}, {next_event, internal, discover}]};\n\n%% State: discovering\nhandle_event(internal, discover, discovering, #{current := Upgrade} = Data) ->\n    App = Upgrade#upgrade.app,\n    Opts = Upgrade#upgrade.opts,\n\n    %% Find all nodes running this app\n    Nodes = case maps:get(nodes, Opts, all) of\n        all -> discover_nodes_with_app(App);\n        Specific -> Specific\n    end,\n\n    case Nodes of\n        [] ->\n            {next_state, failed, Data,\n             [{next_event, internal, {error, no_nodes_found}}]};\n        _ ->\n            Upgrade1 = Upgrade#upgrade{nodes = Nodes},\n            {next_state, planning, Data#{current := Upgrade1},\n             [{next_event, internal, plan}]}\n    end;\n\n%% State: planning\nhandle_event(internal, plan, planning, #{current := Upgrade} = Data) ->\n    Opts = Upgrade#upgrade.opts,\n    Nodes = Upgrade#upgrade.nodes,\n\n    %% Create batches based on strategy\n    Batches = macula_upgrade_planner:create_batches(\n        Nodes,\n        maps:get(strategy, Opts, rolling),\n        maps:get(batch_size, Opts, 3)\n    ),\n\n    Upgrade1 = Upgrade#upgrade{batches = Batches, current_batch = 1},\n    {next_state, upgrading, Data#{current := Upgrade1},\n     [{next_event, internal, upgrade_batch}]};\n\n%% State: upgrading\nhandle_event(internal, upgrade_batch, upgrading, #{current := Upgrade} = Data) ->\n    BatchNum = Upgrade#upgrade.current_batch,\n    Batches = Upgrade#upgrade.batches,\n\n    case BatchNum > length(Batches) of\n        true ->\n            %% All batches complete\n            {next_state, complete, Data,\n             [{next_event, internal, finalize}]};\n        false ->\n            Batch = lists:nth(BatchNum, Batches),\n            %% Upgrade nodes in this batch\n            Results = upgrade_batch_nodes(Batch, Upgrade),\n\n            case check_batch_results(Results, Upgrade#upgrade.opts) of\n                ok ->\n                    Upgrade1 = update_results(Upgrade, Results),\n                    Upgrade2 = Upgrade1#upgrade{current_batch = BatchNum + 1},\n\n                    %% Optional delay between batches\n                    Delay = maps:get(batch_delay, Upgrade#upgrade.opts, 0),\n                    {next_state, verifying, Data#{current := Upgrade2},\n                     [{state_timeout, Delay, next_batch}]};\n                {error, FailedNodes} ->\n                    handle_batch_failure(FailedNodes, Upgrade, Data)\n            end\n    end;\n\n%% State: verifying (health checks between batches)\nhandle_event(state_timeout, next_batch, verifying, #{current := Upgrade} = Data) ->\n    case maps:get(health_check, Upgrade#upgrade.opts, false) of\n        false ->\n            {next_state, upgrading, Data,\n             [{next_event, internal, upgrade_batch}]};\n        HealthOpts ->\n            case perform_health_checks(Upgrade, HealthOpts) of\n                ok ->\n                    {next_state, upgrading, Data,\n                     [{next_event, internal, upgrade_batch}]};\n                {error, UnhealthyNodes} ->\n                    handle_health_failure(UnhealthyNodes, Upgrade, Data)\n            end\n    end.\n\n%%====================================================================\n%% Internal Functions\n%%====================================================================\n\ndiscover_nodes_with_app(App) ->\n    %% Query DHT for nodes advertising this app\n    case macula:discover(<<(atom_to_binary(App))/binary, \".*\">>) of\n        {ok, Services} ->\n            %% Extract unique node IDs from service advertisements\n            lists:usort([NodeId || #{node_id := NodeId} <- Services]);\n        {error, _} ->\n            []\n    end.\n\nupgrade_batch_nodes(Nodes, Upgrade) ->\n    App = Upgrade#upgrade.app,\n    Version = Upgrade#upgrade.version,\n    Opts = Upgrade#upgrade.opts,\n    Timeout = maps:get(node_timeout, Opts, 60000),\n\n    %% Parallel upgrade of all nodes in batch\n    Results = pmap(fun(NodeId) ->\n        Request = #{\n            app => App,\n            version => Version,\n            release_url => maps:get(release_url, Opts, undefined)\n        },\n        case macula:call(NodeId, <<\"system.upgrade\">>, Request, Timeout) of\n            {ok, Result} -> {NodeId, Result};\n            {error, Reason} -> {NodeId, {error, Reason}}\n        end\n    end, Nodes),\n\n    maps:from_list(Results).\n\nperform_health_checks(Upgrade, HealthOpts) when is_map(HealthOpts) ->\n    %% Check health of all upgraded nodes so far\n    UpgradedNodes = get_upgraded_nodes(Upgrade),\n    Endpoint = maps:get(endpoint, HealthOpts, <<\"system.health\">>),\n    Retries = maps:get(retries, HealthOpts, 3),\n    RetryDelay = maps:get(retry_delay, HealthOpts, 5000),\n    RequiredStatus = maps:get(required_status, HealthOpts, ok),\n\n    check_nodes_health(UpgradedNodes, Endpoint, RequiredStatus, Retries, RetryDelay);\n\nperform_health_checks(_Upgrade, true) ->\n    %% Default health check\n    perform_health_checks(_Upgrade, #{endpoint => <<\"system.health\">>}).\n\nhandle_batch_failure(FailedNodes, Upgrade, Data) ->\n    case maps:get(rollback_on_fail, Upgrade#upgrade.opts, true) of\n        true ->\n            %% Rollback all upgraded nodes\n            rollback_upgrade(Upgrade),\n            {next_state, failed, Data,\n             [{next_event, internal, {error, {batch_failed, FailedNodes}}}]};\n        false ->\n            %% Continue despite failures\n            Upgrade1 = Upgrade#upgrade{current_batch = Upgrade#upgrade.current_batch + 1},\n            {next_state, upgrading, Data#{current := Upgrade1},\n             [{next_event, internal, upgrade_batch}]}\n    end.\n\nrollback_upgrade(Upgrade) ->\n    %% Get all successfully upgraded nodes\n    UpgradedNodes = get_upgraded_nodes(Upgrade),\n    PreviousVersion = get_previous_version(Upgrade#upgrade.app),\n\n    %% Rollback each node\n    lists:foreach(fun(NodeId) ->\n        macula:call(NodeId, <<\"system.rollback\">>, #{\n            app => Upgrade#upgrade.app,\n            version => PreviousVersion\n        })\n    end, UpgradedNodes).\n```","title":"Coordinator Module - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#coordinator-module"},{"type":"extras","doc":"```erlang\n-module(macula_upgrade_agent).\n\n-export([\n    init/0,\n    handle_upgrade/1,\n    handle_rollback/1\n]).\n\n%%====================================================================\n%% Initialization\n%%====================================================================\n\ninit() ->\n    %% Register upgrade handlers\n    macula:advertise(<<\"system.upgrade\">>, fun handle_upgrade/1),\n    macula:advertise(<<\"system.rollback\">>, fun handle_rollback/1),\n    macula:advertise(<<\"system.versions\">>, fun handle_versions/1),\n    ok.\n\n%%====================================================================\n%% Handlers\n%%====================================================================\n\nhandle_upgrade(#{app := App, version := Version} = Request) ->\n    logger:info(\"Upgrading ~p to ~s\", [App, Version]),\n\n    %% Fetch release if URL provided\n    case maps:get(release_url, Request, undefined) of\n        undefined -> ok;\n        Url -> fetch_release(Url, Version)\n    end,\n\n    %% Perform OTP release upgrade\n    try\n        %% Unpack the release\n        case release_handler:unpack_release(Version) of\n            {ok, Vsn} ->\n                logger:info(\"Unpacked release ~s\", [Vsn]);\n            {error, {already_installed, Vsn}} ->\n                logger:info(\"Release ~s already installed\", [Vsn])\n        end,\n\n        %% Install the release\n        case release_handler:install_release(Version) of\n            {ok, OldVsn, _} ->\n                logger:info(\"Installed ~s (was ~s)\", [Version, OldVsn]),\n\n                %% Make permanent\n                ok = release_handler:make_permanent(Version),\n                logger:info(\"Made ~s permanent\", [Version]),\n\n                {ok, #{\n                    status => upgraded,\n                    from_version => OldVsn,\n                    to_version => Version,\n                    node_id => macula:node_id()\n                }};\n\n            {error, Reason} ->\n                logger:error(\"Install failed: ~p\", [Reason]),\n                {error, {install_failed, Reason}}\n        end\n    catch\n        Class:Error:Stack ->\n            logger:error(\"Upgrade exception: ~p:~p~n~p\", [Class, Error, Stack]),\n            {error, {exception, Error}}\n    end.\n\nhandle_rollback(#{app := App, version := Version}) ->\n    logger:warning(\"Rolling back ~p to ~s\", [App, Version]),\n\n    case release_handler:install_release(Version) of\n        {ok, _, _} ->\n            ok = release_handler:make_permanent(Version),\n            {ok, #{status => rolled_back, version => Version}};\n        {error, Reason} ->\n            {error, {rollback_failed, Reason}}\n    end.\n\nhandle_versions(#{app := App}) ->\n    %% List installed versions\n    Releases = release_handler:which_releases(),\n    Versions = [Vsn || {Name, Vsn, _, _} <- Releases,\n                       lists:member(App, get_release_apps(Name, Vsn))],\n    {ok, #{app => App, versions => Versions}}.\n\n%%====================================================================\n%% Internal Functions\n%%====================================================================\n\nfetch_release(Url, Version) ->\n    %% Download release tarball\n    ReleasesDir = code:root_dir() ++ \"/releases\",\n    TarFile = ReleasesDir ++ \"/\" ++ Version ++ \".tar.gz\",\n\n    case httpc:request(get, {binary_to_list(Url), []}, [], [{stream, TarFile}]) of\n        {ok, saved_to_file} ->\n            logger:info(\"Downloaded release to ~s\", [TarFile]),\n            ok;\n        {error, Reason} ->\n            logger:error(\"Failed to download release: ~p\", [Reason]),\n            {error, {download_failed, Reason}}\n    end.\n\nget_release_apps(RelName, Vsn) ->\n    %% Get list of apps in a release\n    case release_handler:get_release(RelName, Vsn) of\n        {ok, Release} ->\n            proplists:get_value(applications, Release, []);\n        _ ->\n            []\n    end.\n```\n\n---","title":"Agent Module (Per-Node) - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#agent-module-per-node"},{"type":"extras","doc":"","title":"Health Check Integration - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#health-check-integration"},{"type":"extras","doc":"Every Macula node provides a default health endpoint:\n\n```erlang\n%% Registered automatically by macula_upgrade_agent\nmacula:advertise(<<\"system.health\">>, fun() ->\n    #{\n        status => ok,\n        node_id => macula:node_id(),\n        uptime => get_uptime(),\n        memory => erlang:memory(),\n        processes => erlang:system_info(process_count),\n        apps => application:which_applications()\n    }\nend).\n```","title":"Default Health Service - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#default-health-service"},{"type":"extras","doc":"Applications can register custom health checks:\n\n```erlang\n%% In your workload app\ninit([]) ->\n    macula:advertise(<<\"snake_game.health\">>, fun check_game_health/0),\n    {ok, #state{}}.\n\ncheck_game_health() ->\n    case ets:info(game_state) of\n        undefined ->\n            #{status => error, reason => no_game_state};\n        _ ->\n            ActiveGames = ets:info(game_state, size),\n            #{\n                status => ok,\n                active_games => ActiveGames,\n                memory_mb => erlang:memory(total) / 1024 / 1024\n            }\n    end.\n```","title":"Custom Health Checks - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#custom-health-checks"},{"type":"extras","doc":"```erlang\n%% Upgrade with custom health check\nmacula:upgrade(snake_game, \"1.1.0\", #{\n    health_check => #{\n        endpoint => <<\"snake_game.health\">>,\n        required_status => ok,\n        retries => 5,\n        retry_delay => 2000\n    }\n}).\n```\n\n---","title":"Health Check During Upgrade - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#health-check-during-upgrade"},{"type":"extras","doc":"","title":"Release Distribution - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#release-distribution"},{"type":"extras","doc":"Releases already present on each node:\n\n```erlang\n%% Nodes have releases in /releases directory\nmacula:upgrade(snake_game, \"1.1.0\", #{}).\n```","title":"Option 1: Pre-deployed Releases - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#option-1-pre-deployed-releases"},{"type":"extras","doc":"Fetch releases from central repository:\n\n```erlang\nmacula:upgrade(snake_game, \"1.1.0\", #{\n    release_url => <<\"https://releases.example.com/snake_game-1.1.0.tar.gz\">>\n}).\n```","title":"Option 2: URL-based Distribution - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#option-2-url-based-distribution"},{"type":"extras","doc":"Distribute releases through the mesh itself:\n\n```erlang\n%% Upload release to mesh storage (future feature)\nmacula:store_release(snake_game, \"1.1.0\", TarballBinary),\n\n%% Upgrade fetches from mesh\nmacula:upgrade(snake_game, \"1.1.0\", #{\n    release_source => mesh\n}).\n```\n\n---","title":"Option 3: Mesh-based Distribution (Future) - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#option-3-mesh-based-distribution-future"},{"type":"extras","doc":"","title":"Monitoring and Observability - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#monitoring-and-observability"},{"type":"extras","doc":"Published during upgrade for monitoring:\n\n```erlang\n%% Subscribe to upgrade events\nmacula:subscribe(<<\"system.upgrade.*\">>, fun handle_upgrade_event/1).\n\n%% Events published:\n%% system.upgrade.started     - Upgrade initiated\n%% system.upgrade.batch       - Batch started/completed\n%% system.upgrade.node        - Node upgraded/failed\n%% system.upgrade.health      - Health check result\n%% system.upgrade.rollback    - Rollback initiated\n%% system.upgrade.completed   - Upgrade finished\n%% system.upgrade.failed      - Upgrade failed\n```","title":"Upgrade Events - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#upgrade-events"},{"type":"extras","doc":"Query upgrade history:\n\n```erlang\n%% Get recent upgrades\n{ok, History} = macula:upgrade_history(#{limit => 10}).\n\n%% Get specific upgrade details\n{ok, Details} = macula:upgrade_details(UpgradeId).\n```","title":"Upgrade History - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#upgrade-history"},{"type":"extras","doc":"Exported for Prometheus/OpenTelemetry:\n\n```\n# Upgrade duration histogram\nmacula_upgrade_duration_seconds{app=\"snake_game\",version=\"1.1.0\"}\n\n# Nodes upgraded counter\nmacula_upgrade_nodes_total{app=\"snake_game\",status=\"success\"}\nmacula_upgrade_nodes_total{app=\"snake_game\",status=\"failed\"}\n\n# Active upgrades gauge\nmacula_upgrade_active\n```\n\n---","title":"Metrics - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#metrics"},{"type":"extras","doc":"","title":"Error Handling - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#error-handling"},{"type":"extras","doc":"| Scenario | Detection | Response |\n|----------|-----------|----------|\n| Node unreachable | RPC timeout | Skip or rollback |\n| Release not found | release_handler error | Abort upgrade |\n| Health check fails | Custom check | Retry or rollback |\n| Partial batch failure | Mixed results | Continue or rollback |\n| Coordinator crash | gen_statem terminate | Agents continue running |","title":"Failure Scenarios - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#failure-scenarios"},{"type":"extras","doc":"```erlang\n%% Automatic rollback on failure\nmacula:upgrade(my_app, \"1.1.0\", #{\n    rollback_on_fail => true  % Default\n}).\n\n%% Manual rollback\nmacula:rollback(my_app, \"1.0.0\", #{\n    nodes => all  % or specific nodes\n}).\n```","title":"Rollback Mechanism - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#rollback-mechanism"},{"type":"extras","doc":"If coordinator crashes mid-upgrade:\n\n```erlang\n%% Query current state across mesh\n{ok, Status} = macula:upgrade_audit(my_app).\n%% Returns: #{\n%%   \"1.0.0\" => [node1, node2, node3],\n%%   \"1.1.0\" => [node4, node5]\n%% }\n\n%% Resume upgrade\nmacula:upgrade(my_app, \"1.1.0\", #{\n    nodes => [node1, node2, node3]  % Only remaining nodes\n}).\n```\n\n---","title":"Partial Upgrade Recovery - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#partial-upgrade-recovery"},{"type":"extras","doc":"","title":"Security Considerations - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#security-considerations"},{"type":"extras","doc":"```erlang\n%% Only authorized nodes can initiate upgrades\nmacula:upgrade(my_app, \"1.1.0\", #{\n    auth_token => <<\"secret_token\">>\n}).\n\n%% Agent verifies authorization\nhandle_upgrade(#{auth_token := Token} = Request) ->\n    case verify_upgrade_token(Token) of\n        ok -> do_upgrade(Request);\n        {error, unauthorized} -> {error, unauthorized}\n    end.\n```","title":"Authorization - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#authorization"},{"type":"extras","doc":"```erlang\n%% Verify release signature\nmacula:upgrade(my_app, \"1.1.0\", #{\n    release_url => Url,\n    signature_url => SigUrl,\n    public_key => PublicKey\n}).\n```","title":"Release Verification - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#release-verification"},{"type":"extras","doc":"All upgrade operations logged with:\n- Initiator node ID\n- Timestamp\n- Target app/version\n- Affected nodes\n- Result (success/failure)\n- Rollback actions\n\n---","title":"Audit Logging - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#audit-logging"},{"type":"extras","doc":"","title":"Testing Strategy - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#testing-strategy"},{"type":"extras","doc":"```erlang\n%% Test batch planning\nmacula_upgrade_planner_tests:\n  - rolling_creates_correct_batches/0\n  - canary_separates_first_node/0\n  - all_at_once_single_batch/0\n\n%% Test agent operations\nmacula_upgrade_agent_tests:\n  - successful_upgrade/0\n  - failed_upgrade_returns_error/0\n  - rollback_restores_version/0\n```","title":"Unit Tests - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#unit-tests"},{"type":"extras","doc":"```erlang\n%% Multi-node upgrade test\nupgrade_integration_test() ->\n    %% Start 5-node mesh\n    Nodes = start_test_mesh(5),\n\n    %% Deploy v1.0.0 to all\n    deploy_app(test_app, \"1.0.0\", Nodes),\n\n    %% Upgrade to v1.1.0\n    {ok, Result} = macula:upgrade(test_app, \"1.1.0\", #{\n        strategy => rolling,\n        batch_size => 2\n    }),\n\n    %% Verify all nodes upgraded\n    ?assertEqual(5, maps:get(upgraded, Result)),\n    ?assertEqual(0, maps:get(failed, Result)),\n\n    %% Verify correct version running\n    lists:foreach(fun(Node) ->\n        {ok, #{version := \"1.1.0\"}} = get_app_version(Node, test_app)\n    end, Nodes).\n```","title":"Integration Tests - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#integration-tests"},{"type":"extras","doc":"```erlang\n%% Test failure scenarios\nchaos_upgrade_test() ->\n    Nodes = start_test_mesh(6),\n\n    %% Kill node during upgrade\n    spawn(fun() ->\n        timer:sleep(500),\n        kill_node(lists:nth(3, Nodes))\n    end),\n\n    %% Upgrade should handle failure gracefully\n    Result = macula:upgrade(test_app, \"1.1.0\", #{\n        rollback_on_fail => true\n    }),\n\n    %% Should have rolled back\n    ?assertMatch({error, {batch_failed, _}}, Result).\n```\n\n---","title":"Chaos Testing - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#chaos-testing"},{"type":"extras","doc":"","title":"Implementation Timeline - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#implementation-timeline"},{"type":"extras","doc":"- [ ] `macula_upgrade` coordinator module\n- [ ] `macula_upgrade_agent` per-node module\n- [ ] Basic rolling upgrade strategy\n- [ ] Unit tests","title":"Phase 1: Core Framework (Week 1-2) - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#phase-1-core-framework-week-1-2"},{"type":"extras","doc":"- [ ] `macula_upgrade_planner` with all strategies\n- [ ] `macula_upgrade_health` framework\n- [ ] Custom health check integration\n- [ ] Integration tests","title":"Phase 2: Strategies & Health (Week 3) - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#phase-2-strategies-health-week-3"},{"type":"extras","doc":"- [ ] Rollback mechanism\n- [ ] Partial failure handling\n- [ ] Coordinator crash recovery\n- [ ] Chaos tests","title":"Phase 3: Resilience (Week 4) - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#phase-3-resilience-week-4"},{"type":"extras","doc":"- [ ] Metrics and observability\n- [ ] Security (auth, signatures)\n- [ ] Documentation\n- [ ] Performance optimization\n\n**Total estimated effort**: 5 weeks\n\n---","title":"Phase 4: Polish & Docs (Week 5) - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#phase-4-polish-docs-week-5"},{"type":"extras","doc":"- **Macula v0.9.0**: NAT traversal for reliable node connectivity\n- **OTP 27+**: Modern release_handler features\n- **Application appup files**: Required for stateful upgrades\n\n---","title":"Dependencies - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#dependencies"},{"type":"extras","doc":"","title":"Future Enhancements - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#future-enhancements"},{"type":"extras","doc":"- **Mesh-based release storage**: Store releases in DHT\n- **Differential updates**: Only transfer changed modules\n- **Scheduled upgrades**: Cron-like upgrade scheduling\n- **Upgrade policies**: Automatic upgrades based on rules\n- **Multi-app transactions**: Upgrade multiple apps atomically\n\n---","title":"v1.1.0+ - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#v1-1-0"},{"type":"extras","doc":"- [OTP Release Handling](https://www.erlang.org/doc/design_principles/release_handling.html)\n- [Appup Cookbook](https://www.erlang.org/doc/design_principles/appup_cookbook.html)\n- [Hot Code Loading](https://www.erlang.org/doc/reference_manual/code_loading.html)\n- [Relx Documentation](https://erlware.github.io/relx/)\n\n---","title":"References - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#references"},{"type":"extras","doc":"Mesh-wide hot code upgrade is a **flagship feature** for Macula v1.0.0 that leverages:\n\n1. **Platform/workload separation** - Upgrade workloads while platform maintains connections\n2. **Macula RPC** - Coordinate upgrades across mesh without external tools\n3. **OTP release_handler** - Standard BEAM upgrade mechanism\n4. **Health checks** - Verify upgrades before proceeding\n\n**Result**: True BEAM-native distributed deployment with zero-downtime rolling upgrades orchestrated through the mesh itself.","title":"Summary - Mesh Hot Upgrade Design","ref":"mesh_hot_upgrade.html#summary"},{"type":"extras","doc":"# Macula Architecture Documentation Index\n\n**Current Version**: v0.8.0\n**Last Updated**: 2025-11-17\n\n---","title":"Architecture Index","ref":"index.html"},{"type":"extras","doc":"- **Getting Started**: See `../README.md`\n- **API Reference**: See hex docs or `src/` module documentation\n- **Tutorial**: See `TUTORIAL.md` (coming soon)\n- **FAQ**: See `FAQ.md`\n- **Troubleshooting**: See `TROUBLESHOOTING.md`\n\n---","title":"Quick Links - Architecture Index","ref":"index.html#quick-links"},{"type":"extras","doc":"","title":"Version-Specific Documentation - Architecture Index","ref":"index.html#version-specific-documentation"},{"type":"extras","doc":"**Overview**: Direct P2P with DHT propagation\n\n Core Documents:\n- [`v0.8.0-OVERVIEW.md`](v0.8.0-OVERVIEW.md) - Release overview and key achievements\n- [`v0.8.0-CHANGELOG.md`](v0.8.0-CHANGELOG.md) - Detailed changes from v0.7.x\n- [`v0.8.0-ROADMAP.md`](v0.8.0-ROADMAP.md) - Future plans (v0.9.0 and beyond)\n- [`V0.8.0_COMPLETION_STATUS.md`](V0.8.0_COMPLETION_STATUS.md) - Final implementation status\n- [`V0.8.0_IMPLEMENTATION_ROADMAP.md`](V0.8.0_IMPLEMENTATION_ROADMAP.md) - Original roadmap\n\n Architecture:\n- Direct P2P QUIC connections via `macula_peer_connector`\n- DHT propagation to k=20 closest nodes\n- RPC and PubSub via direct connections\n- All node types run QUIC listeners\n\n Test Coverage:\n- 21/21 integration tests passing (100%)\n- 11 RPC tests + 10 PubSub tests\n\n Archived Development Docs:\n- [`archive/v0.8.0-development/`](archive/v0.8.0-development/) - Development session notes, progress tracking","title":"v0.8.0 (Current - Released 2025-11-17) - Architecture Index","ref":"index.html#v0-8-0-current-released-2025-11-17"},{"type":"extras","doc":"**Overview**: Gateway relay architecture with nomenclature refactoring\n\nKey changes:\n- Renamed `macula_connection`  `macula_peer` (facade)\n- Kept `macula_connection` as transport layer\n- Gateway refactoring into focused modules\n- Memory management improvements","title":"v0.7.x (Previous) - Architecture Index","ref":"index.html#v0-7-x-previous"},{"type":"extras","doc":"**Overview**: Initial DHT implementation and mesh foundation\n\nSee git history for details.\n\n---","title":"v0.6.x and Earlier - Architecture Index","ref":"index.html#v0-6-x-and-earlier"},{"type":"extras","doc":"","title":"Topic Guides - Architecture Index","ref":"index.html#topic-guides"},{"type":"extras","doc":"- **DHT (Distributed Hash Table)**: Kademlia-based routing\n  - See `ALGORITHMS-KADEMLIA.md` (coming soon)\n  - Key concepts: XOR distance, k-buckets, replication factor k=20\n\n- **Direct P2P Messaging**: Fire-and-forget QUIC connections\n  - See `TECHNIQUES-DIRECT-P2P.md` (coming soon)\n  - Module: `macula_peer_connector`\n\n- **Service Discovery**: DHT-based registration and lookup\n  - See `ALGORITHMS-SERVICE-DISCOVERY.md` (coming soon)\n  - Advertisement, TTL, propagation","title":"Core Concepts - Architecture Index","ref":"index.html#core-concepts"},{"type":"extras","doc":"#### RPC (Remote Procedure Call)\n- **Module**: `macula_pubsub_dht.erl` (RPC functions)\n- **Flow**: DHT lookup  Direct connection  Execute  Return result\n- **Test Suite**: `test/integration/multi_hop_rpc_SUITE.erl`\n- **Docs**: See module @doc comments\n\n#### PubSub (Publish/Subscribe)\n- **Module**: `macula_pubsub_dht.erl` (PubSub functions)\n- **Flow**: Subscribe  Advertise in DHT  Publish  DHT lookup  Direct delivery\n- **Test Suite**: `test/integration/multi_hop_pubsub_SUITE.erl`\n- **Docs**: See module @doc comments","title":"Communication Patterns - Architecture Index","ref":"index.html#communication-patterns"},{"type":"extras","doc":"#### NAT Traversal\n- **Status**: Planned for v0.9.0\n- **Approach**: Opportunistic hole punching\n- **Design**: [`NAT_TRAVERSAL_ROADMAP.md`](NAT_TRAVERSAL_ROADMAP.md)\n- **Current**: 100% connectivity via relay fallback\n\n#### Multi-Tenancy\n- **Mechanism**: Realm isolation\n- **Security**: Per-realm routing tables\n- **Docs**: See realm configuration in README\n\n#### Deployment Patterns\n- **Docker**: `docker/` directory - Bootstrap, Gateway, Edge nodes\n- **Multi-node**: `docker-compose.multi-mode.yml`\n- **Test Topology**: 1 bootstrap + 1 gateway + 3 edge nodes\n\n---","title":"Network & Infrastructure - Architecture Index","ref":"index.html#network-infrastructure"},{"type":"extras","doc":"","title":"Reference Documentation - Architecture Index","ref":"index.html#reference-documentation"},{"type":"extras","doc":"- **High-level API**: `src/macula_peer.erl`\n- **Transport**: `src/macula_connection.erl`\n- **P2P Connector**: `src/macula_peer_connector.erl`\n- **DHT**: `src/macula_routing_server.erl`\n- **Gateway**: `src/macula_gateway.erl`","title":"API Documentation - Architecture Index","ref":"index.html#api-documentation"},{"type":"extras","doc":"- **QUIC Transport**: Uses Microsoft MsQuic via `quicer`\n- **Message Encoding**: MessagePack via `msgpack`\n- **DHT Protocol**: Custom Kademlia implementation","title":"Protocol Specifications - Architecture Index","ref":"index.html#protocol-specifications"},{"type":"extras","doc":"- **Application**: `src/macula.app.src`\n- **Runtime**: `sys.config` (not in repo - user-provided)\n- **Docker**: Environment variables in docker-compose files\n\n---","title":"Configuration - Architecture Index","ref":"index.html#configuration"},{"type":"extras","doc":"","title":"Development Documentation - Architecture Index","ref":"index.html#development-documentation"},{"type":"extras","doc":"- **Unit Tests**: `test/*_tests.erl` - EUnit tests\n- **Integration Tests**: `test/integration/*_SUITE.erl` - Common Test suites\n- **Running Tests**: `rebar3 eunit && rebar3 ct`","title":"Testing - Architecture Index","ref":"index.html#testing"},{"type":"extras","doc":"- **Style Guide**: Idiomatic Erlang (see CLAUDE.md)\n- **Test Coverage**: Tracked per module\n- **TODO Tracking**: See `TODO.md`","title":"Code Quality - Architecture Index","ref":"index.html#code-quality"},{"type":"extras","doc":"- **Plan**: [`gateway_refactoring_plan.md`](gateway_refactoring_plan.md)\n- **Status**: Completed in v0.7.x\n- **Result**: 6 focused modules, supervision tree, comprehensive tests","title":"Gateway Refactoring (Completed) - Architecture Index","ref":"index.html#gateway-refactoring-completed"},{"type":"extras","doc":"- **Overview**: [`memory_management/README.md`](memory_management/README.md)\n- **Docs**: [`memory_management/`](memory_management/) directory\n- **Status**: Completed in v0.7.x\n- **Result**: Bounded pools, TTL cleanup, no OOM crashes\n\n---","title":"Memory Management (Completed) - Architecture Index","ref":"index.html#memory-management-completed"},{"type":"extras","doc":"","title":"Historical Documentation - Architecture Index","ref":"index.html#historical-documentation"},{"type":"extras","doc":"- [`ARCHITECTURE_EVOLUTION.md`](ARCHITECTURE_EVOLUTION.md) - How we got here\n- [`DOCUMENTATION_STATUS.md`](DOCUMENTATION_STATUS.md) - Doc tracking","title":"Architecture Evolution - Architecture Index","ref":"index.html#architecture-evolution"},{"type":"extras","doc":"- [`dht_routed_rpc.md`](dht_routed_rpc.md) - Original DHT RPC plan (superseded)\n- [`dht_routed_pubsub.md`](dht_routed_pubsub.md) - Original DHT PubSub plan (superseded)\n- [`god_module_refactoring_plan.md`](god_module_refactoring_plan.md) - Old refactoring (superseded by v0.7.0 nomenclature)\n\n**Note**: Many of these docs describe approaches that were superseded by v0.8.0's direct P2P architecture. They're kept for historical reference.\n\n---","title":"Old Planning (Pre-v0.8.0) - Architecture Index","ref":"index.html#old-planning-pre-v0-8-0"},{"type":"extras","doc":"","title":"Comparison Documents - Architecture Index","ref":"index.html#comparison-documents"},{"type":"extras","doc":"- [`macula_http3_mesh_vs_distributed_erlang.md`](macula_http3_mesh_vs_distributed_erlang.md)\n- [`macula_http3_mesh_vs_libp2p.md`](macula_http3_mesh_vs_libp2p.md)\n- [`macula_http3_mesh_vs_wamp.md`](macula_http3_mesh_vs_wamp.md)\n\n---","title":"vs. Other Technologies - Architecture Index","ref":"index.html#vs-other-technologies"},{"type":"extras","doc":"","title":"Contributing - Architecture Index","ref":"index.html#contributing"},{"type":"extras","doc":"1. Follow the naming convention: `vX.Y.Z-DOCNAME.md` or `TOPIC-NAME.md`\n2. Add entry to this INDEX.md\n3. Keep docs focused and scannable\n4. Include code examples where helpful\n5. Link to related docs","title":"How to Contribute Documentation - Architecture Index","ref":"index.html#how-to-contribute-documentation"},{"type":"extras","doc":"- **Markdown**: Use GitHub-flavored Markdown\n- **Diagrams**: Use Mermaid or ASCII art\n- **Code Examples**: Include working, tested examples\n- **References**: Link to source files with line numbers where possible\n\n---","title":"Documentation Standards - Architecture Index","ref":"index.html#documentation-standards"},{"type":"extras","doc":"Future documentation to create:\n- [ ] `TUTORIAL.md` - Complete tutorial with working examples\n- [ ] `FAQ.md` - Frequently asked questions\n- [ ] `TROUBLESHOOTING.md` - Common issues and solutions\n- [ ] `ALGORITHMS-KADEMLIA.md` - DHT algorithm details\n- [ ] `ALGORITHMS-SERVICE-DISCOVERY.md` - Service discovery flow\n- [ ] `TECHNIQUES-DIRECT-P2P.md` - P2P connection patterns\n- [ ] `v0.8.0-ARCHITECTURE.md` - Detailed architecture diagrams\n- [ ] `v0.8.0-DECISIONS.md` - Architecture Decision Records (ADRs)\n\n---","title":"TODO - Architecture Index","ref":"index.html#todo"},{"type":"extras","doc":"","title":"Quick Reference - Architecture Index","ref":"index.html#quick-reference"},{"type":"extras","doc":"1. [`../README.md`](../README.md) - Project overview\n2. [`v0.8.0-OVERVIEW.md`](v0.8.0-OVERVIEW.md) - Current version overview\n3. [`v0.8.0-CHANGELOG.md`](v0.8.0-CHANGELOG.md) - What changed\n4. [`src/macula_peer.erl`](../src/macula_peer.erl) - High-level API","title":"Key Files to Read First - Architecture Index","ref":"index.html#key-files-to-read-first"},{"type":"extras","doc":"- **Add a new feature**: See module @doc comments for API design patterns\n- **Deploy to production**: See Docker files and compose configurations\n- **Debug an issue**: See hex docs and integration test examples\n- **Understand DHT**: See `macula_routing_server.erl` and `macula_routing_table.erl`\n\n---\n\n**Navigation**: [Back to Main README](../README.md) | [v0.8.0 Overview](v0.8.0-OVERVIEW.md) | [Changelog](v0.8.0-CHANGELOG.md) | [Roadmap](v0.8.0-ROADMAP.md)","title":"Common Tasks - Architecture Index","ref":"index.html#common-tasks"},{"type":"extras","doc":"# Macula HTTP/3 Mesh - Project Structure and Libraries\n\n**Actual Erlang/Elixir projects and libraries to build**\n\n**Created**: 2025-01-08\n**Status**: Planning Document\n\n---","title":"Project Structure","ref":"macula_project_structure.html"},{"type":"extras","doc":"This document outlines the actual Erlang/Elixir libraries, applications, and projects that need to be created to implement the Macula HTTP/3 Mesh platform.\n\n---","title":"Overview - Project Structure","ref":"macula_project_structure.html#overview"},{"type":"extras","doc":"","title":"Repository Organization Strategy - Project Structure","ref":"macula_project_structure.html#repository-organization-strategy"},{"type":"extras","doc":"```\nmacula/\n apps/\n    macula_core/           # Core protocols and types\n    macula_quic/           # QUIC transport layer\n    macula_protocol/       # Wire protocol (framing, encoding)\n    macula_membership/     # SWIM membership\n    macula_routing/        # Kademlia DHT routing\n    macula_topology/       # Mesh topology management\n    macula_pubsub/         # Pub/sub implementation\n    macula_rpc/            # RPC implementation\n    macula_gateway/        # Cross-realm gateway\n    macula_discovery/      # Node discovery\n    macula_security/       # Auth, ACLs, certificates\n    macula/                # Main application (umbrella)\n rebar.config               # Rebar3 umbrella config\n mix.exs                    # Mix umbrella config (if supporting Elixir)\n README.md\n```\n\n**Benefits**:\n- Easy cross-library development\n- Shared dependencies\n- Single release\n- Atomic commits across components\n- Simplified CI/CD","title":"Option A: Monorepo (Recommended for Initial Development) - Project Structure","ref":"macula_project_structure.html#option-a-monorepo-recommended-for-initial-development"},{"type":"extras","doc":"Separate repositories for each library (similar to Erlang/OTP structure).\n\n**Benefits**:\n- Independent versioning\n- Smaller, focused repos\n- Can use different libraries independently\n- Clear boundaries\n\n**Recommendation**: Start with **Option A (monorepo)**, split later if needed.\n\n---","title":"Option B: Multi-repo (For Maturity/Modularity) - Project Structure","ref":"macula_project_structure.html#option-b-multi-repo-for-maturity-modularity"},{"type":"extras","doc":"","title":"Core Libraries (Required for MVP) - Project Structure","ref":"macula_project_structure.html#core-libraries-required-for-mvp"},{"type":"extras","doc":"**Purpose**: Core types, protocols, and shared utilities.\n\n**Modules**:\n```erlang\n%% Core types\nmacula_types.erl           - Common type definitions\nmacula_node.erl            - Node identity and metadata\nmacula_realm.erl           - Realm management\nmacula_topic.erl           - Topic parsing and validation\n\n%% Utilities\nmacula_time.erl            - Time utilities\nmacula_id.erl              - ID generation (SHA-256 node IDs)\nmacula_uri.erl             - Macula URI parsing (macula://realm/node)\n```\n\n**Dependencies**: None (pure Erlang)\n\n**Rebar3 Config**:\n```erlang\n{application, macula_core, [\n    {description, \"Macula core types and protocols\"},\n    {vsn, \"0.1.0\"},\n    {modules, []},\n    {registered, []},\n    {applications, [kernel, stdlib]}\n]}.\n```\n\n---","title":"1. macula_core - Project Structure","ref":"macula_project_structure.html#1-macula_core"},{"type":"extras","doc":"**Purpose**: QUIC transport layer (wrapper around quicer).\n\n**Modules**:\n```erlang\nmacula_quic_listener.erl   - QUIC listener (accept connections)\nmacula_quic_client.erl     - QUIC client (initiate connections)\nmacula_quic_connection.erl - GenServer per QUIC connection\nmacula_quic_stream.erl     - Stream management\nmacula_quic_config.erl     - QUIC configuration (TLS, ALPN, etc.)\n```\n\n**Dependencies**:\n- `quicer` (NIF for MsQuic)\n\n**Key Features**:\n- Connection pooling\n- Stream multiplexing\n- 0-RTT support\n- Connection migration\n- Backpressure handling\n\n**Rebar3 Config**:\n```erlang\n{application, macula_quic, [\n    {description, \"Macula QUIC transport layer\"},\n    {vsn, \"0.1.0\"},\n    {modules, []},\n    {registered, []},\n    {applications, [kernel, stdlib, macula_core, quicer]},\n    {mod, {macula_quic_app, []}}\n]}.\n\n{deps, [\n    {quicer, {git, \"https://github.com/emqx/quic.git\", {branch, \"main\"}}}\n]}.\n```\n\n---","title":"2. macula_quic - Project Structure","ref":"macula_project_structure.html#2-macula_quic"},{"type":"extras","doc":"**Purpose**: Wire protocol (message framing, encoding/decoding).\n\n**Modules**:\n```erlang\nmacula_protocol.erl        - Main protocol API\nmacula_frame.erl           - Frame encoding/decoding\nmacula_message.erl         - Message types and validation\nmacula_codec.erl           - Binary serialization (Erlang term format or MessagePack)\n```\n\n**Message Types**:\n```erlang\n-define(MSG_HANDSHAKE, 16#01).\n-define(MSG_HANDSHAKE_ACK, 16#02).\n-define(MSG_HEARTBEAT, 16#03).\n-define(MSG_PING, 16#04).\n-define(MSG_PONG, 16#05).\n-define(MSG_PUBLISH, 16#10).\n-define(MSG_SUBSCRIBE, 16#11).\n-define(MSG_UNSUBSCRIBE, 16#12).\n-define(MSG_EVENT, 16#13).\n-define(MSG_RPC_CALL, 16#20).\n-define(MSG_RPC_RESULT, 16#21).\n-define(MSG_RPC_ERROR, 16#22).\n-define(MSG_ERROR, 16#F0).\n-define(MSG_CLOSE, 16#FF).\n```\n\n**Dependencies**:\n- `macula_core`\n\n**Optional Dependencies**:\n- `msgpack` (if using MessagePack instead of Erlang term format)\n\n**Rebar3 Config**:\n```erlang\n{application, macula_protocol, [\n    {description, \"Macula wire protocol\"},\n    {vsn, \"0.1.0\"},\n    {applications, [kernel, stdlib, macula_core]}\n]}.\n```\n\n---","title":"3. macula_protocol - Project Structure","ref":"macula_project_structure.html#3-macula_protocol"},{"type":"extras","doc":"**Purpose**: SWIM-based membership and failure detection.\n\n**Modules**:\n```erlang\nmacula_membership.erl      - Main membership API\nmacula_swim.erl            - SWIM protocol GenServer\nmacula_swim_detector.erl   - Failure detector\nmacula_swim_gossip.erl     - Gossip dissemination\nmacula_member.erl          - Member record and state\n```\n\n**Features**:\n- Membership list management\n- Direct ping / indirect ping\n- Suspicion mechanism\n- Incarnation numbers\n- Realm-scoped membership\n\n**Dependencies**:\n- `macula_core`\n- `macula_protocol`\n- `macula_quic`\n\n**Rebar3 Config**:\n```erlang\n{application, macula_membership, [\n    {description, \"Macula SWIM membership\"},\n    {vsn, \"0.1.0\"},\n    {applications, [kernel, stdlib, macula_core, macula_protocol, macula_quic]},\n    {mod, {macula_membership_app, []}}\n]}.\n```\n\n---","title":"4. macula_membership - Project Structure","ref":"macula_project_structure.html#4-macula_membership"},{"type":"extras","doc":"**Purpose**: Kademlia DHT for routing.\n\n**Modules**:\n```erlang\nmacula_routing.erl         - Routing API\nmacula_kademlia.erl        - Kademlia DHT GenServer\nmacula_k_bucket.erl        - K-bucket management\nmacula_node_lookup.erl     - Node lookup (iterative)\nmacula_topic_registry.erl  - Topic  Nodes mapping (for pub/sub)\nmacula_rpc_registry.erl    - RPC name  Node mapping\n```\n\n**Features**:\n- 256 k-buckets (for 256-bit node IDs)\n- XOR distance metric\n- Iterative lookups\n- Bucket refresh\n- Realm partitioning\n\n**Dependencies**:\n- `macula_core`\n- `macula_membership`\n\n**Rebar3 Config**:\n```erlang\n{application, macula_routing, [\n    {description, \"Macula Kademlia DHT routing\"},\n    {vsn, \"0.1.0\"},\n    {applications, [kernel, stdlib, macula_core, macula_membership]},\n    {mod, {macula_routing_app, []}}\n]}.\n```\n\n---","title":"5. macula_routing - Project Structure","ref":"macula_project_structure.html#5-macula_routing"},{"type":"extras","doc":"**Purpose**: Mesh topology management (k-regular graph).\n\n**Modules**:\n```erlang\nmacula_topology.erl        - Topology management\nmacula_k_regular.erl       - k-regular graph algorithm\nmacula_connection_pool.erl - Connection pool supervisor\nmacula_connection.erl      - GenServer per peer connection\n```\n\n**Features**:\n- k-regular graph topology\n- Connection lifecycle (connect, disconnect, reconnect)\n- Exponential backoff for reconnections\n- Topology visualization\n\n**Dependencies**:\n- `macula_core`\n- `macula_quic`\n- `macula_membership`\n- `macula_routing`\n\n**Rebar3 Config**:\n```erlang\n{application, macula_topology, [\n    {description, \"Macula mesh topology management\"},\n    {vsn, \"0.1.0\"},\n    {applications, [kernel, stdlib, macula_core, macula_quic,\n                    macula_membership, macula_routing]},\n    {mod, {macula_topology_app, []}}\n]}.\n```\n\n---","title":"6. macula_topology - Project Structure","ref":"macula_project_structure.html#6-macula_topology"},{"type":"extras","doc":"**Purpose**: Publish/subscribe messaging.\n\n**Modules**:\n```erlang\nmacula_pubsub.erl          - Pub/sub API\nmacula_topic_tree.erl      - Topic subscription tree (pattern matching)\nmacula_subscription.erl    - Subscription management\nmacula_publisher.erl       - Publishing logic\nmacula_event_router.erl    - Event routing to subscribers\n```\n\n**Features**:\n- Topic pattern matching (exact, prefix, wildcard)\n- Local and remote subscriptions\n- Subscription announcements (via DHT)\n- Event delivery guarantees (at-most-once, at-least-once)\n\n**Dependencies**:\n- `macula_core`\n- `macula_protocol`\n- `macula_routing`\n- `macula_topology`\n\n**Rebar3 Config**:\n```erlang\n{application, macula_pubsub, [\n    {description, \"Macula pub/sub messaging\"},\n    {vsn, \"0.1.0\"},\n    {applications, [kernel, stdlib, macula_core, macula_protocol,\n                    macula_routing, macula_topology]},\n    {mod, {macula_pubsub_app, []}}\n]}.\n```\n\n---","title":"7. macula_pubsub - Project Structure","ref":"macula_project_structure.html#7-macula_pubsub"},{"type":"extras","doc":"**Purpose**: Remote procedure call (RPC) implementation.\n\n**Modules**:\n```erlang\nmacula_rpc.erl             - RPC API (call, register, unregister)\nmacula_rpc_server.erl      - RPC request handler\nmacula_rpc_client.erl      - RPC call client\nmacula_rpc_registry.erl    - Local RPC endpoint registry\n```\n\n**Features**:\n- Synchronous RPC (with timeout)\n- Asynchronous RPC (cast)\n- RPC endpoint registration (name  handler function)\n- Endpoint discovery via DHT\n- Load balancing (if multiple nodes register same RPC)\n\n**Dependencies**:\n- `macula_core`\n- `macula_protocol`\n- `macula_routing`\n- `macula_topology`\n\n**Rebar3 Config**:\n```erlang\n{application, macula_rpc, [\n    {description, \"Macula RPC\"},\n    {vsn, \"0.1.0\"},\n    {applications, [kernel, stdlib, macula_core, macula_protocol,\n                    macula_routing, macula_topology]},\n    {mod, {macula_rpc_app, []}}\n]}.\n```\n\n---","title":"8. macula_rpc - Project Structure","ref":"macula_project_structure.html#8-macula_rpc"},{"type":"extras","doc":"**Purpose**: Node discovery (DNS-SD, mDNS, static, cloud).\n\n**Modules**:\n```erlang\nmacula_discovery.erl       - Discovery coordinator\nmacula_discovery_static.erl - Static bootstrap nodes\nmacula_discovery_mdns.erl  - mDNS (Multicast DNS)\nmacula_discovery_dns.erl   - DNS SRV records\nmacula_discovery_consul.erl - Consul service discovery\nmacula_discovery_k8s.erl   - Kubernetes endpoints\n```\n\n**Features**:\n- Multiple discovery methods (configurable)\n- Continuous discovery (periodic re-discovery)\n- Bootstrap node list\n- Realm-aware discovery\n\n**Dependencies**:\n- `macula_core`\n- `mdns` (for mDNS support)\n\n**Rebar3 Config**:\n```erlang\n{application, macula_discovery, [\n    {description, \"Macula node discovery\"},\n    {vsn, \"0.1.0\"},\n    {applications, [kernel, stdlib, macula_core]},\n    {mod, {macula_discovery_app, []}}\n]}.\n\n{deps, [\n    {mdns, {git, \"https://github.com/benoitc/erlang-mdns.git\", {branch, \"master\"}}}\n]}.\n```\n\n---","title":"9. macula_discovery - Project Structure","ref":"macula_project_structure.html#9-macula_discovery"},{"type":"extras","doc":"**Purpose**: Security (TLS certificates, ACLs, audit logging).\n\n**Modules**:\n```erlang\nmacula_security.erl        - Security API\nmacula_cert.erl            - Certificate generation and validation\nmacula_acl.erl             - Access control lists\nmacula_audit.erl           - Audit logging\nmacula_crypto.erl          - Message signing/verification\n```\n\n**Features**:\n- Certificate generation (self-signed, CA-signed)\n- Certificate validation (realm extraction from SAN)\n- ACL enforcement (topic/RPC access control)\n- Audit log (security events)\n- Optional message signing\n\n**Dependencies**:\n- `macula_core`\n- `public_key` (Erlang stdlib)\n- `ssl` (Erlang stdlib)\n\n**Rebar3 Config**:\n```erlang\n{application, macula_security, [\n    {description, \"Macula security\"},\n    {vsn, \"0.1.0\"},\n    {applications, [kernel, stdlib, public_key, ssl, macula_core]},\n    {mod, {macula_security_app, []}}\n]}.\n```\n\n---","title":"10. macula_security - Project Structure","ref":"macula_project_structure.html#10-macula_security"},{"type":"extras","doc":"**Purpose**: Cross-realm gateway functionality.\n\n**Modules**:\n```erlang\nmacula_gateway.erl         - Gateway API\nmacula_gateway_server.erl  - Gateway GenServer\nmacula_policy.erl          - Policy engine (topic filtering, rate limiting)\nmacula_translation.erl     - Topic translation\nmacula_rate_limiter.erl    - Rate limiting per realm pair\n```\n\n**Features**:\n- Multi-realm support\n- Policy-based message filtering\n- Topic translation\n- Rate limiting\n- Audit logging of cross-realm traffic\n\n**Dependencies**:\n- `macula_core`\n- `macula_protocol`\n- `macula_pubsub`\n- `macula_rpc`\n- `macula_security`\n\n**Rebar3 Config**:\n```erlang\n{application, macula_gateway, [\n    {description, \"Macula cross-realm gateway\"},\n    {vsn, \"0.1.0\"},\n    {applications, [kernel, stdlib, macula_core, macula_protocol,\n                    macula_pubsub, macula_rpc, macula_security]},\n    {mod, {macula_gateway_app, []}}\n]}.\n```\n\n---","title":"11. macula_gateway - Project Structure","ref":"macula_project_structure.html#11-macula_gateway"},{"type":"extras","doc":"**Purpose**: Umbrella application that ties everything together.\n\n**Modules**:\n```erlang\nmacula.erl                 - Main API\nmacula_app.erl             - Application callback\nmacula_sup.erl             - Top-level supervisor\nmacula_config.erl          - Configuration management\n```\n\n**Supervision Tree**:\n```erlang\nmacula_sup (one_for_one)\n macula_discovery_sup\n macula_quic_sup\n macula_membership_sup\n macula_routing_sup\n macula_topology_sup\n macula_pubsub_sup\n macula_rpc_sup\n macula_security_sup\n macula_gateway_sup (optional, if gateway mode)\n```\n\n**Dependencies**: All macula_* libraries\n\n**Rebar3 Config**:\n```erlang\n{application, macula, [\n    {description, \"Macula HTTP/3 Mesh Platform\"},\n    {vsn, \"0.1.0\"},\n    {applications, [\n        kernel, stdlib,\n        macula_core,\n        macula_quic,\n        macula_protocol,\n        macula_membership,\n        macula_routing,\n        macula_topology,\n        macula_pubsub,\n        macula_rpc,\n        macula_discovery,\n        macula_security,\n        macula_gateway\n    ]},\n    {mod, {macula_app, []}},\n    {env, [\n        {realm, <<\"org.example.mesh\">>},\n        {listen_port, 4433},\n        {discovery, [{methods, [static, mdns]}]},\n        {topology, [{type, k_regular}, {k, 2}]}\n    ]}\n]}.\n```\n\n---","title":"12. macula (Main Application) - Project Structure","ref":"macula_project_structure.html#12-macula-main-application"},{"type":"extras","doc":"","title":"Supporting Tools and Utilities - Project Structure","ref":"macula_project_structure.html#supporting-tools-and-utilities"},{"type":"extras","doc":"**Purpose**: Command-line tool for Macula operations.\n\n**Features**:\n- Start/stop nodes\n- Join mesh\n- View topology\n- Send test messages\n- Query membership\n- Inspect routing table\n\n**Implementation**: Escript\n\n**Rebar3 Config**:\n```erlang\n{escript_name, macula}.\n{escript_emu_args, \"%%! -escript main macula_cli\\n\"}.\n```\n\n**Usage**:\n```bash\nmacula start --realm org.example.mesh --port 4433\nmacula join 192.168.1.100:4433\nmacula topology\nmacula publish topic.name '{\"data\": \"hello\"}'\nmacula stats\n```\n\n---","title":"13. macula_cli - Project Structure","ref":"macula_project_structure.html#13-macula_cli"},{"type":"extras","doc":"**Purpose**: Real-time mesh visualization and monitoring.\n\n**Features**:\n- Visual mesh topology (graphviz-style)\n- Live message flow\n- Membership state\n- Connection status\n- Metrics dashboard\n\n**Implementation**: Phoenix LiveView application (if using Elixir)\n\n**Alternative**: Standalone Erlang application with web UI (Cowboy + WebSocket)\n\n---","title":"14. macula_observer - Project Structure","ref":"macula_project_structure.html#14-macula_observer"},{"type":"extras","doc":"**Purpose**: Load testing and benchmarking tool.\n\n**Features**:\n- Spawn N virtual nodes\n- Pub/sub throughput testing\n- RPC latency testing\n- Failure injection\n- Report generation\n\n**Implementation**: Standalone Erlang application using Tsung or custom framework\n\n---","title":"15. macula_loadtest - Project Structure","ref":"macula_project_structure.html#15-macula_loadtest"},{"type":"extras","doc":"","title":"Optional/Future Libraries - Project Structure","ref":"macula_project_structure.html#optional-future-libraries"},{"type":"extras","doc":"**Purpose**: WAMP compatibility layer (bridge WAMP clients to Macula).\n\n**Modules**:\n- WAMP protocol adapter\n- WebSocket server\n- Message translation (WAMP  Macula)\n\n**Use Case**: Migrate from Bondy/WAMP to Macula gradually\n\n---","title":"16. macula_wamp_compat - Project Structure","ref":"macula_project_structure.html#16-macula_wamp_compat"},{"type":"extras","doc":"**Purpose**: HTTP/REST gateway for Macula (publish via HTTP POST).\n\n**Modules**:\n- Cowboy HTTP handler\n- REST API (publish, call, subscribe via SSE)\n\n**Use Case**: Non-BEAM clients accessing Macula\n\n---","title":"17. macula_http_bridge - Project Structure","ref":"macula_project_structure.html#17-macula_http_bridge"},{"type":"extras","doc":"**Purpose**: Kafka bridge (publish Macula events to Kafka, consume Kafka events).\n\n**Dependencies**: `brod` (Kafka client)\n\n---","title":"18. macula_kafka_connector - Project Structure","ref":"macula_project_structure.html#18-macula_kafka_connector"},{"type":"extras","doc":"**Purpose**: PostgreSQL integration (CDC, event sourcing).\n\n**Dependencies**: `epgsql` or `postgrex`\n\n---","title":"19. macula_postgres_connector - Project Structure","ref":"macula_project_structure.html#19-macula_postgres_connector"},{"type":"extras","doc":"**Purpose**: Metrics and observability (Prometheus, OpenTelemetry).\n\n**Modules**:\n- Prometheus exporter\n- OpenTelemetry integration\n- StatsD reporter\n\n**Dependencies**:\n- `prometheus` or `prometheus_ex`\n- `opentelemetry` and `opentelemetry_exporter`\n\n---","title":"20. macula_metrics - Project Structure","ref":"macula_project_structure.html#20-macula_metrics"},{"type":"extras","doc":"","title":"Development Roadmap - Project Structure","ref":"macula_project_structure.html#development-roadmap"},{"type":"extras","doc":"**Goal**: Get basic QUIC transport and protocol working.\n\n**Libraries to build**:\n1. `macula_core` - Types and utilities\n2. `macula_quic` - QUIC wrapper\n3. `macula_protocol` - Wire protocol\n\n**Deliverable**: Two nodes can connect and exchange handshake messages.\n\n---","title":"Phase 1: Foundation (Weeks 1-4) - Project Structure","ref":"macula_project_structure.html#phase-1-foundation-weeks-1-4"},{"type":"extras","doc":"**Goal**: Self-organizing mesh network.\n\n**Libraries to build**:\n4. `macula_membership` - SWIM\n5. `macula_routing` - Kademlia DHT\n6. `macula_topology` - k-regular graph\n7. `macula_discovery` - Node discovery\n\n**Deliverable**: N nodes form a mesh and detect failures.\n\n---","title":"Phase 2: Mesh Topology (Weeks 5-8) - Project Structure","ref":"macula_project_structure.html#phase-2-mesh-topology-weeks-5-8"},{"type":"extras","doc":"**Goal**: Pub/sub and RPC working across mesh.\n\n**Libraries to build**:\n8. `macula_pubsub` - Pub/sub\n9. `macula_rpc` - RPC\n\n**Deliverable**: Applications can publish/subscribe and make RPC calls.\n\n---","title":"Phase 3: Messaging (Weeks 9-12) - Project Structure","ref":"macula_project_structure.html#phase-3-messaging-weeks-9-12"},{"type":"extras","doc":"**Goal**: Production-ready security and multi-tenancy.\n\n**Libraries to build**:\n10. `macula_security` - Certificates, ACLs, audit\n11. `macula_gateway` - Cross-realm gateway\n\n**Deliverable**: Secure mesh with realm isolation.\n\n---","title":"Phase 4: Security and Gateways (Weeks 13-16) - Project Structure","ref":"macula_project_structure.html#phase-4-security-and-gateways-weeks-13-16"},{"type":"extras","doc":"**Goal**: Developer experience and operations tooling.\n\n**Tools to build**:\n13. `macula_cli` - Command-line tool\n14. `macula_observer` - Visualization\n15. `macula_loadtest` - Benchmarking\n20. `macula_metrics` - Observability\n\n**Deliverable**: Production-ready platform with tooling.\n\n---","title":"Phase 5: Tooling and Monitoring (Weeks 17-20) - Project Structure","ref":"macula_project_structure.html#phase-5-tooling-and-monitoring-weeks-17-20"},{"type":"extras","doc":"","title":"Testing Strategy - Project Structure","ref":"macula_project_structure.html#testing-strategy"},{"type":"extras","doc":"Each library has its own test suite:\n```\napps/macula_core/test/\napps/macula_quic/test/\napps/macula_protocol/test/\n...\n```\n\n**Framework**: EUnit (Erlang) or ExUnit (Elixir)\n\n**Run**:\n```bash\nrebar3 eunit\n# or\nmix test\n```\n\n---","title":"Unit Tests - Project Structure","ref":"macula_project_structure.html#unit-tests"},{"type":"extras","doc":"Multi-node integration tests:\n```\ntest/integration/\n mesh_formation_test.erl\n pubsub_test.erl\n rpc_test.erl\n failure_recovery_test.erl\n gateway_test.erl\n```\n\n**Framework**: Common Test (Erlang)\n\n**Run**:\n```bash\nrebar3 ct\n```\n\n---","title":"Integration Tests - Project Structure","ref":"macula_project_structure.html#integration-tests"},{"type":"extras","doc":"Use PropEr (Erlang) or StreamData (Elixir):\n```\napps/macula_routing/test/prop_kademlia.erl\napps/macula_membership/test/prop_swim.erl\n```\n\n**Run**:\n```bash\nrebar3 proper\n```\n\n---","title":"Property-Based Tests - Project Structure","ref":"macula_project_structure.html#property-based-tests"},{"type":"extras","doc":"Separate load testing suite:\n```\nloadtest/\n pubsub_throughput.erl\n rpc_latency.erl\n mesh_scale.erl (1000+ nodes)\n failure_injection.erl\n```\n\n**Framework**: Tsung or custom\n\n---","title":"Load Tests - Project Structure","ref":"macula_project_structure.html#load-tests"},{"type":"extras","doc":"","title":"Continuous Integration - Project Structure","ref":"macula_project_structure.html#continuous-integration"},{"type":"extras","doc":"```yaml\nname: CI\n\non: [push, pull_request]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v2\n      - uses: erlef/setup-beam@v1\n        with:\n          otp-version: '26.2'\n          rebar3-version: '3.22'\n      - run: rebar3 compile\n      - run: rebar3 eunit\n      - run: rebar3 ct\n      - run: rebar3 dialyzer\n\n  integration:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v2\n      - uses: erlef/setup-beam@v1\n      - run: rebar3 as test release\n      - run: ./test/integration/run_all.sh\n```\n\n---","title":"GitHub Actions Workflow - Project Structure","ref":"macula_project_structure.html#github-actions-workflow"},{"type":"extras","doc":"","title":"Release Strategy - Project Structure","ref":"macula_project_structure.html#release-strategy"},{"type":"extras","doc":"```erlang\n%% rebar.config\n{relx, [\n    {release, {macula, \"0.1.0\"}, [\n        macula,\n        sasl\n    ]},\n\n    {mode, prod},\n    {include_erts, true},\n    {extended_start_script, true},\n\n    {overlay, [\n        {copy, \"config/sys.config.example\", \"etc/sys.config\"},\n        {copy, \"config/vm.args.example\", \"etc/vm.args\"}\n    ]}\n]}.\n```\n\n**Build**:\n```bash\nrebar3 release\n```\n\n**Result**: `_build/default/rel/macula/`\n\n---","title":"Rebar3 Release - Project Structure","ref":"macula_project_structure.html#rebar3-release"},{"type":"extras","doc":"```dockerfile\nFROM erlang:26-alpine AS builder\n\nWORKDIR /build\nCOPY . .\nRUN rebar3 as prod release\n\nFROM alpine:latest\n\nRUN apk add --no-cache openssl ncurses-libs libstdc++\n\nCOPY --from=builder /build/_build/prod/rel/macula /opt/macula\n\nEXPOSE 4433/udp\n\nCMD [\"/opt/macula/bin/macula\", \"foreground\"]\n```\n\n**Build**:\n```bash\ndocker build -t macula:latest .\n```\n\n---","title":"Docker Image - Project Structure","ref":"macula_project_structure.html#docker-image"},{"type":"extras","doc":"","title":"Repository Initialization - Project Structure","ref":"macula_project_structure.html#repository-initialization"},{"type":"extras","doc":"```bash\n# Erlang (Rebar3)\nrebar3 new umbrella macula\ncd macula\n\n# Create apps\nrebar3 new lib apps/macula_core\nrebar3 new lib apps/macula_quic\nrebar3 new lib apps/macula_protocol\n# ... etc\n\n# Compile\nrebar3 compile\n\n# Test\nrebar3 eunit\n\n# Release\nrebar3 release\n```","title":"Create Umbrella Application - Project Structure","ref":"macula_project_structure.html#create-umbrella-application"},{"type":"extras","doc":"```bash\n# Elixir (Mix)\nmix new macula --umbrella\ncd macula\n\n# Create apps\ncd apps\nmix new macula_core\nmix new macula_quic\nmix new macula_protocol\n# ... etc\n\ncd ..\n\n# Compile\nmix compile\n\n# Test\nmix test\n\n# Release\nmix release\n```\n\n---","title":"OR Elixir (Mix) - Project Structure","ref":"macula_project_structure.html#or-elixir-mix"},{"type":"extras","doc":"**Core Libraries** (12):\n1.  `macula_core` - Core types and utilities\n2.  `macula_quic` - QUIC transport\n3.  `macula_protocol` - Wire protocol\n4.  `macula_membership` - SWIM membership\n5.  `macula_routing` - Kademlia DHT\n6.  `macula_topology` - Mesh topology\n7.  `macula_pubsub` - Pub/sub\n8.  `macula_rpc` - RPC\n9.  `macula_discovery` - Node discovery\n10.  `macula_security` - Security\n11.  `macula_gateway` - Cross-realm gateway\n12.  `macula` - Main application\n\n**Tools** (3):\n13.  `macula_cli` - CLI tool\n14.  `macula_observer` - Visualization\n15.  `macula_loadtest` - Load testing\n\n**Optional** (5):\n16.  `macula_wamp_compat` - WAMP bridge\n17.  `macula_http_bridge` - HTTP gateway\n18.  `macula_kafka_connector` - Kafka integration\n19.  `macula_postgres_connector` - PostgreSQL integration\n20.  `macula_metrics` - Metrics/observability\n\n**Total**: 20 libraries/applications\n\n---\n\n**Next Step**: Initialize the repository structure and start with Phase 1 (Foundation).\n\n---\n\n**Last Updated**: 2025-01-08\n**Maintainers**: [To be assigned]","title":"Summary - Project Structure","ref":"macula_project_structure.html#summary"},{"type":"extras","doc":"# Kademlia DHT Architecture in Macula","title":"Kademlia DHT","ref":"kademlia_dht_architecture.html"},{"type":"extras","doc":"Macula uses a **Kademlia Distributed Hash Table (DHT)** for decentralized service discovery and peer-to-peer routing. This document describes how Kademlia principles are implemented in the HTTP/3 mesh network.\n\n**Key Reference:** [Kademlia: A Peer-to-peer Information System Based on the XOR Metric](http://www.scs.stanford.edu/~dm/home/papers/kpos.pdf) (Maymounkov & Mazires, 2002)","title":"Overview - Kademlia DHT","ref":"kademlia_dht_architecture.html#overview"},{"type":"extras","doc":"Traditional DHTs (like Chord) use numeric distance metrics that don't align well with network topology. Kademlia's XOR-based metric provides:\n\n1. **Symmetric distance** - `distance(A, B) = distance(B, A)`\n2. **Network-aware routing** - Nodes sharing common prefixes tend to be routed through similar paths\n3. **O(log N) lookup complexity** - Efficient even with millions of nodes\n4. **Self-organizing** - No central coordination required\n5. **NAT-friendly** - Works well with HTTP/3's connection-oriented transport","title":"Why Kademlia? - Kademlia DHT","ref":"kademlia_dht_architecture.html#why-kademlia"},{"type":"extras","doc":"","title":"Core Concepts - Kademlia DHT","ref":"kademlia_dht_architecture.html#core-concepts"},{"type":"extras","doc":"Every node in the Macula mesh has a 160-bit **Node ID** derived from:\n- Gateway mode: Hash of (realm + IP + port)\n- Edge peer mode: Randomly generated on startup\n\n**XOR Distance Formula:**\n```\ndistance(A, B) = A  B (bitwise XOR)\n```\n\n**Example:**\n```\nNode A: 0b10110101\nNode B: 0b11010011\n-------\nXOR:    0b01100110  (distance = 102 decimal)\n```\n\nNodes are considered \"closer\" when their XOR distance is smaller. This creates a geometric address space where routing naturally follows network topology.","title":"1. Node IDs and XOR Metric - Kademlia DHT","ref":"kademlia_dht_architecture.html#1-node-ids-and-xor-metric"},{"type":"extras","doc":"Each node maintains a **routing table** of `160 k-buckets`, where `k = 20` (typical value).\n\n**Structure:**\n- **Bucket 0**: Nodes at distance `2^0` to `2^1 - 1` (immediate neighbors)\n- **Bucket 1**: Nodes at distance `2^1` to `2^2 - 1`\n- **Bucket i**: Nodes at distance `2^i` to `2^(i+1) - 1`\n- **Bucket 159**: Nodes at distance `2^159` to `2^160 - 1` (furthest)\n\n**K-Bucket Properties:**\n- Maximum of `k` entries per bucket\n- Least-recently-seen nodes are evicted first (LRU)\n- Bucket 0 (closest nodes) is most important for routing\n\n**Macula Implementation:**\n```erlang\n%% In macula_routing.erl (conceptual)\n-define(KADEMLIA_K, 20).          %% Bucket size\n-define(KADEMLIA_ALPHA, 3).       %% Parallel lookup factor\n-define(ID_BITS, 160).            %% SHA-1 hash size\n\n-record(k_bucket, {\n    distance_range :: {integer(), integer()},\n    nodes :: [node_entry()],       %% Max 20 entries\n    last_updated :: erlang:timestamp()\n}).\n```","title":"2. K-Buckets (Routing Table) - Kademlia DHT","ref":"kademlia_dht_architecture.html#2-k-buckets-routing-table"},{"type":"extras","doc":"Kademlia defines four core RPC operations:\n\n#### PING\n**Purpose:** Check if a node is alive\n\n**Request:**\n```erlang\n{ping, FromNodeID, Timestamp}\n```\n\n**Response:**\n```erlang\n{pong, ToNodeID, Timestamp}\n```\n\n**Use Case:** Health checking, routing table maintenance\n\n---\n\n#### STORE\n**Purpose:** Store a key-value pair on a node\n\n**Request:**\n```erlang\n{store, Key, Value, TTL}\n```\n\n**Response:**\n```erlang\n{stored, Key, ExpiresAt}\n```\n\n**Macula Mapping:**\n- **Key**: Service name hash (e.g., `sha1(\"game.matchmaking\")`)\n- **Value**: Service endpoint info (realm, node_id, capabilities)\n- **TTL**: Advertisement lifetime (default: 5 minutes)\n\n---\n\n#### FIND_NODE\n**Purpose:** Locate k closest nodes to a target ID\n\n**Request:**\n```erlang\n{find_node, TargetID, K}\n```\n\n**Response:**\n```erlang\n{nodes, [\n    {NodeID1, IP1, Port1, Realm1},\n    {NodeID2, IP2, Port2, Realm2},\n    ...\n]} %% Sorted by XOR distance to TargetID\n```\n\n**Use Case:** Populating routing table, iterative lookups\n\n---\n\n#### FIND_VALUE\n**Purpose:** Retrieve value for a key (service discovery)\n\n**Request:**\n```erlang\n{find_value, Key}\n```\n\n**Response (if found):**\n```erlang\n{value, Key, ServiceInfo}\n```\n\n**Response (if not found):**\n```erlang\n{nodes, [...]}  %% Fallback to FIND_NODE\n```\n\n**Macula Mapping:**\n- **Key**: Service name (e.g., `\"game.matchmaking\"`)\n- **ServiceInfo**: List of providers advertising that service\n\n---","title":"3. DHT Operations - Kademlia DHT","ref":"kademlia_dht_architecture.html#3-dht-operations"},{"type":"extras","doc":"To find a service or node, Macula performs an **iterative FIND_VALUE** lookup:\n\n**Algorithm:**\n1. Start with the ` = 3` closest nodes from local routing table\n2. Send parallel `FIND_VALUE` requests to these nodes\n3. If value found  return immediately\n4. Otherwise, add returned nodes to candidate set\n5. Select next `` closest unqueried nodes\n6. Repeat until:\n   - Value is found, OR\n   - No closer nodes remain, OR\n   - Maximum hops reached (logN)\n\n**Convergence:** Guaranteed to find value in O(log N) hops\n\n**Macula Implementation (conceptual):**\n```erlang\nfind_service(ServiceName, Realm) ->\n    Key = crypto:hash(sha, ServiceName),\n    ClosestNodes = get_closest_nodes(Key, ?KADEMLIA_ALPHA),\n    iterative_lookup(Key, ClosestNodes, #{}, 0).\n\niterative_lookup(Key, [], _Queried, _Hops) ->\n    {error, not_found};\niterative_lookup(Key, Candidates, Queried, Hops) when Hops > 20 ->\n    {error, max_hops_exceeded};\niterative_lookup(Key, Candidates, Queried, Hops) ->\n    %% Query  closest unqueried nodes in parallel\n    Results = query_nodes(Candidates, {find_value, Key}),\n\n    case find_value_in_results(Results) of\n        {ok, Value} ->\n            {ok, Value};\n        not_found ->\n            NewNodes = extract_nodes(Results),\n            NextCandidates = select_closest_unqueried(Key, NewNodes, Queried),\n            iterative_lookup(Key, NextCandidates,\n                           maps:merge(Queried, mark_queried(Candidates)),\n                           Hops + 1)\n    end.\n```\n\n---","title":"4. Iterative Lookup Algorithm - Kademlia DHT","ref":"kademlia_dht_architecture.html#4-iterative-lookup-algorithm"},{"type":"extras","doc":"","title":"Macula-Specific Adaptations - Kademlia DHT","ref":"kademlia_dht_architecture.html#macula-specific-adaptations"},{"type":"extras","doc":"Unlike traditional Kademlia, Macula implements **multi-tenancy via realms**:\n\n- Each realm has its own isolated DHT keyspace\n- Node IDs include realm hash: `sha1(Realm || IP || Port)`\n- Service keys are realm-scoped: `sha1(Realm || ServiceName)`\n- Cross-realm queries are blocked at protocol level\n\n**Example:**\n```erlang\n%% Realm \"macula.arcade\"\nNodeID_A = sha1(\"macula.arcade\" ++ \"192.168.1.10\" ++ \"4433\")\n\n%% Realm \"macula.energy\"\nNodeID_B = sha1(\"macula.energy\" ++ \"192.168.1.10\" ++ \"4433\")\n\n%% Same IP/port, different realms  different DHT partitions\n```","title":"1. Realm-Scoped DHT - Kademlia DHT","ref":"kademlia_dht_architecture.html#1-realm-scoped-dht"},{"type":"extras","doc":"Traditional Kademlia requires **bootstrap nodes** to join the network. Macula handles this differently:\n\n**Gateway Mode:**\n- Gateways act as well-known bootstrap nodes\n- Published at predictable URLs (e.g., `https://gateway.example.com:4433`)\n- Maintain authoritative registry for their realm\n\n**Edge Peer Mode:**\n- Peers connect to gateway via `MACULA_BOOTSTRAP_REGISTRY` env var\n- Gateway returns `` closest nodes to peer's ID\n- Peer populates routing table via `FIND_NODE` requests\n\n**No Hardcoded Bootstrap IPs:** Unlike BitTorrent DHT, Macula uses DNS/HTTPS URLs for gateway discovery, making it firewall-friendly.","title":"2. Gateway Bootstrap Nodes - Kademlia DHT","ref":"kademlia_dht_architecture.html#2-gateway-bootstrap-nodes"},{"type":"extras","doc":"Services are stored in the DHT with a **Time-To-Live (TTL)**:\n\n- Default TTL: **5 minutes**\n- Providers re-advertise every **60 seconds** (heartbeat)\n- Expired entries are removed by `macula_advertisement_manager`\n\n**Rationale:** Short TTL ensures stale services don't linger after node crashes, while frequent heartbeats maintain availability.","title":"3. Service Advertisement TTL - Kademlia DHT","ref":"kademlia_dht_architecture.html#3-service-advertisement-ttl"},{"type":"extras","doc":"Traditional Kademlia uses UDP for RPCs. Macula uses **QUIC (HTTP/3)**:\n\n**Advantages:**\n- Reliable transport (no packet loss issues)\n- Connection multiplexing (multiple RPCs over one connection)\n- TLS 1.3 encryption (secure by default)\n- NAT traversal (QUIC connection migration)\n\n**Message Encoding:**\n```erlang\n%% DHT query wrapped in Macula protocol\n#{\n  type => dht_query,\n  operation => find_value,\n  key => < >,\n  realm => <<\"macula.arcade\">>,\n  from_node_id => < >,\n  timestamp => erlang:system_time(millisecond)\n}\n```\n\n---","title":"4. HTTP/3 Transport Integration - Kademlia DHT","ref":"kademlia_dht_architecture.html#4-http-3-transport-integration"},{"type":"extras","doc":"Macula keeps routing tables fresh through **active probing**:","title":"Routing Table Maintenance - Kademlia DHT","ref":"kademlia_dht_architecture.html#routing-table-maintenance"},{"type":"extras","doc":"- When receiving any message from node N, refresh N's entry in k-bucket\n- Update last-seen timestamp\n- Move N to tail of LRU list (most recently seen)","title":"1. Passive Updates - Kademlia DHT","ref":"kademlia_dht_architecture.html#1-passive-updates"},{"type":"extras","doc":"- Every **60 seconds**, ping least-recently-seen node in each non-empty bucket\n- If ping fails 3 times consecutively, evict node\n- Backfill bucket via `FIND_NODE` request","title":"2. Active Probing - Kademlia DHT","ref":"kademlia_dht_architecture.html#2-active-probing"},{"type":"extras","doc":"- When bucket 0 (closest nodes) exceeds `k` entries, split into two buckets\n- Move nodes to new buckets based on refined distance ranges\n- Only split buckets containing own node ID (hot zone)\n\n**Implementation:**\n```erlang\n%% In macula_routing.erl\n-define(REFRESH_INTERVAL, 60000).  %% 60 seconds\n-define(PING_TIMEOUT, 5000).       %% 5 seconds\n-define(MAX_FAILURES, 3).\n\nrefresh_buckets(State) ->\n    lists:foldl(fun refresh_bucket/2, State, State#state.k_buckets).\n\nrefresh_bucket(Bucket, State) ->\n    case get_least_recent_node(Bucket) of\n        undefined -> State;  %% Empty bucket\n        Node ->\n            case ping_node(Node) of\n                pong -> update_node_timestamp(Node, State);\n                timeout -> handle_ping_failure(Node, State)\n            end\n    end.\n```\n\n---","title":"3. Bucket Splitting - Kademlia DHT","ref":"kademlia_dht_architecture.html#3-bucket-splitting"},{"type":"extras","doc":"| Metric | Value | Notes |\n|--------|-------|-------|\n| **Lookup Time** | O(log N) hops | N = total nodes in mesh |\n| **Routing Table Size** | O(log N) entries | ~160 buckets  20 nodes = 3,200 max |\n| **Network Traffic** | O(log N) messages/lookup |  parallel requests per hop |\n| **Storage** | O(k  log N) | Per node, for advertised services |\n| **Convergence** | < 1 second | Typical for 10,000-node network |\n\n**Example (10,000-node network):**\n- Expected hops: `log(10,000)  13.3`  14 hops max\n- Parallel factor  = 3  ~5 rounds of queries\n- Average lookup time: `5 rounds  100ms RTT = 500ms`\n\n---","title":"Performance Characteristics - Kademlia DHT","ref":"kademlia_dht_architecture.html#performance-characteristics"},{"type":"extras","doc":"| Feature | Kademlia (Macula) | Chord | Pastry |\n|---------|-------------------|-------|--------|\n| **Distance Metric** | XOR (symmetric) | Modular arithmetic | Numeric proximity |\n| **Routing Complexity** | O(log N) | O(log N) | O(log N) |\n| **Lookup Parallelism** | Yes ( = 3) | No (sequential) | Limited |\n| **NAT-Friendly** |  (with HTTP/3) |  |  |\n| **Bootstrap Required** | Optional (gateway) | Yes | Yes |\n| **Self-Organizing** |  |  |  |\n\n---","title":"Comparison to Other DHTs - Kademlia DHT","ref":"kademlia_dht_architecture.html#comparison-to-other-dhts"},{"type":"extras","doc":"","title":"Future Enhancements - Kademlia DHT","ref":"kademlia_dht_architecture.html#future-enhancements"},{"type":"extras","doc":"- Cryptographic node ID generation (prevent Sybil attacks)\n- Require nodes to solve proof-of-work for ID assignment\n- Disjoint routing paths for redundancy","title":"1. S/Kademlia (Secure Kademlia) - Kademlia DHT","ref":"kademlia_dht_architecture.html#1-s-kademlia-secure-kademlia"},{"type":"extras","doc":"- Store service advertisements in distributed database (e.g., CRDT)\n- Survive network partitions with eventual consistency\n- Reduce re-advertisement overhead","title":"2. DHT Persistence - Kademlia DHT","ref":"kademlia_dht_architecture.html#2-dht-persistence"},{"type":"extras","doc":"- Dynamically adjust `k` based on network churn rate\n- Larger `k` for stable networks (less probing overhead)\n- Smaller `k` for high-churn networks (faster convergence)\n\n---","title":"3. Adaptive K-Bucket Sizing - Kademlia DHT","ref":"kademlia_dht_architecture.html#3-adaptive-k-bucket-sizing"},{"type":"extras","doc":"1. **Kademlia Paper:** [Maymounkov & Mazires (2002)](http://www.scs.stanford.edu/~dm/home/papers/kpos.pdf)\n2. **S/Kademlia:** [Baumgart & Mies (2007)](https://ieeexplore.ieee.org/document/4447808)\n3. **BitTorrent DHT (BEP-0005):** [bittorrent.org/beps/bep_0005.html](http://www.bittorrent.org/beps/bep_0005.html)\n4. **QUIC Protocol:** [RFC 9000](https://www.rfc-editor.org/rfc/rfc9000.html)\n5. **Macula Architecture:** `docs/QUIC_TLS_GATEWAY_SETUP.md`\n\n---\n\n**Last Updated:** 2025-11-15\n**Macula Version:** 0.6.0\n**Status:**  Production-ready DHT implementation","title":"References - Kademlia DHT","ref":"kademlia_dht_architecture.html#references"},{"type":"extras","doc":"# Development Guide\n\nThis guide covers setting up a development environment for contributing to Macula.","title":"Development Guide","ref":"development.html"},{"type":"extras","doc":"- **Erlang/OTP 26+** - [Installation Guide](https://www.erlang.org/downloads)\n- **Rebar3** - Erlang build tool ([Installation](https://rebar3.org/docs/getting-started/))\n- **Git** - Version control\n- **Docker** (optional) - For multi-node testing","title":"Prerequisites - Development Guide","ref":"development.html#prerequisites"},{"type":"extras","doc":"```bash\n# Clone the repository\ngit clone https://github.com/macula-io/macula.git\ncd macula\n\n# Fetch dependencies\nrebar3 get-deps\n\n# Compile\nrebar3 compile\n\n# Run tests\nrebar3 eunit\n\n# Start a shell with Macula loaded\nrebar3 shell\n```","title":"Quick Setup - Development Guide","ref":"development.html#quick-setup"},{"type":"extras","doc":"Macula is organized as a single Erlang/OTP library with ~68 modules:\n\n```\nmacula/\n src/                    # Source code (~68 .erl files)\n    macula_quic*.erl   # QUIC transport layer\n    macula_protocol*.erl # Wire protocol encoding/decoding\n    macula_connection*.erl # Connection management\n    macula_gateway*.erl # Gateway components\n    macula_routing*.erl # Kademlia DHT routing\n    macula_pubsub*.erl # Pub/Sub messaging\n    macula_rpc*.erl    # RPC operations\n    macula_*.erl       # Core utilities\n test/                  # EUnit tests\n include/               # Header files (.hrl)\n architecture/          # Architecture documentation\n docs/                  # User-facing documentation\n examples/              # Example applications\n rebar.config          # Build configuration\n```\n\nSee [Project Structure](../architecture/MACULA_PROJECT_STRUCTURE.md) for complete module documentation.","title":"Project Structure - Development Guide","ref":"development.html#project-structure"},{"type":"extras","doc":"","title":"Running Tests - Development Guide","ref":"development.html#running-tests"},{"type":"extras","doc":"```bash\nrebar3 eunit\n```","title":"All Tests - Development Guide","ref":"development.html#all-tests"},{"type":"extras","doc":"```bash\nrebar3 eunit --module=macula_id_tests\nrebar3 eunit --module=macula_gateway_client_manager_tests\n```","title":"Specific Module Tests - Development Guide","ref":"development.html#specific-module-tests"},{"type":"extras","doc":"```bash\nrebar3 do eunit, cover\n```","title":"Test Coverage - Development Guide","ref":"development.html#test-coverage"},{"type":"extras","doc":"```bash\ncd docker\ndocker compose -f docker-compose.multi-node-test.yml build --no-cache\ndocker compose -f docker-compose.multi-node-test.yml up\n```","title":"Multi-Node Integration Tests - Development Guide","ref":"development.html#multi-node-integration-tests"},{"type":"extras","doc":"Macula follows **Idiomatic Erlang** principles:","title":"Code Quality Standards - Development Guide","ref":"development.html#code-quality-standards"},{"type":"extras","doc":"-  **Pattern matching on function heads** - Avoid `if` and `cond`\n-  **Guards instead of case** - Use guards for simple conditions\n-  **Shallow nesting** - Keep nesting to 1-2 levels maximum\n-  **Let it crash** - Don't catch errors unless you can handle them meaningfully\n-  **OTP behaviors** - Use gen_server, gen_statem, supervisor where appropriate","title":"Core Principles - Development Guide","ref":"development.html#core-principles"},{"type":"extras","doc":" **Bad:**\n```erlang\nprocess_message(Msg, State) ->\n    if\n        is_binary(Msg) ->\n            case decode_message(Msg) of\n                {ok, Data} ->\n                    if\n                        Data#data.type == request ->\n                            handle_request(Data, State);\n                        Data#data.type == response ->\n                            handle_response(Data, State)\n                    end\n            end\n    end.\n```\n\n **Good:**\n```erlang\n%% Guard ensures binary input\nprocess_message(Msg, State) when is_binary(Msg) ->\n    case decode_message(Msg) of\n        {ok, Data} -> handle_decoded_message(Data, State);\n        {error, Reason} -> {error, Reason}\n    end;\nprocess_message(_Msg, _State) ->\n    {error, invalid_message}.\n\n%% Pattern match on data type\nhandle_decoded_message(#data{type = request} = Data, State) ->\n    handle_request(Data, State);\nhandle_decoded_message(#data{type = response} = Data, State) ->\n    handle_response(Data, State).\n```\n\nSee [CLAUDE.md](../CLAUDE.md) for complete coding guidelines.","title":"Example: Good vs. Bad - Development Guide","ref":"development.html#example-good-vs-bad"},{"type":"extras","doc":"Macula uses ex_doc for documentation generation:\n\n```bash\nrebar3 ex_doc\n```\n\nGenerated docs appear in `doc/` directory. Open `doc/index.html` in a browser.","title":"Building Documentation - Development Guide","ref":"development.html#building-documentation"},{"type":"extras","doc":"","title":"Docker Development - Development Guide","ref":"development.html#docker-development"},{"type":"extras","doc":"```bash\n# Prune cache and rebuild from scratch\ndocker builder prune -af\ndocker compose -f   build --no-cache\n```\n\n**Why?** Docker build cache can use stale layers even after code changes. Always prune and rebuild when testing code changes.","title":"Clean Build (Always After Code Changes) - Development Guide","ref":"development.html#clean-build-always-after-code-changes"},{"type":"extras","doc":"```bash\ncd docker\ndocker-compose -f docker-compose.multi-node-test.yml up\n```\n\nThis starts:\n- 1 registry node (gateway)\n- 3 provider nodes (advertise services)\n- 1 client node (discovers and calls services)","title":"Multi-Node Test Environment - Development Guide","ref":"development.html#multi-node-test-environment"},{"type":"extras","doc":"Macula implements comprehensive memory leak prevention. See [Memory Management](../architecture/memory_management/README.md) for details.\n\n**Key Mechanisms:**\n- Bounded connection pools (max 1,000 connections, LRU eviction)\n- Client connection limits (max 10,000 clients, configurable)\n- Service TTL/cleanup (5-minute TTL, 60-second cleanup interval)\n- Stream cleanup on disconnect\n- Caller process monitoring for RPC handlers\n\n**Monitoring:**\n```erlang\n%% Check connection pool size\nmacula_gateway_mesh:pool_size(GatewayPid).\n\n%% Check client count\nmacula_gateway_client_manager:client_count(ManagerPid).\n\n%% Check service registry size\nmacula_service_registry:service_count().\n```","title":"Memory Management - Development Guide","ref":"development.html#memory-management"},{"type":"extras","doc":"","title":"Refactoring Status - Development Guide","ref":"development.html#refactoring-status"},{"type":"extras","doc":"The gateway module has been refactored into 6 focused modules with comprehensive tests:\n\n-  `macula_gateway_client_manager.erl` - Client lifecycle (24 tests)\n-  `macula_gateway_pubsub.erl` - Pub/Sub routing (31 tests)\n-  `macula_gateway_rpc.erl` - RPC handler management (20 tests)\n-  `macula_gateway_mesh.erl` - Mesh connection pooling (16 tests)\n-  `macula_gateway_dht.erl` - DHT query forwarding (stateless)\n-  `macula_gateway_rpc_router.erl` - Multi-hop RPC routing (17 tests)\n-  `macula_gateway_sup.erl` - Supervision tree (24 tests)\n\nTotal: 132 tests, all passing.","title":"Gateway Refactoring (COMPLETED - Jan 2025) - Development Guide","ref":"development.html#gateway-refactoring-completed-jan-2025"},{"type":"extras","doc":"`macula_connection.erl` (2,030 LOC god module) is being refactored using TDD.\n\nSee:\n- [God Module Refactoring Plan](../architecture/god_module_refactoring_plan.md) - 9-week TDD plan\n- [Connection Behaviors](../architecture/macula_connection_behaviors.md) - 275+ test scenarios\n- [Refactoring Status](../architecture/god_module_refactoring_status.md) - Current progress\n\n**DO NOT** modify `macula_connection.erl` without reading the refactoring plan first!","title":"Connection Refactoring (IN PROGRESS - Jan 2025) - Development Guide","ref":"development.html#connection-refactoring-in-progress-jan-2025"},{"type":"extras","doc":"1. **Read the documentation**\n   - [README.md](../README.md)\n   - [CONTRIBUTING.md](../CONTRIBUTING.md)\n   - [CLAUDE.md](../CLAUDE.md) - Coding guidelines\n\n2. **Create a feature branch**\n   ```bash\n   git checkout -b feature/your-feature-name\n   ```\n\n3. **Write tests first** (TDD approach preferred)\n   ```bash\n   # Create test file\n   touch test/macula_your_module_tests.erl\n\n   # Write failing tests\n   # Implement functionality\n   # Verify tests pass\n   rebar3 eunit --module=macula_your_module_tests\n   ```\n\n4. **Follow code quality standards**\n   - Pattern matching over conditionals\n   - Guards instead of case where possible\n   - Maximum 1-2 levels of nesting\n   - Comprehensive tests for new functionality\n\n5. **Commit and push**\n   ```bash\n   git add .\n   git commit -m \"Add feature: your feature description\"\n   git push origin feature/your-feature-name\n   ```\n\n6. **Create pull request**\n   - Describe what the PR does\n   - Reference any related issues\n   - Ensure all tests pass\n   - Follow PR template guidelines","title":"Contributing Workflow - Development Guide","ref":"development.html#contributing-workflow"},{"type":"extras","doc":"- **Issues**: [GitHub Issues](https://github.com/macula-io/macula/issues)\n- **Documentation**: [Architecture Docs](../architecture/)\n- **Code Quality**: [CODE_REVIEW_REPORT.md](../CODE_REVIEW_REPORT.md)\n\n---\n\n**[ Back to README](hello_world.html)** | **[Technical Documentation ](macula_http3_mesh_root.html)**","title":"Getting Help - Development Guide","ref":"development.html#getting-help"}],"proglang":"erlang","content_type":"text/markdown","producer":{"name":"ex_doc","version":"0.38.2"}}