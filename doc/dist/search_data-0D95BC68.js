searchData={"items":[{"type":"module","title":"macula_advertisement_manager","doc":"Advertisement manager GenServer - manages DHT service advertisements. Responsibilities: - Advertise services in DHT with periodic re-advertisement - Unadvertise services and cancel timers - Register handlers with local gateway - Manage service advertisement lifecycle - Periodic cleanup of expired local services (every 60s, TTL 300s default) Extracted from macula_connection.erl (Phase 6)","ref":"macula_advertisement_manager.html"},{"type":"function","title":"macula_advertisement_manager.advertise_service/4","doc":"Advertise a service in DHT and local registry","ref":"macula_advertisement_manager.html#advertise_service/4"},{"type":"function","title":"macula_advertisement_manager.get_active_advertisements/1","doc":"Get list of actively advertised services","ref":"macula_advertisement_manager.html#get_active_advertisements/1"},{"type":"function","title":"macula_advertisement_manager.handle_call/3","doc":"","ref":"macula_advertisement_manager.html#handle_call/3"},{"type":"function","title":"macula_advertisement_manager.handle_cast/2","doc":"","ref":"macula_advertisement_manager.html#handle_cast/2"},{"type":"function","title":"macula_advertisement_manager.handle_info/2","doc":"Handle re-advertisement timer","ref":"macula_advertisement_manager.html#handle_info/2"},{"type":"function","title":"macula_advertisement_manager.init/1","doc":"","ref":"macula_advertisement_manager.html#init/1"},{"type":"function","title":"macula_advertisement_manager.start_link/1","doc":"","ref":"macula_advertisement_manager.html#start_link/1"},{"type":"function","title":"macula_advertisement_manager.terminate/2","doc":"","ref":"macula_advertisement_manager.html#terminate/2"},{"type":"function","title":"macula_advertisement_manager.unadvertise_service/2","doc":"Stop advertising a service","ref":"macula_advertisement_manager.html#unadvertise_service/2"},{"type":"module","title":"macula_app","doc":"macula public API","ref":"macula_app.html"},{"type":"function","title":"macula_app.start/2","doc":"","ref":"macula_app.html#start/2"},{"type":"function","title":"macula_app.stop/1","doc":"","ref":"macula_app.html#stop/1"},{"type":"module","title":"macula_bootstrap_health","doc":"Bootstrap Health Monitor - Tracks system health metrics. Monitors: - Service registry size - DHT query rate - System uptime - Memory usage","ref":"macula_bootstrap_health.html"},{"type":"function","title":"macula_bootstrap_health.code_change/3","doc":"","ref":"macula_bootstrap_health.html#code_change/3"},{"type":"function","title":"macula_bootstrap_health.get_health/0","doc":"Get current health status","ref":"macula_bootstrap_health.html#get_health/0"},{"type":"function","title":"macula_bootstrap_health.handle_call/3","doc":"","ref":"macula_bootstrap_health.html#handle_call/3"},{"type":"function","title":"macula_bootstrap_health.handle_cast/2","doc":"","ref":"macula_bootstrap_health.html#handle_cast/2"},{"type":"function","title":"macula_bootstrap_health.handle_info/2","doc":"","ref":"macula_bootstrap_health.html#handle_info/2"},{"type":"function","title":"macula_bootstrap_health.init/1","doc":"","ref":"macula_bootstrap_health.html#init/1"},{"type":"function","title":"macula_bootstrap_health.is_healthy/0","doc":"Check if system is healthy","ref":"macula_bootstrap_health.html#is_healthy/0"},{"type":"function","title":"macula_bootstrap_health.start_link/1","doc":"","ref":"macula_bootstrap_health.html#start_link/1"},{"type":"function","title":"macula_bootstrap_health.terminate/2","doc":"","ref":"macula_bootstrap_health.html#terminate/2"},{"type":"module","title":"macula_bootstrap_registry","doc":"Bootstrap Registry - Thin wrapper around macula_routing_server DHT. Delegates all storage/lookup operations to the DHT routing server. Bootstrap nodes use the DHT's built-in key-value storage for: 1. RPC Services - Advertised RPC endpoints 2. Pub/Sub Topics - Topic subscriptions The DHT routing_server handles storage, TTL, and cleanup internally.","ref":"macula_bootstrap_registry.html"},{"type":"function","title":"macula_bootstrap_registry.code_change/3","doc":"","ref":"macula_bootstrap_registry.html#code_change/3"},{"type":"function","title":"macula_bootstrap_registry.handle_call/3","doc":"","ref":"macula_bootstrap_registry.html#handle_call/3"},{"type":"function","title":"macula_bootstrap_registry.handle_cast/2","doc":"","ref":"macula_bootstrap_registry.html#handle_cast/2"},{"type":"function","title":"macula_bootstrap_registry.handle_info/2","doc":"","ref":"macula_bootstrap_registry.html#handle_info/2"},{"type":"function","title":"macula_bootstrap_registry.init/1","doc":"","ref":"macula_bootstrap_registry.html#init/1"},{"type":"function","title":"macula_bootstrap_registry.lookup/1","doc":"Generic lookup (delegates to DHT)","ref":"macula_bootstrap_registry.html#lookup/1"},{"type":"function","title":"macula_bootstrap_registry.lookup_service/1","doc":"Lookup RPC service by key (delegates to DHT)","ref":"macula_bootstrap_registry.html#lookup_service/1"},{"type":"function","title":"macula_bootstrap_registry.lookup_topic/1","doc":"Lookup subscribers for a topic (delegates to DHT)","ref":"macula_bootstrap_registry.html#lookup_topic/1"},{"type":"function","title":"macula_bootstrap_registry.start_link/1","doc":"","ref":"macula_bootstrap_registry.html#start_link/1"},{"type":"function","title":"macula_bootstrap_registry.store/2","doc":"Generic store (delegates to DHT)","ref":"macula_bootstrap_registry.html#store/2"},{"type":"function","title":"macula_bootstrap_registry.store_service/2","doc":"Store RPC service registration (delegates to DHT)","ref":"macula_bootstrap_registry.html#store_service/2"},{"type":"function","title":"macula_bootstrap_registry.store_topic/2","doc":"Store pub/sub topic subscription (delegates to DHT)","ref":"macula_bootstrap_registry.html#store_topic/2"},{"type":"function","title":"macula_bootstrap_registry.terminate/2","doc":"","ref":"macula_bootstrap_registry.html#terminate/2"},{"type":"module","title":"macula_bootstrap_server","doc":"Bootstrap Server - Main GenServer for bootstrap node operations. Handles: - DHT queries (FIND_NODE, FIND_VALUE, STORE) - Peer registration and discovery - Statistics tracking","ref":"macula_bootstrap_server.html"},{"type":"function","title":"macula_bootstrap_server.code_change/3","doc":"","ref":"macula_bootstrap_server.html#code_change/3"},{"type":"function","title":"macula_bootstrap_server.get_stats/0","doc":"Get bootstrap server statistics","ref":"macula_bootstrap_server.html#get_stats/0"},{"type":"function","title":"macula_bootstrap_server.handle_call/3","doc":"","ref":"macula_bootstrap_server.html#handle_call/3"},{"type":"function","title":"macula_bootstrap_server.handle_cast/2","doc":"","ref":"macula_bootstrap_server.html#handle_cast/2"},{"type":"function","title":"macula_bootstrap_server.handle_dht_query/2","doc":"Handle DHT query from remote peer","ref":"macula_bootstrap_server.html#handle_dht_query/2"},{"type":"function","title":"macula_bootstrap_server.handle_info/2","doc":"","ref":"macula_bootstrap_server.html#handle_info/2"},{"type":"function","title":"macula_bootstrap_server.init/1","doc":"","ref":"macula_bootstrap_server.html#init/1"},{"type":"function","title":"macula_bootstrap_server.start_link/1","doc":"","ref":"macula_bootstrap_server.html#start_link/1"},{"type":"function","title":"macula_bootstrap_server.terminate/2","doc":"","ref":"macula_bootstrap_server.html#terminate/2"},{"type":"module","title":"macula_bootstrap_system","doc":"Macula Bootstrap System - Supervision tree for bootstrap nodes. Bootstrap nodes provide: - DHT bootstrap and peer discovery - Service registry (advertised RPC endpoints) - Health monitoring Bootstrap nodes do NOT: - Relay messages (that's macula_relay_system) - Bridge realms (that's macula_bridge_system)","ref":"macula_bootstrap_system.html"},{"type":"function","title":"macula_bootstrap_system.get_server_pid/0","doc":"Get bootstrap server PID","ref":"macula_bootstrap_system.html#get_server_pid/0"},{"type":"function","title":"macula_bootstrap_system.get_stats/0","doc":"Get bootstrap system statistics","ref":"macula_bootstrap_system.html#get_stats/0"},{"type":"function","title":"macula_bootstrap_system.init/1","doc":"","ref":"macula_bootstrap_system.html#init/1"},{"type":"function","title":"macula_bootstrap_system.start_link/1","doc":"Start bootstrap system supervisor","ref":"macula_bootstrap_system.html#start_link/1"},{"type":"module","title":"macula_cache","doc":"Generic LRU cache implementation. Provides least-recently-used eviction with configurable max size.","ref":"macula_cache.html"},{"type":"type","title":"macula_cache.cache/0","doc":"","ref":"macula_cache.html#t:cache/0"},{"type":"function","title":"macula_cache.clear/1","doc":"Clear all entries.","ref":"macula_cache.html#clear/1"},{"type":"type","title":"macula_cache.entry/0","doc":"","ref":"macula_cache.html#t:entry/0"},{"type":"function","title":"macula_cache.get/2","doc":"Get entry from cache. Returns {ok, Value, UpdatedCache} or not_found. The updated cache has the entry moved to front (LRU).","ref":"macula_cache.html#get/2"},{"type":"type","title":"macula_cache.key/0","doc":"","ref":"macula_cache.html#t:key/0"},{"type":"function","title":"macula_cache.keys/1","doc":"Get all keys in cache (most recent first).","ref":"macula_cache.html#keys/1"},{"type":"function","title":"macula_cache.max_size/1","doc":"Get max size.","ref":"macula_cache.html#max_size/1"},{"type":"function","title":"macula_cache.new/1","doc":"Create new cache with max size.","ref":"macula_cache.html#new/1"},{"type":"function","title":"macula_cache.put/3","doc":"Put entry in cache with current timestamp.","ref":"macula_cache.html#put/3"},{"type":"function","title":"macula_cache.put/4","doc":"Put entry in cache with custom timestamp (for testing).","ref":"macula_cache.html#put/4"},{"type":"function","title":"macula_cache.remove/2","doc":"Remove entry from cache.","ref":"macula_cache.html#remove/2"},{"type":"function","title":"macula_cache.size/1","doc":"Get number of entries.","ref":"macula_cache.html#size/1"},{"type":"type","title":"macula_cache.timestamp/0","doc":"","ref":"macula_cache.html#t:timestamp/0"},{"type":"type","title":"macula_cache.value/0","doc":"","ref":"macula_cache.html#t:value/0"},{"type":"module","title":"macula_client","doc":"Macula SDK - Main API module for HTTP/3 mesh client operations. This module provides the primary interface for applications to connect to Macula mesh networks and perform pub/sub and RPC operations over HTTP/3 (QUIC) transport. Quick Start Connect to a mesh, publish events, subscribe to topics, and make RPC calls. See individual function documentation for detailed examples with code.","ref":"macula_client.html"},{"type":"function","title":"macula_client.advertise/3","doc":"Advertise a service that this client provides. Registers a handler function for the specified procedure and advertises it to the DHT so other clients can discover and call it. The handler function receives a map of arguments and must return  {ok, Result}  or  {error, Reason} . Options ttl  - Advertisement TTL in seconds (default: 300) metadata  - Custom metadata map (default: #{}) Examples <span class=\"w\">  </span><span class=\"c1\">%% Define a handler function</span><span class=\"w\">\n  </span><span class=\"n\">Handler</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">fun</span><span class=\"p\" data-group-id=\"2845003739-1\">(</span><span class=\"p\" data-group-id=\"2845003739-2\">#{</span><span class=\"ss\">user_id</span><span class=\"w\"> </span><span class=\"p\">:=</span><span class=\"w\"> </span><span class=\"n\">UserId</span><span class=\"p\" data-group-id=\"2845003739-2\">}</span><span class=\"p\" data-group-id=\"2845003739-1\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\">\n      </span><span class=\"p\" data-group-id=\"2845003739-3\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"2845003739-4\">#{</span><span class=\"ss\">user_id</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">UserId</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">name</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;Alice&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\" data-group-id=\"2845003739-4\">}</span><span class=\"p\" data-group-id=\"2845003739-3\">}</span><span class=\"w\">\n  </span><span class=\"k\">end</span><span class=\"p\">.</span><span class=\"w\">\n \n  </span><span class=\"c1\">%% Advertise the service</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"2845003739-5\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Ref</span><span class=\"p\" data-group-id=\"2845003739-5\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">advertise</span><span class=\"p\" data-group-id=\"2845003739-6\">(</span><span class=\"w\">\n      </span><span class=\"n\">Client</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;my.app.get_user&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"n\">Handler</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"2845003739-6\">)</span><span class=\"p\">.</span><span class=\"w\">\n \n  </span><span class=\"c1\">%% Other clients can now call:</span><span class=\"w\">\n  </span><span class=\"c1\">%% {ok, User} = macula_client:call(OtherClient, &amp;lt;&amp;lt;&quot;my.app.get_user&quot;&amp;gt;&amp;gt;,</span><span class=\"w\">\n  </span><span class=\"c1\">%%     #{user_id =&gt; &amp;lt;&amp;lt;&quot;user-123&quot;&amp;gt;&amp;gt;}).</span>","ref":"macula_client.html#advertise/3"},{"type":"function","title":"macula_client.advertise/4","doc":"Advertise a service with options.","ref":"macula_client.html#advertise/4"},{"type":"type","title":"macula_client.args/0","doc":"Arguments for RPC calls.","ref":"macula_client.html#t:args/0"},{"type":"function","title":"macula_client.call/3","doc":"Make a synchronous RPC call. Calls a remote procedure and waits for the result. Examples <span class=\"w\">  </span><span class=\"c1\">%% Simple RPC call</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"8702565406-1\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">User</span><span class=\"p\" data-group-id=\"8702565406-1\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">call</span><span class=\"p\" data-group-id=\"8702565406-2\">(</span><span class=\"n\">Client</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;my.app.get_user&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"8702565406-3\">#{</span><span class=\"w\">\n      </span><span class=\"ss\">user_id</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;user-123&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"8702565406-3\">}</span><span class=\"p\" data-group-id=\"8702565406-2\">)</span><span class=\"p\">.</span><span class=\"w\">\n \n  </span><span class=\"c1\">%% With timeout</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"8702565406-4\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Result</span><span class=\"p\" data-group-id=\"8702565406-4\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">call</span><span class=\"p\" data-group-id=\"8702565406-5\">(</span><span class=\"n\">Client</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;my.app.process&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"p\" data-group-id=\"8702565406-6\">#{</span><span class=\"ss\">data</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;large&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\" data-group-id=\"8702565406-6\">}</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"p\" data-group-id=\"8702565406-7\">#{</span><span class=\"ss\">timeout</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">30000</span><span class=\"p\" data-group-id=\"8702565406-7\">}</span><span class=\"p\" data-group-id=\"8702565406-5\">)</span><span class=\"p\">.</span>","ref":"macula_client.html#call/3"},{"type":"function","title":"macula_client.call/4","doc":"Make an RPC call with options.","ref":"macula_client.html#call/4"},{"type":"type","title":"macula_client.client/0","doc":"Reference to a connected Macula mesh client.","ref":"macula_client.html#t:client/0"},{"type":"function","title":"macula_client.connect/2","doc":"Connect to a Macula mesh network. Creates a new HTTP/3 (QUIC) connection to the specified mesh endpoint. Options realm  - Required. Binary realm identifier (e.g.,  &lt;&lt;\"my.app.realm\"&gt;&gt; ) auth  - Optional. Authentication map with  api_key  or other auth methods timeout  - Optional. Connection timeout in milliseconds (default: 5000) node_id  - Optional. 32-byte node ID (generated if not provided) Examples <span class=\"w\">  </span><span class=\"c1\">%% Basic connection</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"9486967891-1\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Client</span><span class=\"p\" data-group-id=\"9486967891-1\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">connect</span><span class=\"p\" data-group-id=\"9486967891-2\">(</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;https://mesh.local:443&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9486967891-3\">#{</span><span class=\"w\">\n      </span><span class=\"ss\">realm</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;my.realm&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"9486967891-3\">}</span><span class=\"p\" data-group-id=\"9486967891-2\">)</span><span class=\"p\">.</span><span class=\"w\">\n \n  </span><span class=\"c1\">%% With API key authentication</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"9486967891-4\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Client</span><span class=\"p\" data-group-id=\"9486967891-4\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">connect</span><span class=\"p\" data-group-id=\"9486967891-5\">(</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;https://mesh.local:443&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9486967891-6\">#{</span><span class=\"w\">\n      </span><span class=\"ss\">realm</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;my.realm&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"ss\">auth</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9486967891-7\">#{</span><span class=\"ss\">api_key</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;secret-key&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\" data-group-id=\"9486967891-7\">}</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"9486967891-6\">}</span><span class=\"p\" data-group-id=\"9486967891-5\">)</span><span class=\"p\">.</span>","ref":"macula_client.html#connect/2"},{"type":"function","title":"macula_client.disconnect/1","doc":"Disconnect from the Macula mesh. Cleanly closes the HTTP/3 connection and cleans up all subscriptions.","ref":"macula_client.html#disconnect/1"},{"type":"function","title":"macula_client.discover_subscribers/2","doc":"Discover subscribers to a topic via DHT query. Queries the DHT for all nodes subscribed to the given topic. Returns a list of subscriber nodes with their node IDs and endpoints. This is used for P2P discovery before sending direct messages.","ref":"macula_client.html#discover_subscribers/2"},{"type":"type","title":"macula_client.event_data/0","doc":"Event payload data. Typically a map that will be JSON-encoded.","ref":"macula_client.html#t:event_data/0"},{"type":"function","title":"macula_client.get_node_id/1","doc":"Get the node ID of this client. Returns the 32-byte node ID assigned to this client.","ref":"macula_client.html#get_node_id/1"},{"type":"type","title":"macula_client.options/0","doc":"Connection or operation options.","ref":"macula_client.html#t:options/0"},{"type":"type","title":"macula_client.procedure/0","doc":"RPC procedure name. Example:  \"my.app.get_user\" .","ref":"macula_client.html#t:procedure/0"},{"type":"function","title":"macula_client.publish/3","doc":"Publish an event to a topic. Publishes data to the specified topic. All subscribers to this topic will receive the event. Topic Design Topics should describe EVENT TYPES, not entity instances: Good:  &lt;&lt;\"my.app.user.registered\"&gt;&gt;  (event type) Bad:  &lt;&lt;\"my.app.user.123.registered\"&gt;&gt;  (entity ID in topic) Entity IDs belong in the event payload, not the topic name. Examples <span class=\"w\">  </span><span class=\"c1\">%% Publish with default options</span><span class=\"w\">\n  </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">publish</span><span class=\"p\" data-group-id=\"3311221617-1\">(</span><span class=\"n\">Client</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;my.app.events&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"3311221617-2\">#{</span><span class=\"w\">\n      </span><span class=\"ss\">type</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;user.registered&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"ss\">user_id</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;user-123&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"ss\">email</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;user@example.com&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"3311221617-2\">}</span><span class=\"p\" data-group-id=\"3311221617-1\">)</span><span class=\"p\">.</span><span class=\"w\">\n \n  </span><span class=\"c1\">%% Publish with options</span><span class=\"w\">\n  </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">publish</span><span class=\"p\" data-group-id=\"3311221617-3\">(</span><span class=\"n\">Client</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;my.app.events&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"3311221617-4\">#{</span><span class=\"w\">\n      </span><span class=\"ss\">data</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;important&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"3311221617-4\">}</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"3311221617-5\">#{</span><span class=\"ss\">acknowledge</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"ss\">true</span><span class=\"p\" data-group-id=\"3311221617-5\">}</span><span class=\"p\" data-group-id=\"3311221617-3\">)</span><span class=\"p\">.</span>","ref":"macula_client.html#publish/3"},{"type":"function","title":"macula_client.publish/4","doc":"Publish an event with options.","ref":"macula_client.html#publish/4"},{"type":"function","title":"macula_client.subscribe/3","doc":"Subscribe to a topic. Subscribes to events on the specified topic. The callback function will be invoked for each event received. Callback Function The callback receives the event data and should return  ok . Examples <span class=\"w\">  </span><span class=\"c1\">%% Simple subscription</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"0533954740-1\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">SubRef</span><span class=\"p\" data-group-id=\"0533954740-1\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">subscribe</span><span class=\"p\" data-group-id=\"0533954740-2\">(</span><span class=\"n\">Client</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;my.app.events&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nf\">fun</span><span class=\"p\" data-group-id=\"0533954740-3\">(</span><span class=\"n\">EventData</span><span class=\"p\" data-group-id=\"0533954740-3\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\">\n          </span><span class=\"nc\">io</span><span class=\"p\">:</span><span class=\"nf\">format</span><span class=\"p\" data-group-id=\"0533954740-4\">(</span><span class=\"s\">&quot;Event: </span><span class=\"si\">~p</span><span class=\"si\">~n</span><span class=\"s\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"0533954740-5\">[</span><span class=\"n\">EventData</span><span class=\"p\" data-group-id=\"0533954740-5\">]</span><span class=\"p\" data-group-id=\"0533954740-4\">)</span><span class=\"p\">,</span><span class=\"w\">\n          </span><span class=\"ss\">ok</span><span class=\"w\">\n      </span><span class=\"k\">end</span><span class=\"p\" data-group-id=\"0533954740-2\">)</span><span class=\"p\">.</span><span class=\"w\">\n \n  </span><span class=\"c1\">%% Unsubscribe later</span><span class=\"w\">\n  </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">unsubscribe</span><span class=\"p\" data-group-id=\"0533954740-6\">(</span><span class=\"n\">Client</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">SubRef</span><span class=\"p\" data-group-id=\"0533954740-6\">)</span><span class=\"p\">.</span>","ref":"macula_client.html#subscribe/3"},{"type":"type","title":"macula_client.subscription_ref/0","doc":"Reference to an active subscription for unsubscribe operations.","ref":"macula_client.html#t:subscription_ref/0"},{"type":"type","title":"macula_client.topic/0","doc":"Topic name for pub/sub operations. Topics should describe event types, not entity IDs. Example:  \"my.app.user.registered\"  (good), not  \"my.app.user.123.registered\"  (bad - ID belongs in payload).","ref":"macula_client.html#t:topic/0"},{"type":"function","title":"macula_client.unadvertise/2","doc":"Stop advertising a service. Removes the local handler and stops advertising to the DHT. Examples <span class=\"w\">  </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_client</span><span class=\"p\">:</span><span class=\"nf\">unadvertise</span><span class=\"p\" data-group-id=\"3022727382-1\">(</span><span class=\"n\">Client</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;my.app.get_user&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\" data-group-id=\"3022727382-1\">)</span><span class=\"p\">.</span>","ref":"macula_client.html#unadvertise/2"},{"type":"function","title":"macula_client.unsubscribe/2","doc":"Unsubscribe from a topic. Removes the subscription identified by the subscription reference.","ref":"macula_client.html#unsubscribe/2"},{"type":"module","title":"macula_connection","doc":"Macula Connection - QUIC Transport Layer (v0.7.0+). This module manages the low-level QUIC connection lifecycle and message transport for mesh participants. Responsibilities: - Establish and maintain QUIC connection - Send messages via QUIC stream - Receive and route incoming messages to handlers - Handle connection errors and reconnection - Message encoding/decoding and buffering Renamed from macula_connection in v0.7.0 for clarity: - macula_connection = QUIC transport (this module - low-level) - macula_peer = mesh participant (high-level API)","ref":"macula_connection.html"},{"type":"function","title":"macula_connection.decode_messages/2","doc":"Decode all complete messages from buffer.","ref":"macula_connection.html#decode_messages/2"},{"type":"function","title":"macula_connection.default_config/0","doc":"","ref":"macula_connection.html#default_config/0"},{"type":"function","title":"macula_connection.get_status/1","doc":"","ref":"macula_connection.html#get_status/1"},{"type":"function","title":"macula_connection.handle_call/3","doc":"","ref":"macula_connection.html#handle_call/3"},{"type":"function","title":"macula_connection.handle_cast/2","doc":"","ref":"macula_connection.html#handle_cast/2"},{"type":"function","title":"macula_connection.handle_info/2","doc":"","ref":"macula_connection.html#handle_info/2"},{"type":"function","title":"macula_connection.init/1","doc":"","ref":"macula_connection.html#init/1"},{"type":"function","title":"macula_connection.send_message/3","doc":"","ref":"macula_connection.html#send_message/3"},{"type":"function","title":"macula_connection.start_keepalive_timer/1","doc":"Start keep-alive timer if enabled in options.","ref":"macula_connection.html#start_keepalive_timer/1"},{"type":"function","title":"macula_connection.start_link/2","doc":"","ref":"macula_connection.html#start_link/2"},{"type":"function","title":"macula_connection.terminate/2","doc":"","ref":"macula_connection.html#terminate/2"},{"type":"module","title":"macula_connection_pool","doc":"Connection pool manager for endpoint connections. Manages a pool of QUIC connections to remote endpoints, providing connection caching and reuse to avoid connection overhead for multi-endpoint RPC operations. Connection pool structure: #{Endpoint => #{connection => Conn, stream => Stream, last_used => Timestamp}}","ref":"macula_connection_pool.html"},{"type":"function","title":"macula_connection_pool.close_all_connections/1","doc":"Close all connections in the pool.","ref":"macula_connection_pool.html#close_all_connections/1"},{"type":"function","title":"macula_connection_pool.create_connection/4","doc":"Create a new connection to an endpoint.","ref":"macula_connection_pool.html#create_connection/4"},{"type":"function","title":"macula_connection_pool.get_or_create_connection/4","doc":"Get or create a connection to an endpoint. Returns {ok, Conn, Stream, UpdatedPool} or {error, Reason, Pool}.","ref":"macula_connection_pool.html#get_or_create_connection/4"},{"type":"module","title":"macula_core_types","doc":"Core type definitions and encoding/decoding for Macula. Provides fundamental types like node IDs, realm IDs, and addresses.","ref":"macula_core_types.html"},{"type":"type","title":"macula_core_types.address/0","doc":"","ref":"macula_core_types.html#t:address/0"},{"type":"function","title":"macula_core_types.decode_address/1","doc":"Decode binary address format to {IP, Port} tuple.","ref":"macula_core_types.html#decode_address/1"},{"type":"function","title":"macula_core_types.encode_address/1","doc":"Encode an IP address and port to binary format. Format: - 1 byte: IP version (4 or 6) - 4 or 16 bytes: IP address - 2 bytes: port (big-endian)","ref":"macula_core_types.html#encode_address/1"},{"type":"type","title":"macula_core_types.ip_address/0","doc":"","ref":"macula_core_types.html#t:ip_address/0"},{"type":"type","title":"macula_core_types.node_id/0","doc":"32-byte unique node identifier","ref":"macula_core_types.html#t:node_id/0"},{"type":"function","title":"macula_core_types.node_id/0","doc":"Generate a unique node ID. Uses cryptographically strong random bytes for uniqueness.","ref":"macula_core_types.html#node_id/0"},{"type":"type","title":"macula_core_types.port_number/0","doc":"","ref":"macula_core_types.html#t:port_number/0"},{"type":"type","title":"macula_core_types.realm_id/0","doc":"32-byte realm identifier","ref":"macula_core_types.html#t:realm_id/0"},{"type":"function","title":"macula_core_types.realm_id/1","doc":"Generate a deterministic realm ID from a realm name. Same name always produces the same ID (uses SHA-256 hash).","ref":"macula_core_types.html#realm_id/1"},{"type":"module","title":"macula_dht_rpc","doc":"DHT RPC client for querying remote nodes. Provides callback functions for macula_routing_dht algorithms.","ref":"macula_dht_rpc.html"},{"type":"function","title":"macula_dht_rpc.make_query_fn/0","doc":"Create a query_fn callback for DHT algorithms.","ref":"macula_dht_rpc.html#make_query_fn/0"},{"type":"function","title":"macula_dht_rpc.make_store_fn/0","doc":"Create a store_fn callback for DHT algorithms.","ref":"macula_dht_rpc.html#make_store_fn/0"},{"type":"function","title":"macula_dht_rpc.query_find_node/2","doc":"Query remote node for closest nodes to target. Returns {ok, [NodeInfo]} or {error, Reason}.","ref":"macula_dht_rpc.html#query_find_node/2"},{"type":"function","title":"macula_dht_rpc.query_find_value/2","doc":"Query remote node for value by key. Returns {value, Value} if found, {nodes, [NodeInfo]} if not found, or {error, Reason}.","ref":"macula_dht_rpc.html#query_find_value/2"},{"type":"function","title":"macula_dht_rpc.query_store/3","doc":"Store key-value pair on remote node. Returns ok or {error, Reason}.","ref":"macula_dht_rpc.html#query_store/3"},{"type":"module","title":"macula_discovery","doc":"Generic DHT-based service discovery. Provides cache-integrated lookup and announcement operations. Used by both pub/sub and RPC discovery layers.","ref":"macula_discovery.html"},{"type":"function","title":"macula_discovery.announce/2","doc":"Announce value to DHT.","ref":"macula_discovery.html#announce/2"},{"type":"function","title":"macula_discovery.filter_by_age/3","doc":"Filter items by age based on last_seen timestamp and TTL. Items must have #{last_seen := integer()} in their structure.","ref":"macula_discovery.html#filter_by_age/3"},{"type":"function","title":"macula_discovery.find/2","doc":"Find values for a key via DHT lookup.","ref":"macula_discovery.html#find/2"},{"type":"function","title":"macula_discovery.find_with_cache/3","doc":"Find values with cache (default TTL: 300 seconds).","ref":"macula_discovery.html#find_with_cache/3"},{"type":"function","title":"macula_discovery.find_with_cache/4","doc":"Find values with cache and custom TTL.","ref":"macula_discovery.html#find_with_cache/4"},{"type":"type","title":"macula_discovery.key/0","doc":"","ref":"macula_discovery.html#t:key/0"},{"type":"type","title":"macula_discovery.lookup_fun/0","doc":"","ref":"macula_discovery.html#t:lookup_fun/0"},{"type":"type","title":"macula_discovery.publish_fun/0","doc":"","ref":"macula_discovery.html#t:publish_fun/0"},{"type":"function","title":"macula_discovery.unannounce/2","doc":"Remove value from DHT.","ref":"macula_discovery.html#unannounce/2"},{"type":"type","title":"macula_discovery.unpublish_fun/0","doc":"","ref":"macula_discovery.html#t:unpublish_fun/0"},{"type":"type","title":"macula_discovery.value/0","doc":"","ref":"macula_discovery.html#t:value/0"},{"type":"module","title":"macula_gateway","doc":"Macula Gateway - HTTP/3 Message Router & Orchestrator Main API module and coordinator for the Macula Gateway. The gateway can be embedded in applications or run standalone as a relay node. Quick Start (Embedded Gateway) <span class=\"w\">   </span><span class=\"c1\">%% Start an embedded gateway</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"5821951959-1\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Gateway</span><span class=\"p\" data-group-id=\"5821951959-1\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_gateway</span><span class=\"p\">:</span><span class=\"nf\">start_link</span><span class=\"p\" data-group-id=\"5821951959-2\">(</span><span class=\"p\" data-group-id=\"5821951959-3\">[</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"5821951959-4\">{</span><span class=\"ss\">port</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">9443</span><span class=\"p\" data-group-id=\"5821951959-4\">}</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"5821951959-5\">{</span><span class=\"ss\">realm</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"5821951959-6\">&lt;&lt;</span><span class=\"s\">&quot;com.example.realm&quot;</span><span class=\"p\" data-group-id=\"5821951959-6\">&gt;&gt;</span><span class=\"p\" data-group-id=\"5821951959-5\">}</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"5821951959-7\">{</span><span class=\"ss\">cert_file</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;cert.pem&quot;</span><span class=\"p\" data-group-id=\"5821951959-7\">}</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"5821951959-8\">{</span><span class=\"ss\">key_file</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;key.pem&quot;</span><span class=\"p\" data-group-id=\"5821951959-8\">}</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"5821951959-3\">]</span><span class=\"p\" data-group-id=\"5821951959-2\">)</span><span class=\"p\">.</span><span class=\"w\">\n  \n   </span><span class=\"c1\">%% Register an RPC handler</span><span class=\"w\">\n   </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_gateway</span><span class=\"p\">:</span><span class=\"nf\">register_handler</span><span class=\"p\" data-group-id=\"5821951959-9\">(</span><span class=\"n\">Gateway</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"5821951959-10\">&lt;&lt;</span><span class=\"s\">&quot;calculator.add&quot;</span><span class=\"p\" data-group-id=\"5821951959-10\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nf\">fun</span><span class=\"p\" data-group-id=\"5821951959-11\">(</span><span class=\"n\">Args</span><span class=\"p\" data-group-id=\"5821951959-11\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\">\n       </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">maps</span><span class=\"p\">:</span><span class=\"nf\">get</span><span class=\"p\" data-group-id=\"5821951959-12\">(</span><span class=\"ss\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Args</span><span class=\"p\" data-group-id=\"5821951959-12\">)</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">maps</span><span class=\"p\">:</span><span class=\"nf\">get</span><span class=\"p\" data-group-id=\"5821951959-13\">(</span><span class=\"ss\">b</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Args</span><span class=\"p\" data-group-id=\"5821951959-13\">)</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"5821951959-14\">#{</span><span class=\"ss\">result</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"p\" data-group-id=\"5821951959-14\">}</span><span class=\"w\">\n   </span><span class=\"k\">end</span><span class=\"p\" data-group-id=\"5821951959-9\">)</span><span class=\"p\">.</span> Quick Start (Standalone Gateway) Configure  sys.config : <span class=\"w\">   </span><span class=\"p\" data-group-id=\"2043571642-1\">[</span><span class=\"w\">\n     </span><span class=\"p\" data-group-id=\"2043571642-2\">{</span><span class=\"ss\">macula</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"2043571642-3\">[</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"2043571642-4\">{</span><span class=\"ss\">gateway_port</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">9443</span><span class=\"p\" data-group-id=\"2043571642-4\">}</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"2043571642-5\">{</span><span class=\"ss\">gateway_realm</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"2043571642-6\">&lt;&lt;</span><span class=\"s\">&quot;com.example.realm&quot;</span><span class=\"p\" data-group-id=\"2043571642-6\">&gt;&gt;</span><span class=\"p\" data-group-id=\"2043571642-5\">}</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"2043571642-7\">{</span><span class=\"ss\">cert_file</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;/path/to/cert.pem&quot;</span><span class=\"p\" data-group-id=\"2043571642-7\">}</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"2043571642-8\">{</span><span class=\"ss\">key_file</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;/path/to/key.pem&quot;</span><span class=\"p\" data-group-id=\"2043571642-8\">}</span><span class=\"w\">\n     </span><span class=\"p\" data-group-id=\"2043571642-3\">]</span><span class=\"p\" data-group-id=\"2043571642-2\">}</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"2043571642-1\">]</span><span class=\"p\">.</span> Start application: <span class=\"w\">   </span><span class=\"nc\">application</span><span class=\"p\">:</span><span class=\"nf\">start</span><span class=\"p\" data-group-id=\"8822768369-1\">(</span><span class=\"ss\">macula</span><span class=\"p\" data-group-id=\"8822768369-1\">)</span><span class=\"p\">.</span> Architecture (Modular Design - Refactored Jan 2025) Gateway (this module): - QUIC Listener Management - Message Decoding & Routing - Supervisor Coordination - API Facade Child Modules (managed via macula_gateway_sup): -  macula_gateway_client_manager : Client lifecycle management -  macula_gateway_pubsub : Pub/Sub message routing with wildcards -  macula_gateway_rpc : RPC handler registration & invocation -  macula_gateway_mesh : Mesh connection pooling Stateless Delegation Modules: -  macula_gateway_dht : DHT query forwarding to routing server -  macula_gateway_rpc_router : Multi-hop RPC routing via DHT Single Responsibility Principle: Each module has one clear purpose and delegates to specialized child modules. Gateway acts as orchestrator, not implementer.","ref":"macula_gateway.html"},{"type":"function","title":"macula_gateway.get_stats/1","doc":"Get gateway statistics.","ref":"macula_gateway.html#get_stats/1"},{"type":"function","title":"macula_gateway.handle_call/3","doc":"","ref":"macula_gateway.html#handle_call/3"},{"type":"function","title":"macula_gateway.handle_cast/2","doc":"Handle rpc_route message forwarded from connection","ref":"macula_gateway.html#handle_cast/2"},{"type":"function","title":"macula_gateway.handle_continue/2","doc":"Wire gateway to siblings after init completes. This avoids initialization deadlock from calling supervisor:which_children/1 during init/1 before supervisor has finished starting all children.","ref":"macula_gateway.html#handle_continue/2"},{"type":"function","title":"macula_gateway.handle_info/2","doc":"","ref":"macula_gateway.html#handle_info/2"},{"type":"function","title":"macula_gateway.init/1","doc":"","ref":"macula_gateway.html#init/1"},{"type":"function","title":"macula_gateway.register_handler/2","doc":"Register a handler for a procedure.","ref":"macula_gateway.html#register_handler/2"},{"type":"function","title":"macula_gateway.start_link/0","doc":"Start the gateway with default options.","ref":"macula_gateway.html#start_link/0"},{"type":"function","title":"macula_gateway.start_link/1","doc":"Start the gateway with custom options. Options: {port, Port} - Listen port (default: 9443) {realm, Realm} - Default realm (default: \"macula.default\")","ref":"macula_gateway.html#start_link/1"},{"type":"function","title":"macula_gateway.stop/1","doc":"Stop the gateway.","ref":"macula_gateway.html#stop/1"},{"type":"function","title":"macula_gateway.terminate/2","doc":"","ref":"macula_gateway.html#terminate/2"},{"type":"function","title":"macula_gateway.unregister_handler/1","doc":"Unregister a handler for a procedure.","ref":"macula_gateway.html#unregister_handler/1"},{"type":"module","title":"macula_gateway_clients","doc":"Clients Worker GenServer - tracks connected clients. Responsibilities: - Track connected clients with metadata (BOUNDED POOL) - Enforce max_clients limit with backpressure - Monitor client processes for automatic cleanup - Store bidirectional streams for client communication - Provide client query APIs Pattern: Bounded client pool with backpressure - Tracks clients with max_clients limit (default: 10,000) - Rejects new clients when pool is full (backpressure) - Allows updates to existing clients even when pool is full Configuration: - max_clients: Maximum concurrent clients (default: 10,000) Extracted from macula_gateway.erl (Phase 2) Renamed from macula_gateway_client_manager (Phase 2 QUIC refactoring)","ref":"macula_gateway_clients.html"},{"type":"function","title":"macula_gateway_clients.client_connected/3","doc":"Register a connected client with metadata. Monitors the client process for automatic cleanup on death.","ref":"macula_gateway_clients.html#client_connected/3"},{"type":"function","title":"macula_gateway_clients.client_disconnected/2","doc":"Unregister a disconnected client.","ref":"macula_gateway_clients.html#client_disconnected/2"},{"type":"type","title":"macula_gateway_clients.client_info/0","doc":"","ref":"macula_gateway_clients.html#t:client_info/0"},{"type":"function","title":"macula_gateway_clients.get_all_clients/1","doc":"Get all connected clients.","ref":"macula_gateway_clients.html#get_all_clients/1"},{"type":"function","title":"macula_gateway_clients.get_all_node_ids/1","doc":"Get all node IDs with stored client streams (for debugging).","ref":"macula_gateway_clients.html#get_all_node_ids/1"},{"type":"function","title":"macula_gateway_clients.get_client_info/2","doc":"Get information about a specific client.","ref":"macula_gateway_clients.html#get_client_info/2"},{"type":"function","title":"macula_gateway_clients.get_client_stream/2","doc":"Get the stored stream for a client node.","ref":"macula_gateway_clients.html#get_client_stream/2"},{"type":"function","title":"macula_gateway_clients.get_stream_by_endpoint/2","doc":"Get the stream PID for a given endpoint URL. Used for routing pub/sub messages to remote subscribers.","ref":"macula_gateway_clients.html#get_stream_by_endpoint/2"},{"type":"function","title":"macula_gateway_clients.handle_call/3","doc":"","ref":"macula_gateway_clients.html#handle_call/3"},{"type":"function","title":"macula_gateway_clients.handle_cast/2","doc":"","ref":"macula_gateway_clients.html#handle_cast/2"},{"type":"function","title":"macula_gateway_clients.handle_info/2","doc":"Handle client process death - automatic cleanup.","ref":"macula_gateway_clients.html#handle_info/2"},{"type":"function","title":"macula_gateway_clients.init/1","doc":"","ref":"macula_gateway_clients.html#init/1"},{"type":"function","title":"macula_gateway_clients.is_client_alive/2","doc":"Check if a client is alive (process still running).","ref":"macula_gateway_clients.html#is_client_alive/2"},{"type":"function","title":"macula_gateway_clients.start_link/1","doc":"Start the client manager with options.","ref":"macula_gateway_clients.html#start_link/1"},{"type":"function","title":"macula_gateway_clients.stop/1","doc":"Stop the client manager.","ref":"macula_gateway_clients.html#stop/1"},{"type":"function","title":"macula_gateway_clients.store_client_stream/3","doc":"Store a bidirectional stream for a client node (legacy 3-arg version).","ref":"macula_gateway_clients.html#store_client_stream/3"},{"type":"function","title":"macula_gateway_clients.terminate/2","doc":"","ref":"macula_gateway_clients.html#terminate/2"},{"type":"module","title":"macula_gateway_dht","doc":"DHT Query Handler Module - handles DHT message forwarding to routing server. Responsibilities: - Forward DHT STORE messages to routing server - Forward DHT FIND_VALUE messages to routing server, send encoded replies - Forward DHT FIND_NODE messages to routing server, send encoded replies - Handle DHT queries from process messages - Encode replies using protocol encoder - Handle errors gracefully Pattern: Stateless delegation module - No GenServer (no state to manage) - Pure functions forwarding to routing server - Consistent error handling ({ok, Result} | {error, Reason}) Extracted from macula_gateway.erl (Phase 10)","ref":"macula_gateway_dht.html"},{"type":"function","title":"macula_gateway_dht.handle_find_node/2","doc":"Handle DHT FIND_NODE message. Forwards to routing server and sends encoded reply over stream. Crashes on routing server or encoding failures - exposes DHT/protocol bugs.","ref":"macula_gateway_dht.html#handle_find_node/2"},{"type":"function","title":"macula_gateway_dht.handle_find_value/2","doc":"Handle DHT FIND_VALUE message. Forwards to routing server and sends encoded reply over stream. Crashes on routing server or encoding failures - exposes DHT/protocol bugs.","ref":"macula_gateway_dht.html#handle_find_value/2"},{"type":"function","title":"macula_gateway_dht.handle_query/3","doc":"Handle DHT query from process message. Decodes query, forwards to routing server, encodes reply, sends to requesting process. Crashes on decode or routing failures - exposes protocol/DHT bugs.","ref":"macula_gateway_dht.html#handle_query/3"},{"type":"function","title":"macula_gateway_dht.handle_store/2","doc":"Handle DHT STORE message. Forwards to routing server (no reply sent back). Crashes on routing server failures - this exposes DHT issues immediately.","ref":"macula_gateway_dht.html#handle_store/2"},{"type":"function","title":"macula_gateway_dht.lookup_value/1","doc":"Look up a value from the DHT by key. Synchronous lookup from local DHT storage. Returns list of subscribers for the given key.","ref":"macula_gateway_dht.html#lookup_value/1"},{"type":"function","title":"macula_gateway_dht.query_peer/3","doc":"Query remote peer and wait for response. Used for FIND_NODE and FIND_VALUE operations.","ref":"macula_gateway_dht.html#query_peer/3"},{"type":"function","title":"macula_gateway_dht.send_to_peer/3","doc":"Send DHT message to remote peer (fire-and-forget). Used for STORE operations that don't need a response.","ref":"macula_gateway_dht.html#send_to_peer/3"},{"type":"module","title":"macula_gateway_diagnostics","doc":"Macula Gateway Diagnostics Service Provides simple diagnostic procedures that clients can call to verify connectivity and test the gateway's RPC functionality. Available procedures: - com.macula.diagnostics.hello - Returns a friendly greeting with gateway info - com.macula.diagnostics.echo - Echoes back the arguments sent by client - com.macula.diagnostics.info - Returns detailed gateway information Usage: The diagnostics service automatically registers when the gateway starts. Clients can call these procedures using the Macula SDK: Elixir: {:ok, result} = MaculaSdk.Client.call(client, \"com.macula.diagnostics.hello\", %{}) Result: %{ \"message\" => \"Hello from Macula Gateway!\", \"gateway\" => \"macula@127.0.0.1\", \"realm\" => \"com.example.realm\", \"uptime_seconds\" => 42, \"timestamp\" => 1699612800 }","ref":"macula_gateway_diagnostics.html"},{"type":"function","title":"macula_gateway_diagnostics.handle_call/3","doc":"","ref":"macula_gateway_diagnostics.html#handle_call/3"},{"type":"function","title":"macula_gateway_diagnostics.handle_cast/2","doc":"","ref":"macula_gateway_diagnostics.html#handle_cast/2"},{"type":"function","title":"macula_gateway_diagnostics.handle_info/2","doc":"","ref":"macula_gateway_diagnostics.html#handle_info/2"},{"type":"function","title":"macula_gateway_diagnostics.init/1","doc":"","ref":"macula_gateway_diagnostics.html#init/1"},{"type":"function","title":"macula_gateway_diagnostics.register_procedures/1","doc":"Register diagnostic procedures with the gateway","ref":"macula_gateway_diagnostics.html#register_procedures/1"},{"type":"function","title":"macula_gateway_diagnostics.start_link/1","doc":"Start the diagnostics service","ref":"macula_gateway_diagnostics.html#start_link/1"},{"type":"function","title":"macula_gateway_diagnostics.terminate/2","doc":"","ref":"macula_gateway_diagnostics.html#terminate/2"},{"type":"module","title":"macula_gateway_health","doc":"Macula Gateway Health Check Server Provides HTTP health endpoints for Kubernetes liveness and readiness probes. Runs on a separate port (8080) from the main QUIC gateway (9443). Endpoints: GET /health - Overall health status GET /ready - Readiness check (can accept traffic) GET /live - Liveness check (process is alive) GET /metrics - Basic metrics (optional)","ref":"macula_gateway_health.html"},{"type":"function","title":"macula_gateway_health.handle_call/3","doc":"","ref":"macula_gateway_health.html#handle_call/3"},{"type":"function","title":"macula_gateway_health.handle_cast/2","doc":"","ref":"macula_gateway_health.html#handle_cast/2"},{"type":"function","title":"macula_gateway_health.handle_info/2","doc":"","ref":"macula_gateway_health.html#handle_info/2"},{"type":"function","title":"macula_gateway_health.init/1","doc":"","ref":"macula_gateway_health.html#init/1"},{"type":"function","title":"macula_gateway_health.is_healthy/0","doc":"Check if the gateway is healthy.","ref":"macula_gateway_health.html#is_healthy/0"},{"type":"function","title":"macula_gateway_health.set_ready/1","doc":"Set the readiness state.","ref":"macula_gateway_health.html#set_ready/1"},{"type":"function","title":"macula_gateway_health.start_link/1","doc":"Start the health check server.","ref":"macula_gateway_health.html#start_link/1"},{"type":"function","title":"macula_gateway_health.stop/0","doc":"Stop the health check server.","ref":"macula_gateway_health.html#stop/0"},{"type":"function","title":"macula_gateway_health.terminate/2","doc":"","ref":"macula_gateway_health.html#terminate/2"},{"type":"module","title":"macula_gateway_mesh","doc":"Mesh Connection Manager GenServer - manages peer-to-peer QUIC connections. Responsibilities: - Pool QUIC connections to remote peers by node_id (BOUNDED POOL) - Enforce max_connections limit with LRU eviction - Check connection liveness before reuse - Open new streams on pooled connections - Monitor connection processes for automatic cleanup - Cache connection metadata with timestamps Pattern: Bounded connection pooling with LRU eviction - Cache connections by node_id (max: max_mesh_connections, default 1000) - Evict least recently used when pool is full - Verify liveness before reuse (open new stream) - Remove dead connections and recreate on demand Configuration: - max_mesh_connections: Maximum pooled connections (default: 1000) Extracted from macula_gateway.erl (Phase 9)","ref":"macula_gateway_mesh.html"},{"type":"type","title":"macula_gateway_mesh.connection_info/0","doc":"","ref":"macula_gateway_mesh.html#t:connection_info/0"},{"type":"function","title":"macula_gateway_mesh.get_connection_info/2","doc":"Get connection metadata for a node.","ref":"macula_gateway_mesh.html#get_connection_info/2"},{"type":"function","title":"macula_gateway_mesh.get_or_create_connection/3","doc":"Get existing connection or create new one. Returns opened stream ready for use.","ref":"macula_gateway_mesh.html#get_or_create_connection/3"},{"type":"function","title":"macula_gateway_mesh.handle_call/3","doc":"","ref":"macula_gateway_mesh.html#handle_call/3"},{"type":"function","title":"macula_gateway_mesh.handle_cast/2","doc":"","ref":"macula_gateway_mesh.html#handle_cast/2"},{"type":"function","title":"macula_gateway_mesh.handle_info/2","doc":"","ref":"macula_gateway_mesh.html#handle_info/2"},{"type":"function","title":"macula_gateway_mesh.init/1","doc":"","ref":"macula_gateway_mesh.html#init/1"},{"type":"function","title":"macula_gateway_mesh.list_connections/1","doc":"List all cached connections.","ref":"macula_gateway_mesh.html#list_connections/1"},{"type":"function","title":"macula_gateway_mesh.remove_connection/2","doc":"Explicitly remove connection from cache.","ref":"macula_gateway_mesh.html#remove_connection/2"},{"type":"function","title":"macula_gateway_mesh.start_link/1","doc":"Start the mesh connection manager with options. Options: - cert_file: Path to TLS certificate - key_file: Path to TLS private key","ref":"macula_gateway_mesh.html#start_link/1"},{"type":"function","title":"macula_gateway_mesh.stop/1","doc":"Stop the mesh connection manager.","ref":"macula_gateway_mesh.html#stop/1"},{"type":"function","title":"macula_gateway_mesh.terminate/2","doc":"","ref":"macula_gateway_mesh.html#terminate/2"},{"type":"module","title":"macula_gateway_pubsub","doc":"Pub/Sub Handler GenServer - manages topic subscriptions and message routing. Responsibilities: - Subscribe/unsubscribe streams to topics - Route published messages to matching subscribers - Support wildcard topics (* single-level, ** multi-level) - Track bidirectional mapping (topic  stream) - Monitor stream processes for automatic cleanup Extracted from macula_gateway.erl (Phase 3)","ref":"macula_gateway_pubsub.html"},{"type":"function","title":"macula_gateway_pubsub.get_stream_topics/2","doc":"Get all topics a stream is subscribed to.","ref":"macula_gateway_pubsub.html#get_stream_topics/2"},{"type":"function","title":"macula_gateway_pubsub.get_subscribers/2","doc":"Get all subscribers for a topic (exact and wildcard matches).","ref":"macula_gateway_pubsub.html#get_subscribers/2"},{"type":"function","title":"macula_gateway_pubsub.handle_call/3","doc":"","ref":"macula_gateway_pubsub.html#handle_call/3"},{"type":"function","title":"macula_gateway_pubsub.handle_cast/2","doc":"","ref":"macula_gateway_pubsub.html#handle_cast/2"},{"type":"function","title":"macula_gateway_pubsub.handle_info/2","doc":"Handle stream process death - automatic cleanup.","ref":"macula_gateway_pubsub.html#handle_info/2"},{"type":"function","title":"macula_gateway_pubsub.init/1","doc":"","ref":"macula_gateway_pubsub.html#init/1"},{"type":"function","title":"macula_gateway_pubsub.publish/3","doc":"Publish a message to a topic (routes to matching subscribers).","ref":"macula_gateway_pubsub.html#publish/3"},{"type":"function","title":"macula_gateway_pubsub.start_link/1","doc":"Start the pub/sub handler with options.","ref":"macula_gateway_pubsub.html#start_link/1"},{"type":"function","title":"macula_gateway_pubsub.stop/1","doc":"Stop the pub/sub handler.","ref":"macula_gateway_pubsub.html#stop/1"},{"type":"function","title":"macula_gateway_pubsub.subscribe/3","doc":"Subscribe a stream to a topic (supports wildcards).","ref":"macula_gateway_pubsub.html#subscribe/3"},{"type":"function","title":"macula_gateway_pubsub.terminate/2","doc":"","ref":"macula_gateway_pubsub.html#terminate/2"},{"type":"function","title":"macula_gateway_pubsub.unsubscribe/3","doc":"Unsubscribe a stream from a topic.","ref":"macula_gateway_pubsub.html#unsubscribe/3"},{"type":"module","title":"macula_gateway_pubsub_router","doc":"Macula Gateway Pub/Sub Router - DHT-Routed Message Distribution Handles distribution of pub/sub messages to both local and remote subscribers using multi-hop Kademlia DHT routing (v0.7.8+). Responsibilities: - Deliver messages to local subscribers via QUIC streams - Query DHT for remote subscribers - Route messages via DHT multi-hop (pubsub_route protocol) - Wrap PUBLISH messages in pubsub_route envelopes Extracted from macula_gateway.erl (v0.7.9) for better separation of concerns.","ref":"macula_gateway_pubsub_router.html"},{"type":"function","title":"macula_gateway_pubsub_router.distribute/5","doc":"Distribute pub/sub message to both local and remote subscribers. Uses DHT routing for remote subscribers (multi-hop Kademlia). For connected clients, uses existing bidirectional streams instead of mesh connections.","ref":"macula_gateway_pubsub_router.html#distribute/5"},{"type":"module","title":"macula_gateway_quic_server","doc":"QUIC Transport Layer Gen_Server Handles all QUIC transport operations for the gateway: - Owns QUIC listener - Receives {quic, ...} events - Decodes protocol messages - Routes messages to gateway for business logic This separation follows proper OTP design: - One process, one responsibility (transport vs routing) - Clean fault isolation (QUIC crashes don't crash gateway) - Proper supervision (supervisor can restart independently) - Testability (can test transport in isolation)","ref":"macula_gateway_quic_server.html"},{"type":"function","title":"macula_gateway_quic_server.handle_call/3","doc":"Handle synchronous calls. Set gateway PID for message routing","ref":"macula_gateway_quic_server.html#handle_call/3"},{"type":"function","title":"macula_gateway_quic_server.handle_cast/2","doc":"Handle asynchronous casts.","ref":"macula_gateway_quic_server.html#handle_cast/2"},{"type":"function","title":"macula_gateway_quic_server.handle_info/2","doc":"Handle QUIC event: new_stream (stream created by peer).","ref":"macula_gateway_quic_server.html#handle_info/2"},{"type":"function","title":"macula_gateway_quic_server.init/1","doc":"Initialize the QUIC server and start QUIC listener.","ref":"macula_gateway_quic_server.html#init/1"},{"type":"function","title":"macula_gateway_quic_server.set_gateway/2","doc":"Set the gateway PID for message routing. Called by supervisor after both quic_server and gateway have started.","ref":"macula_gateway_quic_server.html#set_gateway/2"},{"type":"function","title":"macula_gateway_quic_server.start_link/1","doc":"Start the QUIC server gen_server.","ref":"macula_gateway_quic_server.html#start_link/1"},{"type":"function","title":"macula_gateway_quic_server.terminate/2","doc":"Cleanup on termination.","ref":"macula_gateway_quic_server.html#terminate/2"},{"type":"module","title":"macula_gateway_rpc","doc":"RPC Handler GenServer - manages RPC handler registration and call routing. Responsibilities: - Register/unregister RPC handlers for procedures - Route RPC calls to registered handlers - Handle call/response matching - Monitor handler processes for automatic cleanup Extracted from macula_gateway.erl (Phase 4)","ref":"macula_gateway_rpc.html"},{"type":"function","title":"macula_gateway_rpc.call/4","doc":"Make an RPC call to a procedure.","ref":"macula_gateway_rpc.html#call/4"},{"type":"function","title":"macula_gateway_rpc.get_handler/2","doc":"Get the handler for a procedure.","ref":"macula_gateway_rpc.html#get_handler/2"},{"type":"function","title":"macula_gateway_rpc.handle_call/3","doc":"","ref":"macula_gateway_rpc.html#handle_call/3"},{"type":"function","title":"macula_gateway_rpc.handle_cast/2","doc":"","ref":"macula_gateway_rpc.html#handle_cast/2"},{"type":"function","title":"macula_gateway_rpc.handle_info/2","doc":"Handle handler process death - automatic cleanup.","ref":"macula_gateway_rpc.html#handle_info/2"},{"type":"function","title":"macula_gateway_rpc.init/1","doc":"","ref":"macula_gateway_rpc.html#init/1"},{"type":"function","title":"macula_gateway_rpc.list_handlers/1","doc":"List all registered handlers.","ref":"macula_gateway_rpc.html#list_handlers/1"},{"type":"function","title":"macula_gateway_rpc.register_handler/3","doc":"Register a handler for an RPC procedure.","ref":"macula_gateway_rpc.html#register_handler/3"},{"type":"function","title":"macula_gateway_rpc.start_link/1","doc":"Start the RPC handler with options.","ref":"macula_gateway_rpc.html#start_link/1"},{"type":"function","title":"macula_gateway_rpc.stop/1","doc":"Stop the RPC handler.","ref":"macula_gateway_rpc.html#stop/1"},{"type":"function","title":"macula_gateway_rpc.terminate/2","doc":"","ref":"macula_gateway_rpc.html#terminate/2"},{"type":"function","title":"macula_gateway_rpc.unregister_handler/2","doc":"Unregister a handler for an RPC procedure.","ref":"macula_gateway_rpc.html#unregister_handler/2"},{"type":"module","title":"macula_gateway_rpc_router","doc":"RPC Router Module - handles routed RPC messages (CALL/REPLY). Responsibilities: - Process routed CALL messages delivered locally - Process routed REPLY messages delivered locally - Send REPLY back via routing path - Forward rpc_route messages to next hop - Coordinate between RPC handler, mesh, and routing modules Pattern: Stateless delegation module - No GenServer (no state to manage) - Pure functions coordinating between modules - Consistent error handling ({ok, Result} | {error, Reason}) Extracted from macula_gateway.erl (Phase 11)","ref":"macula_gateway_rpc_router.html"},{"type":"function","title":"macula_gateway_rpc_router.forward_rpc_route/3","doc":"Forward rpc_route message to next hop. Gets mesh connection and sends encoded message. Crashes on connection/encoding failures - exposes mesh/protocol issues.","ref":"macula_gateway_rpc_router.html#forward_rpc_route/3"},{"type":"function","title":"macula_gateway_rpc_router.handle_routed_call/5","doc":"Handle routed CALL message delivered locally. Looks up RPC handler, invokes it, sends reply via routing path.","ref":"macula_gateway_rpc_router.html#handle_routed_call/5"},{"type":"function","title":"macula_gateway_rpc_router.handle_routed_reply/4","doc":"Handle routed REPLY message delivered locally. Routes to connection via gproc (local node) or to client stream (remote client).","ref":"macula_gateway_rpc_router.html#handle_routed_reply/4"},{"type":"function","title":"macula_gateway_rpc_router.send_reply_via_routing/4","doc":"Send REPLY back via routing path. Wraps reply in rpc_route envelope and routes to destination. Crashes on routing failures - exposes mesh/routing issues immediately.","ref":"macula_gateway_rpc_router.html#send_reply_via_routing/4"},{"type":"module","title":"macula_gateway_system","doc":"Gateway Root Supervisor - top-level supervisor for gateway subsystem. Supervision Strategy: - rest_for_one: Dependency-based restart ordering - Child order reflects dependencies: 1. quic_server (owns QUIC listener, no dependencies) 2. gateway (depends on quic_server PID) 3. workers_sup (depends on gateway PID) Fault Isolation: - quic_server crash  restart quic_server, gateway, workers_sup - gateway crash  restart gateway, workers_sup (quic_server continues) - workers_sup crash  restart workers_sup only (quic_server and gateway continue) Architecture: <span class=\"w\">   </span><span class=\"nf\">macula_gateway_system</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"4490060767-1\">(</span><span class=\"ss\">this</span><span class=\"w\"> </span><span class=\"ss\">module</span><span class=\"p\" data-group-id=\"4490060767-1\">)</span><span class=\"w\">\n   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_health</span><span class=\"w\">        </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Health</span><span class=\"w\"> </span><span class=\"ss\">check</span><span class=\"w\"> </span><span class=\"n\">HTTP</span><span class=\"w\"> </span><span class=\"ss\">server</span><span class=\"w\">\n   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_diagnostics</span><span class=\"w\">   </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Diagnostics</span><span class=\"w\"> </span><span class=\"ss\">service</span><span class=\"w\">\n   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_quic_server</span><span class=\"w\">   </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">QUIC</span><span class=\"w\"> </span><span class=\"ss\">transport</span><span class=\"w\"> </span><span class=\"ss\">layer</span><span class=\"w\">\n   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway</span><span class=\"w\">               </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Message</span><span class=\"w\"> </span><span class=\"ss\">routing</span><span class=\"w\"> </span><span class=\"ss\">coordinator</span><span class=\"w\">\n   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_workers_sup</span><span class=\"w\">   </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Business</span><span class=\"w\"> </span><span class=\"ss\">logic</span><span class=\"w\"> </span><span class=\"ss\">workers</span><span class=\"w\">\n       </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_clients</span><span class=\"w\">   </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Client</span><span class=\"w\"> </span><span class=\"ss\">tracking</span><span class=\"w\">\n       </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_pubsub</span><span class=\"w\">    </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Pub</span><span class=\"o\">/</span><span class=\"n\">Sub</span><span class=\"w\"> </span><span class=\"ss\">routing</span><span class=\"w\">\n       </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_rpc</span><span class=\"w\">       </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">RPC</span><span class=\"w\"> </span><span class=\"ss\">handling</span><span class=\"w\">\n       </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_mesh</span><span class=\"w\">      </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Mesh</span><span class=\"w\"> </span><span class=\"ss\">connections</span><span class=\"w\">\n   </span> Circular Dependency Resolution: - quic_server starts first (without gateway PID) - gateway starts second (receives quic_server PID) - Supervisor calls quic_server:set_gateway/1 to complete link - workers_sup starts last (receives gateway PID) Created during Phase 2 QUIC refactoring to enable proper OTP supervision.","ref":"macula_gateway_system.html"},{"type":"function","title":"macula_gateway_system.init/1","doc":"","ref":"macula_gateway_system.html#init/1"},{"type":"function","title":"macula_gateway_system.start_link/1","doc":"Start the root gateway supervisor with configuration.","ref":"macula_gateway_system.html#start_link/1"},{"type":"module","title":"macula_gateway_workers_sup","doc":"Gateway Workers Supervisor - supervises gateway worker processes. Supervision Strategy: - rest_for_one: If child N crashes, restart N and all children after N - Rationale: Only clients is foundational; pubsub/rpc/mesh depend on it but are independent of each other. This strategy provides fault isolation while maintaining consistency when clients restarts. Children (in dependency order): - macula_gateway_clients: Client tracking (foundational) - macula_gateway_pubsub: Pub/Sub message routing (depends on clients) - macula_gateway_rpc: RPC handler registration and routing (depends on clients) - macula_gateway_mesh: Mesh connection pooling and management (independent) Fault Isolation Examples: - mesh crash  only mesh restarts (0 clients disconnected) - rpc crash  rpc + mesh restart (0 clients disconnected) - pubsub crash  pubsub + rpc + mesh restart (0 clients disconnected) - clients crash  all restart (unavoidable - foundational) Extracted from macula_gateway.erl (Phase 6, 9) Renamed from macula_gateway_sup (Phase 2 QUIC refactoring)","ref":"macula_gateway_workers_sup.html"},{"type":"function","title":"macula_gateway_workers_sup.get_clients/1","doc":"Get the clients worker child PID.","ref":"macula_gateway_workers_sup.html#get_clients/1"},{"type":"function","title":"macula_gateway_workers_sup.get_mesh/1","doc":"Get the mesh connection manager child PID.","ref":"macula_gateway_workers_sup.html#get_mesh/1"},{"type":"function","title":"macula_gateway_workers_sup.get_pubsub/1","doc":"Get the pubsub handler child PID.","ref":"macula_gateway_workers_sup.html#get_pubsub/1"},{"type":"function","title":"macula_gateway_workers_sup.get_rpc/1","doc":"Get the RPC handler child PID.","ref":"macula_gateway_workers_sup.html#get_rpc/1"},{"type":"function","title":"macula_gateway_workers_sup.init/1","doc":"","ref":"macula_gateway_workers_sup.html#init/1"},{"type":"function","title":"macula_gateway_workers_sup.start_link/1","doc":"Start the gateway supervisor with configuration.","ref":"macula_gateway_workers_sup.html#start_link/1"},{"type":"module","title":"macula_id","doc":"ID generation utilities for Macula. Provides functions for generating various types of IDs.","ref":"macula_id.html"},{"type":"function","title":"macula_id.from_hex/1","doc":"Convert hex string to binary. Crashes on invalid hex - exposes bugs in validation logic.","ref":"macula_id.html#from_hex/1"},{"type":"function","title":"macula_id.from_uuid/1","doc":"Convert UUID string to 16-byte binary ID. Crashes on invalid UUID format - exposes bugs in validation logic.","ref":"macula_id.html#from_uuid/1"},{"type":"function","title":"macula_id.hash_id/1","doc":"Generate deterministic 256-bit hash ID from data.","ref":"macula_id.html#hash_id/1"},{"type":"function","title":"macula_id.message_id/0","doc":"Generate 128-bit (16-byte) random message ID.","ref":"macula_id.html#message_id/0"},{"type":"function","title":"macula_id.node_id/0","doc":"Generate 256-bit (32-byte) random node ID.","ref":"macula_id.html#node_id/0"},{"type":"function","title":"macula_id.session_id/0","doc":"Generate 128-bit (16-byte) random session ID.","ref":"macula_id.html#session_id/0"},{"type":"function","title":"macula_id.to_hex/1","doc":"Convert binary to lowercase hex string.","ref":"macula_id.html#to_hex/1"},{"type":"function","title":"macula_id.to_uuid/1","doc":"Convert 16-byte or 32-byte binary ID to UUID string format. For 16-byte: 8-4-4-4-12 (e.g., \"12345678-90ab-cdef-1234-567890abcdef\") For 32-byte: Uses first 16 bytes","ref":"macula_id.html#to_uuid/1"},{"type":"module","title":"macula_membership_detector","doc":"SWIM failure detector (pure logic, no GenServer). Orchestrates member list, gossip, and protocol timing.","ref":"macula_membership_detector.html"},{"type":"function","title":"macula_membership_detector.add_member/2","doc":"Add a member to the list.","ref":"macula_membership_detector.html#add_member/2"},{"type":"function","title":"macula_membership_detector.apply_gossip_updates/2","doc":"Apply received gossip updates.","ref":"macula_membership_detector.html#apply_gossip_updates/2"},{"type":"type","title":"macula_membership_detector.detector_state/0","doc":"","ref":"macula_membership_detector.html#t:detector_state/0"},{"type":"function","title":"macula_membership_detector.get_alive_members/1","doc":"Get all alive members.","ref":"macula_membership_detector.html#get_alive_members/1"},{"type":"function","title":"macula_membership_detector.get_gossip_updates/2","doc":"Get gossip updates to piggyback on messages.","ref":"macula_membership_detector.html#get_gossip_updates/2"},{"type":"function","title":"macula_membership_detector.get_member/2","doc":"Get a member by node ID.","ref":"macula_membership_detector.html#get_member/2"},{"type":"function","title":"macula_membership_detector.local_node_id/1","doc":"Get local node ID.","ref":"macula_membership_detector.html#local_node_id/1"},{"type":"function","title":"macula_membership_detector.mark_dead/2","doc":"Mark a member as dead.","ref":"macula_membership_detector.html#mark_dead/2"},{"type":"function","title":"macula_membership_detector.mark_suspect/2","doc":"Mark a member as suspect.","ref":"macula_membership_detector.html#mark_suspect/2"},{"type":"function","title":"macula_membership_detector.new/2","doc":"Create a new detector state.","ref":"macula_membership_detector.html#new/2"},{"type":"function","title":"macula_membership_detector.protocol_period/1","doc":"Get protocol period.","ref":"macula_membership_detector.html#protocol_period/1"},{"type":"function","title":"macula_membership_detector.refute_suspicion/1","doc":"Refute suspicion (increment local incarnation).","ref":"macula_membership_detector.html#refute_suspicion/1"},{"type":"function","title":"macula_membership_detector.select_probe_target/1","doc":"Select a random member to probe (excluding self).","ref":"macula_membership_detector.html#select_probe_target/1"},{"type":"module","title":"macula_membership_gossip","doc":"Gossip dissemination for SWIM protocol. Tracks membership updates and provides them for piggybacking. Uses exponential decay: log(N) messages per update.","ref":"macula_membership_gossip.html"},{"type":"function","title":"macula_membership_gossip.add_update/4","doc":"Add a membership update to gossip. If a more recent update exists, it's replaced.","ref":"macula_membership_gossip.html#add_update/4"},{"type":"function","title":"macula_membership_gossip.get_updates/2","doc":"Get updates to piggyback on messages. Returns most recent updates first, limited by max_updates.","ref":"macula_membership_gossip.html#get_updates/2"},{"type":"type","title":"macula_membership_gossip.gossip_state/0","doc":"","ref":"macula_membership_gossip.html#t:gossip_state/0"},{"type":"function","title":"macula_membership_gossip.mark_transmitted/2","doc":"Mark an update as transmitted (increment transmit count).","ref":"macula_membership_gossip.html#mark_transmitted/2"},{"type":"function","title":"macula_membership_gossip.merge_updates/2","doc":"Merge received gossip updates into local state. Uses SWIM merge semantics (higher incarnation wins, etc.).","ref":"macula_membership_gossip.html#merge_updates/2"},{"type":"function","title":"macula_membership_gossip.new/0","doc":"Create a new gossip state.","ref":"macula_membership_gossip.html#new/0"},{"type":"function","title":"macula_membership_gossip.prune/2","doc":"Prune updates that have been transmitted enough times. Target is typically log(N) where N is cluster size.","ref":"macula_membership_gossip.html#prune/2"},{"type":"type","title":"macula_membership_gossip.update/0","doc":"","ref":"macula_membership_gossip.html#t:update/0"},{"type":"module","title":"macula_membership_list","doc":"Membership list for SWIM protocol. Maintains cluster membership view with fast concurrent access. Uses map-based storage (could be ETS in production).","ref":"macula_membership_list.html"},{"type":"function","title":"macula_membership_list.add_member/2","doc":"Add a new member to the list. If member already exists, this is a no-op (use update_member instead).","ref":"macula_membership_list.html#add_member/2"},{"type":"function","title":"macula_membership_list.get_alive_members/1","doc":"Get all alive members.","ref":"macula_membership_list.html#get_alive_members/1"},{"type":"function","title":"macula_membership_list.get_all_members/1","doc":"Get all members.","ref":"macula_membership_list.html#get_all_members/1"},{"type":"function","title":"macula_membership_list.get_member/2","doc":"Get a member by node ID.","ref":"macula_membership_list.html#get_member/2"},{"type":"function","title":"macula_membership_list.get_random_members/2","doc":"Get N random members from the list.","ref":"macula_membership_list.html#get_random_members/2"},{"type":"function","title":"macula_membership_list.get_random_members/3","doc":"Get N random members excluding specified node ID.","ref":"macula_membership_list.html#get_random_members/3"},{"type":"function","title":"macula_membership_list.get_suspect_members/1","doc":"Get all suspect members.","ref":"macula_membership_list.html#get_suspect_members/1"},{"type":"type","title":"macula_membership_list.member_list/0","doc":"","ref":"macula_membership_list.html#t:member_list/0"},{"type":"function","title":"macula_membership_list.new/1","doc":"Create a new membership list with the local node.","ref":"macula_membership_list.html#new/1"},{"type":"function","title":"macula_membership_list.remove_member/2","doc":"Remove a member from the list.","ref":"macula_membership_list.html#remove_member/2"},{"type":"function","title":"macula_membership_list.size/1","doc":"Get the number of members in the list.","ref":"macula_membership_list.html#size/1"},{"type":"function","title":"macula_membership_list.update_member/2","doc":"Update an existing member (or add if not present). Uses merge semantics to resolve conflicts.","ref":"macula_membership_list.html#update_member/2"},{"type":"module","title":"macula_membership_member","doc":"Member record and state transitions for SWIM protocol. Represents a single node in the membership list.","ref":"macula_membership_member.html"},{"type":"function","title":"macula_membership_member.address/1","doc":"Get address.","ref":"macula_membership_member.html#address/1"},{"type":"function","title":"macula_membership_member.compare/2","doc":"Compare two members to determine which is more recent. Returns: gt (M1 is newer), lt (M1 is older), eq (same)","ref":"macula_membership_member.html#compare/2"},{"type":"function","title":"macula_membership_member.incarnation/1","doc":"Get incarnation number.","ref":"macula_membership_member.html#incarnation/1"},{"type":"function","title":"macula_membership_member.mark_alive/2","doc":"Mark member as alive with new incarnation (refutation). Dead members cannot be revived.","ref":"macula_membership_member.html#mark_alive/2"},{"type":"function","title":"macula_membership_member.mark_dead/1","doc":"Mark member as dead (confirmed failure).","ref":"macula_membership_member.html#mark_dead/1"},{"type":"function","title":"macula_membership_member.mark_suspect/1","doc":"Mark member as suspect (failed to respond to ping).","ref":"macula_membership_member.html#mark_suspect/1"},{"type":"type","title":"macula_membership_member.member/0","doc":"","ref":"macula_membership_member.html#t:member/0"},{"type":"function","title":"macula_membership_member.merge/2","doc":"Merge two member states, keeping the most recent information. Rules: 1. Dead always wins 2. Higher incarnation wins 3. Same incarnation: suspect > alive","ref":"macula_membership_member.html#merge/2"},{"type":"function","title":"macula_membership_member.metadata/1","doc":"Get metadata.","ref":"macula_membership_member.html#metadata/1"},{"type":"function","title":"macula_membership_member.new/2","doc":"Create a new member with alive status and incarnation 0.","ref":"macula_membership_member.html#new/2"},{"type":"function","title":"macula_membership_member.new/3","doc":"Create a new member with custom metadata.","ref":"macula_membership_member.html#new/3"},{"type":"function","title":"macula_membership_member.node_id/1","doc":"Get node ID.","ref":"macula_membership_member.html#node_id/1"},{"type":"type","title":"macula_membership_member.status/0","doc":"","ref":"macula_membership_member.html#t:status/0"},{"type":"function","title":"macula_membership_member.status/1","doc":"Get status.","ref":"macula_membership_member.html#status/1"},{"type":"module","title":"macula_names","doc":"Shared naming utilities for hierarchical dot-separated names. Used by both pub/sub topics and RPC procedure names. Supports DNS-style reverse notation: org.domain.service.method","ref":"macula_names.html"},{"type":"type","title":"macula_names.name/0","doc":"","ref":"macula_names.html#t:name/0"},{"type":"function","title":"macula_names.namespace/1","doc":"Extract namespace (first segment).","ref":"macula_names.html#namespace/1"},{"type":"function","title":"macula_names.normalize/1","doc":"Normalize name (lowercase, trim, remove double dots).","ref":"macula_names.html#normalize/1"},{"type":"type","title":"macula_names.options/0","doc":"","ref":"macula_names.html#t:options/0"},{"type":"function","title":"macula_names.segment_count/1","doc":"Count number of segments in name.","ref":"macula_names.html#segment_count/1"},{"type":"function","title":"macula_names.validate/1","doc":"Validate name syntax with default options (no wildcards).","ref":"macula_names.html#validate/1"},{"type":"function","title":"macula_names.validate/2","doc":"Validate name syntax with options. Valid names: - Non-empty - Segments separated by dots - Segments contain alphanumeric, underscore, hyphen - Optionally allow wildcards (* and #) for patterns - No leading or trailing dots - No double dots","ref":"macula_names.html#validate/2"},{"type":"module","title":"macula_node","doc":"Node identity and metadata management. Represents a single node in the Macula mesh.","ref":"macula_node.html"},{"type":"type","title":"macula_node.address/0","doc":"","ref":"macula_node.html#t:address/0"},{"type":"function","title":"macula_node.equals/2","doc":"Check if two nodes are equal (by ID).","ref":"macula_node.html#equals/2"},{"type":"function","title":"macula_node.from_binary/1","doc":"Decode node from binary. Crashes on invalid binary or structure - exposes bugs in encoding/decoding logic.","ref":"macula_node.html#from_binary/1"},{"type":"function","title":"macula_node.get_address/1","doc":"Get address.","ref":"macula_node.html#get_address/1"},{"type":"function","title":"macula_node.get_id/1","doc":"Get node ID.","ref":"macula_node.html#get_id/1"},{"type":"function","title":"macula_node.get_metadata/1","doc":"Get metadata.","ref":"macula_node.html#get_metadata/1"},{"type":"function","title":"macula_node.get_realm/1","doc":"Get realm.","ref":"macula_node.html#get_realm/1"},{"type":"type","title":"macula_node.macula_node/0","doc":"","ref":"macula_node.html#t:macula_node/0"},{"type":"type","title":"macula_node.metadata/0","doc":"","ref":"macula_node.html#t:metadata/0"},{"type":"function","title":"macula_node.new/1","doc":"Create new node with random ID.","ref":"macula_node.html#new/1"},{"type":"function","title":"macula_node.new/2","doc":"Create new node with random ID and metadata.","ref":"macula_node.html#new/2"},{"type":"type","title":"macula_node.node_id/0","doc":"32-byte unique identifier","ref":"macula_node.html#t:node_id/0"},{"type":"type","title":"macula_node.realm/0","doc":"","ref":"macula_node.html#t:realm/0"},{"type":"function","title":"macula_node.set_address/2","doc":"Set address.","ref":"macula_node.html#set_address/2"},{"type":"function","title":"macula_node.set_metadata/2","doc":"Set metadata (replaces existing).","ref":"macula_node.html#set_metadata/2"},{"type":"function","title":"macula_node.to_binary/1","doc":"Encode node to binary.","ref":"macula_node.html#to_binary/1"},{"type":"function","title":"macula_node.update_metadata/2","doc":"Update metadata (merges with existing).","ref":"macula_node.html#update_metadata/2"},{"type":"module","title":"macula_peer","doc":"Macula Peer - Mesh Participant API (v0.7.0+). This module provides the high-level API for mesh participants. Use this module to connect to a Macula mesh and communicate via pub/sub or RPC. Quick Start <span class=\"w\">   </span><span class=\"c1\">%% 1. Connect to a gateway</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"6643531958-1\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Peer</span><span class=\"p\" data-group-id=\"6643531958-1\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peer</span><span class=\"p\">:</span><span class=\"nf\">start_link</span><span class=\"p\" data-group-id=\"6643531958-2\">(</span><span class=\"p\" data-group-id=\"6643531958-3\">&lt;&lt;</span><span class=\"s\">&quot;https://gateway.example.com:9443&quot;</span><span class=\"p\" data-group-id=\"6643531958-3\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"6643531958-4\">#{</span><span class=\"w\">\n       </span><span class=\"ss\">realm</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"6643531958-5\">&lt;&lt;</span><span class=\"s\">&quot;com.example.app&quot;</span><span class=\"p\" data-group-id=\"6643531958-5\">&gt;&gt;</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"6643531958-4\">}</span><span class=\"p\" data-group-id=\"6643531958-2\">)</span><span class=\"p\">.</span><span class=\"w\">\n  \n   </span><span class=\"c1\">%% 2. Subscribe to events</span><span class=\"w\">\n   </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peer</span><span class=\"p\">:</span><span class=\"nf\">subscribe</span><span class=\"p\" data-group-id=\"6643531958-6\">(</span><span class=\"n\">Peer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"6643531958-7\">&lt;&lt;</span><span class=\"s\">&quot;sensor.temperature&quot;</span><span class=\"p\" data-group-id=\"6643531958-7\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nf\">self</span><span class=\"p\" data-group-id=\"6643531958-8\">(</span><span class=\"p\" data-group-id=\"6643531958-8\">)</span><span class=\"p\" data-group-id=\"6643531958-6\">)</span><span class=\"p\">.</span><span class=\"w\">\n  \n   </span><span class=\"c1\">%% 3. Publish an event</span><span class=\"w\">\n   </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peer</span><span class=\"p\">:</span><span class=\"nf\">publish</span><span class=\"p\" data-group-id=\"6643531958-9\">(</span><span class=\"n\">Peer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"6643531958-10\">&lt;&lt;</span><span class=\"s\">&quot;sensor.temperature&quot;</span><span class=\"p\" data-group-id=\"6643531958-10\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"6643531958-11\">#{</span><span class=\"w\">\n       </span><span class=\"ss\">device_id</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"6643531958-12\">&lt;&lt;</span><span class=\"s\">&quot;sensor-001&quot;</span><span class=\"p\" data-group-id=\"6643531958-12\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"ss\">celsius</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"mf\">21.5</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"6643531958-11\">}</span><span class=\"p\" data-group-id=\"6643531958-9\">)</span><span class=\"p\">.</span><span class=\"w\">\n  \n   </span><span class=\"c1\">%% 4. Call a remote service</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"6643531958-13\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Result</span><span class=\"p\" data-group-id=\"6643531958-13\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peer</span><span class=\"p\">:</span><span class=\"nf\">call</span><span class=\"p\" data-group-id=\"6643531958-14\">(</span><span class=\"n\">Peer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"6643531958-15\">&lt;&lt;</span><span class=\"s\">&quot;calculator.add&quot;</span><span class=\"p\" data-group-id=\"6643531958-15\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"6643531958-16\">#{</span><span class=\"ss\">a</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">b</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\" data-group-id=\"6643531958-16\">}</span><span class=\"p\" data-group-id=\"6643531958-14\">)</span><span class=\"p\">.</span><span class=\"w\">\n  \n   </span><span class=\"c1\">%% 5. Advertise a service</span><span class=\"w\">\n   </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peer</span><span class=\"p\">:</span><span class=\"nf\">advertise</span><span class=\"p\" data-group-id=\"6643531958-17\">(</span><span class=\"n\">Peer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"6643531958-18\">&lt;&lt;</span><span class=\"s\">&quot;calculator.add&quot;</span><span class=\"p\" data-group-id=\"6643531958-18\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nf\">fun</span><span class=\"p\" data-group-id=\"6643531958-19\">(</span><span class=\"p\" data-group-id=\"6643531958-20\">#{</span><span class=\"ss\">a</span><span class=\"w\"> </span><span class=\"p\">:=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">b</span><span class=\"w\"> </span><span class=\"p\">:=</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"p\" data-group-id=\"6643531958-20\">}</span><span class=\"p\" data-group-id=\"6643531958-19\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\">\n       </span><span class=\"p\" data-group-id=\"6643531958-21\">#{</span><span class=\"ss\">result</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"p\" data-group-id=\"6643531958-21\">}</span><span class=\"w\">\n   </span><span class=\"k\">end</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"6643531958-22\">#{</span><span class=\"ss\">ttl</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">300</span><span class=\"p\" data-group-id=\"6643531958-22\">}</span><span class=\"p\" data-group-id=\"6643531958-17\">)</span><span class=\"p\">.</span> Architecture The peer acts as a facade/coordinator, delegating to specialized child processes: -  macula_connection : QUIC transport layer (send/receive, encoding/decoding) -  macula_pubsub_handler : Pub/sub message routing -  macula_rpc_handler : RPC call/response handling -  macula_advertisement_manager : DHT service advertisements Renamed from macula_connection in v0.7.0 for clarity: -  macula_peer  = mesh participant (this module) -  macula_connection  = QUIC transport (low-level) Multi-Tenancy via Realms Realms provide logical isolation for different applications: <span class=\"w\">   </span><span class=\"c1\">%% App 1</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"6647807202-1\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Peer1</span><span class=\"p\" data-group-id=\"6647807202-1\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peer</span><span class=\"p\">:</span><span class=\"nf\">start_link</span><span class=\"p\" data-group-id=\"6647807202-2\">(</span><span class=\"n\">GatewayUrl</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"6647807202-3\">#{</span><span class=\"ss\">realm</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"6647807202-4\">&lt;&lt;</span><span class=\"s\">&quot;com.app1&quot;</span><span class=\"p\" data-group-id=\"6647807202-4\">&gt;&gt;</span><span class=\"p\" data-group-id=\"6647807202-3\">}</span><span class=\"p\" data-group-id=\"6647807202-2\">)</span><span class=\"p\">.</span><span class=\"w\">\n  \n   </span><span class=\"c1\">%% App 2 (completely isolated from App 1)</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"6647807202-5\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Peer2</span><span class=\"p\" data-group-id=\"6647807202-5\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peer</span><span class=\"p\">:</span><span class=\"nf\">start_link</span><span class=\"p\" data-group-id=\"6647807202-6\">(</span><span class=\"n\">GatewayUrl</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"6647807202-7\">#{</span><span class=\"ss\">realm</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"6647807202-8\">&lt;&lt;</span><span class=\"s\">&quot;com.app2&quot;</span><span class=\"p\" data-group-id=\"6647807202-8\">&gt;&gt;</span><span class=\"p\" data-group-id=\"6647807202-7\">}</span><span class=\"p\" data-group-id=\"6647807202-6\">)</span><span class=\"p\">.</span>","ref":"macula_peer.html"},{"type":"function","title":"macula_peer.advertise/4","doc":"Advertise a service handler for a procedure. This makes the local handler available to other mesh nodes via DHT. The handler will be periodically re-advertised based on TTL.","ref":"macula_peer.html#advertise/4"},{"type":"function","title":"macula_peer.call/3","doc":"Make an RPC call through this client (default timeout).","ref":"macula_peer.html#call/3"},{"type":"function","title":"macula_peer.call/4","doc":"Make an RPC call through this client with options.","ref":"macula_peer.html#call/4"},{"type":"function","title":"macula_peer.discover_subscribers/2","doc":"Discover subscribers to a topic via DHT query.","ref":"macula_peer.html#discover_subscribers/2"},{"type":"function","title":"macula_peer.get_node_id/1","doc":"Get the node ID of this peer.","ref":"macula_peer.html#get_node_id/1"},{"type":"function","title":"macula_peer.publish/3","doc":"Publish an event through this client (no options).","ref":"macula_peer.html#publish/3"},{"type":"function","title":"macula_peer.publish/4","doc":"Publish an event through this client with options.","ref":"macula_peer.html#publish/4"},{"type":"function","title":"macula_peer.start_link/2","doc":"Start a client connection to a Macula mesh.","ref":"macula_peer.html#start_link/2"},{"type":"function","title":"macula_peer.stop/1","doc":"Stop the client connection.","ref":"macula_peer.html#stop/1"},{"type":"function","title":"macula_peer.subscribe/3","doc":"Subscribe to a topic through this client.","ref":"macula_peer.html#subscribe/3"},{"type":"function","title":"macula_peer.unadvertise/2","doc":"Stop advertising a service. Removes the local handler and stops advertising to the DHT.","ref":"macula_peer.html#unadvertise/2"},{"type":"function","title":"macula_peer.unsubscribe/2","doc":"Unsubscribe from a topic.","ref":"macula_peer.html#unsubscribe/2"},{"type":"module","title":"macula_peer_connector","doc":"Peer Connector - Establishes direct QUIC connections to remote peers (v0.8.0+). This module enables peer-to-peer communication by establishing outbound QUIC connections to arbitrary peers. Used by DHT for STORE/FIND_VALUE message propagation and by RPC/PubSub for direct delivery. Overview Pattern: Stateless utility module (no GenServer) - Direct QUIC connections using  macula_quic  - Fire-and-forget message sending - No connection pooling (future optimization for v0.9.0) Usage Used internally by: -  macula_pubsub_dht : Direct pub/sub delivery to discovered subscribers -  macula_service_registry : DHT STORE propagation to k=20 nodes - Future: Multi-hop RPC routing <span class=\"w\">   </span><span class=\"c1\">%% Send a DHT STORE message to a peer</span><span class=\"w\">\n   </span><span class=\"n\">Endpoint</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"8699860155-1\">&lt;&lt;</span><span class=\"s\">&quot;192.168.1.100:9443&quot;</span><span class=\"p\" data-group-id=\"8699860155-1\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\">\n   </span><span class=\"n\">Message</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"8699860155-2\">#{</span><span class=\"w\">\n       </span><span class=\"ss\">key</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"8699860155-3\">&lt;&lt;</span><span class=\"s\">&quot;service.calculator.add&quot;</span><span class=\"p\" data-group-id=\"8699860155-3\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"ss\">value</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"8699860155-4\">&lt;&lt;</span><span class=\"s\">&quot;192.168.1.50:9443&quot;</span><span class=\"p\" data-group-id=\"8699860155-4\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\">\n       </span><span class=\"ss\">ttl</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">300</span><span class=\"w\">\n   </span><span class=\"p\" data-group-id=\"8699860155-2\">}</span><span class=\"p\">,</span><span class=\"w\">\n   </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nc\">macula_peer_connector</span><span class=\"p\">:</span><span class=\"nf\">send_message</span><span class=\"p\" data-group-id=\"8699860155-5\">(</span><span class=\"n\">Endpoint</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">dht_store</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Message</span><span class=\"p\" data-group-id=\"8699860155-5\">)</span><span class=\"p\">.</span> Performance Characteristics v0.8.0: Fire-and-forget pattern - Creates new connection per message - Simple but inefficient for high-frequency messaging v0.9.0 (planned): Connection pooling - Reuse existing connections - 10x performance improvement for repeated messaging","ref":"macula_peer_connector.html"},{"type":"function","title":"macula_peer_connector.send_message/3","doc":"Send a message to a remote peer (fire-and-forget). Establishes connection, sends message, closes connection. This is simple but creates a new connection per message.","ref":"macula_peer_connector.html#send_message/3"},{"type":"function","title":"macula_peer_connector.send_message/4","doc":"Send a message to a remote peer with custom timeout.","ref":"macula_peer_connector.html#send_message/4"},{"type":"module","title":"macula_peer_system","doc":"Peer System Supervisor - supervises the peer subsystem. Supervision Strategy: - rest_for_one: If child N crashes, restart N and all children after N - Rationale: connection_manager is foundational; handlers depend on it but are independent of each other. This provides fault isolation while maintaining consistency when connection_manager restarts. Architecture: <span class=\"w\">   </span><span class=\"nf\">macula_peer_system</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"8772927158-1\">(</span><span class=\"ss\">this</span><span class=\"w\"> </span><span class=\"ss\">module</span><span class=\"p\" data-group-id=\"8772927158-1\">)</span><span class=\"w\">\n   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_connection</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">QUIC</span><span class=\"w\"> </span><span class=\"ss\">connection</span><span class=\"w\"> </span><span class=\"nf\">lifecycle</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"8772927158-2\">(</span><span class=\"ss\">transport</span><span class=\"w\"> </span><span class=\"ss\">layer</span><span class=\"p\" data-group-id=\"8772927158-2\">)</span><span class=\"w\">\n   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_pubsub_handler</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Pub</span><span class=\"o\">/</span><span class=\"ss\">sub</span><span class=\"w\"> </span><span class=\"ss\">operations</span><span class=\"w\">\n   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_rpc_handler</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">RPC</span><span class=\"w\"> </span><span class=\"ss\">operations</span><span class=\"w\">\n   </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_advertisement_manager</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">DHT</span><span class=\"w\"> </span><span class=\"ss\">service</span><span class=\"w\"> </span><span class=\"ss\">advertisements</span><span class=\"w\">\n   </span> Children (in dependency order): - macula_connection: QUIC connection lifecycle (foundational) - macula_pubsub_handler: Pub/sub operations (depends on connection) - macula_rpc_handler: RPC operations (depends on connection) - macula_advertisement_manager: DHT advertisements (depends on connection) Fault Isolation: - advertisement_manager crash  only advertisement restarts - rpc_handler crash  rpc + advertisement restart - pubsub_handler crash  pubsub + rpc + advertisement restart - connection crash  all restart (unavoidable - foundational) Renamed from macula_connection_sup (v0.7.10) to align with macula_peer nomenclature and macula_gateway_system naming convention.","ref":"macula_peer_system.html"},{"type":"function","title":"macula_peer_system.init/1","doc":"Initialize the supervisor with child specifications.","ref":"macula_peer_system.html#init/1"},{"type":"function","title":"macula_peer_system.start_link/2","doc":"Start the peer system supervisor with given URL and options.","ref":"macula_peer_system.html#start_link/2"},{"type":"function","title":"macula_peer_system.stop/1","doc":"Stop the peer system supervisor and all children.","ref":"macula_peer_system.html#stop/1"},{"type":"module","title":"macula_protocol_decoder","doc":"Protocol message decoder for Macula mesh. Decodes binary wire format to message maps.","ref":"macula_protocol_decoder.html"},{"type":"function","title":"macula_protocol_decoder.decode/1","doc":"Decode a binary message to {Type, Msg} tuple. Returns {ok, {Type, Msg}} on success or {error, Reason} on failure.","ref":"macula_protocol_decoder.html#decode/1"},{"type":"module","title":"macula_protocol_encoder","doc":"Protocol message encoder for Macula mesh. Encodes message maps to binary wire format. Frame Format (8-byte header + payload): - Version (1 byte): Protocol version (currently 0x01) - Type (1 byte): Message type ID - Flags (1 byte): Reserved for future use (0x00) - Reserved (1 byte): Must be 0x00 - Payload Length (4 bytes): Big-endian uint32 - Payload (N bytes): MessagePack-encoded message data","ref":"macula_protocol_encoder.html"},{"type":"function","title":"macula_protocol_encoder.encode/2","doc":"Encode a message to binary format. Returns a binary with 8-byte header + MessagePack payload.","ref":"macula_protocol_encoder.html#encode/2"},{"type":"module","title":"macula_protocol_types","doc":"Protocol message type definitions and constants for Macula mesh. Defines all message types that can be sent over QUIC streams.","ref":"macula_protocol_types.html"},{"type":"type","title":"macula_protocol_types.call_msg/0","doc":"","ref":"macula_protocol_types.html#t:call_msg/0"},{"type":"type","title":"macula_protocol_types.cast_msg/0","doc":"","ref":"macula_protocol_types.html#t:cast_msg/0"},{"type":"type","title":"macula_protocol_types.connect_msg/0","doc":"","ref":"macula_protocol_types.html#t:connect_msg/0"},{"type":"type","title":"macula_protocol_types.disconnect_msg/0","doc":"","ref":"macula_protocol_types.html#t:disconnect_msg/0"},{"type":"type","title":"macula_protocol_types.message/0","doc":"","ref":"macula_protocol_types.html#t:message/0"},{"type":"type","title":"macula_protocol_types.message_type/0","doc":"","ref":"macula_protocol_types.html#t:message_type/0"},{"type":"function","title":"macula_protocol_types.message_type_id/1","doc":"Get numeric ID for a message type.","ref":"macula_protocol_types.html#message_type_id/1"},{"type":"function","title":"macula_protocol_types.message_type_name/1","doc":"Get message type name from numeric ID.","ref":"macula_protocol_types.html#message_type_name/1"},{"type":"type","title":"macula_protocol_types.ping_msg/0","doc":"","ref":"macula_protocol_types.html#t:ping_msg/0"},{"type":"type","title":"macula_protocol_types.pong_msg/0","doc":"","ref":"macula_protocol_types.html#t:pong_msg/0"},{"type":"type","title":"macula_protocol_types.publish_msg/0","doc":"","ref":"macula_protocol_types.html#t:publish_msg/0"},{"type":"type","title":"macula_protocol_types.pubsub_route_msg/0","doc":"","ref":"macula_protocol_types.html#t:pubsub_route_msg/0"},{"type":"type","title":"macula_protocol_types.reply_msg/0","doc":"","ref":"macula_protocol_types.html#t:reply_msg/0"},{"type":"type","title":"macula_protocol_types.rpc_route_msg/0","doc":"","ref":"macula_protocol_types.html#t:rpc_route_msg/0"},{"type":"type","title":"macula_protocol_types.subscribe_msg/0","doc":"","ref":"macula_protocol_types.html#t:subscribe_msg/0"},{"type":"type","title":"macula_protocol_types.unsubscribe_msg/0","doc":"","ref":"macula_protocol_types.html#t:unsubscribe_msg/0"},{"type":"module","title":"macula_provider_selector","doc":"Provider selection strategies for multi-provider RPC load balancing. Supports multiple strategies for choosing which provider to use when multiple providers advertise the same service. Strategies: - round_robin: Distribute calls evenly across providers - random: Random provider selection - first: Always use first provider (default/simple)","ref":"macula_provider_selector.html"},{"type":"type","title":"macula_provider_selector.provider_info/0","doc":"Provider information returned from DHT.","ref":"macula_provider_selector.html#t:provider_info/0"},{"type":"function","title":"macula_provider_selector.select_provider/2","doc":"Select a provider from a list using the default strategy (random). Returns the selected provider or error if list is empty.","ref":"macula_provider_selector.html#select_provider/2"},{"type":"function","title":"macula_provider_selector.select_provider/3","doc":"Select a provider from a list using a specific strategy. Strategies: - first: Always select the first provider (simple, no state) - random: Randomly select a provider - round_robin: Distribute calls evenly using a counter Examples: <span class=\"w\">  </span><span class=\"c1\">%% Random selection</span><span class=\"w\">\n  </span><span class=\"n\">State</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">new_state</span><span class=\"p\" data-group-id=\"2484281014-1\">(</span><span class=\"ss\">random</span><span class=\"p\" data-group-id=\"2484281014-1\">)</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"2484281014-2\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Provider</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">State2</span><span class=\"p\" data-group-id=\"2484281014-2\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">select_provider</span><span class=\"p\" data-group-id=\"2484281014-3\">(</span><span class=\"n\">Providers</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">random</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">State</span><span class=\"p\" data-group-id=\"2484281014-3\">)</span><span class=\"p\">.</span><span class=\"w\">\n \n  </span><span class=\"c1\">%% Round-robin selection</span><span class=\"w\">\n  </span><span class=\"n\">State</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">new_state</span><span class=\"p\" data-group-id=\"2484281014-4\">(</span><span class=\"ss\">round_robin</span><span class=\"p\" data-group-id=\"2484281014-4\">)</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"2484281014-5\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">P1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">State2</span><span class=\"p\" data-group-id=\"2484281014-5\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">select_provider</span><span class=\"p\" data-group-id=\"2484281014-6\">(</span><span class=\"n\">Providers</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">round_robin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">State</span><span class=\"p\" data-group-id=\"2484281014-6\">)</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"2484281014-7\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">P2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">State3</span><span class=\"p\" data-group-id=\"2484281014-7\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">select_provider</span><span class=\"p\" data-group-id=\"2484281014-8\">(</span><span class=\"n\">Providers</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">round_robin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">State2</span><span class=\"p\" data-group-id=\"2484281014-8\">)</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"c1\">%% P1 and P2 will be different providers (if multiple available)</span>","ref":"macula_provider_selector.html#select_provider/3"},{"type":"type","title":"macula_provider_selector.selection_state/0","doc":"","ref":"macula_provider_selector.html#t:selection_state/0"},{"type":"type","title":"macula_provider_selector.strategy/0","doc":"Selection strategy for choosing a provider from multiple options.","ref":"macula_provider_selector.html#t:strategy/0"},{"type":"module","title":"macula_pubsub_cache","doc":"LRU cache for remote subscriber lists. Caches DHT query results to avoid repeated lookups. Wraps macula_cache with subscriber-specific logic.","ref":"macula_pubsub_cache.html"},{"type":"type","title":"macula_pubsub_cache.cache/0","doc":"","ref":"macula_pubsub_cache.html#t:cache/0"},{"type":"function","title":"macula_pubsub_cache.clear/1","doc":"Clear all entries.","ref":"macula_pubsub_cache.html#clear/1"},{"type":"function","title":"macula_pubsub_cache.get/2","doc":"Get entry from cache. Returns {ok, Subscribers, UpdatedCache} or not_found. The updated cache has the entry moved to front (LRU).","ref":"macula_pubsub_cache.html#get/2"},{"type":"function","title":"macula_pubsub_cache.invalidate/2","doc":"Invalidate (remove) entry.","ref":"macula_pubsub_cache.html#invalidate/2"},{"type":"function","title":"macula_pubsub_cache.is_expired/3","doc":"Check if entry is expired based on TTL. This checks if entry exists and its age exceeds TTL.","ref":"macula_pubsub_cache.html#is_expired/3"},{"type":"function","title":"macula_pubsub_cache.max_size/1","doc":"Get max size.","ref":"macula_pubsub_cache.html#max_size/1"},{"type":"function","title":"macula_pubsub_cache.new/1","doc":"Create new cache with max size.","ref":"macula_pubsub_cache.html#new/1"},{"type":"function","title":"macula_pubsub_cache.put/3","doc":"Put entry in cache.","ref":"macula_pubsub_cache.html#put/3"},{"type":"function","title":"macula_pubsub_cache.put_with_timestamp/4","doc":"Put entry with custom timestamp (for testing).","ref":"macula_pubsub_cache.html#put_with_timestamp/4"},{"type":"function","title":"macula_pubsub_cache.size/1","doc":"Get number of entries.","ref":"macula_pubsub_cache.html#size/1"},{"type":"module","title":"macula_pubsub_delivery","doc":"Message routing and delivery to local and remote subscribers. Combines local registry and remote discovery for full fan-out.","ref":"macula_pubsub_delivery.html"},{"type":"function","title":"macula_pubsub_delivery.deliver_local/2","doc":"Deliver message to all matching local subscribers. Crashes if subscriber callback fails - indicates dead subscriber process.","ref":"macula_pubsub_delivery.html#deliver_local/2"},{"type":"function","title":"macula_pubsub_delivery.deliver_remote/3","doc":"Deliver message to remote subscribers via QUIC.","ref":"macula_pubsub_delivery.html#deliver_remote/3"},{"type":"type","title":"macula_pubsub_delivery.delivery_result/0","doc":"","ref":"macula_pubsub_delivery.html#t:delivery_result/0"},{"type":"type","title":"macula_pubsub_delivery.discovery_fun/0","doc":"","ref":"macula_pubsub_delivery.html#t:discovery_fun/0"},{"type":"function","title":"macula_pubsub_delivery.get_matching_patterns/2","doc":"Get all unique patterns that match the topic. Used for remote subscriber discovery.","ref":"macula_pubsub_delivery.html#get_matching_patterns/2"},{"type":"type","title":"macula_pubsub_delivery.message/0","doc":"","ref":"macula_pubsub_delivery.html#t:message/0"},{"type":"function","title":"macula_pubsub_delivery.publish/4","doc":"Publish message to both local and remote subscribers. Returns {LocalResults, RemoteResults}.","ref":"macula_pubsub_delivery.html#publish/4"},{"type":"type","title":"macula_pubsub_delivery.send_fun/0","doc":"","ref":"macula_pubsub_delivery.html#t:send_fun/0"},{"type":"module","title":"macula_pubsub_dht","doc":"DHT operations for pub/sub - handles subscription advertisement and discovery. Responsibilities: - Advertise subscriptions in DHT with TTL - Schedule re-advertisement timers - Discover remote subscribers via DHT queries - Route messages to remote subscribers - Track pending DHT queries Extracted from macula_pubsub_handler.erl (Phase 3)","ref":"macula_pubsub_dht.html"},{"type":"function","title":"macula_pubsub_dht.advertise_subscription/5","doc":"Advertise a subscription in the DHT. Sends STORE message to DHT and schedules re-advertisement. Returns {ok, SubInfo}.","ref":"macula_pubsub_dht.html#advertise_subscription/5"},{"type":"type","title":"macula_pubsub_dht.advertised_subscriptions/0","doc":"","ref":"macula_pubsub_dht.html#t:advertised_subscriptions/0"},{"type":"function","title":"macula_pubsub_dht.cancel_advertisement/2","doc":"Cancel advertisement for a topic. Cancels the re-advertisement timer. Returns updated advertised_subscriptions map.","ref":"macula_pubsub_dht.html#cancel_advertisement/2"},{"type":"type","title":"macula_pubsub_dht.connection_manager_pid/0","doc":"","ref":"macula_pubsub_dht.html#t:connection_manager_pid/0"},{"type":"function","title":"macula_pubsub_dht.discover_subscribers/6","doc":"Discover remote subscribers for a topic. Checks cache first, queries DHT on cache miss. Returns {cached, Subscribers, Registry} | {query_sent, Pending, MsgId, Registry}.","ref":"macula_pubsub_dht.html#discover_subscribers/6"},{"type":"function","title":"macula_pubsub_dht.handle_discovery_response/3","doc":"Handle DHT discovery response. Routes messages to discovered subscribers. Returns updated pending queries map.","ref":"macula_pubsub_dht.html#handle_discovery_response/3"},{"type":"type","title":"macula_pubsub_dht.node_id/0","doc":"","ref":"macula_pubsub_dht.html#t:node_id/0"},{"type":"type","title":"macula_pubsub_dht.payload/0","doc":"","ref":"macula_pubsub_dht.html#t:payload/0"},{"type":"type","title":"macula_pubsub_dht.pending_queries/0","doc":"","ref":"macula_pubsub_dht.html#t:pending_queries/0"},{"type":"type","title":"macula_pubsub_dht.qos/0","doc":"","ref":"macula_pubsub_dht.html#t:qos/0"},{"type":"function","title":"macula_pubsub_dht.route_to_subscribers/5","doc":"Route message to remote subscribers via direct P2P connections (v0.8.0+). Wraps publish in pubsub_route envelope and sends directly to each subscriber. Uses macula_peer_connector for direct QUIC connections to subscriber endpoints.","ref":"macula_pubsub_dht.html#route_to_subscribers/5"},{"type":"type","title":"macula_pubsub_dht.subscription_ref/0","doc":"","ref":"macula_pubsub_dht.html#t:subscription_ref/0"},{"type":"type","title":"macula_pubsub_dht.topic/0","doc":"","ref":"macula_pubsub_dht.html#t:topic/0"},{"type":"type","title":"macula_pubsub_dht.url/0","doc":"","ref":"macula_pubsub_dht.html#t:url/0"},{"type":"module","title":"macula_pubsub_discovery","doc":"DHT integration for finding remote subscribers. Uses Kademlia DHT to publish and discover subscriptions. Wraps macula_discovery with pub/sub-specific types.","ref":"macula_pubsub_discovery.html"},{"type":"type","title":"macula_pubsub_discovery.address/0","doc":"","ref":"macula_pubsub_discovery.html#t:address/0"},{"type":"function","title":"macula_pubsub_discovery.announce/4","doc":"Announce local subscription to DHT.","ref":"macula_pubsub_discovery.html#announce/4"},{"type":"type","title":"macula_pubsub_discovery.dht_lookup_fun/0","doc":"","ref":"macula_pubsub_discovery.html#t:dht_lookup_fun/0"},{"type":"type","title":"macula_pubsub_discovery.dht_publish_fun/0","doc":"","ref":"macula_pubsub_discovery.html#t:dht_publish_fun/0"},{"type":"type","title":"macula_pubsub_discovery.dht_unpublish_fun/0","doc":"","ref":"macula_pubsub_discovery.html#t:dht_unpublish_fun/0"},{"type":"function","title":"macula_pubsub_discovery.find_subscribers/2","doc":"Find remote subscribers for a pattern via DHT.","ref":"macula_pubsub_discovery.html#find_subscribers/2"},{"type":"function","title":"macula_pubsub_discovery.find_with_cache/3","doc":"Find subscribers with cache (default TTL: 300 seconds).","ref":"macula_pubsub_discovery.html#find_with_cache/3"},{"type":"function","title":"macula_pubsub_discovery.find_with_cache/4","doc":"Find subscribers with cache and custom TTL.","ref":"macula_pubsub_discovery.html#find_with_cache/4"},{"type":"type","title":"macula_pubsub_discovery.node_id/0","doc":"","ref":"macula_pubsub_discovery.html#t:node_id/0"},{"type":"type","title":"macula_pubsub_discovery.pattern/0","doc":"","ref":"macula_pubsub_discovery.html#t:pattern/0"},{"type":"type","title":"macula_pubsub_discovery.subscriber/0","doc":"","ref":"macula_pubsub_discovery.html#t:subscriber/0"},{"type":"function","title":"macula_pubsub_discovery.unannounce/3","doc":"Remove local subscription from DHT.","ref":"macula_pubsub_discovery.html#unannounce/3"},{"type":"module","title":"macula_pubsub_handler","doc":"PubSub handler GenServer - facade that orchestrates pub/sub operations. This module acts as a facade/coordinator, delegating business logic to: - macula_pubsub_subscription: Subscription storage, pattern matching, callbacks - macula_pubsub_dht: DHT advertisement, discovery, routing - macula_pubsub_qos: QoS 1 tracking and retry logic Responsibilities: - API facade for subscribe/unsubscribe/publish operations - Message routing coordination between specialized modules - GenServer lifecycle management - State management (delegates actual operations to modules) Extracted from macula_connection.erl (Phase 4) Refactored using TDD to extract god module (Phase 5)","ref":"macula_pubsub_handler.html"},{"type":"function","title":"macula_pubsub_handler.handle_call/3","doc":"","ref":"macula_pubsub_handler.html#handle_call/3"},{"type":"function","title":"macula_pubsub_handler.handle_cast/2","doc":"","ref":"macula_pubsub_handler.html#handle_cast/2"},{"type":"function","title":"macula_pubsub_handler.handle_incoming_publish/2","doc":"","ref":"macula_pubsub_handler.html#handle_incoming_publish/2"},{"type":"function","title":"macula_pubsub_handler.handle_info/2","doc":"","ref":"macula_pubsub_handler.html#handle_info/2"},{"type":"function","title":"macula_pubsub_handler.init/1","doc":"","ref":"macula_pubsub_handler.html#init/1"},{"type":"function","title":"macula_pubsub_handler.publish/4","doc":"","ref":"macula_pubsub_handler.html#publish/4"},{"type":"function","title":"macula_pubsub_handler.start_link/1","doc":"","ref":"macula_pubsub_handler.html#start_link/1"},{"type":"function","title":"macula_pubsub_handler.subscribe/3","doc":"","ref":"macula_pubsub_handler.html#subscribe/3"},{"type":"function","title":"macula_pubsub_handler.terminate/2","doc":"","ref":"macula_pubsub_handler.html#terminate/2"},{"type":"function","title":"macula_pubsub_handler.unsubscribe/2","doc":"","ref":"macula_pubsub_handler.html#unsubscribe/2"},{"type":"module","title":"macula_pubsub_qos","doc":"QoS (Quality of Service) manager for pub/sub. Handles QoS 1 (at-least-once delivery) logic: - Message tracking with timeout timers - Automatic retry on timeout (up to max retries) - Acknowledgment handling Extracted from macula_pubsub_handler.erl (Phase 2)","ref":"macula_pubsub_qos.html"},{"type":"type","title":"macula_pubsub_qos.connection_manager_pid/0","doc":"","ref":"macula_pubsub_qos.html#t:connection_manager_pid/0"},{"type":"function","title":"macula_pubsub_qos.get_pending/1","doc":"Get list of pending message IDs (for testing/debugging).","ref":"macula_pubsub_qos.html#get_pending/1"},{"type":"function","title":"macula_pubsub_qos.handle_ack/2","doc":"Handle acknowledgment for a message. Cancels timer and removes message from pending map. Returns updated pending_pubacks map.","ref":"macula_pubsub_qos.html#handle_ack/2"},{"type":"function","title":"macula_pubsub_qos.handle_timeout/3","doc":"Handle timeout for a pending message. Retries sending if under max retries, otherwise gives up. Returns {retry, UpdatedPending, PublishMsg} | {give_up, UpdatedPending}.","ref":"macula_pubsub_qos.html#handle_timeout/3"},{"type":"type","title":"macula_pubsub_qos.message_id/0","doc":"","ref":"macula_pubsub_qos.html#t:message_id/0"},{"type":"type","title":"macula_pubsub_qos.payload/0","doc":"","ref":"macula_pubsub_qos.html#t:payload/0"},{"type":"type","title":"macula_pubsub_qos.pending_pubacks/0","doc":"","ref":"macula_pubsub_qos.html#t:pending_pubacks/0"},{"type":"type","title":"macula_pubsub_qos.qos/0","doc":"","ref":"macula_pubsub_qos.html#t:qos/0"},{"type":"type","title":"macula_pubsub_qos.retry_count/0","doc":"","ref":"macula_pubsub_qos.html#t:retry_count/0"},{"type":"type","title":"macula_pubsub_qos.timer_ref/0","doc":"","ref":"macula_pubsub_qos.html#t:timer_ref/0"},{"type":"type","title":"macula_pubsub_qos.topic/0","doc":"","ref":"macula_pubsub_qos.html#t:topic/0"},{"type":"function","title":"macula_pubsub_qos.track_message/5","doc":"Track a message for QoS 1 acknowledgment. Starts a timeout timer and stores message in pending map. Returns updated pending_pubacks map.","ref":"macula_pubsub_qos.html#track_message/5"},{"type":"module","title":"macula_pubsub_registry","doc":"Local subscription registry for pub/sub. Maps topic patterns to local subscribers (callback PIDs).","ref":"macula_pubsub_registry.html"},{"type":"function","title":"macula_pubsub_registry.get_subscription/3","doc":"Get specific subscription.","ref":"macula_pubsub_registry.html#get_subscription/3"},{"type":"function","title":"macula_pubsub_registry.list_patterns/1","doc":"List all unique patterns.","ref":"macula_pubsub_registry.html#list_patterns/1"},{"type":"function","title":"macula_pubsub_registry.match/2","doc":"Find subscriptions matching a topic.","ref":"macula_pubsub_registry.html#match/2"},{"type":"function","title":"macula_pubsub_registry.new/0","doc":"Create new empty registry.","ref":"macula_pubsub_registry.html#new/0"},{"type":"type","title":"macula_pubsub_registry.registry/0","doc":"","ref":"macula_pubsub_registry.html#t:registry/0"},{"type":"function","title":"macula_pubsub_registry.size/1","doc":"Get number of subscriptions.","ref":"macula_pubsub_registry.html#size/1"},{"type":"function","title":"macula_pubsub_registry.subscribe/4","doc":"Subscribe to a pattern. If subscription already exists (same subscriber_id + pattern), updates callback.","ref":"macula_pubsub_registry.html#subscribe/4"},{"type":"type","title":"macula_pubsub_registry.subscription/0","doc":"","ref":"macula_pubsub_registry.html#t:subscription/0"},{"type":"function","title":"macula_pubsub_registry.unsubscribe/3","doc":"Unsubscribe from a pattern.","ref":"macula_pubsub_registry.html#unsubscribe/3"},{"type":"module","title":"macula_pubsub_routing","doc":"Pub/Sub routing for multi-hop DHT-routed pub/sub. Handles wrapping, unwrapping, and routing of PUBLISH messages through the Kademlia DHT mesh. Pattern: Clone of macula_rpc_routing for pub/sub messages","ref":"macula_pubsub_routing.html"},{"type":"function","title":"macula_pubsub_routing.route_or_deliver/3","doc":"Route a pubsub_route message: either deliver locally or forward to next hop. Returns one of: {deliver, Topic, PublishMsg} - Message is for this node {forward, NextHopNodeInfo, UpdatedPubSubRouteMsg} - Forward to next hop {error, Reason} - Cannot route (TTL exceeded, no route, etc.)","ref":"macula_pubsub_routing.html#route_or_deliver/3"},{"type":"function","title":"macula_pubsub_routing.should_deliver_locally/2","doc":"Determine if this node should deliver the message locally or forward it.","ref":"macula_pubsub_routing.html#should_deliver_locally/2"},{"type":"function","title":"macula_pubsub_routing.wrap_publish/4","doc":"Wrap a PUBLISH message in pubsub_route envelope for DHT routing.","ref":"macula_pubsub_routing.html#wrap_publish/4"},{"type":"module","title":"macula_pubsub_server","doc":"Pub/Sub GenServer - manages subscriptions and message delivery. Ties together registry, cache, discovery, and delivery layers.","ref":"macula_pubsub_server.html"},{"type":"function","title":"macula_pubsub_server.cache_stats/1","doc":"Get cache statistics.","ref":"macula_pubsub_server.html#cache_stats/1"},{"type":"function","title":"macula_pubsub_server.list_patterns/1","doc":"List all unique patterns.","ref":"macula_pubsub_server.html#list_patterns/1"},{"type":"function","title":"macula_pubsub_server.list_subscriptions/1","doc":"List all subscriptions.","ref":"macula_pubsub_server.html#list_subscriptions/1"},{"type":"type","title":"macula_pubsub_server.options/0","doc":"","ref":"macula_pubsub_server.html#t:options/0"},{"type":"function","title":"macula_pubsub_server.publish/2","doc":"Publish message to all matching subscribers.","ref":"macula_pubsub_server.html#publish/2"},{"type":"function","title":"macula_pubsub_server.start_link/0","doc":"Start server with default options.","ref":"macula_pubsub_server.html#start_link/0"},{"type":"function","title":"macula_pubsub_server.start_link/1","doc":"Start server with options.","ref":"macula_pubsub_server.html#start_link/1"},{"type":"function","title":"macula_pubsub_server.stop/1","doc":"Stop server.","ref":"macula_pubsub_server.html#stop/1"},{"type":"function","title":"macula_pubsub_server.subscribe/4","doc":"Subscribe to a pattern.","ref":"macula_pubsub_server.html#subscribe/4"},{"type":"function","title":"macula_pubsub_server.subscription_count/1","doc":"Get subscription count.","ref":"macula_pubsub_server.html#subscription_count/1"},{"type":"function","title":"macula_pubsub_server.unsubscribe/3","doc":"Unsubscribe from a pattern.","ref":"macula_pubsub_server.html#unsubscribe/3"},{"type":"module","title":"macula_pubsub_subscription","doc":"Subscription management for pub/sub. Responsibilities: - Store and retrieve subscriptions - Pattern matching with wildcards (*, **) - Find matching subscriptions for a topic - Invoke subscriber callbacks Extracted from macula_pubsub_handler.erl (Phase 4)","ref":"macula_pubsub_subscription.html"},{"type":"function","title":"macula_pubsub_subscription.add_subscription/4","doc":"Add a subscription. Returns {ok, UpdatedSubscriptions, SubRef}.","ref":"macula_pubsub_subscription.html#add_subscription/4"},{"type":"type","title":"macula_pubsub_subscription.callback/0","doc":"","ref":"macula_pubsub_subscription.html#t:callback/0"},{"type":"function","title":"macula_pubsub_subscription.find_matches/3","doc":"Find matching subscriptions for a topic. Returns list of {SubRef, {Pattern, Callback}} tuples.","ref":"macula_pubsub_subscription.html#find_matches/3"},{"type":"function","title":"macula_pubsub_subscription.invoke_callbacks/4","doc":"Invoke callbacks for matching subscriptions. Spawns async tasks to invoke each callback.","ref":"macula_pubsub_subscription.html#invoke_callbacks/4"},{"type":"type","title":"macula_pubsub_subscription.node_id/0","doc":"","ref":"macula_pubsub_subscription.html#t:node_id/0"},{"type":"type","title":"macula_pubsub_subscription.payload/0","doc":"","ref":"macula_pubsub_subscription.html#t:payload/0"},{"type":"function","title":"macula_pubsub_subscription.remove_subscription/2","doc":"Remove a subscription. Returns {ok, UpdatedSubscriptions, Topic} | {error, not_found}.","ref":"macula_pubsub_subscription.html#remove_subscription/2"},{"type":"type","title":"macula_pubsub_subscription.subscription_ref/0","doc":"","ref":"macula_pubsub_subscription.html#t:subscription_ref/0"},{"type":"type","title":"macula_pubsub_subscription.subscriptions/0","doc":"","ref":"macula_pubsub_subscription.html#t:subscriptions/0"},{"type":"type","title":"macula_pubsub_subscription.topic/0","doc":"","ref":"macula_pubsub_subscription.html#t:topic/0"},{"type":"module","title":"macula_pubsub_topic","doc":"Topic utilities for pub/sub system. Handles topic validation, pattern matching, and normalization. Supports MQTT-style wildcards: * (single-level) and # (multi-level).","ref":"macula_pubsub_topic.html"},{"type":"function","title":"macula_pubsub_topic.matches/2","doc":"Check if topic matches pattern. Patterns can contain: - * matches exactly one segment - # matches zero or more segments","ref":"macula_pubsub_topic.html#matches/2"},{"type":"function","title":"macula_pubsub_topic.namespace/1","doc":"Extract namespace (first segment).","ref":"macula_pubsub_topic.html#namespace/1"},{"type":"function","title":"macula_pubsub_topic.normalize/1","doc":"Normalize topic (lowercase, trim, remove double dots).","ref":"macula_pubsub_topic.html#normalize/1"},{"type":"type","title":"macula_pubsub_topic.pattern/0","doc":"","ref":"macula_pubsub_topic.html#t:pattern/0"},{"type":"function","title":"macula_pubsub_topic.segment_count/1","doc":"Count number of segments in topic.","ref":"macula_pubsub_topic.html#segment_count/1"},{"type":"type","title":"macula_pubsub_topic.topic/0","doc":"","ref":"macula_pubsub_topic.html#t:topic/0"},{"type":"function","title":"macula_pubsub_topic.validate/1","doc":"Validate topic syntax. Valid topics: - Non-empty - Segments separated by dots - Segments contain alphanumeric, underscore, hyphen, wildcards - No leading or trailing dots","ref":"macula_pubsub_topic.html#validate/1"},{"type":"module","title":"macula_quic","doc":"Main API module for Macula QUIC transport. Provides a simplified wrapper around the quicer library.","ref":"macula_quic.html"},{"type":"function","title":"macula_quic.accept/2","doc":"Accept an incoming connection on a listener. After accepting, the connection needs handshake to complete.","ref":"macula_quic.html#accept/2"},{"type":"function","title":"macula_quic.accept_stream/2","doc":"Accept an incoming stream on a connection.","ref":"macula_quic.html#accept_stream/2"},{"type":"function","title":"macula_quic.async_send/2","doc":"Send data on a stream asynchronously (non-blocking). This returns immediately without waiting for QUIC flow control.","ref":"macula_quic.html#async_send/2"},{"type":"function","title":"macula_quic.close/1","doc":"Close a listener, connection, or stream.","ref":"macula_quic.html#close/1"},{"type":"function","title":"macula_quic.connect/4","doc":"Connect to a QUIC server. Options: {alpn, [Protocol]} - List of ALPN protocols {verify, none | verify_peer} - Certificate verification mode","ref":"macula_quic.html#connect/4"},{"type":"function","title":"macula_quic.listen/2","doc":"Start a QUIC listener on the specified port. Options: {cert, CertFile} - Path to PEM certificate file {key, KeyFile} - Path to PEM private key file {alpn, [Protocol]} - List of ALPN protocols (e.g., [\"macula\"]) {peer_unidi_stream_count, N} - Max unidirectional streams {peer_bidi_stream_count, N} - Max bidirectional streams","ref":"macula_quic.html#listen/2"},{"type":"function","title":"macula_quic.open_stream/1","doc":"Open a new bidirectional stream on a connection.","ref":"macula_quic.html#open_stream/1"},{"type":"function","title":"macula_quic.recv/2","doc":"Receive data from a stream (blocking).","ref":"macula_quic.html#recv/2"},{"type":"function","title":"macula_quic.send/2","doc":"Send data on a stream (blocking).","ref":"macula_quic.html#send/2"},{"type":"module","title":"macula_quic_cert","doc":"Macula QUIC certificate utilities. Provides functions for generating and validating self-signed certificates for QUIC connections via OpenSSL command-line tool.","ref":"macula_quic_cert.html"},{"type":"function","title":"macula_quic_cert.generate_self_signed/0","doc":"Generate a self-signed certificate and key in a temporary directory. Returns {ok, CertFile, KeyFile} with paths to generated files. The files are created in /tmp/macula_certs_PID for test isolation.","ref":"macula_quic_cert.html#generate_self_signed/0"},{"type":"function","title":"macula_quic_cert.generate_self_signed/1","doc":"Generate a self-signed certificate and key in the given directory. Returns {ok, {CertFile, KeyFile}} with paths to generated files.","ref":"macula_quic_cert.html#generate_self_signed/1"},{"type":"function","title":"macula_quic_cert.generate_self_signed/2","doc":"Generate a self-signed certificate with custom options. Options: subject - Certificate subject (default: \"/CN=macula.local\") validity_days - Validity period in days (default: 365)","ref":"macula_quic_cert.html#generate_self_signed/2"},{"type":"function","title":"macula_quic_cert.validate_files/2","doc":"Validate that both certificate and key files exist and are readable.","ref":"macula_quic_cert.html#validate_files/2"},{"type":"module","title":"macula_quic_conn_callback","doc":"QUIC connection callback module for Macula. Implements quicer_connection behavior to handle connection lifecycle.","ref":"macula_quic_conn_callback.html"},{"type":"function","title":"macula_quic_conn_callback.closed/3","doc":"Handle connection closed","ref":"macula_quic_conn_callback.html#closed/3"},{"type":"function","title":"macula_quic_conn_callback.connected/3","doc":"Handle connection established","ref":"macula_quic_conn_callback.html#connected/3"},{"type":"function","title":"macula_quic_conn_callback.handle_info/2","doc":"Handle other messages","ref":"macula_quic_conn_callback.html#handle_info/2"},{"type":"function","title":"macula_quic_conn_callback.init/1","doc":"Initialize connection callback state","ref":"macula_quic_conn_callback.html#init/1"},{"type":"function","title":"macula_quic_conn_callback.local_address_changed/3","doc":"Handle local address changed","ref":"macula_quic_conn_callback.html#local_address_changed/3"},{"type":"function","title":"macula_quic_conn_callback.new_conn/3","doc":"Handle new connection With quicer_server, streams are delivered automatically via new_stream/3","ref":"macula_quic_conn_callback.html#new_conn/3"},{"type":"function","title":"macula_quic_conn_callback.new_stream/3","doc":"Handle new stream With quicer_server, ALL streams are delivered here (not just orphans) Forward them to the gateway for processing","ref":"macula_quic_conn_callback.html#new_stream/3"},{"type":"function","title":"macula_quic_conn_callback.nst_received/3","doc":"Handle NST received (not used for server)","ref":"macula_quic_conn_callback.html#nst_received/3"},{"type":"function","title":"macula_quic_conn_callback.peer_address_changed/3","doc":"Handle peer address changed","ref":"macula_quic_conn_callback.html#peer_address_changed/3"},{"type":"function","title":"macula_quic_conn_callback.peer_needs_streams/3","doc":"Handle peer needs streams","ref":"macula_quic_conn_callback.html#peer_needs_streams/3"},{"type":"function","title":"macula_quic_conn_callback.resumed/3","doc":"Handle connection resumed","ref":"macula_quic_conn_callback.html#resumed/3"},{"type":"function","title":"macula_quic_conn_callback.shutdown/3","doc":"Handle connection shutdown","ref":"macula_quic_conn_callback.html#shutdown/3"},{"type":"function","title":"macula_quic_conn_callback.streams_available/3","doc":"Handle streams available","ref":"macula_quic_conn_callback.html#streams_available/3"},{"type":"function","title":"macula_quic_conn_callback.transport_shutdown/3","doc":"Handle transport shutdown","ref":"macula_quic_conn_callback.html#transport_shutdown/3"},{"type":"module","title":"macula_quic_stream_acceptor","doc":"QUIC stream acceptor process. Dedicated process that waits for incoming streams on a connection and forwards them to the gateway for processing.","ref":"macula_quic_stream_acceptor.html"},{"type":"function","title":"macula_quic_stream_acceptor.handle_call/3","doc":"","ref":"macula_quic_stream_acceptor.html#handle_call/3"},{"type":"function","title":"macula_quic_stream_acceptor.handle_cast/2","doc":"","ref":"macula_quic_stream_acceptor.html#handle_cast/2"},{"type":"function","title":"macula_quic_stream_acceptor.handle_info/2","doc":"Handle new stream from peer - THIS IS THE KEY MESSAGE!","ref":"macula_quic_stream_acceptor.html#handle_info/2"},{"type":"function","title":"macula_quic_stream_acceptor.init/1","doc":"","ref":"macula_quic_stream_acceptor.html#init/1"},{"type":"function","title":"macula_quic_stream_acceptor.start_link/2","doc":"Start stream acceptor process","ref":"macula_quic_stream_acceptor.html#start_link/2"},{"type":"function","title":"macula_quic_stream_acceptor.terminate/2","doc":"","ref":"macula_quic_stream_acceptor.html#terminate/2"},{"type":"module","title":"macula_realm","doc":"Realm management and validation. Realms provide logical isolation boundaries in the mesh. Realm names follow reverse DNS notation (e.g., \"org.example.mesh\").","ref":"macula_realm.html"},{"type":"function","title":"macula_realm.equals/2","doc":"Check if two realm names are equal.","ref":"macula_realm.html#equals/2"},{"type":"function","title":"macula_realm.from_binary/1","doc":"Decode realm name from binary.","ref":"macula_realm.html#from_binary/1"},{"type":"function","title":"macula_realm.id/1","doc":"Generate deterministic realm ID from name. Uses SHA-256 hash for 256-bit realm IDs.","ref":"macula_realm.html#id/1"},{"type":"function","title":"macula_realm.namespace/1","doc":"Extract namespace (top-level domain) from realm name. Example: \"org.example.mesh\" -> \"org\"","ref":"macula_realm.html#namespace/1"},{"type":"function","title":"macula_realm.normalize/1","doc":"Normalize realm name (lowercase, trim).","ref":"macula_realm.html#normalize/1"},{"type":"type","title":"macula_realm.realm_id/0","doc":"32-byte SHA-256 hash","ref":"macula_realm.html#t:realm_id/0"},{"type":"type","title":"macula_realm.realm_name/0","doc":"","ref":"macula_realm.html#t:realm_name/0"},{"type":"function","title":"macula_realm.to_binary/1","doc":"Encode realm name to binary.","ref":"macula_realm.html#to_binary/1"},{"type":"function","title":"macula_realm.validate/1","doc":"Validate realm name format. Rules: - Reverse DNS notation (org.example.mesh) - Lowercase alphanumeric, dots, hyphens, underscores - No leading/trailing dots - No consecutive dots","ref":"macula_realm.html#validate/1"},{"type":"module","title":"macula_root","doc":"Macula Application Root Supervisor. This is the top-level supervisor for the Macula application. It manages core infrastructure and optionally starts gateway services. Supervision Hierarchy: <span class=\"w\">  </span><span class=\"nf\">macula_root</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9117607625-1\">(</span><span class=\"ss\">this</span><span class=\"w\"> </span><span class=\"ss\">module</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"ss\">application</span><span class=\"w\"> </span><span class=\"ss\">root</span><span class=\"p\" data-group-id=\"9117607625-1\">)</span><span class=\"w\">\n  </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"nf\">macula_routing_server</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9117607625-2\">(</span><span class=\"ss\">core</span><span class=\"w\"> </span><span class=\"n\">DHT</span><span class=\"w\"> </span><span class=\"ss\">infrastructure</span><span class=\"p\" data-group-id=\"9117607625-2\">)</span><span class=\"w\">\n  </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"nf\">macula_gateway_system</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"9117607625-3\">(</span><span class=\"ss\">optional</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"ss\">gateway</span><span class=\"w\"> </span><span class=\"ss\">subsystem</span><span class=\"p\" data-group-id=\"9117607625-3\">)</span><span class=\"w\">\n      </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_health</span><span class=\"w\">\n      </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_diagnostics</span><span class=\"w\">\n      </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_quic_server</span><span class=\"w\">\n      </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway</span><span class=\"w\">\n      </span><span class=\"err\"></span><span class=\"err\"></span><span class=\"err\"></span><span class=\"w\"> </span><span class=\"ss\">macula_gateway_workers_sup</span><span class=\"w\">\n  </span> Naming Convention (v0.7.10+): - _root: Application root supervisor (one per application) - _system: Subsystem root supervisors (gateway, peer, etc.) - _sup: Worker supervisors (workers_sup)","ref":"macula_root.html"},{"type":"function","title":"macula_root.init/1","doc":"","ref":"macula_root.html#init/1"},{"type":"function","title":"macula_root.start_link/0","doc":"","ref":"macula_root.html#start_link/0"},{"type":"module","title":"macula_routing_bucket","doc":"K-bucket for Kademlia routing table. Stores up to k nodes with LRU eviction policy.","ref":"macula_routing_bucket.html"},{"type":"function","title":"macula_routing_bucket.add_node/2","doc":"Add a node to the bucket. If node exists, move to tail (most recent). If bucket full, return {error, bucket_full}.","ref":"macula_routing_bucket.html#add_node/2"},{"type":"type","title":"macula_routing_bucket.bucket/0","doc":"","ref":"macula_routing_bucket.html#t:bucket/0"},{"type":"function","title":"macula_routing_bucket.capacity/1","doc":"Get bucket capacity.","ref":"macula_routing_bucket.html#capacity/1"},{"type":"function","title":"macula_routing_bucket.find_closest/3","doc":"Find n closest nodes to target (sorted by XOR distance).","ref":"macula_routing_bucket.html#find_closest/3"},{"type":"function","title":"macula_routing_bucket.find_node/2","doc":"Find a node by ID.","ref":"macula_routing_bucket.html#find_node/2"},{"type":"function","title":"macula_routing_bucket.get_nodes/1","doc":"Get all nodes in the bucket (ordered: oldest first).","ref":"macula_routing_bucket.html#get_nodes/1"},{"type":"function","title":"macula_routing_bucket.has_node/2","doc":"Check if bucket contains node.","ref":"macula_routing_bucket.html#has_node/2"},{"type":"function","title":"macula_routing_bucket.new/1","doc":"Create a new bucket with capacity k.","ref":"macula_routing_bucket.html#new/1"},{"type":"type","title":"macula_routing_bucket.node_info/0","doc":"","ref":"macula_routing_bucket.html#t:node_info/0"},{"type":"function","title":"macula_routing_bucket.remove_node/2","doc":"Remove a node from the bucket.","ref":"macula_routing_bucket.html#remove_node/2"},{"type":"function","title":"macula_routing_bucket.size/1","doc":"Get number of nodes in bucket.","ref":"macula_routing_bucket.html#size/1"},{"type":"function","title":"macula_routing_bucket.update_timestamp/2","doc":"Update node's last_seen timestamp (moves to tail).","ref":"macula_routing_bucket.html#update_timestamp/2"},{"type":"module","title":"macula_routing_dht","doc":"Core DHT algorithms for Kademlia routing. Implements iterative lookup, store, and find operations. Pure functions - no GenServer, designed to be called by macula_routing_server.","ref":"macula_routing_dht.html"},{"type":"function","title":"macula_routing_dht.find_value/4","doc":"Find value in DHT. Returns {ok, Value} if found, {nodes, [NodeInfo]} if not found.","ref":"macula_routing_dht.html#find_value/4"},{"type":"function","title":"macula_routing_dht.iterative_find_node/4","doc":"Iterative lookup to find k closest nodes to target. Uses alpha concurrent queries (default: 3).","ref":"macula_routing_dht.html#iterative_find_node/4"},{"type":"type","title":"macula_routing_dht.query_fn/0","doc":"","ref":"macula_routing_dht.html#t:query_fn/0"},{"type":"function","title":"macula_routing_dht.select_alpha/3","doc":"Select up to alpha unqueried nodes from closest set.","ref":"macula_routing_dht.html#select_alpha/3"},{"type":"type","title":"macula_routing_dht.store_fn/0","doc":"","ref":"macula_routing_dht.html#t:store_fn/0"},{"type":"function","title":"macula_routing_dht.store_value/6","doc":"Store value at k closest nodes to key.","ref":"macula_routing_dht.html#store_value/6"},{"type":"function","title":"macula_routing_dht.update_closest/4","doc":"Update closest set with new nodes, maintaining k closest and removing duplicates.","ref":"macula_routing_dht.html#update_closest/4"},{"type":"module","title":"macula_routing_nodeid","doc":"Node ID utilities for Kademlia DHT. 256-bit node identifiers with XOR distance metric.","ref":"macula_routing_nodeid.html"},{"type":"function","title":"macula_routing_nodeid.bucket_index/2","doc":"Calculate bucket index for a node relative to local node. Returns leading zero count of XOR distance (0..255). Special case: distance 0 (same node) returns 256. Normalizes inputs to 32 bytes if needed.","ref":"macula_routing_nodeid.html#bucket_index/2"},{"type":"function","title":"macula_routing_nodeid.closer_to/3","doc":"Check if NodeA is closer to Target than NodeB. Normalizes inputs to 32 bytes if needed.","ref":"macula_routing_nodeid.html#closer_to/3"},{"type":"function","title":"macula_routing_nodeid.compare/3","doc":"Compare distances of NodeA and NodeB to Target. Returns: less (A closer), equal (same distance), greater (B closer). Normalizes inputs to 32 bytes if needed.","ref":"macula_routing_nodeid.html#compare/3"},{"type":"function","title":"macula_routing_nodeid.distance/2","doc":"Calculate XOR distance between two node IDs. Normalizes inputs to 32 bytes if needed.","ref":"macula_routing_nodeid.html#distance/2"},{"type":"function","title":"macula_routing_nodeid.from_binary/1","doc":"Create node ID from binary (validates size).","ref":"macula_routing_nodeid.html#from_binary/1"},{"type":"function","title":"macula_routing_nodeid.from_hex/1","doc":"Parse node ID from hex string. Crashes on invalid hex or wrong length - exposes bugs in validation logic.","ref":"macula_routing_nodeid.html#from_hex/1"},{"type":"function","title":"macula_routing_nodeid.generate/0","doc":"Generate a random 256-bit node ID.","ref":"macula_routing_nodeid.html#generate/0"},{"type":"function","title":"macula_routing_nodeid.leading_zeros/1","doc":"Count leading zero bits in binary.","ref":"macula_routing_nodeid.html#leading_zeros/1"},{"type":"type","title":"macula_routing_nodeid.node_id/0","doc":"32 bytes (256 bits)","ref":"macula_routing_nodeid.html#t:node_id/0"},{"type":"function","title":"macula_routing_nodeid.normalize/1","doc":"Normalize any binary to a 32-byte node ID. If already 32 bytes, returns as-is. Otherwise, hashes with SHA-256.","ref":"macula_routing_nodeid.html#normalize/1"},{"type":"function","title":"macula_routing_nodeid.to_hex/1","doc":"Convert node ID to hex string.","ref":"macula_routing_nodeid.html#to_hex/1"},{"type":"module","title":"macula_routing_protocol","doc":"DHT protocol message encoding/decoding. Maps DHT operations to/from message format.","ref":"macula_routing_protocol.html"},{"type":"function","title":"macula_routing_protocol.decode_find_node/1","doc":"Decode FIND_NODE request.","ref":"macula_routing_protocol.html#decode_find_node/1"},{"type":"function","title":"macula_routing_protocol.decode_find_node_reply/1","doc":"Decode FIND_NODE reply.","ref":"macula_routing_protocol.html#decode_find_node_reply/1"},{"type":"function","title":"macula_routing_protocol.decode_find_value/1","doc":"Decode FIND_VALUE request.","ref":"macula_routing_protocol.html#decode_find_value/1"},{"type":"function","title":"macula_routing_protocol.decode_find_value_reply/1","doc":"Decode FIND_VALUE reply.","ref":"macula_routing_protocol.html#decode_find_value_reply/1"},{"type":"function","title":"macula_routing_protocol.decode_node_info/1","doc":"Decode node info.","ref":"macula_routing_protocol.html#decode_node_info/1"},{"type":"function","title":"macula_routing_protocol.decode_store/1","doc":"Decode STORE request.","ref":"macula_routing_protocol.html#decode_store/1"},{"type":"function","title":"macula_routing_protocol.encode_find_node/1","doc":"Encode FIND_NODE request.","ref":"macula_routing_protocol.html#encode_find_node/1"},{"type":"function","title":"macula_routing_protocol.encode_find_node_reply/1","doc":"Encode FIND_NODE reply.","ref":"macula_routing_protocol.html#encode_find_node_reply/1"},{"type":"function","title":"macula_routing_protocol.encode_find_value/1","doc":"Encode FIND_VALUE request.","ref":"macula_routing_protocol.html#encode_find_value/1"},{"type":"function","title":"macula_routing_protocol.encode_find_value_reply/1","doc":"Encode FIND_VALUE reply.","ref":"macula_routing_protocol.html#encode_find_value_reply/1"},{"type":"function","title":"macula_routing_protocol.encode_node_info/1","doc":"Encode node info (for transmission).","ref":"macula_routing_protocol.html#encode_node_info/1"},{"type":"function","title":"macula_routing_protocol.encode_store/2","doc":"Encode STORE request.","ref":"macula_routing_protocol.html#encode_store/2"},{"type":"function","title":"macula_routing_protocol.is_find_node/1","doc":"Check if message is FIND_NODE.","ref":"macula_routing_protocol.html#is_find_node/1"},{"type":"function","title":"macula_routing_protocol.is_find_value/1","doc":"Check if message is FIND_VALUE.","ref":"macula_routing_protocol.html#is_find_value/1"},{"type":"function","title":"macula_routing_protocol.is_store/1","doc":"Check if message is STORE.","ref":"macula_routing_protocol.html#is_store/1"},{"type":"type","title":"macula_routing_protocol.message/0","doc":"","ref":"macula_routing_protocol.html#t:message/0"},{"type":"module","title":"macula_routing_server","doc":"GenServer managing Kademlia DHT routing table and operations. Integrates all routing components: table, DHT algorithms, protocol.","ref":"macula_routing_server.html"},{"type":"function","title":"macula_routing_server.add_node/2","doc":"Add node to routing table.","ref":"macula_routing_server.html#add_node/2"},{"type":"function","title":"macula_routing_server.find_closest/3","doc":"Find k closest nodes to target.","ref":"macula_routing_server.html#find_closest/3"},{"type":"function","title":"macula_routing_server.find_value/3","doc":"Find value in DHT using iterative lookup. Returns {ok, Value} if found, {nodes, Nodes} if not found.","ref":"macula_routing_server.html#find_value/3"},{"type":"function","title":"macula_routing_server.get_local/2","doc":"Get value from local storage.","ref":"macula_routing_server.html#get_local/2"},{"type":"function","title":"macula_routing_server.get_routing_table/1","doc":"Get routing table snapshot.","ref":"macula_routing_server.html#get_routing_table/1"},{"type":"function","title":"macula_routing_server.handle_message/2","doc":"Handle incoming DHT message and return reply.","ref":"macula_routing_server.html#handle_message/2"},{"type":"function","title":"macula_routing_server.size/1","doc":"Get number of nodes in routing table.","ref":"macula_routing_server.html#size/1"},{"type":"function","title":"macula_routing_server.start_link/2","doc":"Start routing server with registered name macula_routing_server.","ref":"macula_routing_server.html#start_link/2"},{"type":"function","title":"macula_routing_server.store/3","doc":"Store value in DHT by propagating to k closest nodes. Stores locally first, then sends STORE messages to k closest peers.","ref":"macula_routing_server.html#store/3"},{"type":"function","title":"macula_routing_server.store_local/3","doc":"Store value locally.","ref":"macula_routing_server.html#store_local/3"},{"type":"module","title":"macula_routing_table","doc":"Routing table for Kademlia DHT. Manages 256 k-buckets organized by XOR distance.","ref":"macula_routing_table.html"},{"type":"function","title":"macula_routing_table.add_node/2","doc":"Add a node to the routing table. Calculates bucket index and adds to appropriate bucket.","ref":"macula_routing_table.html#add_node/2"},{"type":"function","title":"macula_routing_table.bucket_size/2","doc":"Get size of a specific bucket.","ref":"macula_routing_table.html#bucket_size/2"},{"type":"function","title":"macula_routing_table.find_closest/3","doc":"Find k closest nodes to target.","ref":"macula_routing_table.html#find_closest/3"},{"type":"function","title":"macula_routing_table.get_all_nodes/1","doc":"Get all nodes from all buckets.","ref":"macula_routing_table.html#get_all_nodes/1"},{"type":"function","title":"macula_routing_table.get_bucket/2","doc":"Get bucket by index.","ref":"macula_routing_table.html#get_bucket/2"},{"type":"function","title":"macula_routing_table.k/1","doc":"Get k (bucket capacity).","ref":"macula_routing_table.html#k/1"},{"type":"function","title":"macula_routing_table.local_node_id/1","doc":"Get local node ID.","ref":"macula_routing_table.html#local_node_id/1"},{"type":"function","title":"macula_routing_table.new/2","doc":"Create a new routing table.","ref":"macula_routing_table.html#new/2"},{"type":"function","title":"macula_routing_table.remove_node/2","doc":"Remove a node from the routing table.","ref":"macula_routing_table.html#remove_node/2"},{"type":"type","title":"macula_routing_table.routing_table/0","doc":"","ref":"macula_routing_table.html#t:routing_table/0"},{"type":"function","title":"macula_routing_table.size/1","doc":"Get total number of nodes in routing table.","ref":"macula_routing_table.html#size/1"},{"type":"function","title":"macula_routing_table.update_timestamp/2","doc":"Update timestamp for a node (moves to tail in its bucket).","ref":"macula_routing_table.html#update_timestamp/2"},{"type":"module","title":"macula_rpc_cache","doc":"LRU cache for RPC procedure results. Caches results of idempotent procedures to avoid repeated execution. Wraps macula_cache with RPC-specific logic and TTL handling.","ref":"macula_rpc_cache.html"},{"type":"type","title":"macula_rpc_cache.cache/0","doc":"","ref":"macula_rpc_cache.html#t:cache/0"},{"type":"function","title":"macula_rpc_cache.clear/1","doc":"Clear all entries.","ref":"macula_rpc_cache.html#clear/1"},{"type":"function","title":"macula_rpc_cache.get/3","doc":"Get entry from cache. Returns {ok, Result, UpdatedCache} or not_found. The updated cache has the entry moved to front (LRU). Automatically removes expired entries.","ref":"macula_rpc_cache.html#get/3"},{"type":"function","title":"macula_rpc_cache.invalidate/3","doc":"Invalidate (remove) entry.","ref":"macula_rpc_cache.html#invalidate/3"},{"type":"function","title":"macula_rpc_cache.is_expired/3","doc":"Check if entry is expired.","ref":"macula_rpc_cache.html#is_expired/3"},{"type":"function","title":"macula_rpc_cache.make_key/2","doc":"Make cache key from URI and args. Uses hash of URI and args for consistent key generation.","ref":"macula_rpc_cache.html#make_key/2"},{"type":"function","title":"macula_rpc_cache.max_size/1","doc":"Get max size.","ref":"macula_rpc_cache.html#max_size/1"},{"type":"function","title":"macula_rpc_cache.new/1","doc":"Create new cache with max size.","ref":"macula_rpc_cache.html#new/1"},{"type":"function","title":"macula_rpc_cache.put/5","doc":"Put entry in cache.","ref":"macula_rpc_cache.html#put/5"},{"type":"function","title":"macula_rpc_cache.put_with_timestamp/6","doc":"Put entry with custom timestamp (for testing).","ref":"macula_rpc_cache.html#put_with_timestamp/6"},{"type":"function","title":"macula_rpc_cache.size/1","doc":"Get number of entries.","ref":"macula_rpc_cache.html#size/1"},{"type":"module","title":"macula_rpc_discovery","doc":"DHT integration for finding RPC service providers. Uses Kademlia DHT to publish and discover RPC registrations. Wraps macula_discovery with RPC-specific types.","ref":"macula_rpc_discovery.html"},{"type":"type","title":"macula_rpc_discovery.address/0","doc":"","ref":"macula_rpc_discovery.html#t:address/0"},{"type":"function","title":"macula_rpc_discovery.announce/5","doc":"Announce local registration to DHT.","ref":"macula_rpc_discovery.html#announce/5"},{"type":"type","title":"macula_rpc_discovery.dht_lookup_fun/0","doc":"","ref":"macula_rpc_discovery.html#t:dht_lookup_fun/0"},{"type":"type","title":"macula_rpc_discovery.dht_publish_fun/0","doc":"","ref":"macula_rpc_discovery.html#t:dht_publish_fun/0"},{"type":"type","title":"macula_rpc_discovery.dht_unpublish_fun/0","doc":"","ref":"macula_rpc_discovery.html#t:dht_unpublish_fun/0"},{"type":"function","title":"macula_rpc_discovery.filter_available/2","doc":"Filter providers to only available ones (based on last_seen TTL).","ref":"macula_rpc_discovery.html#filter_available/2"},{"type":"function","title":"macula_rpc_discovery.find_providers/2","doc":"Find service providers for a URI via DHT.","ref":"macula_rpc_discovery.html#find_providers/2"},{"type":"function","title":"macula_rpc_discovery.find_with_cache/3","doc":"Find providers with cache (default TTL: 300 seconds).","ref":"macula_rpc_discovery.html#find_with_cache/3"},{"type":"function","title":"macula_rpc_discovery.find_with_cache/4","doc":"Find providers with cache and custom TTL.","ref":"macula_rpc_discovery.html#find_with_cache/4"},{"type":"type","title":"macula_rpc_discovery.node_id/0","doc":"","ref":"macula_rpc_discovery.html#t:node_id/0"},{"type":"type","title":"macula_rpc_discovery.provider_info/0","doc":"","ref":"macula_rpc_discovery.html#t:provider_info/0"},{"type":"function","title":"macula_rpc_discovery.unannounce/3","doc":"Remove local registration from DHT.","ref":"macula_rpc_discovery.html#unannounce/3"},{"type":"type","title":"macula_rpc_discovery.uri/0","doc":"","ref":"macula_rpc_discovery.html#t:uri/0"},{"type":"module","title":"macula_rpc_executor","doc":"RPC call execution with timeout handling. Executes local handlers and remote calls via QUIC.","ref":"macula_rpc_executor.html"},{"type":"type","title":"macula_rpc_executor.address/0","doc":"","ref":"macula_rpc_executor.html#t:address/0"},{"type":"function","title":"macula_rpc_executor.execute_local/3","doc":"Execute local handler with timeout.","ref":"macula_rpc_executor.html#execute_local/3"},{"type":"function","title":"macula_rpc_executor.execute_remote/5","doc":"Execute remote call via QUIC with timeout.","ref":"macula_rpc_executor.html#execute_remote/5"},{"type":"function","title":"macula_rpc_executor.generate_call_id/0","doc":"Generate unique call ID (16-byte UUID).","ref":"macula_rpc_executor.html#generate_call_id/0"},{"type":"type","title":"macula_rpc_executor.handler_fn/0","doc":"","ref":"macula_rpc_executor.html#t:handler_fn/0"},{"type":"type","title":"macula_rpc_executor.provider_info/0","doc":"","ref":"macula_rpc_executor.html#t:provider_info/0"},{"type":"type","title":"macula_rpc_executor.send_fun/0","doc":"","ref":"macula_rpc_executor.html#t:send_fun/0"},{"type":"module","title":"macula_rpc_handler","doc":"RPC handler GenServer - manages RPC calls, replies, and failover. Responsibilities: - Execute RPC calls (local check first, then DHT discovery) - Handle incoming RPC replies from network - Manage call timeouts with automatic failover - Track pending calls with call IDs - Monitor caller processes for automatic cleanup - Provider selection strategies (random, round-robin, etc.) Memory Safety: - Monitors caller processes to prevent memory leaks - Cleans up immediately when caller dies (no waiting for timeout) - Cancels timers and removes pending entries on cleanup Extracted from macula_connection.erl (Phase 5)","ref":"macula_rpc_handler.html"},{"type":"function","title":"macula_rpc_handler.call/4","doc":"","ref":"macula_rpc_handler.html#call/4"},{"type":"function","title":"macula_rpc_handler.handle_call/3","doc":"","ref":"macula_rpc_handler.html#handle_call/3"},{"type":"function","title":"macula_rpc_handler.handle_cast/2","doc":"","ref":"macula_rpc_handler.html#handle_cast/2"},{"type":"function","title":"macula_rpc_handler.handle_incoming_reply/2","doc":"","ref":"macula_rpc_handler.html#handle_incoming_reply/2"},{"type":"function","title":"macula_rpc_handler.handle_info/2","doc":"","ref":"macula_rpc_handler.html#handle_info/2"},{"type":"function","title":"macula_rpc_handler.init/1","doc":"","ref":"macula_rpc_handler.html#init/1"},{"type":"function","title":"macula_rpc_handler.register_handler/2","doc":"","ref":"macula_rpc_handler.html#register_handler/2"},{"type":"function","title":"macula_rpc_handler.start_link/1","doc":"","ref":"macula_rpc_handler.html#start_link/1"},{"type":"function","title":"macula_rpc_handler.terminate/2","doc":"","ref":"macula_rpc_handler.html#terminate/2"},{"type":"function","title":"macula_rpc_handler.unregister_handler/1","doc":"","ref":"macula_rpc_handler.html#unregister_handler/1"},{"type":"module","title":"macula_rpc_names","doc":"Name validation and utilities for RPC procedures. Uses reverse DNS notation: org.domain.service.procedure","ref":"macula_rpc_names.html"},{"type":"function","title":"macula_rpc_names.matches/2","doc":"Check if name matches pattern. For now, only exact matching (no wildcards). Future: Could add wildcard patterns if needed.","ref":"macula_rpc_names.html#matches/2"},{"type":"type","title":"macula_rpc_names.name/0","doc":"","ref":"macula_rpc_names.html#t:name/0"},{"type":"function","title":"macula_rpc_names.namespace/1","doc":"Extract namespace (first segment).","ref":"macula_rpc_names.html#namespace/1"},{"type":"function","title":"macula_rpc_names.normalize/1","doc":"Normalize name (lowercase, trim, remove double dots).","ref":"macula_rpc_names.html#normalize/1"},{"type":"function","title":"macula_rpc_names.segment_count/1","doc":"Count number of segments in name.","ref":"macula_rpc_names.html#segment_count/1"},{"type":"function","title":"macula_rpc_names.validate/1","doc":"Validate RPC procedure name syntax. Valid names: - Non-empty - Segments separated by dots - Segments contain alphanumeric, underscore, hyphen - No leading or trailing dots - No double dots - No wildcards allowed (unlike topics)","ref":"macula_rpc_names.html#validate/1"},{"type":"module","title":"macula_rpc_registry","doc":"Local RPC procedure registration registry. Maps URIs to handler functions. Supports multiple handlers per URI (for load balancing).","ref":"macula_rpc_registry.html"},{"type":"function","title":"macula_rpc_registry.find/2","doc":"Find all registrations for a URI.","ref":"macula_rpc_registry.html#find/2"},{"type":"function","title":"macula_rpc_registry.find_handlers/2","doc":"Find all handlers for a URI.","ref":"macula_rpc_registry.html#find_handlers/2"},{"type":"type","title":"macula_rpc_registry.handler_fn/0","doc":"","ref":"macula_rpc_registry.html#t:handler_fn/0"},{"type":"type","title":"macula_rpc_registry.invocation_strategy/0","doc":"","ref":"macula_rpc_registry.html#t:invocation_strategy/0"},{"type":"function","title":"macula_rpc_registry.list_registrations/1","doc":"List all registrations.","ref":"macula_rpc_registry.html#list_registrations/1"},{"type":"function","title":"macula_rpc_registry.list_uris/1","doc":"List all unique URIs in registry.","ref":"macula_rpc_registry.html#list_uris/1"},{"type":"function","title":"macula_rpc_registry.new/0","doc":"Create new empty registry with default strategy (round_robin).","ref":"macula_rpc_registry.html#new/0"},{"type":"function","title":"macula_rpc_registry.new/1","doc":"Create new empty registry with custom strategy.","ref":"macula_rpc_registry.html#new/1"},{"type":"function","title":"macula_rpc_registry.register/4","doc":"Register a procedure handler. Allows multiple handlers for the same URI (for load balancing).","ref":"macula_rpc_registry.html#register/4"},{"type":"type","title":"macula_rpc_registry.registration/0","doc":"","ref":"macula_rpc_registry.html#t:registration/0"},{"type":"type","title":"macula_rpc_registry.registry/0","doc":"","ref":"macula_rpc_registry.html#t:registry/0"},{"type":"function","title":"macula_rpc_registry.size/1","doc":"Get total number of registrations.","ref":"macula_rpc_registry.html#size/1"},{"type":"function","title":"macula_rpc_registry.unregister/3","doc":"Unregister a specific procedure handler. Only removes the exact handler function.","ref":"macula_rpc_registry.html#unregister/3"},{"type":"module","title":"macula_rpc_router","doc":"RPC call routing strategies. Selects which provider to use for a call (local or remote).","ref":"macula_rpc_router.html"},{"type":"function","title":"macula_rpc_router.new_state/1","doc":"Create new router state.","ref":"macula_rpc_router.html#new_state/1"},{"type":"type","title":"macula_rpc_router.provider_info/0","doc":"","ref":"macula_rpc_router.html#t:provider_info/0"},{"type":"type","title":"macula_rpc_router.registration/0","doc":"","ref":"macula_rpc_router.html#t:registration/0"},{"type":"type","title":"macula_rpc_router.router_state/0","doc":"","ref":"macula_rpc_router.html#t:router_state/0"},{"type":"function","title":"macula_rpc_router.select_local/1","doc":"Select local handler (returns first one).","ref":"macula_rpc_router.html#select_local/1"},{"type":"function","title":"macula_rpc_router.select_provider/3","doc":"Select provider using stateless strategy. For local_first, random, and closest strategies.","ref":"macula_rpc_router.html#select_provider/3"},{"type":"function","title":"macula_rpc_router.select_provider_closest/3","doc":"Select provider using closest strategy (requires local node ID).","ref":"macula_rpc_router.html#select_provider_closest/3"},{"type":"function","title":"macula_rpc_router.select_provider_stateful/3","doc":"Select provider using stateful strategy (for round_robin).","ref":"macula_rpc_router.html#select_provider_stateful/3"},{"type":"function","title":"macula_rpc_router.select_remote_random/1","doc":"Select random remote provider.","ref":"macula_rpc_router.html#select_remote_random/1"},{"type":"type","title":"macula_rpc_router.strategy/0","doc":"","ref":"macula_rpc_router.html#t:strategy/0"},{"type":"module","title":"macula_rpc_routing","doc":"RPC routing for multi-hop DHT-routed RPC. Handles wrapping, unwrapping, and routing of RPC messages through the Kademlia DHT mesh.","ref":"macula_rpc_routing.html"},{"type":"function","title":"macula_rpc_routing.route_or_deliver/3","doc":"Route an rpc_route message: either deliver locally or forward to next hop. Returns one of: {deliver, PayloadType, Payload} - Message is for this node {forward, NextHopNodeInfo, UpdatedRpcRouteMsg} - Forward to next hop {error, Reason} - Cannot route (TTL exceeded, no route, etc.)","ref":"macula_rpc_routing.html#route_or_deliver/3"},{"type":"function","title":"macula_rpc_routing.should_deliver_locally/2","doc":"Determine if this node should deliver the message locally or forward it.","ref":"macula_rpc_routing.html#should_deliver_locally/2"},{"type":"function","title":"macula_rpc_routing.wrap_call/4","doc":"Wrap a CALL message in rpc_route envelope for DHT routing.","ref":"macula_rpc_routing.html#wrap_call/4"},{"type":"function","title":"macula_rpc_routing.wrap_reply/4","doc":"Wrap a REPLY message in rpc_route envelope for DHT routing back to caller.","ref":"macula_rpc_routing.html#wrap_reply/4"},{"type":"module","title":"macula_rpc_server","doc":"RPC server managing registrations and calls. GenServer that integrates registry, cache, discovery, router, and executor.","ref":"macula_rpc_server.html"},{"type":"function","title":"macula_rpc_server.call/4","doc":"Synchronous call to procedure.","ref":"macula_rpc_server.html#call/4"},{"type":"type","title":"macula_rpc_server.config/0","doc":"","ref":"macula_rpc_server.html#t:config/0"},{"type":"function","title":"macula_rpc_server.handle_call/3","doc":"Handle synchronous calls.","ref":"macula_rpc_server.html#handle_call/3"},{"type":"function","title":"macula_rpc_server.handle_cast/2","doc":"Handle asynchronous casts (none implemented).","ref":"macula_rpc_server.html#handle_cast/2"},{"type":"function","title":"macula_rpc_server.handle_info/2","doc":"Handle info messages (none expected).","ref":"macula_rpc_server.html#handle_info/2"},{"type":"function","title":"macula_rpc_server.init/1","doc":"Initialize server state.","ref":"macula_rpc_server.html#init/1"},{"type":"function","title":"macula_rpc_server.list_registrations/1","doc":"List local registrations.","ref":"macula_rpc_server.html#list_registrations/1"},{"type":"function","title":"macula_rpc_server.register/4","doc":"Register procedure.","ref":"macula_rpc_server.html#register/4"},{"type":"function","title":"macula_rpc_server.start_link/2","doc":"Start RPC server.","ref":"macula_rpc_server.html#start_link/2"},{"type":"type","title":"macula_rpc_server.state/0","doc":"","ref":"macula_rpc_server.html#t:state/0"},{"type":"function","title":"macula_rpc_server.stop/1","doc":"Stop RPC server.","ref":"macula_rpc_server.html#stop/1"},{"type":"function","title":"macula_rpc_server.terminate/2","doc":"Cleanup on termination.","ref":"macula_rpc_server.html#terminate/2"},{"type":"function","title":"macula_rpc_server.unregister/3","doc":"Unregister procedure.","ref":"macula_rpc_server.html#unregister/3"},{"type":"module","title":"macula_service_registry","doc":"Decentralized service advertisement registry using DHT. Provides service discovery via Kademlia DHT instead of centralized registration. Services advertise their capabilities to the DHT, and clients discover providers by querying the DHT. Architecture - Services advertise: \"I provide procedure X\"  DHT stores node_id at key=hash(procedure) - Clients discover: \"Who provides procedure X?\"  DHT returns list of node_ids - Local cache: Recent discoveries cached with TTL for low-latency lookups - Re-advertisement: Periodic republish to DHT for TTL renewal (default: every 5 min) Features - Fully decentralized (no central authority) - Multiple providers supported (DHT returns list) - Load balancing (client picks from list) - Fault tolerant (try another provider if one fails) - Low latency after first lookup (local cache)","ref":"macula_service_registry.html"},{"type":"function","title":"macula_service_registry.advertise_local/4","doc":"Advertise a service locally (stores handler for incoming calls). This registers the service handler locally so this node can respond to incoming RPC calls. The actual DHT advertisement must be done separately (see  publish_to_dht/4 ).","ref":"macula_service_registry.html#advertise_local/4"},{"type":"type","title":"macula_service_registry.cache_entry/0","doc":"","ref":"macula_service_registry.html#t:cache_entry/0"},{"type":"function","title":"macula_service_registry.cache_service/4","doc":"Cache discovered service providers. Stores providers in local cache with TTL. Subsequent  discover_service  calls will return cached results until TTL expires.","ref":"macula_service_registry.html#cache_service/4"},{"type":"function","title":"macula_service_registry.cache_subscribers/4","doc":"Cache discovered subscribers for a topic. Stores subscribers in local cache with TTL. Subsequent discover_subscribers/2 calls will return cached results until TTL expires.","ref":"macula_service_registry.html#cache_subscribers/4"},{"type":"function","title":"macula_service_registry.clear_cache/1","doc":"Clear the entire discovery cache.","ref":"macula_service_registry.html#clear_cache/1"},{"type":"function","title":"macula_service_registry.clear_subscriber_cache/1","doc":"Clear the entire subscriber cache.","ref":"macula_service_registry.html#clear_subscriber_cache/1"},{"type":"function","title":"macula_service_registry.discover_service/2","doc":"Discover service providers (checks cache first, returns cached if available).","ref":"macula_service_registry.html#discover_service/2"},{"type":"function","title":"macula_service_registry.discover_service/3","doc":"Discover service providers with options. Checks local cache first. If found and not expired, returns cached providers. If cache miss or expired, returns  {cache_miss, Registry}  so caller can query DHT. Options: -  force_refresh  - Skip cache, force DHT lookup (default: false)","ref":"macula_service_registry.html#discover_service/3"},{"type":"function","title":"macula_service_registry.discover_subscribers/2","doc":"Discover subscribers for a topic (checks cache first). Similar to discover_service/2 but for pub/sub subscribers. Returns cached subscribers if found and not expired, otherwise cache_miss.","ref":"macula_service_registry.html#discover_subscribers/2"},{"type":"function","title":"macula_service_registry.get_local_handler/2","doc":"Get handler function for a locally advertised service.","ref":"macula_service_registry.html#get_local_handler/2"},{"type":"type","title":"macula_service_registry.handler_fn/0","doc":"Handler function for local service implementations.","ref":"macula_service_registry.html#t:handler_fn/0"},{"type":"function","title":"macula_service_registry.list_local_services/1","doc":"List all locally advertised services.","ref":"macula_service_registry.html#list_local_services/1"},{"type":"type","title":"macula_service_registry.local_service/0","doc":"","ref":"macula_service_registry.html#t:local_service/0"},{"type":"function","title":"macula_service_registry.new/0","doc":"Create new empty service registry with default settings.","ref":"macula_service_registry.html#new/0"},{"type":"function","title":"macula_service_registry.new/1","doc":"Create new service registry with custom options. Options: -  default_ttl  - Default TTL for DHT advertisements (default: 300s) -  cache_ttl  - How long to cache discovered services (default: 60s) -  service_ttl  - TTL for local services before cleanup (default: 300s, 5 minutes)","ref":"macula_service_registry.html#new/1"},{"type":"type","title":"macula_service_registry.node_id/0","doc":"32-byte node identifier.","ref":"macula_service_registry.html#t:node_id/0"},{"type":"type","title":"macula_service_registry.provider_info/0","doc":"","ref":"macula_service_registry.html#t:provider_info/0"},{"type":"function","title":"macula_service_registry.prune_expired/1","doc":"Remove expired entries from discovery cache. Should be called periodically to prevent memory leaks. Returns updated registry and count of removed entries.","ref":"macula_service_registry.html#prune_expired/1"},{"type":"function","title":"macula_service_registry.prune_expired_local_services/1","doc":"Remove expired local services. Should be called periodically to prevent memory leaks from stale service registrations. Returns updated registry and count of removed services.","ref":"macula_service_registry.html#prune_expired_local_services/1"},{"type":"function","title":"macula_service_registry.prune_expired_subscribers/1","doc":"Remove expired subscriber cache entries. Should be called periodically to prevent memory leaks. Returns updated registry and count of removed entries.","ref":"macula_service_registry.html#prune_expired_subscribers/1"},{"type":"function","title":"macula_service_registry.publish_to_dht/5","doc":"Publish a service advertisement to the DHT. This function publishes a service's provider information to the DHT so other nodes can discover it. The service_id is hashed to create a DHT key, and the provider information is stored at that key. Parameters: - DhtPid: Process ID or registered name of macula_routing_server - ServiceId: The service identifier (procedure URI) - ProviderInfo: Information about this provider (node_id, endpoint, metadata) - TTL: Time-to-live in seconds for this advertisement - K: Number of nodes to store at (typically 20 for Kademlia) Returns: - ok if successful - {error, Reason} if publication failed Example: <span class=\"w\">  </span><span class=\"n\">ProviderInfo</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"0563811690-1\">#{</span><span class=\"w\">\n      </span><span class=\"ss\">node_id</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"0563811690-2\">&lt;&lt;</span><span class=\"s\">&quot;my-node-123&quot;</span><span class=\"p\" data-group-id=\"0563811690-2\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"ss\">endpoint</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"0563811690-3\">&lt;&lt;</span><span class=\"s\">&quot;https://localhost:9443&quot;</span><span class=\"p\" data-group-id=\"0563811690-3\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"ss\">metadata</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"0563811690-4\">#{</span><span class=\"ss\">version</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\" data-group-id=\"0563811690-5\">&lt;&lt;</span><span class=\"s\">&quot;1.0&quot;</span><span class=\"p\" data-group-id=\"0563811690-5\">&gt;&gt;</span><span class=\"p\" data-group-id=\"0563811690-4\">}</span><span class=\"w\">\n  </span><span class=\"p\" data-group-id=\"0563811690-1\">}</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"ss\">ok</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">publish_to_dht</span><span class=\"p\" data-group-id=\"0563811690-6\">(</span><span class=\"n\">DhtPid</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;energy.home.get&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ProviderInfo</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">300</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"p\" data-group-id=\"0563811690-6\">)</span><span class=\"p\">.</span>","ref":"macula_service_registry.html#publish_to_dht/5"},{"type":"function","title":"macula_service_registry.query_dht_for_service/3","doc":"Query the DHT for service providers. This function queries the DHT to find nodes that provide a given service. It returns a list of provider_info() maps, each containing node_id, endpoint, and metadata for a provider. Parameters: - DhtPid: Process ID or registered name of macula_routing_server - ServiceId: The service identifier to query for - K: Number of closest nodes to query (typically 20 for Kademlia) Returns: - {ok, [ProviderInfo]} if providers found - {ok, []} if no providers found - {error, Reason} if query failed Example: <span class=\"w\">  </span><span class=\"p\" data-group-id=\"7265565950-1\">{</span><span class=\"ss\">ok</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Providers</span><span class=\"p\" data-group-id=\"7265565950-1\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">query_dht_for_service</span><span class=\"p\" data-group-id=\"7265565950-2\">(</span><span class=\"n\">DhtPid</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">lt</span><span class=\"p\">;</span><span class=\"s\">&quot;energy.home.get&quot;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"err\">&amp;</span><span class=\"ss\">gt</span><span class=\"p\">;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"p\" data-group-id=\"7265565950-2\">)</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"c1\">%% Returns: [{ok, [#{node_id =&gt; ..., endpoint =&gt; ..., metadata =&gt; ...}]}]</span>","ref":"macula_service_registry.html#query_dht_for_service/3"},{"type":"type","title":"macula_service_registry.registry/0","doc":"","ref":"macula_service_registry.html#t:registry/0"},{"type":"function","title":"macula_service_registry.remove_from_dht/3","doc":"Remove a service advertisement from the DHT. This function removes a service advertisement when unadvertising. Note: In practice, DHT entries expire naturally via TTL, so this is optional and mainly useful for immediate cleanup. Parameters: - DhtPid: Process ID or registered name of macula_routing_server - ServiceId: The service identifier to remove - NodeId: This node's identifier (to remove only this provider) Returns: - ok if successful or entry not found - {error, Reason} if removal failed","ref":"macula_service_registry.html#remove_from_dht/3"},{"type":"type","title":"macula_service_registry.service_id/0","doc":"Service identifier (procedure URI). Example: <<\"energy.home.get\">>.","ref":"macula_service_registry.html#t:service_id/0"},{"type":"function","title":"macula_service_registry.unadvertise_local/2","doc":"Remove a local service advertisement.","ref":"macula_service_registry.html#unadvertise_local/2"},{"type":"module","title":"macula_stream_acceptor","doc":"Dedicated process for accepting QUIC streams on a connection. This process runs a blocking loop calling quicer:accept_stream/3, ensuring we're ready to accept streams before the client creates them.","ref":"macula_stream_acceptor.html"},{"type":"function","title":"macula_stream_acceptor.init/2","doc":"Initialize the stream acceptor loop.","ref":"macula_stream_acceptor.html#init/2"},{"type":"function","title":"macula_stream_acceptor.start_link/2","doc":"Start a stream acceptor for a connection. Gateway is the process that should receive stream data events.","ref":"macula_stream_acceptor.html#start_link/2"},{"type":"module","title":"macula_time","doc":"Time utilities for Macula. Provides functions for timestamps, durations, and timeouts.","ref":"macula_time.html"},{"type":"function","title":"macula_time.duration_ms/2","doc":"Calculate duration in milliseconds between two timestamps.","ref":"macula_time.html#duration_ms/2"},{"type":"function","title":"macula_time.format_duration_ms/1","doc":"Format duration in milliseconds to human-readable string.","ref":"macula_time.html#format_duration_ms/1"},{"type":"function","title":"macula_time.format_timestamp/1","doc":"Format timestamp to ISO 8601 string.","ref":"macula_time.html#format_timestamp/1"},{"type":"function","title":"macula_time.is_expired/2","doc":"Check if timeout has expired.","ref":"macula_time.html#is_expired/2"},{"type":"function","title":"macula_time.minutes_to_ms/1","doc":"Convert minutes to milliseconds.","ref":"macula_time.html#minutes_to_ms/1"},{"type":"function","title":"macula_time.ms_to_seconds/1","doc":"Convert milliseconds to seconds (truncates).","ref":"macula_time.html#ms_to_seconds/1"},{"type":"function","title":"macula_time.seconds_to_ms/1","doc":"Convert seconds to milliseconds.","ref":"macula_time.html#seconds_to_ms/1"},{"type":"function","title":"macula_time.time_remaining/2","doc":"Calculate remaining time before timeout (in milliseconds). Returns 0 if already expired.","ref":"macula_time.html#time_remaining/2"},{"type":"function","title":"macula_time.timestamp/0","doc":"Get current timestamp in milliseconds since epoch.","ref":"macula_time.html#timestamp/0"},{"type":"function","title":"macula_time.timestamp_microseconds/0","doc":"Get current timestamp in microseconds since epoch.","ref":"macula_time.html#timestamp_microseconds/0"},{"type":"module","title":"macula_uri","doc":"Macula URI parsing and construction. Format: macula://realm/node_id Example: macula://org.example.mesh/0123456789abcdef...","ref":"macula_uri.html"},{"type":"function","title":"macula_uri.equals/2","doc":"Check if two URIs are equal.","ref":"macula_uri.html#equals/2"},{"type":"function","title":"macula_uri.get_node_id/1","doc":"Extract node ID from URI.","ref":"macula_uri.html#get_node_id/1"},{"type":"function","title":"macula_uri.get_realm/1","doc":"Extract realm from URI.","ref":"macula_uri.html#get_realm/1"},{"type":"function","title":"macula_uri.is_valid/1","doc":"Check if URI is valid.","ref":"macula_uri.html#is_valid/1"},{"type":"function","title":"macula_uri.new/2","doc":"Construct Macula URI from realm and node ID.","ref":"macula_uri.html#new/2"},{"type":"type","title":"macula_uri.node_id/0","doc":"","ref":"macula_uri.html#t:node_id/0"},{"type":"function","title":"macula_uri.parse/1","doc":"Parse Macula URI to extract realm and node ID.","ref":"macula_uri.html#parse/1"},{"type":"type","title":"macula_uri.realm/0","doc":"","ref":"macula_uri.html#t:realm/0"},{"type":"type","title":"macula_uri.uri/0","doc":"","ref":"macula_uri.html#t:uri/0"},{"type":"module","title":"macula_utils","doc":"Common utility functions for Macula. This module contains pure utility functions used across the Macula codebase to improve testability and eliminate duplication. All functions in this module are pure (no side effects) and can be tested independently.","ref":"macula_utils.html"},{"type":"function","title":"macula_utils.decode_json/1","doc":"Decode JSON binary to map/list.","ref":"macula_utils.html#decode_json/1"},{"type":"function","title":"macula_utils.encode_json/1","doc":"Encode map/list to JSON binary.","ref":"macula_utils.html#encode_json/1"},{"type":"function","title":"macula_utils.ensure_binary/1","doc":"Ensure value is binary.","ref":"macula_utils.html#ensure_binary/1"},{"type":"function","title":"macula_utils.generate_node_id/0","doc":"Generate a random node ID.","ref":"macula_utils.html#generate_node_id/0"},{"type":"function","title":"macula_utils.next_message_id/1","doc":"Get next message ID from counter. Returns {MessageId, NewCounter}.","ref":"macula_utils.html#next_message_id/1"},{"type":"function","title":"macula_utils.normalize_provider/1","doc":"Normalize provider map from binary keys to atom keys.","ref":"macula_utils.html#normalize_provider/1"},{"type":"function","title":"macula_utils.parse_host_port/2","doc":"Parse host:port string with default port.","ref":"macula_utils.html#parse_host_port/2"},{"type":"function","title":"macula_utils.parse_url/1","doc":"Parse URL to extract host and port.","ref":"macula_utils.html#parse_url/1"},{"type":"function","title":"macula_utils.topic_matches/5","doc":"Check if a published topic matches a subscription topic pattern. Supports configurable wildcards (defaults: dot-separated with * and **): - WildcardSingle (e.g., '*') matches a single segment - WildcardMulti (e.g., '**') matches multiple segments - Separator (e.g., '.') splits topic into segments - exact match otherwise","ref":"macula_utils.html#topic_matches/5"},{"type":"extras","title":"Overview","doc":"Macula HTTP/3 Mesh \n    Self-organizing distributed mesh for decentralized applications  \n\n   \n       \n       \n       \n   \n \n\n---\n\n \n   \n \n\n \n    BEAM-Native  HTTP/3 (QUIC)  Kademlia DHT  Direct P2P  Multi-Tenant  50% Faster (v0.8.0)  \n \n\n---","ref":"readme.html"},{"type":"extras","title":"Documentation - Overview","doc":"-  **[Getting Started](GETTING_STARTED.md)** - Installation, quick start, code examples\n-  **[Architecture Guide](ARCHITECTURE.md)** - Visual guide with C4 diagrams, deployment topologies\n-  **[Changelog](CHANGELOG.md)** - Version history and migration guides\n-  **[Development Guide](docs/DEVELOPMENT.md)** - Contributing and testing\n-  **[Kademlia DHT](docs/KADEMLIA_DHT_ARCHITECTURE.md)** - DHT implementation details\n\n---","ref":"readme.html#documentation"},{"type":"extras","title":"Latest Release: v0.8.4 (2025-11-17) - Overview","doc":"**Major features from v0.8.0:**\n-  Direct P2P QUIC connections (50% latency improvement)\n-  DHT propagation to k=20 closest nodes\n-  RPC and PubSub via direct P2P\n-  Production-ready memory management\n\n---","ref":"readme.html#latest-release-v0-8-4-2025-11-17"},{"type":"extras","title":"Community - Overview","doc":"- **Hex**: [hex.pm/packages/macula](https://hex.pm/packages/macula)\n- **GitHub**: [github.com/macula-io/macula](https://github.com/macula-io/macula)\n- **Issues**: [github.com/macula-io/macula/issues](https://github.com/macula-io/macula/issues)\n\n---\n\n**Built with  for the BEAM community**","ref":"readme.html#community"},{"type":"extras","title":"Getting Started","doc":"Macula HTTP/3 Mesh \n    Self-organizing distributed mesh for decentralized applications  \n\n   \n       \n       \n       \n   \n \n\n---\n\n \n   \n \n\n \n    BEAM-Native  HTTP/3 (QUIC)  Kademlia DHT  Direct P2P  Multi-Tenant  50% Faster (v0.8.0)  \n \n\n---","ref":"getting_started.html"},{"type":"extras","title":"Table of Contents - Getting Started","doc":"-  [Architecture Overview](ARCHITECTURE.md) - **Visual guide with diagrams** (C4, supervision trees, deployment topologies)\n-  [Quick Start](#quick-start) - Get started in minutes\n-  [What's New in v0.8.0](#whats-new-in-v080) - Latest features\n-  [Core Concepts](#core-concepts) - Understanding the mesh\n-  [API Overview](#api-overview) - Using Macula in your application\n-  [Changelog](CHANGELOG.md) - Version history and migration guides\n-  [Issues](https://github.com/macula-io/macula/issues) - Report bugs and request features\n\n---","ref":"getting_started.html#table-of-contents"},{"type":"extras","title":"What is Macula? - Getting Started","doc":"Macula is infrastructure for building **decentralized applications and services** that operate autonomously at the edge, without dependency on centralized cloud infrastructure.\n\n**Key Features:**\n\n **BEAM-native** (Erlang/Elixir OTP supervision and fault tolerance)\n **HTTP/3 (QUIC)** transport (modern, encrypted, NAT-friendly)\n **Edge-first design** (works through firewalls and NAT)\n **Built-in pub/sub & RPC** (no external message broker needed)\n **Multi-tenancy** (realm isolation for SaaS and shared infrastructure)\n **Self-organizing mesh** (DHT-based service discovery, O(log N) routing)\n **Production-ready patterns** (OTP behaviors, comprehensive testing, memory management)\n\n---","ref":"getting_started.html#what-is-macula"},{"type":"extras","title":"Architecture at a Glance - Getting Started","doc":"**System Context** - How your application uses Macula:\n\n```\n\n     Your     \n Application  \n\n        macula_peer API\n       \n     QUIC/HTTP3      \n Macula Peer     Gateway    \n (Local Node)     Or Direct P2P     (Relay Node) \n                     \n                                           \n        DHT \n                 (Service Discovery)\n```\n\n**Message Flow** (v0.8.0 Direct P2P):\n\n```\nClient 1. Query DHT DHT (Find Service)\nClient 2. Endpoint DHT Returns \"192.168.1.50:9443\"\nClient 3. Direct Provider (1-hop, 50ms)\nClient 4. Response Provider (50% faster than relay!)\n```\n\n** [See Full Architecture Guide](ARCHITECTURE.md)** with:\n- C4 diagrams (context, container views)\n- Deployment topologies (edge, microservices, hybrid)\n- Supervision trees (OTP fault tolerance)\n- DHT architecture (Kademlia routing)\n- Performance characteristics\n- When to use Macula\n\n---","ref":"getting_started.html#architecture-at-a-glance"},{"type":"extras","title":"Installation - Getting Started","doc":"**Elixir (mix.exs):**\n\n```elixir\ndef deps do\n  [\n    {:macula, \"~> 0.8\"}\n  ]\nend\n```\n\n**Erlang (rebar.config):**\n\n```erlang\n{deps, [\n    {macula, \"0.8.4\"}\n]}.\n```\n\n**Latest Release**: v0.8.4 (2025-11-17) - Fixed hex docs landing page redirect (v0.8.0: Direct P2P with DHT propagation)\n\n---\n\n##  What's New in v0.8.0\n\n**Major Features:**\n-  Direct P2P QUIC connections via `macula_peer_connector`\n-  DHT propagation to k=20 closest nodes (Kademlia-based)\n-  RPC via direct P2P (50% latency improvement)\n-  PubSub via direct P2P (50% latency improvement)\n-  21/21 integration tests passing (100% coverage)\n\n**Performance:**\n- 1-hop direct connections vs 2+ hop relay routing\n- Reduced gateway load\n- Better scalability for large meshes\n\n**Breaking Changes:** None - fully backward compatible with v0.7.x\n\n---","ref":"getting_started.html#installation"},{"type":"extras","title":"Quick Start - Getting Started","doc":"","ref":"getting_started.html#quick-start"},{"type":"extras","title":"1. Connect to a Gateway - Getting Started","doc":"```erlang\n%% Start a peer connection\n{ok, Peer} = macula_peer:start_link(<<\"https://gateway.example.com:9443\">>, #{\n    realm => <<\"com.example.app\">>\n}).\n```","ref":"getting_started.html#1-connect-to-a-gateway"},{"type":"extras","title":"2. Publish/Subscribe - Getting Started","doc":"```erlang\n%% Subscribe to events\nok = macula_peer:subscribe(Peer, <<\"sensor.temperature\">>, self()).\n\n%% Publish an event\nok = macula_peer:publish(Peer, <<\"sensor.temperature\">>, #{\n    device_id => <<\"sensor-001\">>,\n    celsius => 21.5,\n    timestamp => erlang:system_time(millisecond)\n}).\n\n%% Receive events\nreceive\n    {macula_event, <<\"sensor.temperature\">>, Payload} ->\n        io:format(\"Temperature: ~pC~n\", [maps:get(celsius, Payload)])\nend.\n```","ref":"getting_started.html#2-publish-subscribe"},{"type":"extras","title":"3. RPC (Remote Procedure Calls) - Getting Started","doc":"```erlang\n%% Call a remote service\n{ok, Result} = macula_peer:call(Peer, <<\"calculator.add\">>, #{\n    a => 5,\n    b => 3\n}).\n%% Result: #{result => 8}\n```","ref":"getting_started.html#3-rpc-remote-procedure-calls"},{"type":"extras","title":"4. Advertise Services (Providers) - Getting Started","doc":"```erlang\n%% Advertise a service handler\nok = macula_peer:advertise(Peer, <<\"calculator.add\">>, fun(Args) ->\n    A = maps:get(a, Args),\n    B = maps:get(b, Args),\n    #{result => A + B}\nend, #{ttl => 300}).\n```\n\n---","ref":"getting_started.html#4-advertise-services-providers"},{"type":"extras","title":"Core Concepts - Getting Started","doc":"","ref":"getting_started.html#core-concepts"},{"type":"extras","title":"Mesh Architecture - Getting Started","doc":"Macula creates a self-organizing mesh network where nodes communicate over HTTP/3 (QUIC). Each node can act as:\n- **Peer** - Application client/server participating in the mesh\n- **Gateway** - Relay node for NAT-traversed peers (optional)\n- **Registry** - DHT participant storing service advertisements","ref":"getting_started.html#mesh-architecture"},{"type":"extras","title":"Multi-Tenancy via Realms - Getting Started","doc":"Realms provide logical isolation for different applications sharing the same physical mesh:\n```erlang\n%% App 1\n{ok, Peer1} = macula_peer:start_link(GatewayUrl, #{realm => <<\"com.app1\">>}).\n\n%% App 2 (completely isolated from App 1)\n{ok, Peer2} = macula_peer:start_link(GatewayUrl, #{realm => <<\"com.app2\">>}).\n```","ref":"getting_started.html#multi-tenancy-via-realms"},{"type":"extras","title":"DHT-Based Service Discovery - Getting Started","doc":"Services are discovered via a Kademlia DHT with k=20 replication:\n1. Provider advertises: `advertise(<<\"my.service\">>, Handler)`\n2. DHT propagates to k=20 closest nodes\n3. Consumer discovers: `call(<<\"my.service\">>, Args)`\n4. Direct P2P connection established (v0.8.0+)","ref":"getting_started.html#dht-based-service-discovery"},{"type":"extras","title":"Direct P2P Connections (v0.8.0) - Getting Started","doc":"Instead of relaying through gateways, v0.8.0 establishes direct QUIC connections:\n- Discovered endpoint  Direct connection\n- 50% latency reduction (1-hop vs 2+ hops)\n- Reduced gateway load\n\n---","ref":"getting_started.html#direct-p2p-connections-v0-8-0"},{"type":"extras","title":"API Overview - Getting Started","doc":"","ref":"getting_started.html#api-overview"},{"type":"extras","title":"Main Modules - Getting Started","doc":"**`macula_peer`** - High-level mesh participant API\n- `start_link/2` - Connect to gateway\n- `publish/3`, `subscribe/3` - Pub/sub messaging\n- `call/3`, `advertise/4` - RPC and service registration\n\n**`macula_gateway`** - Gateway/relay node\n- Embedded or standalone gateway deployment\n- Client lifecycle management\n- Message routing and forwarding\n\n**`macula_peer_connector`** - Direct P2P connections (v0.8.0)\n- Establishes outbound QUIC connections\n- Fire-and-forget message delivery","ref":"getting_started.html#main-modules"},{"type":"extras","title":"Configuration Options - Getting Started","doc":"```erlang\nOpts = #{\n    realm => <<\"com.example.app\">>,        %% Required: Realm for isolation\n    node_id => <<\"my-node-001\">>,         %% Optional: Custom node ID\n    cert_file => \"cert.pem\",               %% Optional: TLS certificate\n    key_file => \"key.pem\"                  %% Optional: TLS private key\n}\n```\n\n---","ref":"getting_started.html#configuration-options"},{"type":"extras","title":"Development Setup - Getting Started","doc":"```bash\n# Clone the repository\ngit clone https://github.com/macula-io/macula.git\ncd macula\n\n# Fetch dependencies\nrebar3 get-deps\n\n# Compile\nrebar3 compile\n\n# Run tests\nrebar3 eunit\n\n# Start a shell with Macula loaded\nrebar3 shell\n```\n\n---","ref":"getting_started.html#development-setup"},{"type":"extras","title":"Testing - Getting Started","doc":"```bash\n# Run unit tests\nrebar3 eunit\n\n# Run integration tests (requires Docker)\nrebar3 ct --suite=test/integration/multi_hop_rpc_SUITE\nrebar3 ct --suite=test/integration/multi_hop_pubsub_SUITE\n```\n\n---","ref":"getting_started.html#testing"},{"type":"extras","title":"License - Getting Started","doc":"Macula is licensed under the Apache License 2.0. See [LICENSE](LICENSE) for details.\n\n---","ref":"getting_started.html#license"},{"type":"extras","title":"Community & Support - Getting Started","doc":"- **Issues**: [GitHub Issues](https://github.com/macula-io/macula/issues)\n- **Hex Package**: [hex.pm/packages/macula](https://hex.pm/packages/macula)\n- **Source Code**: [github.com/macula-io/macula](https://github.com/macula-io/macula)\n\n---\n\n**Built with  for the BEAM community**","ref":"getting_started.html#community-support"},{"type":"extras","title":"Architecture Guide","doc":"# Macula Architecture Overview\n\n> **Visual guide to understanding Macula's distributed mesh architecture**\n\n---","ref":"architecture.html"},{"type":"extras","title":"Table of Contents - Architecture Guide","doc":"1. [System Context (C4)](#system-context-c4)\n2. [Container View (C4)](#container-view-c4)\n3. [Deployment Topologies](#deployment-topologies)\n4. [Supervision Trees](#supervision-trees)\n5. [Message Flow Patterns](#message-flow-patterns)\n6. [DHT Architecture](#dht-architecture)\n7. [Direct P2P Connections (v0.8.0)](#direct-p2p-connections-v080)\n\n---","ref":"architecture.html#table-of-contents"},{"type":"extras","title":"System Context (C4) - Architecture Guide","doc":"**How applications use Macula to build distributed systems**\n\n```mermaid\ngraph TB\n    subgraph \"Your Application\"\n        App[Elixir/Erlang Application]\n    end\n\n    subgraph \"Macula Platform\"\n        Peer[macula_peer Mesh Participant API]\n        Gateway[macula_gateway Relay Node]\n        DHT[Distributed Hash Table Service Discovery]\n    end\n\n    subgraph \"Other Nodes\"\n        Remote1[Remote Service 1]\n        Remote2[Remote Service 2]\n        Remote3[Remote Subscriber]\n    end\n\n    App -->|start_link publish subscribe call advertise| Peer\n    Peer -->|QUIC/HTTP3| Gateway\n    Peer -.->|Direct P2P| Remote1\n    Peer -.->|Direct P2P| Remote2\n    Gateway -->|Relay| Remote3\n\n    Peer <-->|Query| DHT\n    Gateway <-->|Store/Find| DHT\n\n    style Peer fill:#4CAF50\n    style Gateway fill:#2196F3\n    style DHT fill:#FF9800\n    style App fill:#9C27B0\n```\n\n**Key Concepts:**\n- **macula_peer**: Your application's interface to the mesh\n- **macula_gateway**: Relay node for NAT-traversed peers (optional)\n- **DHT**: Kademlia-based distributed service registry (k=20 replication)\n- **Direct P2P**: v0.8.0+ establishes direct QUIC connections (50% latency improvement)\n\n---","ref":"architecture.html#system-context-c4"},{"type":"extras","title":"Container View (C4) - Architecture Guide","doc":"**Internal architecture of a Macula node**\n\n```mermaid\ngraph TB\n    subgraph \"Application Layer\"\n        App[Your Application Code]\n    end\n\n    subgraph \"Macula Peer (High-Level API)\"\n        Peer[macula_peer Facade/Coordinator]\n\n        subgraph \"Supervised Children\"\n            Conn[macula_connection QUIC Transport]\n            PSH[macula_pubsub_handler Pub/Sub Logic]\n            RPC[macula_rpc_handler RPC Logic]\n            ADV[macula_advertisement_manager DHT Ads]\n        end\n    end\n\n    subgraph \"Gateway (Optional Relay)\"\n        GW[macula_gateway Coordinator]\n\n        subgraph \"Gateway Workers\"\n            Clients[macula_gateway_client_manager Client Lifecycle]\n            GWPS[macula_gateway_pubsub Message Routing]\n            GWRPC[macula_gateway_rpc Handler Registry]\n            Mesh[macula_gateway_mesh Connection Pool]\n        end\n    end\n\n    subgraph \"Core Services\"\n        Routing[macula_routing_server DHT Node]\n        Service[macula_service_registry Service Store]\n        PubSubDHT[macula_pubsub_dht Subscriber Discovery]\n    end\n\n    App -->|API Calls| Peer\n    Peer --> Conn\n    Peer --> PSH\n    Peer --> RPC\n    Peer --> ADV\n\n    Conn -.->|QUIC| GW\n    GW --> Clients\n    GW --> GWPS\n    GW --> GWRPC\n    GW --> Mesh\n\n    PSH --> PubSubDHT\n    RPC --> Service\n    ADV --> Service\n    Service --> Routing\n    PubSubDHT --> Routing\n\n    style Peer fill:#4CAF50\n    style GW fill:#2196F3\n    style Routing fill:#FF9800\n```\n\n**Architecture Principles:**\n- **Single Responsibility**: Each module has one clear purpose\n- **OTP Supervision**: Automatic fault recovery at all levels\n- **Stateless Utilities**: DHT operations don't hold state\n- **Connection Pooling**: Gateway reuses QUIC connections (v0.9.0+)\n\n---","ref":"architecture.html#container-view-c4"},{"type":"extras","title":"Deployment Topologies - Architecture Guide","doc":"","ref":"architecture.html#deployment-topologies"},{"type":"extras","title":"1. Edge-First Mesh (IoT, Distributed Systems) - Architecture Guide","doc":"```\n\n                     Cloud / Data Center                      \n                  \n    Bootstrap   Bootstrap   Bootstrap     \n      Node              Node              Node        \n   (DHT Seed)        (DHT Seed)        (DHT Seed)     \n                  \n                                                           \n\n                                                 \n                       \n     Gateway             Gateway          Gateway \n      Node     Node     Node   \n    (Relay+             (Relay+          (Relay+  \n     DHT)                DHT)             DHT)    \n                       \n                                                 \n                       \n      Edge                Edge             Edge   \n      Peer     Peer     Peer   \n    (Behind    Direct   (Behind   Direct (Behind  \n      NAT)       P2P      NAT)     P2P     NAT)   \n      (v0.8.0)  (v0.8.0)\n                                                 \n                       \n     Sensor              Sensor           Sensor  \n     Device              Device           Device  \n                       \n```\n\n**Use Cases:**\n- IoT networks with edge processing\n- Distributed sensor networks\n- Edge computing platforms\n- Multi-site deployments\n\n**Features:**\n- Bootstrap nodes: DHT seeds (always available)\n- Gateway nodes: Relay for NAT-traversed peers\n- Edge peers: Application logic at the edge\n- Direct P2P: v0.8.0+ bypasses relay when possible\n\n---","ref":"architecture.html#1-edge-first-mesh-iot-distributed-systems"},{"type":"extras","title":"2. Microservices Mesh (Kubernetes, Cloud) - Architecture Guide","doc":"```\n\n                    Kubernetes Cluster                        \n                                                               \n     \n                Namespace: macula-system                    \n                                                             \n                      \n    Bootstrap   Bootstrap   Bootstrap               \n       Pod         Pod         Pod                  \n    (Headless   (Headless   (Headless               \n     Service)    Service)    Service)               \n                      \n                             \n     \n                                                              \n     \n                Namespace: app-services                      \n                                                            \n                   \n            Service A (3 replicas)                       \n                       \n        Pod A1    Pod A2    Pod A3                \n      (macula   (macula   (macula                 \n       peer)     peer)     peer)                  \n                       \n                   \n                                                        \n                                  \n                                                          \n                   \n            Service B (2 replicas)                       \n                                  \n        Pod B1   Pod B2                       \n      (macula  Direct(macula                        \n       peer)     P2P  peer)                         \n      (v0.8)                      \n                    \n     \n\n```\n\n**Use Cases:**\n- Microservices communication\n- Service mesh alternative\n- Event-driven architectures\n- Multi-tenant platforms\n\n**Features:**\n- No external message broker needed\n- Built-in service discovery via DHT\n- Realm-based multi-tenancy\n- Direct P2P between pods (v0.8.0+)\n\n---","ref":"architecture.html#2-microservices-mesh-kubernetes-cloud"},{"type":"extras","title":"3. Hybrid Cloud-Edge (Best of Both Worlds) - Architecture Guide","doc":"```\n\n                         Cloud Region                         \n                  \n    Gateway     Gateway     Gateway       \n   (Public IP)       (Public IP)       (Public IP)    \n                  \n\n                                                 \n    Internet/WAN          Internet/WAN        Internet/WAN\n                                                 \n\n                                                           \n                           \n    Factory              Retail           Office      \n      Site                Site             Site       \n                                                      \n                                 \n    Edge              Edge           Edge       \n    Peer              Peer           Peer       \n                                 \n                                                   \n                                 \n    Equip              POS            App       \n                                 \n                           \n                     Edge Locations                           \n\n```\n\n**Use Cases:**\n- Retail chains with local processing\n- Manufacturing with edge analytics\n- Distributed branch offices\n- Multi-region applications\n\n**Features:**\n- Cloud gateways for global reach\n- Edge peers for local processing\n- Automatic failover (relay  direct P2P)\n- Low latency via direct connections\n\n---","ref":"architecture.html#3-hybrid-cloud-edge-best-of-both-worlds"},{"type":"extras","title":"Supervision Trees - Architecture Guide","doc":"","ref":"architecture.html#supervision-trees"},{"type":"extras","title":"Peer Supervision Tree - Architecture Guide","doc":"```\n                    macula_peer_sup\n                          \n        \n                                          \n                                          \nmacula_connection  macula_pubsub_handler  macula_rpc_handler\n  (QUIC Layer)      (Pub/Sub Logic)       (RPC Logic)\n        \n        \nmacula_advertisement_manager\n  (Service Ads)\n```\n\n**Strategy**: `one_for_all`\n- If any child crashes, restart all (coordinated state)\n- Connection is the foundation; handlers depend on it\n\n---","ref":"architecture.html#peer-supervision-tree"},{"type":"extras","title":"Gateway Supervision Tree - Architecture Guide","doc":"```\n                    macula_gateway_sup (Root)\n                            \n        \n                                              \n                                              \nmacula_gateway_    macula_gateway    macula_gateway_workers_sup\n  quic_server                               (Supervisor)\n (QUIC Listener)   (Coordinator)                \n                                    \n                                                          \n                                                          \n                          client_manager  pubsub_router  rpc_handler\n                            (Lifecycle)    (Routing)     (Registry)\n                                    \n                                    \n                              mesh_connection_manager\n                                 (Pool)\n```\n\n**Strategy**: `rest_for_one` (top-level)\n- QUIC server starts first\n- Gateway coordinates\n- Workers handle business logic\n- If QUIC crashes, restart everything\n- If worker crashes, only restart later siblings\n\n**Strategy**: `one_for_one` (workers)\n- Each worker independent\n- Failures isolated to single worker\n\n---","ref":"architecture.html#gateway-supervision-tree"},{"type":"extras","title":"Message Flow Patterns - Architecture Guide","doc":"","ref":"architecture.html#message-flow-patterns"},{"type":"extras","title":"RPC Flow (v0.8.0 Direct P2P) - Architecture Guide","doc":"```\n                                         \n Client                                           Provider \n  Peer                                              Peer   \n                                         \n                                                         \n      1. call(\"service.add\", #{a=>5, b=>3})            \n                      \n                                                       \n                                                       \n                                            \n                                   DHT                \n                                 (Find                \n                                 Service)             \n                                            \n                                                       \n      2. Returns: \"192.168.1.50:9443\"                  \n                      \n                                                        \n      3. Direct QUIC Connection                        \n     \n        RPC_REQUEST: service.add, {a:5, b:3}           \n                                                        \n                                       4. Execute Handler\n                                          Result = 8    \n                                                        \n      5. RPC_RESPONSE: {result: 8}                     \n     \n                                                        \n                                                        \n  Returns                                            Handler\n{ok, #{result=>8}}                                   Executed\n```\n\n**Performance**: 1-hop (direct), ~10-50ms latency\n**Fallback**: If direct fails, relay via gateway (2-3 hops)\n\n---","ref":"architecture.html#rpc-flow-v0-8-0-direct-p2p"},{"type":"extras","title":"PubSub Flow (v0.8.0 Direct P2P) - Architecture Guide","doc":"```\n                                      \nPublisher                                       Subscriber\n   Peer                                            Peer   \n                                      \n                                                      \n      1. subscribe(\"sensor.temp\")                    \n                                         \n                                      DHT          \n                                     Store:  \n                                   \"sensor.\"       \n                                   \"temp\" ->       \n                                   192.1.1.X       \n                                         \n                                                      \n      2. publish(\"sensor.temp\", {celsius: 21.5})     \n                                   \n                                                     \n                                                     \n                                          \n                    DHT                             \n                  Find:                             \n                 \"sensor.\"                          \n                   \"temp\"                           \n                                          \n                                                     \n      3. Returns: \"192.168.1.X:9443\"                 \n                                   \n                                                      \n      4. Direct QUIC Connection                      \n     \n        PUBLISH: sensor.temp, {celsius: 21.5}        \n                                                      \n                                       5. Deliver to  \n                                          Subscriber  \n                                                      \n                                             receive {macula_event,\n                                                      \"sensor.temp\",\n                                                      #{celsius=>21.5}}\n```\n\n**Performance**: 1-hop (direct), ~10-50ms latency\n**Wildcard Support**: `sensor.*` matches `sensor.temp`, `sensor.pressure`\n**Fanout**: One DHT query finds all subscribers\n\n---","ref":"architecture.html#pubsub-flow-v0-8-0-direct-p2p"},{"type":"extras","title":"DHT Architecture - Architecture Guide","doc":"","ref":"architecture.html#dht-architecture"},{"type":"extras","title":"Kademlia XOR Distance - Architecture Guide","doc":"```\nNode ID Space (160-bit):\n\n    0                                              2^160\n    \n\n    Distance(A, B) = A XOR B\n\n    Example:\n    Node A: 1010...\n    Node B: 1100...\n    XOR:    0110... (closer = smaller distance)\n```","ref":"architecture.html#kademlia-xor-distance"},{"type":"extras","title":"Routing Table (K-Buckets) - Architecture Guide","doc":"```\nEach node maintains:\n\nBucket 0:  Nodes 2^0    distance away  [0-1 bits different]\nBucket 1:  Nodes 2^1    distance away  [1-2 bits different]\nBucket 2:  Nodes 2^2    distance away  [2-4 bits different]\n...\nBucket 159: Nodes 2^159 distance away  [159-160 bits different]\n\nEach bucket holds up to k=20 nodes (sorted by last-seen time)\n```","ref":"architecture.html#routing-table-k-buckets"},{"type":"extras","title":"DHT Operations - Architecture Guide","doc":"#### STORE Operation (k=20 Propagation)\n\n```\n1. Hash key: hash(\"service.calculator.add\") = node_id\n2. Find k=20 closest nodes via iterative lookup\n3. Send STORE to all k nodes\n4. Each node stores: {key, value, ttl}\n\n  STORE   \n  Node   Node 1  (closest)\n  (You)  Node 2 \n         Node 3 \n           ...  \n        Node 20 \n          \n```\n\n#### FIND_VALUE Operation\n\n```\n1. Hash key: hash(\"service.calculator.add\") = target_id\n2. Query closest known nodes\n3. If found, return value\n4. If not found, return closer nodes\n5. Repeat until value found or no closer nodes\n\n  FIND    \n  Node   Node A \n  (You)           \"Not found,\n          Closer     try Node B\"\n           Nodes              \n                              \n          FIND    \n         Node B \n                 \"Found! Here's\n          Value     the value\"\n\n```\n\n**Complexity**: O(log N) hops to find any key\n**Redundancy**: k=20 replication for fault tolerance\n\n---","ref":"architecture.html#dht-operations"},{"type":"extras","title":"Direct P2P Connections (v0.8.0) - Architecture Guide","doc":"","ref":"architecture.html#direct-p2p-connections-v0-8-0"},{"type":"extras","title":"Connection Strategy - Architecture Guide","doc":"```\n\n                    Connection Decision Flow                  \n\n\n        \n          Need to send message   \n          (RPC or PubSub)        \n        \n                    \n                    \n        \n          Query DHT for endpoint \n          (IP:Port discovered)   \n        \n                    \n                    \n        \n          Attempt Direct P2P     \n          via peer_connector     \n        \n                    \n            \n                           \n       Success           Failure\n                           \n                           \n       \n       Message        Fallback   \n      Delivered       to Gateway \n       (1-hop)         Relay     \n                      (2-3 hops) \n       \n                             \n        \n                   \n                   \n          \n           100% Reliability\n            Guaranteed     \n          \n```\n\n**Benefits**:\n- 50% latency reduction when direct succeeds\n- Automatic fallback ensures reliability\n- Gateway load reduced (more direct connections = less relay traffic)\n\n---","ref":"architecture.html#connection-strategy"},{"type":"extras","title":"Performance Comparison - Architecture Guide","doc":"```\n\n              Message Delivery Latency (ms)                   \n\n\nv0.7.x (Relay-Only):\n    50ms        50ms    \nClient  Gateway Server \n                        \nTotal: ~100ms (2-hop minimum)\n\n\nv0.8.0 (Direct P2P):\n           50ms              \nClient Server \n                             \nTotal: ~50ms (1-hop direct)\n\n50% Improvement! \n```\n\n---","ref":"architecture.html#performance-comparison"},{"type":"extras","title":"Module Dependencies - Architecture Guide","doc":"```\nApplication Layer\n       \n       \n\n              macula_peer (API Facade)               \n\n                                   \n     \n    macula_connection     macula_pubsub_   \n     (QUIC Transport)        handler       \n     \n                                   \n     \n     macula_quic          macula_pubsub_   \n      (MsQuic FFI)             dht         \n     \n                                    \n   \n         macula_routing_server (DHT)         \n       (Kademlia, k=20 replication)          \n   \n             \n   \n    macula_routing_    \n         table         \n     (K-buckets)       \n   \n```\n\n**Layered Architecture**:\n1. **API Layer**: High-level user-facing API\n2. **Business Logic**: Pub/sub, RPC, advertisements\n3. **Transport Layer**: QUIC connections and streams\n4. **Discovery Layer**: DHT for service/subscriber lookup\n5. **Routing Layer**: Kademlia routing table\n\n---","ref":"architecture.html#module-dependencies"},{"type":"extras","title":"Key Takeaways for Architects - Architecture Guide","doc":"","ref":"architecture.html#key-takeaways-for-architects"},{"type":"extras","title":" What Makes Macula Unique - Architecture Guide","doc":"1. **BEAM-Native**\n   - OTP supervision for automatic fault recovery\n   - Process-per-connection scalability\n   - Erlang's proven distributed systems DNA\n\n2. **Modern Transport**\n   - HTTP/3 (QUIC) instead of TCP\n   - Built-in encryption (TLS 1.3)\n   - NAT/firewall friendly\n   - Multiplexed streams\n\n3. **Self-Organizing**\n   - No centralized message broker\n   - DHT-based service discovery (Kademlia)\n   - Automatic replication (k=20)\n   - O(log N) lookup complexity\n\n4. **Direct P2P (v0.8.0)**\n   - 50% latency improvement\n   - Bypasses relay when possible\n   - Automatic fallback for reliability\n   - Scales better (less gateway load)\n\n5. **Multi-Tenancy**\n   - Realm-based isolation\n   - Share infrastructure, isolate traffic\n   - Perfect for SaaS platforms\n\n---","ref":"architecture.html#what-makes-macula-unique"},{"type":"extras","title":" Performance Characteristics - Architecture Guide","doc":"| Metric | Value | Notes |\n|--------|-------|-------|\n| **Message Latency** | ~50ms | Direct P2P (v0.8.0) |\n| | ~100ms | Relay via gateway |\n| **DHT Lookup** | O(log N) | Kademlia routing |\n| **Replication** | k=20 | Fault tolerance |\n| **Throughput** | 500-2K msg/s | Gateway (v0.8.0) |\n| | 10K+ msg/s | Planned (v0.9.0 pooling) |\n| **Connections** | 100K+ | Per gateway node |\n\n---","ref":"architecture.html#performance-characteristics"},{"type":"extras","title":" When to Use Macula - Architecture Guide","doc":"** Great Fit:**\n- Distributed IoT systems\n- Microservices mesh\n- Edge computing platforms\n- Real-time event streaming\n- Multi-region applications\n- Multi-tenant SaaS\n\n** Consider Alternatives:**\n- Single-region monoliths (RabbitMQ simpler)\n- Ultra-high-frequency trading (direct TCP faster)\n- Batch processing (Kafka better)\n- Web browser clients (use gateway as WebSocket bridge)\n\n---\n\n**Next Steps**: See [README.md](README.md) for Quick Start and [v0.8.0-OVERVIEW.md](architecture/v0.8.0-OVERVIEW.md) for latest features.","ref":"architecture.html#when-to-use-macula"},{"type":"extras","title":"Changelog","doc":"# Changelog\n\nAll notable changes to this project will be documented in this file.\n\nThe format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),\nand this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).\n\n---\n\n## [0.8.4] - 2025-11-17","ref":"changelog.html"},{"type":"extras","title":"Fixed - Changelog","doc":"- **Hex docs landing page redirect** - Fixed broken redirect with compact README\n  - **Root cause 1**: README too large (303 lines) - ex_doc splits into readme-1.html, readme-2.html\n  - **Root cause 2**: docs/README.md in extras - content merged with root README, making it larger\n  - **Solution 1**: Compacted README to 55 lines (SVG diagram + TOC only)\n  - **Solution 2**: Moved detailed content to GETTING_STARTED.md\n  - **Solution 3**: Removed docs/README.md from hex extras\n  - **Solution 4**: Set `{main, \"readme\"}` to redirect to single readme.html\n  - Result: Single readme.html (8KB) with SVG diagram prominently displayed","ref":"changelog.html#fixed"},{"type":"extras","title":"Added - Changelog","doc":"- **GETTING_STARTED.md** - Complete getting started guide with all examples, code samples, API overview\n  - Moved from README.md to keep landing page compact\n  - Full installation instructions\n  - Comprehensive code examples\n  - Core concepts explained\n  - API reference overview","ref":"changelog.html#added"},{"type":"extras","title":"Changed - Changelog","doc":"- **README.md** - Compacted from 303 lines to 55 lines\n  - SVG architecture diagram prominently displayed\n  - Clean table of contents linking to detailed guides\n  - Quick start code example\n  - Latest release info\n  - Community links","ref":"changelog.html#changed"},{"type":"extras","title":"Result - Changelog","doc":"- Hex docs at https://hexdocs.pm/macula now properly load readme.html\n- Professional SVG architecture diagram visible immediately on landing page\n- No more \"PAGE NOT FOUND\" error (was redirecting to hello_world.html)\n- Clean navigation to detailed guides\n\n**No functional changes** - This is a documentation deployment fix.\n\n---\n\n## [0.8.3] - 2025-11-17","ref":"changelog.html#result"},{"type":"extras","title":"Note - Changelog","doc":" **This version had a broken hex docs redirect** - superseded by v0.8.4","ref":"changelog.html#note"},{"type":"extras","title":"Fixed - Changelog","doc":"- **Hex docs landing page redirect** - Fixed broken redirect to non-existent page\n  - Changed `{main, \"Overview\"}` to `{main, \"readme-1\"}` in rebar.config\n  - Hex docs now properly redirect to README with SVG architecture diagram\n  - Issue: v0.8.2 redirected to non-existent `hello_world.html` causing \"PAGE NOT FOUND\"\n  - Root cause: ex_doc splits long README into multiple pages (readme-1.html, readme-2.html)\n  - Solution: Configure main page to point to actual generated file (readme-1.html)","ref":"changelog.html#fixed-1"},{"type":"extras","title":"Result - Changelog","doc":"- Hex docs at https://hexdocs.pm/macula now properly load landing page\n- Professional SVG architecture diagram visible immediately\n- No more \"PAGE NOT FOUND\" error\n\n**No functional changes** - This is a documentation deployment fix.\n\n---\n\n## [0.8.2] - 2025-11-17","ref":"changelog.html#result-1"},{"type":"extras","title":"Documentation - Changelog","doc":"- **NEW: Professional SVG Architecture Diagram** - Compelling visual on hex docs landing page\n  - Created `artwork/macula-architecture-overview.svg` (5KB, scalable)\n  - System overview showing App  Peer  Gateway/DHT  Remote Services\n  - Color-coded components (purple=app, green=peer, blue=gateway, orange=DHT)\n  - Direct P2P connections highlighted with green dashed arrows\n  - Key features listed (6 bullet points)\n  - Performance metric: \"50% Latency Improvement (v0.8.0)\"\n- **README.md landing page enhanced**:\n  - SVG diagram prominently displayed immediately after logo\n  - Added hex.pm version badge\n  - Enhanced subtitle: \"Self-organizing distributed mesh for decentralized applications\"\n  - Feature tagline: BEAM-Native  HTTP/3  DHT  Direct P2P  Multi-Tenant  50% Faster","ref":"changelog.html#documentation"},{"type":"extras","title":"Result - Changelog","doc":"- Hex docs now open with compelling architecture diagram\n- Immediate visual understanding without reading text\n- Professional, polished first impression\n- Sparks interest of developers and architects\n- v0.8.0 Direct P2P feature prominently showcased\n\n**No functional changes** - This is purely a documentation/visual improvement release.\n\n---\n\n## [0.8.1] - 2025-11-17","ref":"changelog.html#result-2"},{"type":"extras","title":"Documentation - Changelog","doc":"- **Hex docs completely redesigned** - Professional, comprehensive documentation for hex.pm\n- **NEW: Comprehensive Architecture Guide** (`ARCHITECTURE.md`):\n  - C4 diagrams (system context, container views) with Mermaid\n  - 3 deployment topologies (edge-first, microservices, hybrid cloud-edge)\n  - Supervision tree diagrams (peer, gateway)\n  - Message flow diagrams (RPC, PubSub with direct P2P)\n  - DHT architecture (Kademlia routing, k-buckets, STORE/FIND_VALUE)\n  - Performance comparison (v0.7.x vs v0.8.0)\n  - Module dependency graph\n  - \"When to use Macula\" decision guide\n- **README.md improvements**:\n  - Added \"Architecture at a Glance\" section with ASCII diagrams\n  - Prominent link to Architecture Guide as first ToC item\n  - Added comprehensive Quick Start section with practical code examples\n  - Added \"What's New in v0.8.0\" section highlighting key features\n  - Added Core Concepts section (mesh architecture, realms, DHT, direct P2P)\n  - Added API Overview section with main modules and configuration\n  - Removed all broken links to non-existent files\n  - Replaced broken table of contents with working internal links\n- **Enhanced module documentation**:\n  - `macula_peer`: Added comprehensive examples for pub/sub and RPC usage\n  - `macula_gateway`: Added embedded and standalone gateway configuration examples\n  - `macula_peer_connector`: Added usage examples and performance characteristics\n- **rebar.config cleanup**:\n  - Removed references to non-existent files (HELLO_WORLD.md, EXECUTIVE_SUMMARY.md, etc.)\n  - Added ARCHITECTURE.md to hex docs (prominently featured)\n  - Added v0.8.0 documentation files (OVERVIEW, CHANGELOG, ROADMAP)\n  - Added TODO.md to hex docs\n  - Updated hex package description to mention v0.8.0 features\n  - Changed main page to \"readme\" for better landing experience","ref":"changelog.html#documentation-1"},{"type":"extras","title":"Result - Changelog","doc":"- Hex docs now render professionally on hex.pm with compelling visuals\n- Architecture diagrams showcase system design to developers and architects\n- Clear navigation and documentation structure\n- v0.8.0 features prominently showcased\n- Code examples visible and practical\n- Warnings reduced from 100+ to ~30 (mostly future docs references)\n\n**No functional changes** - This is purely a documentation release to fix the hex.pm documentation quality.\n\n---\n\n## [0.8.0] - 2025-11-17","ref":"changelog.html#result-3"},{"type":"extras","title":"Added - Changelog","doc":"- **Direct P2P QUIC connections** via new `macula_peer_connector` module (112 LOC)\n- **DHT STORE propagation** to k=20 closest nodes for service registrations\n- **RPC via direct P2P** - Service discovery + direct connection (11/11 tests passing)\n- **PubSub via direct P2P** - Subscription discovery + direct messaging (10/10 tests passing)\n- **Gateway on all node types** - Bootstrap, Gateway, and Edge nodes all run QUIC listeners\n- **Comprehensive integration tests** - 21/21 tests passing (100% success rate)\n  - `test/integration/multi_hop_rpc_SUITE.erl` (11 RPC tests)\n  - `test/integration/multi_hop_pubsub_SUITE.erl` (10 PubSub tests)\n- **TODO tracking** - Created `TODO.md` for known limitations and planned improvements","ref":"changelog.html#added-1"},{"type":"extras","title":"Changed - Changelog","doc":"- **RPC architecture** - Now uses direct P2P instead of multi-hop routing (50% latency improvement)\n- **PubSub architecture** - Now uses direct P2P for message delivery (50% latency improvement)\n- **DHT operations** - Service registry now uses `store/3` with k-node propagation\n- **Node configuration** - All node types expose port 9443 for P2P connections\n- **Version** - Updated to 0.8.0 in `macula.app.src`","ref":"changelog.html#changed-1"},{"type":"extras","title":"Fixed - Changelog","doc":"- Edge nodes can now send messages (via peer_connector, no gateway required)\n- Edge nodes can now receive messages (gateway enabled on all node types)\n- QUIC connection errors properly handled (transport_down 3-tuple)\n- Stream closing race condition fixed (100ms delay added)\n- Docker configuration now respects environment variables","ref":"changelog.html#fixed-2"},{"type":"extras","title":"Deprecated - Changelog","doc":"- `macula_dht_rpc` module - Superseded by `macula_peer_connector` (moved to `src/archive/`)","ref":"changelog.html#deprecated"},{"type":"extras","title":"Documentation - Changelog","doc":"- Created comprehensive v0.8.0 documentation:\n  - `architecture/v0.8.0-OVERVIEW.md` - Release overview and achievements\n  - `architecture/v0.8.0-CHANGELOG.md` - Detailed changes\n  - `architecture/v0.8.0-ROADMAP.md` - Future plans (v0.9.0)\n  - `architecture/INDEX.md` - Master architecture documentation index\n- Archived development documentation to `architecture/archive/v0.8.0-development/`\n- Updated `README.md` for v0.8.0","ref":"changelog.html#documentation-2"},{"type":"extras","title":"Breaking Changes - Changelog","doc":"None - Fully backward compatible with v0.7.x\n\n**Upgrade Guide**: Simply update dependency version - no code changes required.\n\n**Full Details**: See [`architecture/v0.8.0-OVERVIEW.md`](architecture/v0.8.0-OVERVIEW.md) and [`architecture/v0.8.0-CHANGELOG.md`](architecture/v0.8.0-CHANGELOG.md)\n\n---\n\n## [0.7.9] - 2025-11-16","ref":"changelog.html#breaking-changes"},{"type":"extras","title":"Added - Changelog","doc":"- **Gateway Supervision Refactoring**: Implemented proper OTP supervision tree\n  - New 3-tier architecture: `macula_gateway_sup` (root) supervises `macula_gateway_quic_server`, `macula_gateway`, `macula_gateway_workers_sup`\n  - Added `macula_gateway_quic_server.erl` - Dedicated QUIC transport layer (248 LOC, 17 tests)\n  - Added `macula_gateway_workers_sup.erl` - Supervises business logic workers (152 LOC, 24 tests)\n  - Added `macula_gateway_clients.erl` - Renamed from `macula_gateway_client_manager` (clearer naming)\n  - Circular dependency resolution via `set_gateway/2` callback pattern\n  - `rest_for_one` supervision strategy for controlled fault isolation","ref":"changelog.html#added-2"},{"type":"extras","title":"Changed - Changelog","doc":"- **Gateway Architecture**: Refactored from manual process management to supervised architecture\n  - Gateway now finds siblings via supervisor instead of starting them manually\n  - Simplified `macula_gateway` init/1 - uses `find_parent_supervisor/0` and `find_sibling/2`\n  - Removed manual lifecycle management - supervisor handles cleanup\n  - Updated `macula_gateway_sup.erl` to be root supervisor (was workers supervisor)\n  - All gateway tests updated for new supervision tree (106 tests, 0 failures)","ref":"changelog.html#changed-2"},{"type":"extras","title":"Fixed - Changelog","doc":"- **CRITICAL**: Gateway now actually USES DHT-routed pub/sub (v0.7.8 had the code but wasn't calling it!)\n  - Bug: Gateway's `handle_publish` was still using v0.7.7 endpoint-based routing\n  - Impact: v0.7.8 protocol infrastructure existed but gateway bypassed it entirely\n  - Root cause: `handle_publish` (macula_gateway.erl:885-943) never called `macula_pubsub_routing`\n  - Solution: Rewrote `handle_publish` to use `macula_pubsub_routing:wrap_publish` and send via `pubsub_route` messages\n  - Flow: Gateway now queries DHT for `node_id` (not endpoint), wraps PUBLISH in `pubsub_route`, sends via mesh connection manager\n  - Result: Messages now actually route via multi-hop Kademlia DHT to remote subscribers\n- Fixed test failures in `macula_connection_tests` - replaced invalid `connected` message type with `subscribe`\n- Fixed edoc warning in `macula_gateway_sup.erl` - replaced markdown code fence with HTML pre tags for proper documentation generation","ref":"changelog.html#fixed-3"},{"type":"extras","title":"Improved - Changelog","doc":"- **Fault Tolerance**: Automatic recovery from gateway/QUIC/worker crashes\n- **Production Stability**: Proper OTP supervision with configurable restart strategies\n- **Code Organization**: Clean separation between transport (QUIC), coordination (gateway), and business logic (workers)\n- **Testability**: Each module tested independently with comprehensive coverage","ref":"changelog.html#improved"},{"type":"extras","title":"Technical Details - Changelog","doc":"- v0.7.8 added `pubsub_route` protocol + routing modules but gateway never used them\n- v0.7.9 integrates the v0.7.8 infrastructure into gateway's publish flow\n- This completes the DHT-routed pub/sub implementation started in v0.7.8\n- Supervision refactoring provides +2/10 scalability improvement (foundational infrastructure)\n- Enables future optimizations: process pools, connection pooling, horizontal scaling\n\n## [0.7.8] - 2025-11-16","ref":"changelog.html#technical-details"},{"type":"extras","title":"Fixed - Changelog","doc":"- **CRITICAL**: Implemented multi-hop DHT routing for pub/sub to fix matchmaking\n  - Bug: v0.7.7 gateway queried DHT but routed to endpoints, which failed for NAT peers\n  - Impact: Matchmaking still broken - messages couldn't reach subscribers behind NAT\n  - Root cause: Split-brain architecture - subscribers register locally but routing via gateway\n  - Solution: Multi-hop Kademlia DHT routing (same pattern as RPC routing)","ref":"changelog.html#fixed-4"},{"type":"extras","title":"Added - Changelog","doc":"- **Protocol Layer**: New `pubsub_route` message type (0x13)\n  - Wraps PUBLISH messages for multi-hop routing through mesh\n  - Fields: `destination_node_id`, `source_node_id`, `hop_count`, `max_hops`, `topic`, `payload`\n  - Protocol encoder/decoder support with validation\n  - 8 encoder tests + 3 decoder tests added\n\n- **Routing Module**: `macula_pubsub_routing.erl` (NEW - 115 LOC)\n  - Stateless routing logic for pub/sub messages\n  - `wrap_publish/4` - Wraps PUBLISH in routing envelope\n  - `route_or_deliver/3` - Routes to next hop or delivers locally\n  - `should_deliver_locally/2` - Checks if destination matches\n  - TTL protection via `max_hops` (default: 10)\n  - 14 comprehensive tests (all passing)\n\n- **Gateway Integration**: Enhanced `macula_gateway.erl`\n  - Added `handle_decoded_message` clause for `pubsub_route` messages\n  - Routes via XOR distance to next hop OR delivers locally\n  - `handle_pubsub_route_deliver/2` - Unwraps and delivers to local subscribers\n  - `forward_pubsub_route/3` - Forwards to next hop through mesh\n\n- **Pub/Sub Handler**: Updated `macula_pubsub_dht.erl`\n  - `route_to_subscribers/5` now uses actual DHT routing (was TODO stub)\n  - Extracts subscriber `node_id` (not endpoint) from DHT results\n  - Wraps PUBLISH in `pubsub_route` envelope\n  - Sends via connection manager which routes through gateway","ref":"changelog.html#added-3"},{"type":"extras","title":"Technical Details - Changelog","doc":"**v0.7.7 Architecture (BROKEN):**\n-  Publisher queries DHT for subscriber endpoints\n-  Tries to route directly to endpoints\n-  Fails for NAT peers (can't accept connections)\n-  Matchmaking stuck on \"Looking for opponent...\"\n\n**v0.7.8 Architecture (FIXED):**\n-  Publisher queries DHT for subscriber node IDs\n-  Wraps PUBLISH in `pubsub_route` envelope\n-  Routes via multi-hop Kademlia (same as RPC)\n-  Works with relay OR direct connections\n-  Matchmaking succeeds across NAT peers\n\n**Message Flow:**\n```\nPublisher                Gateway              Node A               Subscriber\n  |                         |                    |                      |\n  |--pubsub_route---------->|                    |                      |\n  |  dest: Subscriber       |--pubsub_route----->|                      |\n  |  topic: \"matchmaking\"   |  (forward closer)  |--pubsub_route------->|\n  |  payload: {msg}         |                    |                      |\n  |                         |                    |                      | Deliver locally\n```","ref":"changelog.html#technical-details-1"},{"type":"extras","title":"Tests - Changelog","doc":"- Protocol encoder: 49 tests (8 new for pubsub_route)\n- Protocol decoder: 35 tests (3 new for pubsub_route)\n- Pub/sub routing: 14 tests (all passing)\n  - wrap_publish envelope creation\n  - should_deliver_locally checks\n  - route_or_deliver decision logic\n  - TTL exhaustion handling\n  - No-route error handling","ref":"changelog.html#tests"},{"type":"extras","title":"Architecture Documentation - Changelog","doc":"- Added `architecture/dht_routed_pubsub.md` with complete design\n- Future refactoring note: Consider unifying RPC and pub/sub routing modules (nearly identical logic)\n\n**This completes the DHT-routed pub/sub implementation and should enable working matchmaking.**\n\n---\n\n## [0.7.7] - 2025-11-15","ref":"changelog.html#architecture-documentation"},{"type":"extras","title":"Fixed - Changelog","doc":"- **CRITICAL**: Gateway pub/sub now queries DHT for remote subscribers\n  - Bug: Gateway only checked local subscriptions, never queried DHT for remote subscribers\n  - Impact: Distributed pub/sub and matchmaking completely broken - remote peers couldn't receive messages\n  - Root cause: `handle_publish` only called `macula_gateway_pubsub:get_subscribers` (local streams only)\n  - Fix Phase 1: Added endpoint  stream PID tracking in `macula_gateway_client_manager`\n    - New state field: `endpoint_to_stream :: #{binary() => pid()}`\n    - New API: `get_stream_by_endpoint/2`\n    - Updated `store_client_stream/4` to track endpoints\n    - Updated `remove_client/2` to clean up endpoint mappings\n  - Fix Phase 2: Modified `handle_publish` to query DHT\n    - Queries local subscribers (existing behavior)\n    - Queries DHT for remote subscribers via `crypto:hash(sha256, Topic)`\n    - Converts remote endpoints to stream PIDs using client_manager\n    - Combines local + remote and delivers to all\n  - Fix Phase 3: Added `macula_gateway_dht:lookup_value/1`\n    - Synchronous lookup from local DHT storage\n    - Calls `macula_routing_server:find_value/3` with K=20\n    - Returns `{ok, [Subscriber]}` or `{error, not_found}`\n  - Tests: 90 tests passing (39 client_manager + 49 gateway + 7 endpoint + 5 pub/sub DHT)\n\n**This completes the distributed pub/sub fix and enables working matchmaking across multiple peer containers.**","ref":"changelog.html#fixed-5"},{"type":"extras","title":"Technical Details - Changelog","doc":"Before v0.7.7:\n-  Gateway only queried `macula_gateway_pubsub` (local subscriptions)\n-  Remote subscribers stored in DHT but never looked up\n-  Pub/sub messages only delivered to local streams\n-  Multi-peer matchmaking broken\n\nAfter v0.7.7:\n-  Gateway queries both local + DHT for subscribers\n-  Remote endpoints resolved to stream PIDs via endpoint tracking\n-  Messages delivered to all subscribers (local + remote)\n-  Multi-peer matchmaking works correctly\n\nThe architecture remains hub-and-spoke (v0.7.x):\n- All peers connect to gateway\n- Gateway routes all pub/sub messages\n- Subscriptions stored in DHT for discovery\n- Gateway has stream PIDs for all connected peers\n\n---\n\n## [0.8.0] - TBD (Q2 2025)","ref":"changelog.html#technical-details-2"},{"type":"extras","title":"Planned - True Mesh Architecture - Changelog","doc":"- **BREAKING**: Opportunistic NAT hole punching for direct peer-to-peer connections\n  - 80% direct P2P connections (cone NAT, no firewall)\n  - 20% gateway relay fallback (symmetric NAT, strict firewalls)\n  - True mesh topology (no single point of failure)\n  - New modules: `macula_nat_discovery`, `macula_hole_punch`, `macula_connection_upgrade`\n  - Backward compatible with v0.7.x gateway relay architecture\n\n**This will transform Macula from hub-and-spoke (star topology) to true decentralized mesh.**\n\nSee `architecture/NAT_TRAVERSAL_ROADMAP.md` for complete design.\n\n---\n\n## [0.7.6] - 2025-11-15","ref":"changelog.html#planned-true-mesh-architecture"},{"type":"extras","title":"Fixed - Changelog","doc":"- **CRITICAL**: Disabled QUIC transport-layer idle timeout causing connection closures\n  - Root cause: MsQuic default idle timeout of 30 seconds (2x = 60s to closure)\n  - v0.7.4-0.7.5 application-level PING/PONG worked but didn't reset QUIC transport timer\n  - Added `idle_timeout_ms => 0` to both client connection and gateway listener options\n  - Setting to 0 disables QUIC idle timeout entirely\n  - Connections now stay alive indefinitely (application PING/PONG provides health checks)\n  - Modified: `macula_quic:connect/4` and `macula_quic:listen/2`\n\n**This completes the connection stability fix started in v0.7.4-0.7.5.**","ref":"changelog.html#fixed-6"},{"type":"extras","title":"Tests - Changelog","doc":"- Added `test/macula_quic_idle_timeout_tests.erl` with 7 tests\n  - Client connection idle timeout configuration\n  - Gateway listener idle timeout configuration\n  - Option structure and value validation\n  - Defense-in-depth architecture documentation","ref":"changelog.html#tests-1"},{"type":"extras","title":"Technical Details - Changelog","doc":"**Defense in Depth** approach:\n1. **Transport Layer** (v0.7.6): QUIC idle timeout disabled (`idle_timeout_ms => 0`)\n2. **Application Layer** (v0.7.4-0.7.5): PING/PONG keep-alive every 30 seconds\n3. **Result**: Connections stay alive + health monitoring\n\nPrevious versions had application keep-alive but QUIC transport still enforced 30s idle timeout independently.\n\n---\n\n## [0.7.5] - 2025-11-15","ref":"changelog.html#technical-details-3"},{"type":"extras","title":"Fixed - Changelog","doc":"- **CRITICAL**: Gateway PING message handler missing, preventing keep-alive from working\n  - v0.7.4 implemented keep-alive on edge peer side only\n  - Gateway had no handler for incoming PING messages\n  - Result: PINGs sent but never acknowledged, connections still timed out after 2 minutes\n  - Added `handle_decoded_message({ok, {ping, PingMsg}}, ...)` to gateway\n  - Gateway now responds with PONG to all incoming PING messages\n  - Keep-alive now works bidirectionally (edge peer  gateway)\n  - Also added PONG message handler to gateway for completeness\n\n**This completes the keep-alive implementation started in v0.7.4.**","ref":"changelog.html#fixed-7"},{"type":"extras","title":"Technical Details - Changelog","doc":"The keep-alive flow now works correctly:\n1. Edge peer timer fires every 30 seconds (configurable)\n2. Edge peer sends PING to gateway\n3. **Gateway receives PING and responds with PONG** (new in v0.7.5)\n4. Edge peer receives PONG confirmation\n5. QUIC connection stays alive (no idle timeout)\n\nWithout this fix, PINGs were sent but ignored, causing connections to timeout despite v0.7.4's implementation.\n\n---\n\n## [0.7.4] - 2025-11-15","ref":"changelog.html#technical-details-4"},{"type":"extras","title":"Fixed - Changelog","doc":"- **CRITICAL**: Configurable keep-alive mechanism to prevent QUIC connection timeouts\n  - PING/PONG message support in `macula_connection`\n  - Default keep-alive interval: 30 seconds (configurable)\n  - Keep-alive enabled by default (can be disabled via options)\n  - Automatic PONG response to incoming PING messages\n  - Configuration via `macula_connection:default_config/0`\n  - Prevents 2-minute connection timeout that broke distributed matchmaking\n  - Added 6 tests for keep-alive functionality (all passing)\n\n**This is a critical fix for production deployments where QUIC connections timeout after ~2 minutes of inactivity, breaking pub/sub and matchmaking.**","ref":"changelog.html#fixed-8"},{"type":"extras","title":"Configuration - Changelog","doc":"Enable/disable keep-alive:\n```erlang\n%% Enable with custom interval (milliseconds)\nOpts = #{\n    keepalive_enabled => true,\n    keepalive_interval => 30000  %% 30 seconds\n}.\n\n%% Disable keep-alive\nOpts = #{\n    keepalive_enabled => false\n}.\n\n%% Use defaults (enabled, 30 second interval)\nDefaultConfig = macula_connection:default_config().\n```","ref":"changelog.html#configuration"},{"type":"extras","title":"Architecture Note - Changelog","doc":"**v0.7.4 maintains hub-and-spoke (star) topology**:\n- Edge peers connect to gateway (not each other)\n- Gateway routes all messages (relay architecture)\n- Gateway is single point of failure (by design for now)\n- DHT routing table exists but routing happens at gateway\n- True peer-to-peer mesh deferred to v0.8.0 (NAT traversal required)\n\n## [0.7.3] - 2025-11-15","ref":"changelog.html#architecture-note"},{"type":"extras","title":"Fixed - Changelog","doc":"- **CRITICAL**: Fixed DHT routing table address serialization crash in `macula_gateway_dht`\n  - Bug: Gateway stored parsed address **tuples** `{{127,0,0,1}, 9443}` in DHT instead of binary strings\n  - Impact: When FIND_VALUE replies tried to serialize node addresses, msgpack returned error `{:error, {:badarg, {{127,0,0,1}, 9443}}}`\n  - Root cause: `macula_gateway.erl:522` used `Address` (tuple from `parse_endpoint/1`) instead of `Endpoint` (binary string)\n  - Error chain: DHT stored tuples  encode_node_info extracted tuples  msgpack:pack failed  byte_size crashed\n  - Symptoms: Gateway crashed with \"ArgumentError: 1st argument not a bitstring\" when peers queried DHT\n  - Fix: Store original `Endpoint` binary string in DHT routing table instead of parsed tuple\n  - Added test: `dht_address_serialization_test` documents bug and validates fix\n\n**This is a critical fix for distributed matchmaking and service discovery. Without it, DHT queries crash the gateway.**\n\n## [0.7.2] - 2025-11-15","ref":"changelog.html#fixed-9"},{"type":"extras","title":"Fixed - Changelog","doc":"- **CRITICAL**: Fixed gateway crash in `parse_endpoint/1` when DNS resolution fails\n  - Bug: `inet:getaddr/2` error tuple was not handled, causing ArgumentError when passed to `byte_size/1`\n  - Impact: Gateway crashed repeatedly, closing all client connections and preventing pub/sub communication\n  - Symptoms: \"Failed to publish to topic: :closed\", \"Failed to send STORE for subscription: :closed\"\n  - Fix: Added proper error handling with localhost fallback when DNS resolution fails\n  - Now returns `{{127,0,0,1}, Port}` fallback instead of crashing\n\n**This is a critical fix for production deployments where endpoint DNS resolution may fail.**\n\n## [0.7.1] - 2025-11-15","ref":"changelog.html#fixed-10"},{"type":"extras","title":"Fixed - Changelog","doc":"- **CRITICAL**: Fixed ArithmeticError in `macula_pubsub_handler` message ID handling\n  - Bug: Was assigning binary MsgId to counter instead of integer NewCounter\n  - Impact: Caused pub/sub to crash on second publish attempt with \"bad argument in arithmetic expression\"\n  - Fix: Corrected destructuring in line 300 to use `{_MsgId, NewCounter}` instead of `{MsgIdCounter, _}`\n  - Now properly increments integer counter instead of trying to do arithmetic on binary\n\n**This is a critical fix for anyone using pub/sub functionality in v0.7.0.**\n\n## [0.7.0] - 2025-11-15","ref":"changelog.html#fixed-11"},{"type":"extras","title":"Changed - Changelog","doc":"- **BREAKING**: Major nomenclature refactoring for clarity and industry alignment\n  - Renamed `macula_connection`  `macula_peer` (mesh participant facade - high-level API)\n  - Renamed `macula_connection_manager`  `macula_connection` (QUIC transport layer - low-level)\n  - Follows industry standards used by libp2p, IPFS, and BitTorrent\n  - Clear separation: `macula_peer` = mesh participant, `macula_connection` = transport","ref":"changelog.html#changed-3"},{"type":"extras","title":"Added - Changelog","doc":"- Comprehensive transport layer test coverage (36 tests total)\n  - 11 new tests for message decoding, buffering, URL parsing, and realm normalization\n  - All tests passing with zero regressions\n- Complete v0.7.0 documentation in CLAUDE.md\n  - Migration guide with specific API examples\n  - Architecture rationale and benefits\n  - Status tracking for implementation phases","ref":"changelog.html#added-4"},{"type":"extras","title":"Migration Guide (0.6.x  0.7.0) - Changelog","doc":"**API Changes:**\n\nAll high-level mesh operations now use `macula_peer` instead of `macula_connection`:\n\n```erlang\n%% Before (0.6.x)\n{ok, Client} = macula_connection:start_link(Url, Opts).\nok = macula_connection:publish(Client, Topic, Data).\n{ok, SubRef} = macula_connection:subscribe(Client, Topic, Callback).\n{ok, Result} = macula_connection:call(Client, Procedure, Args).\n\n%% After (0.7.0)\n{ok, Client} = macula_peer:start_link(Url, Opts).\nok = macula_peer:publish(Client, Topic, Data).\n{ok, SubRef} = macula_peer:subscribe(Client, Topic, Callback).\n{ok, Result} = macula_peer:call(Client, Procedure, Args).\n```\n\n**Why This Change?**\n\nThe original naming was confusing:\n-  `macula_connection` served both facade AND transport roles\n-  Mixed high-level mesh operations with low-level QUIC handling\n-  Not aligned with P2P industry standards\n\nAfter v0.7.0:\n-  `macula_peer` = mesh participant (clear high-level API for pub/sub, RPC, DHT)\n-  `macula_connection` = QUIC transport (clear low-level transport layer)\n-  Follows libp2p/IPFS/BitTorrent naming conventions\n\n**Note:** The `macula_client` wrapper module has been updated to use `macula_peer` internally, so if you're using `macula_client`, no changes are required.\n\n## [0.6.7] - 2025-11-15","ref":"changelog.html#migration-guide-0-6-x-0-7-0"},{"type":"extras","title":"Fixed - Changelog","doc":"- **CRITICAL:** Fixed all installation examples to use Hex package references instead of git dependencies\n  - README.md: Changed from git-based to `{:macula, \"~> 0.6\"}` (Elixir) and `{macula, \"0.6.7\"}` (Erlang)\n  - HELLO_WORLD.md: Updated to use proper Hex package format\n  - architecture/macula_http3_mesh_hello_world.md: Fixed tutorial installation examples\n  - architecture/macula_http3_mesh_rpc_guide.md: Fixed migration guide examples\n  - All code examples now show proper Hex.pm installation for published package\n\n## [0.6.6] - 2025-11-15","ref":"changelog.html#fixed-12"},{"type":"extras","title":"Fixed - Changelog","doc":"- Fixed navigation links in documentation guides to use ex_doc HTML filenames\n  - Changed GitHub-style relative paths (`../README.md`) to ex_doc HTML references (`readme.html`)\n  - Fixed all navigation links in EXECUTIVE_SUMMARY.md, COMPARISONS.md, USE_CASES.md, and DEVELOPMENT.md\n  - Links now work correctly in published Hexdocs without \"page not found\" errors\n\n## [0.6.5] - 2025-11-15","ref":"changelog.html#fixed-13"},{"type":"extras","title":"Changed - Changelog","doc":"- Updated to modern alternative logo (macula-alt-logo.svg) in both README.md and ex_doc\n- Changed tutorial greeting to brand-specific \"Hello, Macula!\" instead of generic greeting","ref":"changelog.html#changed-4"},{"type":"extras","title":"Fixed - Changelog","doc":"- Replaced old color logo with cleaner, more modern alternative logo for better visual appeal\n\n## [0.6.4] - 2025-11-15","ref":"changelog.html#fixed-14"},{"type":"extras","title":"Changed - Changelog","doc":"- **Documentation restructuring** - Split README.md into focused landing page with table of contents\n  - Created `docs/EXECUTIVE_SUMMARY.md` - Why Macula and the case for decentralization\n  - Created `docs/COMPARISONS.md` - How Macula compares to libp2p, Distributed Erlang, Akka, etc.\n  - Created `docs/USE_CASES.md` - Real-world applications across business, IoT, and AI domains\n  - Created `docs/DEVELOPMENT.md` - Complete development guide and coding standards\n  - README.md now serves as concise landing page (119 lines vs 372 lines)\n  - All detailed content accessible via clear table of contents\n  - Removed Mermaid diagram from README.md (ex_doc doesn't support Mermaid - works on GitHub)","ref":"changelog.html#changed-5"},{"type":"extras","title":"Fixed - Changelog","doc":"- ex_doc landing page uses HELLO_WORLD.md (tutorial-first approach, no multi-page split)\n- Documentation properly links to all new guide documents\n- Better first impression for Hex.pm users (logo, quick navigation)\n\n## [0.6.3] - 2025-11-15","ref":"changelog.html#fixed-15"},{"type":"extras","title":"Fixed - Changelog","doc":"- Removed README.md from ex_doc extras to prevent multi-page split and broken landing page\n- Documentation now correctly redirects to API reference page\n\n## [0.6.2] - 2025-11-15","ref":"changelog.html#fixed-16"},{"type":"extras","title":"Fixed - Changelog","doc":"- ex_doc landing page configuration (`{main, \"api-reference\"}`) - resolved \"readme.html not found\" error\n\n## [0.6.1] - 2025-11-15","ref":"changelog.html#fixed-17"},{"type":"extras","title":"Added - Changelog","doc":"- Professional documentation structure for Hex publication\n  - Architecture diagram in README.md (Mermaid format) showing mesh topology\n  - Organized documentation: moved 50+ files from root to docs/archive/, docs/development/, docs/planning/\n  - Created docs/README.md navigation index\n  - Logo and assets configuration for ex_doc\n  - Comprehensive Hex package file list (artwork/, docs/, architecture/)","ref":"changelog.html#added-5"},{"type":"extras","title":"Fixed - Changelog","doc":"- README.md badge rendering (moved badges outside ` ` tag for proper GitHub display)\n- ex_doc assets configuration (deprecated warning resolved)\n- ex_doc landing page configuration (changed `{main, \"readme\"}` to `{main, \"api-reference\"}` to fix \"readme.html not found\" error)\n- Hex package configuration to include all necessary assets and documentation\n- Documentation organization for professional first impression\n\n## [0.6.0] - 2025-11-15","ref":"changelog.html#fixed-18"},{"type":"extras","title":"Changed - Changelog","doc":"- **BREAKING**: Renamed environment variable from `GATEWAY_REALM` to `MACULA_REALM` for better API consistency\n  - All `MACULA_*` environment variables now follow consistent naming\n  - Applies to both gateway mode and edge peer mode\n  - Update your deployment configurations to use `MACULA_REALM` instead of `GATEWAY_REALM`","ref":"changelog.html#changed-6"},{"type":"extras","title":"Added - Changelog","doc":"- Comprehensive Kademlia DHT architecture documentation (`docs/KADEMLIA_DHT_ARCHITECTURE.md`)\n  - XOR distance metric explanation\n  - K-bucket routing table details\n  - DHT operations (PING, STORE, FIND_NODE, FIND_VALUE)\n  - Iterative lookup algorithm\n  - Macula-specific adaptations (realm-scoped DHT, HTTP/3 transport)\n  - Performance characteristics and comparisons","ref":"changelog.html#added-6"},{"type":"extras","title":"Fixed - Changelog","doc":"- Updated documentation to reflect `MACULA_REALM` environment variable usage\n- Updated `entrypoint.sh`, `Dockerfile.gateway`, and `config/sys.config` to use `MACULA_REALM`","ref":"changelog.html#fixed-19"},{"type":"extras","title":"Upcoming in v0.7.0 - Changelog","doc":"- Architecture improvement: Separation of `macula_connection` into `macula_peer` (high-level mesh API) and `macula_connection` (low-level QUIC transport)\n- See `docs/NOMENCLATURE_PROPOSAL_CONNECTION_TO_PEER.md` and `docs/PEER_CONNECTION_SEPARATION_PLAN.md` for details\n- Expected timeline: 4-5 weeks after v0.6.0 release","ref":"changelog.html#upcoming-in-v0-7-0"},{"type":"extras","title":"Migration Guide (0.5.0  0.6.0) - Changelog","doc":"If you're using Macula in gateway mode or configuring realm multi-tenancy:\n\n**Before (0.5.0):**\n```bash\nexport GATEWAY_REALM=my-app\n```\n\n**After (0.6.0):**\n```bash\nexport MACULA_REALM=my-app\n```\n\n**Elixir/Phoenix runtime.exs:**\n```elixir\n# Before (0.5.0)\nSystem.put_env(\"GATEWAY_REALM\", realm)\n\n# After (0.6.0)\nSystem.put_env(\"MACULA_REALM\", realm)\n```\n\n## [0.5.0] - 2025-11-14","ref":"changelog.html#migration-guide-0-5-0-0-6-0"},{"type":"extras","title":"Added - Changelog","doc":"- Initial public release\n- HTTP/3 (QUIC) mesh networking platform\n- Gateway mode for accepting incoming connections\n- Edge peer mode for mesh participation\n- Multi-tenancy via realm isolation\n- Pub/Sub messaging with wildcard support\n- RPC (request/response) patterns\n- Service discovery and advertisement\n- mDNS local discovery support\n- Process registry via gproc\n- Comprehensive documentation","ref":"changelog.html#added-7"},{"type":"extras","title":"Known Issues - Changelog","doc":"- Gateway mode requires proper TLS certificate configuration\n- Certificates must have Subject Alternative Name (SAN) extension\n- Docker deployments require proper file ownership (`--chown=app:app`)\n\n---\n\n[0.7.0]: https://github.com/macula-io/macula/compare/v0.6.7...v0.7.0\n[0.6.7]: https://github.com/macula-io/macula/compare/v0.6.6...v0.6.7\n[0.6.0]: https://github.com/macula-io/macula/compare/v0.5.0...v0.6.0\n[0.5.0]: https://github.com/macula-io/macula/releases/tag/v0.5.0","ref":"changelog.html#known-issues"},{"type":"extras","title":"Known Issues & Roadmap","doc":"# Macula TODO List\n\nThis document tracks known limitations and planned improvements.","ref":"todo.html"},{"type":"extras","title":"v0.9.0 - Security & Production Hardening - Known Issues & Roadmap","doc":"","ref":"todo.html#v0-9-0-security-production-hardening"},{"type":"extras","title":"TLS Certificate Verification - Known Issues & Roadmap","doc":"**Status**: Deferred to v0.9.0\n**Modules Affected**:\n- `macula_connection.erl:115` - QUIC connection TLS verification\n- `macula_connection_pool.erl:88` - Connection pool TLS verification\n- `macula_peer_connector.erl:82` - Peer connector certificate verification\n\n**Current Behavior**: `{verify, none}` - accepts any certificate\n**Planned Fix**: Implement proper certificate validation with CA bundle\n**Priority**: High (security)","ref":"todo.html#tls-certificate-verification"},{"type":"extras","title":"DHT Request/Response Pattern - Known Issues & Roadmap","doc":"**Status**: Deferred to v0.9.0\n**Module**: `macula_gateway_dht.erl:various`\n\n**Current Behavior**: Fire-and-forget DHT operations\n**Planned Fix**: Implement request/response with timeout and correlation IDs\n**Priority**: Medium (observability)","ref":"todo.html#dht-request-response-pattern"},{"type":"extras","title":"DHT Routing Table Bucket Management - Known Issues & Roadmap","doc":"**Status**: Deferred to v0.9.0\n**Module**: `macula_routing_table.erl:various`\n\n**Current Behavior**: Buckets don't split when full\n**Limitation**: Documented in code - buckets have max capacity\n**Planned Fix**: Implement k-bucket splitting algorithm\n**Priority**: Low (scalability improvement)","ref":"todo.html#dht-routing-table-bucket-management"},{"type":"extras","title":"Remote DHT Node Queries - Known Issues & Roadmap","doc":"**Status**: Documented limitation\n**Module**: `macula_routing_server.erl:various`\n\n**Current Behavior**: Cannot directly query remote nodes without connection\n**Workaround**: Use gateway relay for remote queries\n**Planned Fix**: Implement direct peer-to-peer DHT queries\n**Priority**: Medium (performance)\n\n---","ref":"todo.html#remote-dht-node-queries"},{"type":"extras","title":"v0.8.1 - Quality of Life Improvements - Known Issues & Roadmap","doc":"","ref":"todo.html#v0-8-1-quality-of-life-improvements"},{"type":"extras","title":"PubSub Helper Functions - Known Issues & Roadmap","doc":"**Module**: `macula_pubsub_qos.erl`, `macula_pubsub_subscription.erl`\n\n**Status**: Stub TODOs to remove\n**Action**: Add internal helper functions or remove placeholder comments\n**Priority**: Low (cleanup)","ref":"todo.html#pubsub-helper-functions"},{"type":"extras","title":"RPC Handler Advertisement Manager - Known Issues & Roadmap","doc":"**Module**: `macula_rpc_handler.erl`\n\n**Status**: Phase 6 notes from old refactoring\n**Action**: Remove obsolete Phase 6 comments\n**Priority**: Low (cleanup)\n\n---","ref":"todo.html#rpc-handler-advertisement-manager"},{"type":"extras","title":"Version History - Known Issues & Roadmap","doc":"- **v0.8.0**: Direct P2P with DHT propagation, RPC and PubSub via peer_connector\n- **v0.7.x**: Gateway relay architecture, nomenclature refactoring\n- **v0.6.x**: Initial DHT implementation\n\n---","ref":"todo.html#version-history"},{"type":"extras","title":"Contributing - Known Issues & Roadmap","doc":"When adding TODOs to code:\n1. Add entry to this document\n2. Link to GitHub issue if exists\n3. Specify target version\n4. Include priority level","ref":"todo.html#contributing"},{"type":"extras","title":"License","doc":"MIT License\n\nCopyright (c) 2025 macula.io\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.","ref":"license.html"},{"type":"extras","title":"v0.8.0 Release Overview","doc":"# Macula v0.8.0 - Direct P2P with DHT Propagation\n\n**Release Date**: 2025-11-17\n**Status**:  Production Ready\n**Test Coverage**: 21/21 integration tests passing (100%)\n\n---","ref":"v0-8-0-overview.html"},{"type":"extras","title":"Executive Summary - v0.8.0 Release Overview","doc":"Macula v0.8.0 introduces **direct peer-to-peer communication** with **DHT propagation**, eliminating the need for multi-hop routing. This release represents a fundamental architectural improvement over v0.7.x, enabling true distributed mesh networking with comprehensive test coverage.","ref":"v0-8-0-overview.html#executive-summary"},{"type":"extras","title":"Key Achievements - v0.8.0 Release Overview","doc":"1. **Direct P2P QUIC Connections** - Messages delivered directly to destination without intermediary hops\n2. **DHT Propagation** - Service registrations and subscriptions propagate to k=20 closest nodes\n3. **Unified Architecture** - All node types (bootstrap, gateway, edge) run QUIC listeners\n4. **RPC via Direct P2P** - Service discovery + direct connection (11/11 tests passing)\n5. **PubSub via Direct P2P** - Subscription discovery + direct messaging (10/10 tests passing)\n\n---","ref":"v0-8-0-overview.html#key-achievements"},{"type":"extras","title":"What's New in v0.8.0 - v0.8.0 Release Overview","doc":"","ref":"v0-8-0-overview.html#what-s-new-in-v0-8-0"},{"type":"extras","title":"1. Direct Peer-to-Peer Messaging - v0.8.0 Release Overview","doc":"**Before (v0.7.x)**: Multi-hop relay through gateway\n```\nPublisher  Gateway Connection  Multi-hop Routing  Subscriber\n```\n\n**After (v0.8.0)**: Direct QUIC connection\n```\nPublisher  DHT Lookup  Direct QUIC Connection  Subscriber\n```\n\n**Benefits**:\n- Lower latency (1 hop instead of 2+)\n- Reduced gateway load\n- Better scalability\n- Simpler message flow","ref":"v0-8-0-overview.html#1-direct-peer-to-peer-messaging"},{"type":"extras","title":"2. New Module: macula_peer_connector - v0.8.0 Release Overview","doc":"Fire-and-forget P2P QUIC connections (112 LOC):\n\n```erlang\n%% Send message directly to peer\nmacula_peer_connector:send_message(Endpoint, MessageType, Message).\n```\n\n**Features**:\n- Handles transport_down errors gracefully\n- 100ms delay before closing (prevents race condition)\n- Simple endpoint parsing (host:port format)\n- Direct quicer integration with ALPN [\"macula\"]","ref":"v0-8-0-overview.html#2-new-module-macula_peer_connector"},{"type":"extras","title":"3. DHT STORE Propagation - v0.8.0 Release Overview","doc":"Service registrations now propagate to k closest nodes:\n\n```erlang\n%% Register service - automatically propagates\nmacula_routing_server:store(Pid, Key, Value)\n```\n\n**Propagation**:\n- Stores locally\n- Finds k=20 closest nodes via XOR distance\n- Sends STORE message to each node\n- Eventual consistency across mesh","ref":"v0-8-0-overview.html#3-dht-store-propagation"},{"type":"extras","title":"4. Gateway on All Node Types - v0.8.0 Release Overview","doc":"**All nodes now run QUIC listeners on port 9443**:\n- Bootstrap nodes - Accept P2P connections\n- Gateway nodes - Accept P2P connections\n- Edge nodes - Accept P2P connections\n\n**Why**: Edge nodes must receive incoming DHT STORE messages and direct P2P messages. Without a listener, they cannot participate fully in the mesh.","ref":"v0-8-0-overview.html#4-gateway-on-all-node-types"},{"type":"extras","title":"5. Updated RPC Architecture - v0.8.0 Release Overview","doc":"RPC now uses direct P2P instead of multi-hop routing:\n\n1. Client queries DHT for service provider\n2. DHT returns provider endpoint\n3. Client connects directly via `macula_peer_connector`\n4. RPC message delivered in single hop\n\n**Test Coverage**: 11/11 integration tests passing\n- Service registration/discovery\n- Multi-node RPC calls\n- Timeout handling\n- Error scenarios","ref":"v0-8-0-overview.html#5-updated-rpc-architecture"},{"type":"extras","title":"6. Updated PubSub Architecture - v0.8.0 Release Overview","doc":"PubSub now uses direct P2P for message delivery:\n\n1. Subscriber advertises subscription in DHT\n2. Publisher queries DHT for subscribers\n3. Publisher connects directly to each subscriber\n4. Message delivered via pubsub_route envelope\n\n**Test Coverage**: 10/10 integration tests passing\n- Subscription advertisement\n- Subscriber discovery\n- Multi-hop topology\n- Multiple subscribers\n\n---","ref":"v0-8-0-overview.html#6-updated-pubsub-architecture"},{"type":"extras","title":"Architecture Changes - v0.8.0 Release Overview","doc":"","ref":"v0-8-0-overview.html#architecture-changes"},{"type":"extras","title":"Node Types - v0.8.0 Release Overview","doc":"All node types now have identical P2P capabilities:\n\n| Node Type | v0.7.x | v0.8.0 |\n|-----------|--------|--------|\n| **Bootstrap** | DHT only | DHT + QUIC listener |\n| **Gateway** | DHT + listener | DHT + QUIC listener |\n| **Edge** | DHT only | DHT + QUIC listener |","ref":"v0-8-0-overview.html#node-types"},{"type":"extras","title":"Message Flow - v0.8.0 Release Overview","doc":"#### RPC Message Flow (v0.8.0)\n```\n1. Client queries DHT for service \"calculator\"\n2. DHT returns: {node_id, endpoint: \"172.21.0.33:9443\"}\n3. Client  peer_connector  QUIC connection  Provider\n4. Provider executes RPC, returns result\n5. Result  peer_connector  Client\n```\n\n#### PubSub Message Flow (v0.8.0)\n```\n1. Edge1 advertises subscription to \"sensor.data\" in DHT\n2. DHT propagates to k=20 nodes\n3. Publisher queries DHT for \"sensor.data\" subscribers\n4. DHT returns: [{node_id, endpoint: \"172.21.0.31:9443\"}]\n5. Publisher  peer_connector  QUIC  Subscriber\n6. Message delivered wrapped in pubsub_route envelope\n```","ref":"v0-8-0-overview.html#message-flow"},{"type":"extras","title":"DHT Propagation Flow - v0.8.0 Release Overview","doc":"```\nEdge3 registers service \"calculator\"\n  \nmacula_routing_server:store(Key, Value)\n  \nStore locally + Find k=20 closest nodes\n  \nFor each of k nodes:\n  \nmacula_gateway_dht:send_to_peer(Node, store, Message)\n  \nmacula_peer_connector:send_message(Endpoint, store, Message)\n  \nEstablish QUIC connection\n  \nSend MessagePack-encoded STORE\n  \nWait 100ms for transmission\n  \nGracefully close stream and connection\n  \nRemote node receives STORE message\n  \nStores value locally in DHT\n```\n\n---","ref":"v0-8-0-overview.html#dht-propagation-flow"},{"type":"extras","title":"Performance Characteristics - v0.8.0 Release Overview","doc":"","ref":"v0-8-0-overview.html#performance-characteristics"},{"type":"extras","title":"Connection Pattern - v0.8.0 Release Overview","doc":"- **Fire-and-forget**: New connection per DHT message\n- **Connection lifetime**: ~100-200ms (connect + send + delay + close)\n- **No connection pooling**: Simple but creates overhead","ref":"v0-8-0-overview.html#connection-pattern"},{"type":"extras","title":"Throughput - v0.8.0 Release Overview","doc":"- **DHT STORE**: ~5-10 operations/sec per node\n- **RPC calls**: Limited by DHT discovery latency (~100-200ms first call, then cached)\n- **PubSub messages**: Direct delivery, ~10-50ms latency","ref":"v0-8-0-overview.html#throughput"},{"type":"extras","title":"Optimization Opportunities (v0.9.0) - v0.8.0 Release Overview","doc":"1. **Connection pooling** - Reuse connections to frequently-contacted peers\n2. **Persistent streams** - Keep streams open for multiple messages\n3. **Batch sending** - Combine multiple DHT operations\n4. **Adaptive delay** - Tune delay based on network conditions\n\n---","ref":"v0-8-0-overview.html#optimization-opportunities-v0-9-0"},{"type":"extras","title":"Breaking Changes - v0.8.0 Release Overview","doc":"","ref":"v0-8-0-overview.html#breaking-changes"},{"type":"extras","title":"None (Fully Backward Compatible) - v0.8.0 Release Overview","doc":"v0.8.0 is fully compatible with v0.7.x. The internal architecture changed but the external API remains the same.\n\n**Migration**: Simply upgrade - no code changes required.\n\n---","ref":"v0-8-0-overview.html#none-fully-backward-compatible"},{"type":"extras","title":"Files Created - v0.8.0 Release Overview","doc":"","ref":"v0-8-0-overview.html#files-created"},{"type":"extras","title":"New Modules - v0.8.0 Release Overview","doc":"- `src/macula_peer_connector.erl` (112 LOC) - Direct P2P QUIC connections","ref":"v0-8-0-overview.html#new-modules"},{"type":"extras","title":"New Tests - v0.8.0 Release Overview","doc":"- `test/integration/multi_hop_rpc_SUITE.erl` (11 tests) - RPC integration tests\n- `test/integration/multi_hop_pubsub_SUITE.erl` (10 tests) - PubSub integration tests","ref":"v0-8-0-overview.html#new-tests"},{"type":"extras","title":"Documentation - v0.8.0 Release Overview","doc":"- `architecture/v0.8.0-OVERVIEW.md` - This document\n- `architecture/v0.8.0-ARCHITECTURE.md` - Technical architecture\n- `architecture/v0.8.0-DECISIONS.md` - Architecture Decision Records\n- `architecture/v0.8.0-CHANGELOG.md` - Detailed changes\n- `architecture/v0.8.0-ROADMAP.md` - Future plans (v0.9.0)\n- `architecture/v0.8.0-HISTORY.md` - Development history\n\n---","ref":"v0-8-0-overview.html#documentation"},{"type":"extras","title":"Files Modified - v0.8.0 Release Overview","doc":"","ref":"v0-8-0-overview.html#files-modified"},{"type":"extras","title":"Core Implementation - v0.8.0 Release Overview","doc":"- `src/macula_routing_server.erl` - Added `store/3` with k-node propagation\n- `src/macula_gateway_dht.erl` - Updated to use peer_connector\n- `src/macula_service_registry.erl` - Changed to use `store/3` instead of `store_local/3`\n- `src/macula_pubsub_dht.erl` - Updated RPC and PubSub to use peer_connector","ref":"v0-8-0-overview.html#core-implementation"},{"type":"extras","title":"Docker Infrastructure - v0.8.0 Release Overview","doc":"- `docker/Dockerfile.bootstrap` - Enabled gateway, added certs, exposed 9443\n- `docker/Dockerfile.edge` - Enabled gateway, added certs, exposed 9443\n- `docker/docker-compose.multi-mode.yml` - Added TLS volumes, gateway env vars","ref":"v0-8-0-overview.html#docker-infrastructure"},{"type":"extras","title":"Test Infrastructure - v0.8.0 Release Overview","doc":"- `test/integration/test_helpers.erl` - Updated to use DHT APIs\n- Added routing table seeding for reproducible integration tests\n\n---","ref":"v0-8-0-overview.html#test-infrastructure"},{"type":"extras","title":"Upgrade Guide - v0.8.0 Release Overview","doc":"","ref":"v0-8-0-overview.html#upgrade-guide"},{"type":"extras","title":"From v0.7.x to v0.8.0 - v0.8.0 Release Overview","doc":"**Step 1**: Update dependency\n```erlang\n{deps, [\n    {macula, \"0.8.0\"}\n]}.\n```\n\n**Step 2**: Rebuild\n```bash\nrebar3 upgrade macula\nrebar3 compile\n```\n\n**Step 3**: Update Docker images (if using)\n```bash\ndocker build -f docker/Dockerfile.edge -t macula-edge:0.8.0 .\n```\n\n**Step 4**: Verify\n```bash\nrebar3 eunit\nrebar3 ct\n```\n\n**No configuration changes required!**\n\n---","ref":"v0-8-0-overview.html#from-v0-7-x-to-v0-8-0"},{"type":"extras","title":"Known Limitations - v0.8.0 Release Overview","doc":"","ref":"v0-8-0-overview.html#known-limitations"},{"type":"extras","title":"TLS Certificate Verification - v0.8.0 Release Overview","doc":"**Status**: Deferred to v0.9.0\n**Impact**: Low (works but less secure)\n**Workaround**: Run on trusted networks\n\nCurrent implementation uses `{verify, none}` for QUIC connections. This works but doesn't validate peer certificates.\n\n**Modules affected**:\n- `macula_connection.erl`\n- `macula_connection_pool.erl`\n- `macula_peer_connector.erl`\n\n**Planned fix (v0.9.0)**: Implement proper certificate validation with CA bundle.","ref":"v0-8-0-overview.html#tls-certificate-verification"},{"type":"extras","title":"Fire-and-Forget Pattern Limitations - v0.8.0 Release Overview","doc":"**Status**: By design\n**Impact**: Low (works well for DHT)\n**Workaround**: None needed\n\nThe peer connector uses fire-and-forget pattern:\n- No confirmation of delivery\n- No feedback if remote node processed message\n- Good for DHT (eventual consistency)\n- May need request/response pattern for other use cases (v0.9.0)","ref":"v0-8-0-overview.html#fire-and-forget-pattern-limitations"},{"type":"extras","title":"Connection Overhead - v0.8.0 Release Overview","doc":"**Status**: Optimization opportunity\n**Impact**: Medium (creates overhead)\n**Workaround**: Acceptable for current workloads\n\nNew connection per message creates overhead:\n- ~100-200ms per operation\n- No connection reuse\n- Good enough for service discovery use case\n- Connection pooling planned for v0.9.0\n\n---","ref":"v0-8-0-overview.html#connection-overhead"},{"type":"extras","title":"What's Next (v0.9.0) - v0.8.0 Release Overview","doc":"See `architecture/v0.8.0-ROADMAP.md` for detailed planning.\n\n**High Priority**:\n1. **Connection Pooling** - Reuse connections to frequently-contacted peers\n2. **TLS Certificate Validation** - Proper certificate verification\n3. **Request/Response Pattern** - DHT queries with timeout and correlation IDs\n\n**Medium Priority**:\n4. **NAT Traversal** - Hole punching for direct P2P behind NAT\n5. **Performance Tuning** - Optimize delay parameter, batch operations\n6. **Subsystem Refactoring** - Extract bootstrap and relay systems\n\n---","ref":"v0-8-0-overview.html#what-s-next-v0-9-0"},{"type":"extras","title":"References - v0.8.0 Release Overview","doc":"- **Source Code**: https://github.com/macula-io/macula\n- **Architecture Docs**: `architecture/v0.8.0-ARCHITECTURE.md`\n- **Changelog**: `architecture/v0.8.0-CHANGELOG.md`\n- **Roadmap**: `architecture/v0.8.0-ROADMAP.md`\n- **Integration Tests**: `test/integration/`\n\n---","ref":"v0-8-0-overview.html#references"},{"type":"extras","title":"Contributors - v0.8.0 Release Overview","doc":"- Architecture design and implementation\n- Comprehensive integration test coverage\n- Documentation and release preparation\n\n---\n\n**Document Version**: 1.0\n**Last Updated**: 2025-11-17\n**Status**: Final","ref":"v0-8-0-overview.html#contributors"},{"type":"extras","title":"v0.8.0 Detailed Changelog","doc":"# Macula v0.8.0 Changelog\n\n**Release Date**: 2025-11-17\n\n---","ref":"v0-8-0-changelog.html"},{"type":"extras","title":"New Features - v0.8.0 Detailed Changelog","doc":"","ref":"v0-8-0-changelog.html#new-features"},{"type":"extras","title":"Direct Peer-to-Peer Messaging - v0.8.0 Detailed Changelog","doc":"**New Module**: `macula_peer_connector` (112 LOC)\n- Fire-and-forget QUIC connections\n- Handles transport_down errors gracefully\n- 100ms delay before closing to prevent race conditions\n- Simple endpoint parsing\n\n**API**:\n```erlang\nmacula_peer_connector:send_message(Endpoint, MessageType, Message).\nmacula_peer_connector:send_message(Endpoint, MessageType, Message, Timeout).\n```","ref":"v0-8-0-changelog.html#direct-peer-to-peer-messaging"},{"type":"extras","title":"DHT STORE Propagation - v0.8.0 Detailed Changelog","doc":"**Enhanced**: `macula_routing_server:store/3`\n- Now propagates to k=20 closest nodes\n- Automatic replication across mesh\n- Eventual consistency model\n\n**Before**:\n```erlang\n%% Only stored locally\nmacula_routing_server:store_local(Pid, Key, Value).\n```\n\n**After**:\n```erlang\n%% Stores locally + propagates to k closest nodes\nmacula_routing_server:store(Pid, Key, Value).\n```","ref":"v0-8-0-changelog.html#dht-store-propagation"},{"type":"extras","title":"Gateway on All Node Types - v0.8.0 Detailed Changelog","doc":"**Changed**: All node types now run QUIC listeners\n\n- Bootstrap nodes: Now accept P2P connections on port 9443\n- Gateway nodes: (unchanged) Accept P2P connections on port 9443\n- Edge nodes: Now accept P2P connections on port 9443\n\n**Why**: Enables edge nodes to receive incoming DHT messages and participate fully in P2P mesh.","ref":"v0-8-0-changelog.html#gateway-on-all-node-types"},{"type":"extras","title":"RPC via Direct P2P - v0.8.0 Detailed Changelog","doc":"**Updated**: `src/macula_pubsub_dht.erl` (RPC functions)\n- Service discovery via DHT\n- Direct connection to provider endpoint\n- No multi-hop routing needed\n\n**Message Flow**:\n1. Query DHT for service  Get endpoint\n2. Connect directly via peer_connector\n3. Deliver RPC message\n4. Return result directly\n\n**Test Coverage**: 11/11 integration tests passing","ref":"v0-8-0-changelog.html#rpc-via-direct-p2p"},{"type":"extras","title":"PubSub via Direct P2P - v0.8.0 Detailed Changelog","doc":"**Updated**: `src/macula_pubsub_dht.erl` (PubSub functions)\n- Subscription advertisement in DHT\n- Subscriber discovery via DHT queries\n- Direct message delivery to subscribers\n\n**Message Flow**:\n1. Subscriber advertises in DHT\n2. Publisher queries DHT for subscribers\n3. Publisher connects directly to each subscriber\n4. Delivers message wrapped in pubsub_route envelope\n\n**Test Coverage**: 10/10 integration tests passing\n\n---","ref":"v0-8-0-changelog.html#pubsub-via-direct-p2p"},{"type":"extras","title":"Improvements - v0.8.0 Detailed Changelog","doc":"","ref":"v0-8-0-changelog.html#improvements"},{"type":"extras","title":"Error Handling - v0.8.0 Detailed Changelog","doc":"**Improved**: QUIC connection error handling\n- Added pattern match for 3-tuple errors: `{error, transport_down, Details}`\n- Graceful handling of connection failures\n- Better error messages","ref":"v0-8-0-changelog.html#error-handling"},{"type":"extras","title":"Stream Lifecycle Management - v0.8.0 Detailed Changelog","doc":"**Fixed**: Race condition in stream closing\n- Added 100ms delay after send before closing stream\n- Allows QUIC to flush send buffer\n- Prevents \"Failed to set stream active: closed\" errors\n- Graceful shutdown with proper ACKs","ref":"v0-8-0-changelog.html#stream-lifecycle-management"},{"type":"extras","title":"Docker Configuration - v0.8.0 Detailed Changelog","doc":"**Fixed**: Gateway configuration in Dockerfiles\n- Changed hardcoded `start_gateway` to environment-driven\n- All node types now expose port 9443\n- TLS certificates properly mounted\n\n**Files Modified**:\n- `docker/Dockerfile.bootstrap`\n- `docker/Dockerfile.edge`\n- `docker/docker-compose.multi-mode.yml`","ref":"v0-8-0-changelog.html#docker-configuration"},{"type":"extras","title":"Test Infrastructure - v0.8.0 Detailed Changelog","doc":"**New**: Integration test suites\n- `test/integration/multi_hop_rpc_SUITE.erl` - 11 RPC tests\n- `test/integration/multi_hop_pubsub_SUITE.erl` - 10 PubSub tests\n- Routing table seeding for reproducible tests\n- Docker-based multi-node testing\n\n**New**: Test helpers\n- `test/integration/test_helpers.erl` - DHT operations, Docker exec, health checks\n\n---","ref":"v0-8-0-changelog.html#test-infrastructure"},{"type":"extras","title":"Bug Fixes - v0.8.0 Detailed Changelog","doc":"","ref":"v0-8-0-changelog.html#bug-fixes"},{"type":"extras","title":"Fixed: Edge Nodes Cannot Send Messages - v0.8.0 Detailed Changelog","doc":"**Problem**: Edge nodes don't run gateway, so `whereis(macula_gateway)` returned `undefined`.\n\n**Solution**: Implemented `macula_peer_connector` for direct QUIC connections without requiring local gateway.","ref":"v0-8-0-changelog.html#fixed-edge-nodes-cannot-send-messages"},{"type":"extras","title":"Fixed: Edge Nodes Cannot Receive Messages - v0.8.0 Detailed Changelog","doc":"**Problem**: Edge nodes without QUIC listener cannot accept incoming connections.\n\n**Solution**: Enabled gateway on all node types so every node can receive P2P connections.","ref":"v0-8-0-changelog.html#fixed-edge-nodes-cannot-receive-messages"},{"type":"extras","title":"Fixed: QUIC Error Handling - v0.8.0 Detailed Changelog","doc":"**Problem**: `quicer:connect` returns `{error, transport_down, Details}` (3-tuple) but code only handled 2-tuple errors.\n\n**Solution**: Added pattern match for 3-tuple error.","ref":"v0-8-0-changelog.html#fixed-quic-error-handling"},{"type":"extras","title":"Fixed: Stream Closing Race Condition - v0.8.0 Detailed Changelog","doc":"**Problem**: Sender closed stream immediately after `quicer:send/2`, receiver got \"Failed to set stream active: closed\".\n\n**Solution**: Added 100ms delay after send before closing.","ref":"v0-8-0-changelog.html#fixed-stream-closing-race-condition"},{"type":"extras","title":"Fixed: Dockerfile Configuration Override - v0.8.0 Detailed Changelog","doc":"**Problem**: `docker-compose.yml` environment variables didn't override Dockerfile CMD arguments.\n\n**Solution**: Changed Dockerfiles to enable gateway by default with proper ENV vars.\n\n---","ref":"v0-8-0-changelog.html#fixed-dockerfile-configuration-override"},{"type":"extras","title":"Deprecated - v0.8.0 Detailed Changelog","doc":"","ref":"v0-8-0-changelog.html#deprecated"},{"type":"extras","title":"Deprecated: macula_dht_rpc module - v0.8.0 Detailed Changelog","doc":"**Status**: Moved to `src/archive/`\n**Reason**: Superseded by `macula_peer_connector`\n**Migration**: Use `macula_peer_connector:send_message/3` instead\n\n---","ref":"v0-8-0-changelog.html#deprecated-macula_dht_rpc-module"},{"type":"extras","title":"API Changes - v0.8.0 Detailed Changelog","doc":"","ref":"v0-8-0-changelog.html#api-changes"},{"type":"extras","title":"No Breaking Changes - v0.8.0 Detailed Changelog","doc":"All v0.7.x APIs remain functional. New functionality is additive.","ref":"v0-8-0-changelog.html#no-breaking-changes"},{"type":"extras","title":"New APIs - v0.8.0 Detailed Changelog","doc":"```erlang\n%% macula_peer_connector (NEW)\n-spec send_message(binary(), atom(), map()) -> ok | {error, term()}.\n-spec send_message(binary(), atom(), map(), timeout()) -> ok | {error, term()}.\n\n%% macula_routing_server (ENHANCED)\n-spec store(pid(), binary(), term()) -> ok.  % Now propagates to k nodes\n```","ref":"v0-8-0-changelog.html#new-apis"},{"type":"extras","title":"Enhanced APIs - v0.8.0 Detailed Changelog","doc":"```erlang\n%% macula_pubsub_dht (UPDATED)\n%% Now uses peer_connector for direct P2P delivery\nroute_to_subscribers(Topic, Payload, Qos, Subscribers, SourceNodeId).\nadvertise_subscription(Topic, SubRef, NodeId, Url, ConnMgrPid).\nquery_dht_async(Topic, Payload, Qos, MsgId, ConnMgrPid).\n```\n\n---","ref":"v0-8-0-changelog.html#enhanced-apis"},{"type":"extras","title":"Configuration Changes - v0.8.0 Detailed Changelog","doc":"","ref":"v0-8-0-changelog.html#configuration-changes"},{"type":"extras","title":"No Required Changes - v0.8.0 Detailed Changelog","doc":"v0.8.0 is fully backward compatible. No configuration changes required.","ref":"v0-8-0-changelog.html#no-required-changes"},{"type":"extras","title":"New Optional Configuration - v0.8.0 Detailed Changelog","doc":"```erlang\n%% Future: Connection pooling (v0.9.0)\n{macula, [\n    {peer_connector, #{\n        pool_size => 100,\n        connection_ttl => 300000  % 5 minutes\n    }}\n]}.\n\n%% Future: TLS verification (v0.9.0)\n{macula, [\n    {tls, #{\n        verify => verify_peer,\n        cacertfile => \"/path/to/ca.pem\"\n    }}\n]}.\n```\n\n---","ref":"v0-8-0-changelog.html#new-optional-configuration"},{"type":"extras","title":"Performance - v0.8.0 Detailed Changelog","doc":"","ref":"v0-8-0-changelog.html#performance"},{"type":"extras","title":"Latency Improvements - v0.8.0 Detailed Changelog","doc":"- **RPC calls**: 1-hop direct vs 2+ hop relay (~50% latency reduction)\n- **PubSub messages**: Direct delivery vs gateway relay (~50% latency reduction)\n- **DHT queries**: Local + remote queries (~100-200ms for remote)","ref":"v0-8-0-changelog.html#latency-improvements"},{"type":"extras","title":"Throughput - v0.8.0 Detailed Changelog","doc":"- **DHT STORE**: ~5-10 operations/sec per node\n- **RPC calls**: Limited by DHT discovery (~100-200ms first call, cached after)\n- **PubSub**: Direct delivery, ~10-50ms latency","ref":"v0-8-0-changelog.html#throughput"},{"type":"extras","title":"Resource Usage - v0.8.0 Detailed Changelog","doc":"- **Connection overhead**: New connection per message (~100-200ms)\n- **Memory**: Minimal increase (peer_connector is stateless)\n- **CPU**: Slightly higher due to connection establishment overhead\n\n---","ref":"v0-8-0-changelog.html#resource-usage"},{"type":"extras","title":"Testing - v0.8.0 Detailed Changelog","doc":"","ref":"v0-8-0-changelog.html#testing"},{"type":"extras","title":"New Test Suites - v0.8.0 Detailed Changelog","doc":"**RPC Integration Tests** (`test/integration/multi_hop_rpc_SUITE.erl`):\n-  test_bootstrap_node_healthy\n-  test_gateway_node_healthy\n-  test_edge_nodes_healthy\n-  test_dht_peer_discovery\n-  test_service_registration_in_dht\n-  test_service_discovery_via_dht\n-  test_single_hop_rpc_call\n-  test_multi_hop_rpc_call\n-  test_rpc_timeout_handling\n-  test_rpc_provider_not_found\n-  test_rpc_max_hops_exceeded\n\n**PubSub Integration Tests** (`test/integration/multi_hop_pubsub_SUITE.erl`):\n-  test_bootstrap_node_healthy\n-  test_gateway_node_healthy\n-  test_edge_nodes_healthy\n-  test_dht_peer_discovery\n-  test_subscription_advertisement_in_dht\n-  test_subscriber_discovery_via_dht\n-  test_single_hop_pubsub\n-  test_multi_hop_pubsub\n-  test_wildcard_subscriptions\n-  test_multiple_subscribers\n\n**Total**: 21/21 integration tests passing (100%)\n\n---","ref":"v0-8-0-changelog.html#new-test-suites"},{"type":"extras","title":"Known Issues - v0.8.0 Detailed Changelog","doc":"","ref":"v0-8-0-changelog.html#known-issues"},{"type":"extras","title":"TLS Certificate Verification Disabled - v0.8.0 Detailed Changelog","doc":"**Impact**: Security concern for production\n**Workaround**: Run on trusted networks\n**Fix**: Planned for v0.9.0\n\nCurrently using `{verify, none}` in QUIC connections. This works but doesn't validate peer certificates.","ref":"v0-8-0-changelog.html#tls-certificate-verification-disabled"},{"type":"extras","title":"Fire-and-Forget Pattern Limitations - v0.8.0 Detailed Changelog","doc":"**Impact**: No delivery confirmation\n**Workaround**: Use eventual consistency model\n**Enhancement**: Request/response pattern planned for v0.9.0\n\nThe peer connector doesn't confirm delivery or provide feedback. This is by design for DHT operations but may need enhancement for other use cases.","ref":"v0-8-0-changelog.html#fire-and-forget-pattern-limitations"},{"type":"extras","title":"Connection Overhead - v0.8.0 Detailed Changelog","doc":"**Impact**: New connection per message\n**Workaround**: Acceptable for current workloads\n**Optimization**: Connection pooling planned for v0.9.0\n\nCreating new connection for each message adds overhead. Connection pooling will significantly improve performance.\n\n---","ref":"v0-8-0-changelog.html#connection-overhead"},{"type":"extras","title":"Documentation - v0.8.0 Detailed Changelog","doc":"","ref":"v0-8-0-changelog.html#documentation"},{"type":"extras","title":"New Documents - v0.8.0 Detailed Changelog","doc":"- `architecture/v0.8.0-OVERVIEW.md` - Release overview\n- `architecture/v0.8.0-ARCHITECTURE.md` - Technical architecture\n- `architecture/v0.8.0-DECISIONS.md` - Architecture Decision Records\n- `architecture/v0.8.0-CHANGELOG.md` - This document\n- `architecture/v0.8.0-ROADMAP.md` - Future plans\n- `architecture/v0.8.0-HISTORY.md` - Development history\n- `TODO.md` - Tracked limitations and planned improvements","ref":"v0-8-0-changelog.html#new-documents"},{"type":"extras","title":"Updated Documents - v0.8.0 Detailed Changelog","doc":"- `README.md` - Updated for v0.8.0\n- Module @doc comments - Enhanced documentation\n- Integration test documentation","ref":"v0-8-0-changelog.html#updated-documents"},{"type":"extras","title":"Archived Documents - v0.8.0 Detailed Changelog","doc":"Moved to `architecture/archive/v0.8.0-development/`:\n- Development session summaries\n- Implementation progress tracking\n- Work breakdown documents\n- Phase completion reports\n\n---","ref":"v0-8-0-changelog.html#archived-documents"},{"type":"extras","title":"Upgrade Instructions - v0.8.0 Detailed Changelog","doc":"","ref":"v0-8-0-changelog.html#upgrade-instructions"},{"type":"extras","title":"From v0.7.x - v0.8.0 Detailed Changelog","doc":"**Step 1**: Update dependency\n```erlang\n%% In rebar.config\n{deps, [\n    {macula, \"0.8.0\"}\n]}.\n```\n\n**Step 2**: Rebuild\n```bash\nrebar3 upgrade macula\nrebar3 compile\n```\n\n**Step 3**: Update Docker images (optional)\n```bash\n# Rebuild with v0.8.0\ndocker build -f docker/Dockerfile.bootstrap -t macula-bootstrap:0.8.0 .\ndocker build -f docker/Dockerfile.gateway -t macula-gateway:0.8.0 .\ndocker build -f docker/Dockerfile.edge -t macula-edge:0.8.0 .\n```\n\n**Step 4**: Test\n```bash\nrebar3 eunit\nrebar3 ct\n```\n\n**No configuration changes required!**\n\n---","ref":"v0-8-0-changelog.html#from-v0-7-x"},{"type":"extras","title":"Contributors - v0.8.0 Detailed Changelog","doc":"Development, testing, documentation, and release preparation.\n\n---","ref":"v0-8-0-changelog.html#contributors"},{"type":"extras","title":"Release Assets - v0.8.0 Detailed Changelog","doc":"- **Source**: GitHub tag `v0.8.0`\n- **Hex Package**: `macula` v0.8.0\n- **Docker Images**:\n  - `macula-bootstrap:0.8.0`\n  - `macula-gateway:0.8.0`\n  - `macula-edge:0.8.0`\n\n---\n\n**Document Version**: 1.0\n**Last Updated**: 2025-11-17","ref":"v0-8-0-changelog.html#release-assets"},{"type":"extras","title":"v0.9.0 Roadmap","doc":"# Macula v0.8.0 Roadmap - What's Next\n\n**Current Version**: v0.8.0\n**Next Release**: v0.9.0 (Planned Q2 2025)\n\n---","ref":"v0-8-0-roadmap.html"},{"type":"extras","title":"v0.8.0 Status - v0.9.0 Roadmap","doc":" **COMPLETE** - All features implemented and tested\n\n-  Direct P2P QUIC connections\n-  DHT propagation (k=20 replication)\n-  Gateway on all node types\n-  RPC via direct P2P (11/11 tests)\n-  PubSub via direct P2P (10/10 tests)\n-  Comprehensive integration tests\n\n**Test Coverage**: 21/21 integration tests passing (100%)\n\n---","ref":"v0-8-0-roadmap.html#v0-8-0-status"},{"type":"extras","title":"v0.9.0 Planning - Production Hardening - v0.9.0 Roadmap","doc":"**Target Release**: Q2 2025 (4-6 months)\n**Focus**: Security, Performance, NAT Traversal","ref":"v0-8-0-roadmap.html#v0-9-0-planning-production-hardening"},{"type":"extras","title":"Theme: Production-Ready Infrastructure - v0.9.0 Roadmap","doc":"v0.8.0 provides the foundation. v0.9.0 makes it production-grade with security hardening, performance optimization, and NAT traversal.\n\n---","ref":"v0-8-0-roadmap.html#theme-production-ready-infrastructure"},{"type":"extras","title":"High Priority Features - v0.9.0 Roadmap","doc":"","ref":"v0-8-0-roadmap.html#high-priority-features"},{"type":"extras","title":"1. Connection Pooling - v0.9.0 Roadmap","doc":"**Problem**: New connection per message creates overhead\n**Impact**: Performance (100-200ms per operation)\n**Effort**: 2-3 weeks\n\n**Implementation**:\n- Create `macula_connection_pool` enhancement\n- LRU eviction policy\n- Max 100 connections per pool\n- TTL-based cleanup (5-minute idle timeout)\n- Automatic reconnection on failure\n\n**Benefits**:\n- 10x performance improvement for repeated operations\n- Reduced connection establishment overhead\n- Better resource utilization\n- Lower latency for frequent P2P operations\n\n**API**:\n```erlang\n%% Get connection from pool (or create new)\n{ok, Conn} = macula_connection_pool:get_connection(Endpoint).\n\n%% Send via pooled connection\nok = macula_connection_pool:send_message(Conn, MessageType, Message).\n\n%% Return to pool (automatic via monitoring)\n```","ref":"v0-8-0-roadmap.html#1-connection-pooling"},{"type":"extras","title":"2. TLS Certificate Verification - v0.9.0 Roadmap","doc":"**Problem**: Currently using `{verify, none}` (security risk)\n**Impact**: Security (high)\n**Effort**: 1-2 weeks\n\n**Implementation**:\n- Add CA certificate bundle support\n- Implement certificate validation\n- Support custom CA paths\n- Add certificate pinning option\n\n**Configuration**:\n```erlang\n{macula, [\n    {tls, #{\n        verify => verify_peer,\n        cacertfile => \"/etc/macula/ca-bundle.pem\",\n        certfile => \"/etc/macula/node-cert.pem\",\n        keyfile => \"/etc/macula/node-key.pem\",\n        %% Optional: Pin specific certificates\n        pinned_certs => [\n            <<...>>  % SHA256 fingerprint\n        ]\n    }}\n]}.\n```\n\n**Modules to Update**:\n- `macula_connection.erl`\n- `macula_connection_pool.erl`\n- `macula_peer_connector.erl`\n- `macula_quic.erl`","ref":"v0-8-0-roadmap.html#2-tls-certificate-verification"},{"type":"extras","title":"3. Request/Response Pattern for DHT - v0.9.0 Roadmap","doc":"**Problem**: Fire-and-forget provides no feedback\n**Impact**: Observability (medium)\n**Effort**: 2-3 weeks\n\n**Implementation**:\n- Add correlation IDs to DHT messages\n- Implement response tracking with timeout\n- Return query results to caller\n- Add retry logic for failed queries\n\n**API**:\n```erlang\n%% Query with response\n{ok, Result} = macula_routing_server:query_with_response(\n    Pid, Key, Timeout\n).\n\n%% Store with confirmation\n{ok, StoredNodes} = macula_routing_server:store_with_confirmation(\n    Pid, Key, Value, Timeout\n).\n```\n\n**Benefits**:\n- Confirm DHT operations succeeded\n- Monitor propagation success rate\n- Better debugging and observability\n- Retry failed operations\n\n---","ref":"v0-8-0-roadmap.html#3-request-response-pattern-for-dht"},{"type":"extras","title":"Medium Priority Features - v0.9.0 Roadmap","doc":"","ref":"v0-8-0-roadmap.html#medium-priority-features"},{"type":"extras","title":"4. NAT Traversal - Opportunistic Hole Punching - v0.9.0 Roadmap","doc":"**Problem**: Edge nodes behind NAT cannot accept connections\n**Impact**: Connectivity (medium)\n**Effort**: 6-8 weeks\n\n**Strategy**: Attempt direct connection while keeping relay fallback\n\n**Implementation Phases**:\n\n#### Phase A: NAT Discovery (2 weeks)\n- Create `macula_nat_discovery.erl`\n- Detect public IP/port via gateway\n- Detect NAT type (cone, symmetric, etc.)\n- Cache NAT type and public address\n\n#### Phase B: Hole Punching (3 weeks)\n- Create `macula_hole_punch.erl`\n- Coordinate simultaneous connection attempts\n- Exchange addresses via gateway\n- Timeout and fallback to relay\n\n#### Phase C: Connection Upgrade (2 weeks)\n- Create `macula_connection_upgrade.erl`\n- Migrate active streams from relay to direct\n- Handle graceful transition\n- Update routing tables\n\n#### Phase D: Testing (1 week)\n- Docker-based NAT simulation\n- Test various NAT types\n- Verify fallback behavior\n- Integration tests\n\n**Success Metrics**:\n- 80%+ direct P2P success (non-symmetric NAT)\n- 100% connectivity (with relay fallback)\n- <100ms upgrade time (relay  direct)\n- No message loss during upgrade\n\n**See**: `architecture/NAT_TRAVERSAL_ROADMAP.md` for detailed design","ref":"v0-8-0-roadmap.html#4-nat-traversal-opportunistic-hole-punching"},{"type":"extras","title":"5. Performance Tuning - v0.9.0 Roadmap","doc":"**Problem**: Various performance bottlenecks\n**Impact**: Performance (medium)\n**Effort**: 2-3 weeks\n\n**Optimizations**:\n\n#### 5.1. Adaptive Delay Tuning\n- Currently 100ms fixed delay before closing streams\n- Implement adaptive delay based on network conditions\n- Measure actual transmission time\n- Tune per-connection\n\n#### 5.2. Batch DHT Operations\n- Combine multiple STORE operations\n- Batch FIND_VALUE queries\n- Reduce connection overhead\n- Better throughput\n\n#### 5.3. DHT Cache Tuning\n- Optimize cache TTL values\n- Implement cache warming\n- Add cache statistics\n- Monitor hit rates\n\n#### 5.4. Message Batching\n- Batch multiple messages to same peer\n- Reduce per-message overhead\n- Improve throughput\n\n**Target Improvements**:\n- 2-3x throughput increase\n- 30-50% latency reduction\n- 50% reduction in connection overhead","ref":"v0-8-0-roadmap.html#5-performance-tuning"},{"type":"extras","title":"6. Observability & Metrics - v0.9.0 Roadmap","doc":"**Problem**: Limited visibility into mesh operations\n**Impact**: Operations (medium)\n**Effort**: 2 weeks\n\n**Implementation**:\n- Add telemetry events for DHT operations\n- Track connection pool statistics\n- Monitor P2P connection success rates\n- Add health check endpoints\n- Integration with Prometheus/Grafana\n\n**Metrics**:\n```erlang\n%% DHT metrics\ndht_store_operations_total\ndht_store_propagation_success_rate\ndht_query_latency_milliseconds\ndht_cache_hit_rate\n\n%% Connection metrics\np2p_connections_total\np2p_connection_duration_seconds\np2p_connection_pool_size\np2p_connection_errors_total\n\n%% RPC/PubSub metrics\nrpc_calls_total\nrpc_call_latency_milliseconds\npubsub_messages_total\npubsub_delivery_latency_milliseconds\n```\n\n---","ref":"v0-8-0-roadmap.html#6-observability-metrics"},{"type":"extras","title":"Low Priority / Future Considerations - v0.9.0 Roadmap","doc":"","ref":"v0-8-0-roadmap.html#low-priority-future-considerations"},{"type":"extras","title":"7. Subsystem Refactoring - v0.9.0 Roadmap","doc":"**Problem**: Gateway module mixes bootstrap and relay concerns\n**Impact**: Architecture (low)\n**Effort**: 4 weeks\n\n**Deferred Reason**: Current architecture works well. Refactoring is architectural cleanup, not critical for production.\n\n**When to Reconsider**:\n- If deploying dedicated bootstrap nodes\n- If relay logic becomes complex\n- If separation of concerns becomes important\n\n**See**: `architecture/V0.8.0_IMPLEMENTATION_ROADMAP.md` for original plan","ref":"v0-8-0-roadmap.html#7-subsystem-refactoring"},{"type":"extras","title":"8. STUN/TURN Infrastructure - v0.9.0 Roadmap","doc":"**Problem**: Symmetric NAT requires TURN relay\n**Impact**: Connectivity (low - already have relay fallback)\n**Effort**: 8-10 weeks + infrastructure costs\n\n**Deferred Reason**: v0.8.0 relay fallback works for 100% connectivity. STUN/TURN improves from 80% direct to 95% direct, but requires external infrastructure.\n\n**When to Reconsider**:\n- If 80% direct P2P isn't sufficient\n- If relay costs become prohibitive\n- If symmetric NAT is common in target deployment\n\n**See**: `architecture/NAT_TRAVERSAL_ROADMAP.md` Phase 3\n\n---","ref":"v0-8-0-roadmap.html#8-stun-turn-infrastructure"},{"type":"extras","title":"Version Roadmap - v0.9.0 Roadmap","doc":"","ref":"v0-8-0-roadmap.html#version-roadmap"},{"type":"extras","title":"v0.8.1 (Optional - Q1 2025) - v0.9.0 Roadmap","doc":"Quick quality-of-life improvements:\n- Remove remaining empty TODOs\n- Add more integration tests\n- Improve error messages\n- Documentation polish\n\n**Effort**: 1 week","ref":"v0-8-0-roadmap.html#v0-8-1-optional-q1-2025"},{"type":"extras","title":"v0.9.0 (Target - Q2 2025) - v0.9.0 Roadmap","doc":"Production hardening:\n-  Connection pooling (High Priority)\n-  TLS certificate verification (High Priority)\n-  Request/response DHT pattern (High Priority)\n-  NAT hole punching (Medium Priority)\n-  Performance tuning (Medium Priority)\n-  Observability & metrics (Medium Priority)\n\n**Effort**: 18-24 weeks (4-6 months)","ref":"v0-8-0-roadmap.html#v0-9-0-target-q2-2025"},{"type":"extras","title":"v0.10.0 (Future - Q3 2025) - v0.9.0 Roadmap","doc":"Advanced features:\n- STUN/TURN infrastructure (if needed)\n- Subsystem refactoring (if needed)\n- Advanced routing strategies\n- Multi-datacenter support\n\n**Effort**: TBD\n\n---","ref":"v0-8-0-roadmap.html#v0-10-0-future-q3-2025"},{"type":"extras","title":"Development Priorities - v0.9.0 Roadmap","doc":"","ref":"v0-8-0-roadmap.html#development-priorities"},{"type":"extras","title":"Phase 1: Security (Weeks 1-3) - v0.9.0 Roadmap","doc":"1. TLS certificate verification\n2. Certificate pinning\n3. Security audit","ref":"v0-8-0-roadmap.html#phase-1-security-weeks-1-3"},{"type":"extras","title":"Phase 2: Performance (Weeks 4-9) - v0.9.0 Roadmap","doc":"1. Connection pooling\n2. Adaptive delay tuning\n3. Batch operations\n4. Performance benchmarking","ref":"v0-8-0-roadmap.html#phase-2-performance-weeks-4-9"},{"type":"extras","title":"Phase 3: Reliability (Weeks 10-12) - v0.9.0 Roadmap","doc":"1. Request/response DHT pattern\n2. Retry logic\n3. Error handling improvements","ref":"v0-8-0-roadmap.html#phase-3-reliability-weeks-10-12"},{"type":"extras","title":"Phase 4: Connectivity (Weeks 13-20) - v0.9.0 Roadmap","doc":"1. NAT discovery\n2. Hole punching\n3. Connection upgrade\n4. NAT traversal testing","ref":"v0-8-0-roadmap.html#phase-4-connectivity-weeks-13-20"},{"type":"extras","title":"Phase 5: Observability (Weeks 21-22) - v0.9.0 Roadmap","doc":"1. Telemetry integration\n2. Metrics endpoints\n3. Dashboards\n4. Monitoring","ref":"v0-8-0-roadmap.html#phase-5-observability-weeks-21-22"},{"type":"extras","title":"Phase 6: Polish (Weeks 23-24) - v0.9.0 Roadmap","doc":"1. Documentation\n2. Tutorial updates\n3. Integration testing\n4. Release preparation\n\n---","ref":"v0-8-0-roadmap.html#phase-6-polish-weeks-23-24"},{"type":"extras","title":"Success Criteria (v0.9.0) - v0.9.0 Roadmap","doc":"","ref":"v0-8-0-roadmap.html#success-criteria-v0-9-0"},{"type":"extras","title":"Performance - v0.9.0 Roadmap","doc":"-  10x improvement in repeated P2P operations (via connection pooling)\n-  <50ms P2P message delivery (cached routes)\n-  2-3x throughput increase (batching + tuning)","ref":"v0-8-0-roadmap.html#performance"},{"type":"extras","title":"Security - v0.9.0 Roadmap","doc":"-  TLS certificate verification enabled by default\n-  Certificate pinning option available\n-  Security audit passed","ref":"v0-8-0-roadmap.html#security"},{"type":"extras","title":"Reliability - v0.9.0 Roadmap","doc":"-  100% test coverage maintained\n-  DHT operation confirmation available\n-  Retry logic for failed operations","ref":"v0-8-0-roadmap.html#reliability"},{"type":"extras","title":"Connectivity - v0.9.0 Roadmap","doc":"-  80%+ direct P2P connections (NAT hole punching)\n-  100% connectivity maintained (relay fallback)\n-  Graceful connection upgrade","ref":"v0-8-0-roadmap.html#connectivity"},{"type":"extras","title":"Observability - v0.9.0 Roadmap","doc":"-  Comprehensive metrics available\n-  Integration with Prometheus\n-  Sample Grafana dashboards\n\n---","ref":"v0-8-0-roadmap.html#observability"},{"type":"extras","title":"Breaking Changes (v0.9.0) - v0.9.0 Roadmap","doc":"","ref":"v0-8-0-roadmap.html#breaking-changes-v0-9-0"},{"type":"extras","title":"Minimal Breaking Changes Expected - v0.9.0 Roadmap","doc":"**Possible**:\n- TLS verification enabled by default (may require configuration)\n- Connection pool configuration (optional)\n- Metrics endpoint (new feature)\n\n**Mitigation**:\n- Feature flags for gradual rollout\n- Backward compatibility mode\n- Clear migration guide\n\n---","ref":"v0-8-0-roadmap.html#minimal-breaking-changes-expected"},{"type":"extras","title":"Community Feedback - v0.9.0 Roadmap","doc":"We welcome feedback on this roadmap!\n\n**High Priority Questions**:\n- Is NAT traversal critical for your use case?\n- What performance metrics matter most?\n- What observability features do you need?\n\n**How to Provide Feedback**:\n- GitHub Issues: https://github.com/macula-io/macula/issues\n- GitHub Discussions: https://github.com/macula-io/macula/discussions\n\n---","ref":"v0-8-0-roadmap.html#community-feedback"},{"type":"extras","title":"References - v0.9.0 Roadmap","doc":"- **NAT Traversal Design**: `architecture/NAT_TRAVERSAL_ROADMAP.md`\n- **Original v0.8.0 Roadmap**: `architecture/V0.8.0_IMPLEMENTATION_ROADMAP.md`\n- **Current Architecture**: `architecture/v0.8.0-ARCHITECTURE.md`\n- **Known Issues**: `TODO.md`\n\n---\n\n**Document Version**: 1.0\n**Last Updated**: 2025-11-17\n**Next Review**: After v0.8.0 release","ref":"v0-8-0-roadmap.html#references"},{"type":"extras","title":"Architecture Index","doc":"# Macula Architecture Documentation Index\n\n**Current Version**: v0.8.0\n**Last Updated**: 2025-11-17\n\n---","ref":"index.html"},{"type":"extras","title":"Quick Links - Architecture Index","doc":"- **Getting Started**: See `../README.md`\n- **API Reference**: See hex docs or `src/` module documentation\n- **Tutorial**: See `TUTORIAL.md` (coming soon)\n- **FAQ**: See `FAQ.md`\n- **Troubleshooting**: See `TROUBLESHOOTING.md`\n\n---","ref":"index.html#quick-links"},{"type":"extras","title":"Version-Specific Documentation - Architecture Index","doc":"","ref":"index.html#version-specific-documentation"},{"type":"extras","title":"v0.8.0 (Current - Released 2025-11-17) - Architecture Index","doc":"**Overview**: Direct P2P with DHT propagation\n\n Core Documents:\n- [`v0.8.0-OVERVIEW.md`](v0.8.0-OVERVIEW.md) - Release overview and key achievements\n- [`v0.8.0-CHANGELOG.md`](v0.8.0-CHANGELOG.md) - Detailed changes from v0.7.x\n- [`v0.8.0-ROADMAP.md`](v0.8.0-ROADMAP.md) - Future plans (v0.9.0 and beyond)\n- [`V0.8.0_COMPLETION_STATUS.md`](V0.8.0_COMPLETION_STATUS.md) - Final implementation status\n- [`V0.8.0_IMPLEMENTATION_ROADMAP.md`](V0.8.0_IMPLEMENTATION_ROADMAP.md) - Original roadmap\n\n Architecture:\n- Direct P2P QUIC connections via `macula_peer_connector`\n- DHT propagation to k=20 closest nodes\n- RPC and PubSub via direct connections\n- All node types run QUIC listeners\n\n Test Coverage:\n- 21/21 integration tests passing (100%)\n- 11 RPC tests + 10 PubSub tests\n\n Archived Development Docs:\n- [`archive/v0.8.0-development/`](archive/v0.8.0-development/) - Development session notes, progress tracking","ref":"index.html#v0-8-0-current-released-2025-11-17"},{"type":"extras","title":"v0.7.x (Previous) - Architecture Index","doc":"**Overview**: Gateway relay architecture with nomenclature refactoring\n\nKey changes:\n- Renamed `macula_connection`  `macula_peer` (facade)\n- Kept `macula_connection` as transport layer\n- Gateway refactoring into focused modules\n- Memory management improvements","ref":"index.html#v0-7-x-previous"},{"type":"extras","title":"v0.6.x and Earlier - Architecture Index","doc":"**Overview**: Initial DHT implementation and mesh foundation\n\nSee git history for details.\n\n---","ref":"index.html#v0-6-x-and-earlier"},{"type":"extras","title":"Topic Guides - Architecture Index","doc":"","ref":"index.html#topic-guides"},{"type":"extras","title":"Core Concepts - Architecture Index","doc":"- **DHT (Distributed Hash Table)**: Kademlia-based routing\n  - See `ALGORITHMS-KADEMLIA.md` (coming soon)\n  - Key concepts: XOR distance, k-buckets, replication factor k=20\n\n- **Direct P2P Messaging**: Fire-and-forget QUIC connections\n  - See `TECHNIQUES-DIRECT-P2P.md` (coming soon)\n  - Module: `macula_peer_connector`\n\n- **Service Discovery**: DHT-based registration and lookup\n  - See `ALGORITHMS-SERVICE-DISCOVERY.md` (coming soon)\n  - Advertisement, TTL, propagation","ref":"index.html#core-concepts"},{"type":"extras","title":"Communication Patterns - Architecture Index","doc":"#### RPC (Remote Procedure Call)\n- **Module**: `macula_pubsub_dht.erl` (RPC functions)\n- **Flow**: DHT lookup  Direct connection  Execute  Return result\n- **Test Suite**: `test/integration/multi_hop_rpc_SUITE.erl`\n- **Docs**: See module @doc comments\n\n#### PubSub (Publish/Subscribe)\n- **Module**: `macula_pubsub_dht.erl` (PubSub functions)\n- **Flow**: Subscribe  Advertise in DHT  Publish  DHT lookup  Direct delivery\n- **Test Suite**: `test/integration/multi_hop_pubsub_SUITE.erl`\n- **Docs**: See module @doc comments","ref":"index.html#communication-patterns"},{"type":"extras","title":"Network & Infrastructure - Architecture Index","doc":"#### NAT Traversal\n- **Status**: Planned for v0.9.0\n- **Approach**: Opportunistic hole punching\n- **Design**: [`NAT_TRAVERSAL_ROADMAP.md`](NAT_TRAVERSAL_ROADMAP.md)\n- **Current**: 100% connectivity via relay fallback\n\n#### Multi-Tenancy\n- **Mechanism**: Realm isolation\n- **Security**: Per-realm routing tables\n- **Docs**: See realm configuration in README\n\n#### Deployment Patterns\n- **Docker**: `docker/` directory - Bootstrap, Gateway, Edge nodes\n- **Multi-node**: `docker-compose.multi-mode.yml`\n- **Test Topology**: 1 bootstrap + 1 gateway + 3 edge nodes\n\n---","ref":"index.html#network-infrastructure"},{"type":"extras","title":"Reference Documentation - Architecture Index","doc":"","ref":"index.html#reference-documentation"},{"type":"extras","title":"API Documentation - Architecture Index","doc":"- **High-level API**: `src/macula_peer.erl`\n- **Transport**: `src/macula_connection.erl`\n- **P2P Connector**: `src/macula_peer_connector.erl`\n- **DHT**: `src/macula_routing_server.erl`\n- **Gateway**: `src/macula_gateway.erl`","ref":"index.html#api-documentation"},{"type":"extras","title":"Protocol Specifications - Architecture Index","doc":"- **QUIC Transport**: Uses Microsoft MsQuic via `quicer`\n- **Message Encoding**: MessagePack via `msgpack`\n- **DHT Protocol**: Custom Kademlia implementation","ref":"index.html#protocol-specifications"},{"type":"extras","title":"Configuration - Architecture Index","doc":"- **Application**: `src/macula.app.src`\n- **Runtime**: `sys.config` (not in repo - user-provided)\n- **Docker**: Environment variables in docker-compose files\n\n---","ref":"index.html#configuration"},{"type":"extras","title":"Development Documentation - Architecture Index","doc":"","ref":"index.html#development-documentation"},{"type":"extras","title":"Testing - Architecture Index","doc":"- **Unit Tests**: `test/*_tests.erl` - EUnit tests\n- **Integration Tests**: `test/integration/*_SUITE.erl` - Common Test suites\n- **Running Tests**: `rebar3 eunit && rebar3 ct`","ref":"index.html#testing"},{"type":"extras","title":"Code Quality - Architecture Index","doc":"- **Style Guide**: Idiomatic Erlang (see CLAUDE.md)\n- **Test Coverage**: Tracked per module\n- **TODO Tracking**: See `TODO.md`","ref":"index.html#code-quality"},{"type":"extras","title":"Gateway Refactoring (Completed) - Architecture Index","doc":"- **Plan**: [`gateway_refactoring_plan.md`](gateway_refactoring_plan.md)\n- **Status**: Completed in v0.7.x\n- **Result**: 6 focused modules, supervision tree, comprehensive tests","ref":"index.html#gateway-refactoring-completed"},{"type":"extras","title":"Memory Management (Completed) - Architecture Index","doc":"- **Overview**: [`memory_management/README.md`](memory_management/README.md)\n- **Docs**: [`memory_management/`](memory_management/) directory\n- **Status**: Completed in v0.7.x\n- **Result**: Bounded pools, TTL cleanup, no OOM crashes\n\n---","ref":"index.html#memory-management-completed"},{"type":"extras","title":"Historical Documentation - Architecture Index","doc":"","ref":"index.html#historical-documentation"},{"type":"extras","title":"Architecture Evolution - Architecture Index","doc":"- [`ARCHITECTURE_EVOLUTION.md`](ARCHITECTURE_EVOLUTION.md) - How we got here\n- [`DOCUMENTATION_STATUS.md`](DOCUMENTATION_STATUS.md) - Doc tracking","ref":"index.html#architecture-evolution"},{"type":"extras","title":"Old Planning (Pre-v0.8.0) - Architecture Index","doc":"- [`dht_routed_rpc.md`](dht_routed_rpc.md) - Original DHT RPC plan (superseded)\n- [`dht_routed_pubsub.md`](dht_routed_pubsub.md) - Original DHT PubSub plan (superseded)\n- [`god_module_refactoring_plan.md`](god_module_refactoring_plan.md) - Old refactoring (superseded by v0.7.0 nomenclature)\n\n**Note**: Many of these docs describe approaches that were superseded by v0.8.0's direct P2P architecture. They're kept for historical reference.\n\n---","ref":"index.html#old-planning-pre-v0-8-0"},{"type":"extras","title":"Comparison Documents - Architecture Index","doc":"","ref":"index.html#comparison-documents"},{"type":"extras","title":"vs. Other Technologies - Architecture Index","doc":"- [`macula_http3_mesh_vs_distributed_erlang.md`](macula_http3_mesh_vs_distributed_erlang.md)\n- [`macula_http3_mesh_vs_libp2p.md`](macula_http3_mesh_vs_libp2p.md)\n- [`macula_http3_mesh_vs_wamp.md`](macula_http3_mesh_vs_wamp.md)\n\n---","ref":"index.html#vs-other-technologies"},{"type":"extras","title":"Contributing - Architecture Index","doc":"","ref":"index.html#contributing"},{"type":"extras","title":"How to Contribute Documentation - Architecture Index","doc":"1. Follow the naming convention: `vX.Y.Z-DOCNAME.md` or `TOPIC-NAME.md`\n2. Add entry to this INDEX.md\n3. Keep docs focused and scannable\n4. Include code examples where helpful\n5. Link to related docs","ref":"index.html#how-to-contribute-documentation"},{"type":"extras","title":"Documentation Standards - Architecture Index","doc":"- **Markdown**: Use GitHub-flavored Markdown\n- **Diagrams**: Use Mermaid or ASCII art\n- **Code Examples**: Include working, tested examples\n- **References**: Link to source files with line numbers where possible\n\n---","ref":"index.html#documentation-standards"},{"type":"extras","title":"TODO - Architecture Index","doc":"Future documentation to create:\n- [ ] `TUTORIAL.md` - Complete tutorial with working examples\n- [ ] `FAQ.md` - Frequently asked questions\n- [ ] `TROUBLESHOOTING.md` - Common issues and solutions\n- [ ] `ALGORITHMS-KADEMLIA.md` - DHT algorithm details\n- [ ] `ALGORITHMS-SERVICE-DISCOVERY.md` - Service discovery flow\n- [ ] `TECHNIQUES-DIRECT-P2P.md` - P2P connection patterns\n- [ ] `v0.8.0-ARCHITECTURE.md` - Detailed architecture diagrams\n- [ ] `v0.8.0-DECISIONS.md` - Architecture Decision Records (ADRs)\n\n---","ref":"index.html#todo"},{"type":"extras","title":"Quick Reference - Architecture Index","doc":"","ref":"index.html#quick-reference"},{"type":"extras","title":"Key Files to Read First - Architecture Index","doc":"1. [`../README.md`](../README.md) - Project overview\n2. [`v0.8.0-OVERVIEW.md`](v0.8.0-OVERVIEW.md) - Current version overview\n3. [`v0.8.0-CHANGELOG.md`](v0.8.0-CHANGELOG.md) - What changed\n4. [`src/macula_peer.erl`](../src/macula_peer.erl) - High-level API","ref":"index.html#key-files-to-read-first"},{"type":"extras","title":"Common Tasks - Architecture Index","doc":"- **Add a new feature**: See module @doc comments for API design patterns\n- **Deploy to production**: See Docker files and compose configurations\n- **Debug an issue**: See hex docs and integration test examples\n- **Understand DHT**: See `macula_routing_server.erl` and `macula_routing_table.erl`\n\n---\n\n**Navigation**: [Back to Main README](../README.md) | [v0.8.0 Overview](v0.8.0-OVERVIEW.md) | [Changelog](v0.8.0-CHANGELOG.md) | [Roadmap](v0.8.0-ROADMAP.md)","ref":"index.html#common-tasks"},{"type":"extras","title":"Project Structure","doc":"# Macula HTTP/3 Mesh - Project Structure and Libraries\n\n**Actual Erlang/Elixir projects and libraries to build**\n\n**Created**: 2025-01-08\n**Status**: Planning Document\n\n---","ref":"macula_project_structure.html"},{"type":"extras","title":"Overview - Project Structure","doc":"This document outlines the actual Erlang/Elixir libraries, applications, and projects that need to be created to implement the Macula HTTP/3 Mesh platform.\n\n---","ref":"macula_project_structure.html#overview"},{"type":"extras","title":"Repository Organization Strategy - Project Structure","doc":"","ref":"macula_project_structure.html#repository-organization-strategy"},{"type":"extras","title":"Option A: Monorepo (Recommended for Initial Development) - Project Structure","doc":"```\nmacula/\n apps/\n    macula_core/           # Core protocols and types\n    macula_quic/           # QUIC transport layer\n    macula_protocol/       # Wire protocol (framing, encoding)\n    macula_membership/     # SWIM membership\n    macula_routing/        # Kademlia DHT routing\n    macula_topology/       # Mesh topology management\n    macula_pubsub/         # Pub/sub implementation\n    macula_rpc/            # RPC implementation\n    macula_gateway/        # Cross-realm gateway\n    macula_discovery/      # Node discovery\n    macula_security/       # Auth, ACLs, certificates\n    macula/                # Main application (umbrella)\n rebar.config               # Rebar3 umbrella config\n mix.exs                    # Mix umbrella config (if supporting Elixir)\n README.md\n```\n\n**Benefits**:\n- Easy cross-library development\n- Shared dependencies\n- Single release\n- Atomic commits across components\n- Simplified CI/CD","ref":"macula_project_structure.html#option-a-monorepo-recommended-for-initial-development"},{"type":"extras","title":"Option B: Multi-repo (For Maturity/Modularity) - Project Structure","doc":"Separate repositories for each library (similar to Erlang/OTP structure).\n\n**Benefits**:\n- Independent versioning\n- Smaller, focused repos\n- Can use different libraries independently\n- Clear boundaries\n\n**Recommendation**: Start with **Option A (monorepo)**, split later if needed.\n\n---","ref":"macula_project_structure.html#option-b-multi-repo-for-maturity-modularity"},{"type":"extras","title":"Core Libraries (Required for MVP) - Project Structure","doc":"","ref":"macula_project_structure.html#core-libraries-required-for-mvp"},{"type":"extras","title":"1. macula_core - Project Structure","doc":"**Purpose**: Core types, protocols, and shared utilities.\n\n**Modules**:\n```erlang\n%% Core types\nmacula_types.erl           - Common type definitions\nmacula_node.erl            - Node identity and metadata\nmacula_realm.erl           - Realm management\nmacula_topic.erl           - Topic parsing and validation\n\n%% Utilities\nmacula_time.erl            - Time utilities\nmacula_id.erl              - ID generation (SHA-256 node IDs)\nmacula_uri.erl             - Macula URI parsing (macula://realm/node)\n```\n\n**Dependencies**: None (pure Erlang)\n\n**Rebar3 Config**:\n```erlang\n{application, macula_core, [\n    {description, \"Macula core types and protocols\"},\n    {vsn, \"0.1.0\"},\n    {modules, []},\n    {registered, []},\n    {applications, [kernel, stdlib]}\n]}.\n```\n\n---","ref":"macula_project_structure.html#1-macula_core"},{"type":"extras","title":"2. macula_quic - Project Structure","doc":"**Purpose**: QUIC transport layer (wrapper around quicer).\n\n**Modules**:\n```erlang\nmacula_quic_listener.erl   - QUIC listener (accept connections)\nmacula_quic_client.erl     - QUIC client (initiate connections)\nmacula_quic_connection.erl - GenServer per QUIC connection\nmacula_quic_stream.erl     - Stream management\nmacula_quic_config.erl     - QUIC configuration (TLS, ALPN, etc.)\n```\n\n**Dependencies**:\n- `quicer` (NIF for MsQuic)\n\n**Key Features**:\n- Connection pooling\n- Stream multiplexing\n- 0-RTT support\n- Connection migration\n- Backpressure handling\n\n**Rebar3 Config**:\n```erlang\n{application, macula_quic, [\n    {description, \"Macula QUIC transport layer\"},\n    {vsn, \"0.1.0\"},\n    {modules, []},\n    {registered, []},\n    {applications, [kernel, stdlib, macula_core, quicer]},\n    {mod, {macula_quic_app, []}}\n]}.\n\n{deps, [\n    {quicer, {git, \"https://github.com/emqx/quic.git\", {branch, \"main\"}}}\n]}.\n```\n\n---","ref":"macula_project_structure.html#2-macula_quic"},{"type":"extras","title":"3. macula_protocol - Project Structure","doc":"**Purpose**: Wire protocol (message framing, encoding/decoding).\n\n**Modules**:\n```erlang\nmacula_protocol.erl        - Main protocol API\nmacula_frame.erl           - Frame encoding/decoding\nmacula_message.erl         - Message types and validation\nmacula_codec.erl           - Binary serialization (Erlang term format or MessagePack)\n```\n\n**Message Types**:\n```erlang\n-define(MSG_HANDSHAKE, 16#01).\n-define(MSG_HANDSHAKE_ACK, 16#02).\n-define(MSG_HEARTBEAT, 16#03).\n-define(MSG_PING, 16#04).\n-define(MSG_PONG, 16#05).\n-define(MSG_PUBLISH, 16#10).\n-define(MSG_SUBSCRIBE, 16#11).\n-define(MSG_UNSUBSCRIBE, 16#12).\n-define(MSG_EVENT, 16#13).\n-define(MSG_RPC_CALL, 16#20).\n-define(MSG_RPC_RESULT, 16#21).\n-define(MSG_RPC_ERROR, 16#22).\n-define(MSG_ERROR, 16#F0).\n-define(MSG_CLOSE, 16#FF).\n```\n\n**Dependencies**:\n- `macula_core`\n\n**Optional Dependencies**:\n- `msgpack` (if using MessagePack instead of Erlang term format)\n\n**Rebar3 Config**:\n```erlang\n{application, macula_protocol, [\n    {description, \"Macula wire protocol\"},\n    {vsn, \"0.1.0\"},\n    {applications, [kernel, stdlib, macula_core]}\n]}.\n```\n\n---","ref":"macula_project_structure.html#3-macula_protocol"},{"type":"extras","title":"4. macula_membership - Project Structure","doc":"**Purpose**: SWIM-based membership and failure detection.\n\n**Modules**:\n```erlang\nmacula_membership.erl      - Main membership API\nmacula_swim.erl            - SWIM protocol GenServer\nmacula_swim_detector.erl   - Failure detector\nmacula_swim_gossip.erl     - Gossip dissemination\nmacula_member.erl          - Member record and state\n```\n\n**Features**:\n- Membership list management\n- Direct ping / indirect ping\n- Suspicion mechanism\n- Incarnation numbers\n- Realm-scoped membership\n\n**Dependencies**:\n- `macula_core`\n- `macula_protocol`\n- `macula_quic`\n\n**Rebar3 Config**:\n```erlang\n{application, macula_membership, [\n    {description, \"Macula SWIM membership\"},\n    {vsn, \"0.1.0\"},\n    {applications, [kernel, stdlib, macula_core, macula_protocol, macula_quic]},\n    {mod, {macula_membership_app, []}}\n]}.\n```\n\n---","ref":"macula_project_structure.html#4-macula_membership"},{"type":"extras","title":"5. macula_routing - Project Structure","doc":"**Purpose**: Kademlia DHT for routing.\n\n**Modules**:\n```erlang\nmacula_routing.erl         - Routing API\nmacula_kademlia.erl        - Kademlia DHT GenServer\nmacula_k_bucket.erl        - K-bucket management\nmacula_node_lookup.erl     - Node lookup (iterative)\nmacula_topic_registry.erl  - Topic  Nodes mapping (for pub/sub)\nmacula_rpc_registry.erl    - RPC name  Node mapping\n```\n\n**Features**:\n- 256 k-buckets (for 256-bit node IDs)\n- XOR distance metric\n- Iterative lookups\n- Bucket refresh\n- Realm partitioning\n\n**Dependencies**:\n- `macula_core`\n- `macula_membership`\n\n**Rebar3 Config**:\n```erlang\n{application, macula_routing, [\n    {description, \"Macula Kademlia DHT routing\"},\n    {vsn, \"0.1.0\"},\n    {applications, [kernel, stdlib, macula_core, macula_membership]},\n    {mod, {macula_routing_app, []}}\n]}.\n```\n\n---","ref":"macula_project_structure.html#5-macula_routing"},{"type":"extras","title":"6. macula_topology - Project Structure","doc":"**Purpose**: Mesh topology management (k-regular graph).\n\n**Modules**:\n```erlang\nmacula_topology.erl        - Topology management\nmacula_k_regular.erl       - k-regular graph algorithm\nmacula_connection_pool.erl - Connection pool supervisor\nmacula_connection.erl      - GenServer per peer connection\n```\n\n**Features**:\n- k-regular graph topology\n- Connection lifecycle (connect, disconnect, reconnect)\n- Exponential backoff for reconnections\n- Topology visualization\n\n**Dependencies**:\n- `macula_core`\n- `macula_quic`\n- `macula_membership`\n- `macula_routing`\n\n**Rebar3 Config**:\n```erlang\n{application, macula_topology, [\n    {description, \"Macula mesh topology management\"},\n    {vsn, \"0.1.0\"},\n    {applications, [kernel, stdlib, macula_core, macula_quic,\n                    macula_membership, macula_routing]},\n    {mod, {macula_topology_app, []}}\n]}.\n```\n\n---","ref":"macula_project_structure.html#6-macula_topology"},{"type":"extras","title":"7. macula_pubsub - Project Structure","doc":"**Purpose**: Publish/subscribe messaging.\n\n**Modules**:\n```erlang\nmacula_pubsub.erl          - Pub/sub API\nmacula_topic_tree.erl      - Topic subscription tree (pattern matching)\nmacula_subscription.erl    - Subscription management\nmacula_publisher.erl       - Publishing logic\nmacula_event_router.erl    - Event routing to subscribers\n```\n\n**Features**:\n- Topic pattern matching (exact, prefix, wildcard)\n- Local and remote subscriptions\n- Subscription announcements (via DHT)\n- Event delivery guarantees (at-most-once, at-least-once)\n\n**Dependencies**:\n- `macula_core`\n- `macula_protocol`\n- `macula_routing`\n- `macula_topology`\n\n**Rebar3 Config**:\n```erlang\n{application, macula_pubsub, [\n    {description, \"Macula pub/sub messaging\"},\n    {vsn, \"0.1.0\"},\n    {applications, [kernel, stdlib, macula_core, macula_protocol,\n                    macula_routing, macula_topology]},\n    {mod, {macula_pubsub_app, []}}\n]}.\n```\n\n---","ref":"macula_project_structure.html#7-macula_pubsub"},{"type":"extras","title":"8. macula_rpc - Project Structure","doc":"**Purpose**: Remote procedure call (RPC) implementation.\n\n**Modules**:\n```erlang\nmacula_rpc.erl             - RPC API (call, register, unregister)\nmacula_rpc_server.erl      - RPC request handler\nmacula_rpc_client.erl      - RPC call client\nmacula_rpc_registry.erl    - Local RPC endpoint registry\n```\n\n**Features**:\n- Synchronous RPC (with timeout)\n- Asynchronous RPC (cast)\n- RPC endpoint registration (name  handler function)\n- Endpoint discovery via DHT\n- Load balancing (if multiple nodes register same RPC)\n\n**Dependencies**:\n- `macula_core`\n- `macula_protocol`\n- `macula_routing`\n- `macula_topology`\n\n**Rebar3 Config**:\n```erlang\n{application, macula_rpc, [\n    {description, \"Macula RPC\"},\n    {vsn, \"0.1.0\"},\n    {applications, [kernel, stdlib, macula_core, macula_protocol,\n                    macula_routing, macula_topology]},\n    {mod, {macula_rpc_app, []}}\n]}.\n```\n\n---","ref":"macula_project_structure.html#8-macula_rpc"},{"type":"extras","title":"9. macula_discovery - Project Structure","doc":"**Purpose**: Node discovery (DNS-SD, mDNS, static, cloud).\n\n**Modules**:\n```erlang\nmacula_discovery.erl       - Discovery coordinator\nmacula_discovery_static.erl - Static bootstrap nodes\nmacula_discovery_mdns.erl  - mDNS (Multicast DNS)\nmacula_discovery_dns.erl   - DNS SRV records\nmacula_discovery_consul.erl - Consul service discovery\nmacula_discovery_k8s.erl   - Kubernetes endpoints\n```\n\n**Features**:\n- Multiple discovery methods (configurable)\n- Continuous discovery (periodic re-discovery)\n- Bootstrap node list\n- Realm-aware discovery\n\n**Dependencies**:\n- `macula_core`\n- `mdns` (for mDNS support)\n\n**Rebar3 Config**:\n```erlang\n{application, macula_discovery, [\n    {description, \"Macula node discovery\"},\n    {vsn, \"0.1.0\"},\n    {applications, [kernel, stdlib, macula_core]},\n    {mod, {macula_discovery_app, []}}\n]}.\n\n{deps, [\n    {mdns, {git, \"https://github.com/benoitc/erlang-mdns.git\", {branch, \"master\"}}}\n]}.\n```\n\n---","ref":"macula_project_structure.html#9-macula_discovery"},{"type":"extras","title":"10. macula_security - Project Structure","doc":"**Purpose**: Security (TLS certificates, ACLs, audit logging).\n\n**Modules**:\n```erlang\nmacula_security.erl        - Security API\nmacula_cert.erl            - Certificate generation and validation\nmacula_acl.erl             - Access control lists\nmacula_audit.erl           - Audit logging\nmacula_crypto.erl          - Message signing/verification\n```\n\n**Features**:\n- Certificate generation (self-signed, CA-signed)\n- Certificate validation (realm extraction from SAN)\n- ACL enforcement (topic/RPC access control)\n- Audit log (security events)\n- Optional message signing\n\n**Dependencies**:\n- `macula_core`\n- `public_key` (Erlang stdlib)\n- `ssl` (Erlang stdlib)\n\n**Rebar3 Config**:\n```erlang\n{application, macula_security, [\n    {description, \"Macula security\"},\n    {vsn, \"0.1.0\"},\n    {applications, [kernel, stdlib, public_key, ssl, macula_core]},\n    {mod, {macula_security_app, []}}\n]}.\n```\n\n---","ref":"macula_project_structure.html#10-macula_security"},{"type":"extras","title":"11. macula_gateway - Project Structure","doc":"**Purpose**: Cross-realm gateway functionality.\n\n**Modules**:\n```erlang\nmacula_gateway.erl         - Gateway API\nmacula_gateway_server.erl  - Gateway GenServer\nmacula_policy.erl          - Policy engine (topic filtering, rate limiting)\nmacula_translation.erl     - Topic translation\nmacula_rate_limiter.erl    - Rate limiting per realm pair\n```\n\n**Features**:\n- Multi-realm support\n- Policy-based message filtering\n- Topic translation\n- Rate limiting\n- Audit logging of cross-realm traffic\n\n**Dependencies**:\n- `macula_core`\n- `macula_protocol`\n- `macula_pubsub`\n- `macula_rpc`\n- `macula_security`\n\n**Rebar3 Config**:\n```erlang\n{application, macula_gateway, [\n    {description, \"Macula cross-realm gateway\"},\n    {vsn, \"0.1.0\"},\n    {applications, [kernel, stdlib, macula_core, macula_protocol,\n                    macula_pubsub, macula_rpc, macula_security]},\n    {mod, {macula_gateway_app, []}}\n]}.\n```\n\n---","ref":"macula_project_structure.html#11-macula_gateway"},{"type":"extras","title":"12. macula (Main Application) - Project Structure","doc":"**Purpose**: Umbrella application that ties everything together.\n\n**Modules**:\n```erlang\nmacula.erl                 - Main API\nmacula_app.erl             - Application callback\nmacula_sup.erl             - Top-level supervisor\nmacula_config.erl          - Configuration management\n```\n\n**Supervision Tree**:\n```erlang\nmacula_sup (one_for_one)\n macula_discovery_sup\n macula_quic_sup\n macula_membership_sup\n macula_routing_sup\n macula_topology_sup\n macula_pubsub_sup\n macula_rpc_sup\n macula_security_sup\n macula_gateway_sup (optional, if gateway mode)\n```\n\n**Dependencies**: All macula_* libraries\n\n**Rebar3 Config**:\n```erlang\n{application, macula, [\n    {description, \"Macula HTTP/3 Mesh Platform\"},\n    {vsn, \"0.1.0\"},\n    {applications, [\n        kernel, stdlib,\n        macula_core,\n        macula_quic,\n        macula_protocol,\n        macula_membership,\n        macula_routing,\n        macula_topology,\n        macula_pubsub,\n        macula_rpc,\n        macula_discovery,\n        macula_security,\n        macula_gateway\n    ]},\n    {mod, {macula_app, []}},\n    {env, [\n        {realm, <<\"org.example.mesh\">>},\n        {listen_port, 4433},\n        {discovery, [{methods, [static, mdns]}]},\n        {topology, [{type, k_regular}, {k, 2}]}\n    ]}\n]}.\n```\n\n---","ref":"macula_project_structure.html#12-macula-main-application"},{"type":"extras","title":"Supporting Tools and Utilities - Project Structure","doc":"","ref":"macula_project_structure.html#supporting-tools-and-utilities"},{"type":"extras","title":"13. macula_cli - Project Structure","doc":"**Purpose**: Command-line tool for Macula operations.\n\n**Features**:\n- Start/stop nodes\n- Join mesh\n- View topology\n- Send test messages\n- Query membership\n- Inspect routing table\n\n**Implementation**: Escript\n\n**Rebar3 Config**:\n```erlang\n{escript_name, macula}.\n{escript_emu_args, \"%%! -escript main macula_cli\\n\"}.\n```\n\n**Usage**:\n```bash\nmacula start --realm org.example.mesh --port 4433\nmacula join 192.168.1.100:4433\nmacula topology\nmacula publish topic.name '{\"data\": \"hello\"}'\nmacula stats\n```\n\n---","ref":"macula_project_structure.html#13-macula_cli"},{"type":"extras","title":"14. macula_observer - Project Structure","doc":"**Purpose**: Real-time mesh visualization and monitoring.\n\n**Features**:\n- Visual mesh topology (graphviz-style)\n- Live message flow\n- Membership state\n- Connection status\n- Metrics dashboard\n\n**Implementation**: Phoenix LiveView application (if using Elixir)\n\n**Alternative**: Standalone Erlang application with web UI (Cowboy + WebSocket)\n\n---","ref":"macula_project_structure.html#14-macula_observer"},{"type":"extras","title":"15. macula_loadtest - Project Structure","doc":"**Purpose**: Load testing and benchmarking tool.\n\n**Features**:\n- Spawn N virtual nodes\n- Pub/sub throughput testing\n- RPC latency testing\n- Failure injection\n- Report generation\n\n**Implementation**: Standalone Erlang application using Tsung or custom framework\n\n---","ref":"macula_project_structure.html#15-macula_loadtest"},{"type":"extras","title":"Optional/Future Libraries - Project Structure","doc":"","ref":"macula_project_structure.html#optional-future-libraries"},{"type":"extras","title":"16. macula_wamp_compat - Project Structure","doc":"**Purpose**: WAMP compatibility layer (bridge WAMP clients to Macula).\n\n**Modules**:\n- WAMP protocol adapter\n- WebSocket server\n- Message translation (WAMP  Macula)\n\n**Use Case**: Migrate from Bondy/WAMP to Macula gradually\n\n---","ref":"macula_project_structure.html#16-macula_wamp_compat"},{"type":"extras","title":"17. macula_http_bridge - Project Structure","doc":"**Purpose**: HTTP/REST gateway for Macula (publish via HTTP POST).\n\n**Modules**:\n- Cowboy HTTP handler\n- REST API (publish, call, subscribe via SSE)\n\n**Use Case**: Non-BEAM clients accessing Macula\n\n---","ref":"macula_project_structure.html#17-macula_http_bridge"},{"type":"extras","title":"18. macula_kafka_connector - Project Structure","doc":"**Purpose**: Kafka bridge (publish Macula events to Kafka, consume Kafka events).\n\n**Dependencies**: `brod` (Kafka client)\n\n---","ref":"macula_project_structure.html#18-macula_kafka_connector"},{"type":"extras","title":"19. macula_postgres_connector - Project Structure","doc":"**Purpose**: PostgreSQL integration (CDC, event sourcing).\n\n**Dependencies**: `epgsql` or `postgrex`\n\n---","ref":"macula_project_structure.html#19-macula_postgres_connector"},{"type":"extras","title":"20. macula_metrics - Project Structure","doc":"**Purpose**: Metrics and observability (Prometheus, OpenTelemetry).\n\n**Modules**:\n- Prometheus exporter\n- OpenTelemetry integration\n- StatsD reporter\n\n**Dependencies**:\n- `prometheus` or `prometheus_ex`\n- `opentelemetry` and `opentelemetry_exporter`\n\n---","ref":"macula_project_structure.html#20-macula_metrics"},{"type":"extras","title":"Development Roadmap - Project Structure","doc":"","ref":"macula_project_structure.html#development-roadmap"},{"type":"extras","title":"Phase 1: Foundation (Weeks 1-4) - Project Structure","doc":"**Goal**: Get basic QUIC transport and protocol working.\n\n**Libraries to build**:\n1. `macula_core` - Types and utilities\n2. `macula_quic` - QUIC wrapper\n3. `macula_protocol` - Wire protocol\n\n**Deliverable**: Two nodes can connect and exchange handshake messages.\n\n---","ref":"macula_project_structure.html#phase-1-foundation-weeks-1-4"},{"type":"extras","title":"Phase 2: Mesh Topology (Weeks 5-8) - Project Structure","doc":"**Goal**: Self-organizing mesh network.\n\n**Libraries to build**:\n4. `macula_membership` - SWIM\n5. `macula_routing` - Kademlia DHT\n6. `macula_topology` - k-regular graph\n7. `macula_discovery` - Node discovery\n\n**Deliverable**: N nodes form a mesh and detect failures.\n\n---","ref":"macula_project_structure.html#phase-2-mesh-topology-weeks-5-8"},{"type":"extras","title":"Phase 3: Messaging (Weeks 9-12) - Project Structure","doc":"**Goal**: Pub/sub and RPC working across mesh.\n\n**Libraries to build**:\n8. `macula_pubsub` - Pub/sub\n9. `macula_rpc` - RPC\n\n**Deliverable**: Applications can publish/subscribe and make RPC calls.\n\n---","ref":"macula_project_structure.html#phase-3-messaging-weeks-9-12"},{"type":"extras","title":"Phase 4: Security and Gateways (Weeks 13-16) - Project Structure","doc":"**Goal**: Production-ready security and multi-tenancy.\n\n**Libraries to build**:\n10. `macula_security` - Certificates, ACLs, audit\n11. `macula_gateway` - Cross-realm gateway\n\n**Deliverable**: Secure mesh with realm isolation.\n\n---","ref":"macula_project_structure.html#phase-4-security-and-gateways-weeks-13-16"},{"type":"extras","title":"Phase 5: Tooling and Monitoring (Weeks 17-20) - Project Structure","doc":"**Goal**: Developer experience and operations tooling.\n\n**Tools to build**:\n13. `macula_cli` - Command-line tool\n14. `macula_observer` - Visualization\n15. `macula_loadtest` - Benchmarking\n20. `macula_metrics` - Observability\n\n**Deliverable**: Production-ready platform with tooling.\n\n---","ref":"macula_project_structure.html#phase-5-tooling-and-monitoring-weeks-17-20"},{"type":"extras","title":"Testing Strategy - Project Structure","doc":"","ref":"macula_project_structure.html#testing-strategy"},{"type":"extras","title":"Unit Tests - Project Structure","doc":"Each library has its own test suite:\n```\napps/macula_core/test/\napps/macula_quic/test/\napps/macula_protocol/test/\n...\n```\n\n**Framework**: EUnit (Erlang) or ExUnit (Elixir)\n\n**Run**:\n```bash\nrebar3 eunit\n# or\nmix test\n```\n\n---","ref":"macula_project_structure.html#unit-tests"},{"type":"extras","title":"Integration Tests - Project Structure","doc":"Multi-node integration tests:\n```\ntest/integration/\n mesh_formation_test.erl\n pubsub_test.erl\n rpc_test.erl\n failure_recovery_test.erl\n gateway_test.erl\n```\n\n**Framework**: Common Test (Erlang)\n\n**Run**:\n```bash\nrebar3 ct\n```\n\n---","ref":"macula_project_structure.html#integration-tests"},{"type":"extras","title":"Property-Based Tests - Project Structure","doc":"Use PropEr (Erlang) or StreamData (Elixir):\n```\napps/macula_routing/test/prop_kademlia.erl\napps/macula_membership/test/prop_swim.erl\n```\n\n**Run**:\n```bash\nrebar3 proper\n```\n\n---","ref":"macula_project_structure.html#property-based-tests"},{"type":"extras","title":"Load Tests - Project Structure","doc":"Separate load testing suite:\n```\nloadtest/\n pubsub_throughput.erl\n rpc_latency.erl\n mesh_scale.erl (1000+ nodes)\n failure_injection.erl\n```\n\n**Framework**: Tsung or custom\n\n---","ref":"macula_project_structure.html#load-tests"},{"type":"extras","title":"Continuous Integration - Project Structure","doc":"","ref":"macula_project_structure.html#continuous-integration"},{"type":"extras","title":"GitHub Actions Workflow - Project Structure","doc":"```yaml\nname: CI\n\non: [push, pull_request]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v2\n      - uses: erlef/setup-beam@v1\n        with:\n          otp-version: '26.2'\n          rebar3-version: '3.22'\n      - run: rebar3 compile\n      - run: rebar3 eunit\n      - run: rebar3 ct\n      - run: rebar3 dialyzer\n\n  integration:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v2\n      - uses: erlef/setup-beam@v1\n      - run: rebar3 as test release\n      - run: ./test/integration/run_all.sh\n```\n\n---","ref":"macula_project_structure.html#github-actions-workflow"},{"type":"extras","title":"Release Strategy - Project Structure","doc":"","ref":"macula_project_structure.html#release-strategy"},{"type":"extras","title":"Rebar3 Release - Project Structure","doc":"```erlang\n%% rebar.config\n{relx, [\n    {release, {macula, \"0.1.0\"}, [\n        macula,\n        sasl\n    ]},\n\n    {mode, prod},\n    {include_erts, true},\n    {extended_start_script, true},\n\n    {overlay, [\n        {copy, \"config/sys.config.example\", \"etc/sys.config\"},\n        {copy, \"config/vm.args.example\", \"etc/vm.args\"}\n    ]}\n]}.\n```\n\n**Build**:\n```bash\nrebar3 release\n```\n\n**Result**: `_build/default/rel/macula/`\n\n---","ref":"macula_project_structure.html#rebar3-release"},{"type":"extras","title":"Docker Image - Project Structure","doc":"```dockerfile\nFROM erlang:26-alpine AS builder\n\nWORKDIR /build\nCOPY . .\nRUN rebar3 as prod release\n\nFROM alpine:latest\n\nRUN apk add --no-cache openssl ncurses-libs libstdc++\n\nCOPY --from=builder /build/_build/prod/rel/macula /opt/macula\n\nEXPOSE 4433/udp\n\nCMD [\"/opt/macula/bin/macula\", \"foreground\"]\n```\n\n**Build**:\n```bash\ndocker build -t macula:latest .\n```\n\n---","ref":"macula_project_structure.html#docker-image"},{"type":"extras","title":"Repository Initialization - Project Structure","doc":"","ref":"macula_project_structure.html#repository-initialization"},{"type":"extras","title":"Create Umbrella Application - Project Structure","doc":"```bash\n# Erlang (Rebar3)\nrebar3 new umbrella macula\ncd macula\n\n# Create apps\nrebar3 new lib apps/macula_core\nrebar3 new lib apps/macula_quic\nrebar3 new lib apps/macula_protocol\n# ... etc\n\n# Compile\nrebar3 compile\n\n# Test\nrebar3 eunit\n\n# Release\nrebar3 release\n```","ref":"macula_project_structure.html#create-umbrella-application"},{"type":"extras","title":"OR Elixir (Mix) - Project Structure","doc":"```bash\n# Elixir (Mix)\nmix new macula --umbrella\ncd macula\n\n# Create apps\ncd apps\nmix new macula_core\nmix new macula_quic\nmix new macula_protocol\n# ... etc\n\ncd ..\n\n# Compile\nmix compile\n\n# Test\nmix test\n\n# Release\nmix release\n```\n\n---","ref":"macula_project_structure.html#or-elixir-mix"},{"type":"extras","title":"Summary - Project Structure","doc":"**Core Libraries** (12):\n1.  `macula_core` - Core types and utilities\n2.  `macula_quic` - QUIC transport\n3.  `macula_protocol` - Wire protocol\n4.  `macula_membership` - SWIM membership\n5.  `macula_routing` - Kademlia DHT\n6.  `macula_topology` - Mesh topology\n7.  `macula_pubsub` - Pub/sub\n8.  `macula_rpc` - RPC\n9.  `macula_discovery` - Node discovery\n10.  `macula_security` - Security\n11.  `macula_gateway` - Cross-realm gateway\n12.  `macula` - Main application\n\n**Tools** (3):\n13.  `macula_cli` - CLI tool\n14.  `macula_observer` - Visualization\n15.  `macula_loadtest` - Load testing\n\n**Optional** (5):\n16.  `macula_wamp_compat` - WAMP bridge\n17.  `macula_http_bridge` - HTTP gateway\n18.  `macula_kafka_connector` - Kafka integration\n19.  `macula_postgres_connector` - PostgreSQL integration\n20.  `macula_metrics` - Metrics/observability\n\n**Total**: 20 libraries/applications\n\n---\n\n**Next Step**: Initialize the repository structure and start with Phase 1 (Foundation).\n\n---\n\n**Last Updated**: 2025-01-08\n**Maintainers**: [To be assigned]","ref":"macula_project_structure.html#summary"},{"type":"extras","title":"Kademlia DHT","doc":"# Kademlia DHT Architecture in Macula","ref":"kademlia_dht_architecture.html"},{"type":"extras","title":"Overview - Kademlia DHT","doc":"Macula uses a **Kademlia Distributed Hash Table (DHT)** for decentralized service discovery and peer-to-peer routing. This document describes how Kademlia principles are implemented in the HTTP/3 mesh network.\n\n**Key Reference:** [Kademlia: A Peer-to-peer Information System Based on the XOR Metric](http://www.scs.stanford.edu/~dm/home/papers/kpos.pdf) (Maymounkov & Mazires, 2002)","ref":"kademlia_dht_architecture.html#overview"},{"type":"extras","title":"Why Kademlia? - Kademlia DHT","doc":"Traditional DHTs (like Chord) use numeric distance metrics that don't align well with network topology. Kademlia's XOR-based metric provides:\n\n1. **Symmetric distance** - `distance(A, B) = distance(B, A)`\n2. **Network-aware routing** - Nodes sharing common prefixes tend to be routed through similar paths\n3. **O(log N) lookup complexity** - Efficient even with millions of nodes\n4. **Self-organizing** - No central coordination required\n5. **NAT-friendly** - Works well with HTTP/3's connection-oriented transport","ref":"kademlia_dht_architecture.html#why-kademlia"},{"type":"extras","title":"Core Concepts - Kademlia DHT","doc":"","ref":"kademlia_dht_architecture.html#core-concepts"},{"type":"extras","title":"1. Node IDs and XOR Metric - Kademlia DHT","doc":"Every node in the Macula mesh has a 160-bit **Node ID** derived from:\n- Gateway mode: Hash of (realm + IP + port)\n- Edge peer mode: Randomly generated on startup\n\n**XOR Distance Formula:**\n```\ndistance(A, B) = A  B (bitwise XOR)\n```\n\n**Example:**\n```\nNode A: 0b10110101\nNode B: 0b11010011\n-------\nXOR:    0b01100110  (distance = 102 decimal)\n```\n\nNodes are considered \"closer\" when their XOR distance is smaller. This creates a geometric address space where routing naturally follows network topology.","ref":"kademlia_dht_architecture.html#1-node-ids-and-xor-metric"},{"type":"extras","title":"2. K-Buckets (Routing Table) - Kademlia DHT","doc":"Each node maintains a **routing table** of `160 k-buckets`, where `k = 20` (typical value).\n\n**Structure:**\n- **Bucket 0**: Nodes at distance `2^0` to `2^1 - 1` (immediate neighbors)\n- **Bucket 1**: Nodes at distance `2^1` to `2^2 - 1`\n- **Bucket i**: Nodes at distance `2^i` to `2^(i+1) - 1`\n- **Bucket 159**: Nodes at distance `2^159` to `2^160 - 1` (furthest)\n\n**K-Bucket Properties:**\n- Maximum of `k` entries per bucket\n- Least-recently-seen nodes are evicted first (LRU)\n- Bucket 0 (closest nodes) is most important for routing\n\n**Macula Implementation:**\n```erlang\n%% In macula_routing.erl (conceptual)\n-define(KADEMLIA_K, 20).          %% Bucket size\n-define(KADEMLIA_ALPHA, 3).       %% Parallel lookup factor\n-define(ID_BITS, 160).            %% SHA-1 hash size\n\n-record(k_bucket, {\n    distance_range :: {integer(), integer()},\n    nodes :: [node_entry()],       %% Max 20 entries\n    last_updated :: erlang:timestamp()\n}).\n```","ref":"kademlia_dht_architecture.html#2-k-buckets-routing-table"},{"type":"extras","title":"3. DHT Operations - Kademlia DHT","doc":"Kademlia defines four core RPC operations:\n\n#### PING\n**Purpose:** Check if a node is alive\n\n**Request:**\n```erlang\n{ping, FromNodeID, Timestamp}\n```\n\n**Response:**\n```erlang\n{pong, ToNodeID, Timestamp}\n```\n\n**Use Case:** Health checking, routing table maintenance\n\n---\n\n#### STORE\n**Purpose:** Store a key-value pair on a node\n\n**Request:**\n```erlang\n{store, Key, Value, TTL}\n```\n\n**Response:**\n```erlang\n{stored, Key, ExpiresAt}\n```\n\n**Macula Mapping:**\n- **Key**: Service name hash (e.g., `sha1(\"game.matchmaking\")`)\n- **Value**: Service endpoint info (realm, node_id, capabilities)\n- **TTL**: Advertisement lifetime (default: 5 minutes)\n\n---\n\n#### FIND_NODE\n**Purpose:** Locate k closest nodes to a target ID\n\n**Request:**\n```erlang\n{find_node, TargetID, K}\n```\n\n**Response:**\n```erlang\n{nodes, [\n    {NodeID1, IP1, Port1, Realm1},\n    {NodeID2, IP2, Port2, Realm2},\n    ...\n]} %% Sorted by XOR distance to TargetID\n```\n\n**Use Case:** Populating routing table, iterative lookups\n\n---\n\n#### FIND_VALUE\n**Purpose:** Retrieve value for a key (service discovery)\n\n**Request:**\n```erlang\n{find_value, Key}\n```\n\n**Response (if found):**\n```erlang\n{value, Key, ServiceInfo}\n```\n\n**Response (if not found):**\n```erlang\n{nodes, [...]}  %% Fallback to FIND_NODE\n```\n\n**Macula Mapping:**\n- **Key**: Service name (e.g., `\"game.matchmaking\"`)\n- **ServiceInfo**: List of providers advertising that service\n\n---","ref":"kademlia_dht_architecture.html#3-dht-operations"},{"type":"extras","title":"4. Iterative Lookup Algorithm - Kademlia DHT","doc":"To find a service or node, Macula performs an **iterative FIND_VALUE** lookup:\n\n**Algorithm:**\n1. Start with the ` = 3` closest nodes from local routing table\n2. Send parallel `FIND_VALUE` requests to these nodes\n3. If value found  return immediately\n4. Otherwise, add returned nodes to candidate set\n5. Select next `` closest unqueried nodes\n6. Repeat until:\n   - Value is found, OR\n   - No closer nodes remain, OR\n   - Maximum hops reached (logN)\n\n**Convergence:** Guaranteed to find value in O(log N) hops\n\n**Macula Implementation (conceptual):**\n```erlang\nfind_service(ServiceName, Realm) ->\n    Key = crypto:hash(sha, ServiceName),\n    ClosestNodes = get_closest_nodes(Key, ?KADEMLIA_ALPHA),\n    iterative_lookup(Key, ClosestNodes, #{}, 0).\n\niterative_lookup(Key, [], _Queried, _Hops) ->\n    {error, not_found};\niterative_lookup(Key, Candidates, Queried, Hops) when Hops > 20 ->\n    {error, max_hops_exceeded};\niterative_lookup(Key, Candidates, Queried, Hops) ->\n    %% Query  closest unqueried nodes in parallel\n    Results = query_nodes(Candidates, {find_value, Key}),\n\n    case find_value_in_results(Results) of\n        {ok, Value} ->\n            {ok, Value};\n        not_found ->\n            NewNodes = extract_nodes(Results),\n            NextCandidates = select_closest_unqueried(Key, NewNodes, Queried),\n            iterative_lookup(Key, NextCandidates,\n                           maps:merge(Queried, mark_queried(Candidates)),\n                           Hops + 1)\n    end.\n```\n\n---","ref":"kademlia_dht_architecture.html#4-iterative-lookup-algorithm"},{"type":"extras","title":"Macula-Specific Adaptations - Kademlia DHT","doc":"","ref":"kademlia_dht_architecture.html#macula-specific-adaptations"},{"type":"extras","title":"1. Realm-Scoped DHT - Kademlia DHT","doc":"Unlike traditional Kademlia, Macula implements **multi-tenancy via realms**:\n\n- Each realm has its own isolated DHT keyspace\n- Node IDs include realm hash: `sha1(Realm || IP || Port)`\n- Service keys are realm-scoped: `sha1(Realm || ServiceName)`\n- Cross-realm queries are blocked at protocol level\n\n**Example:**\n```erlang\n%% Realm \"macula.arcade\"\nNodeID_A = sha1(\"macula.arcade\" ++ \"192.168.1.10\" ++ \"4433\")\n\n%% Realm \"macula.energy\"\nNodeID_B = sha1(\"macula.energy\" ++ \"192.168.1.10\" ++ \"4433\")\n\n%% Same IP/port, different realms  different DHT partitions\n```","ref":"kademlia_dht_architecture.html#1-realm-scoped-dht"},{"type":"extras","title":"2. Gateway Bootstrap Nodes - Kademlia DHT","doc":"Traditional Kademlia requires **bootstrap nodes** to join the network. Macula handles this differently:\n\n**Gateway Mode:**\n- Gateways act as well-known bootstrap nodes\n- Published at predictable URLs (e.g., `https://gateway.example.com:4433`)\n- Maintain authoritative registry for their realm\n\n**Edge Peer Mode:**\n- Peers connect to gateway via `MACULA_BOOTSTRAP_REGISTRY` env var\n- Gateway returns `` closest nodes to peer's ID\n- Peer populates routing table via `FIND_NODE` requests\n\n**No Hardcoded Bootstrap IPs:** Unlike BitTorrent DHT, Macula uses DNS/HTTPS URLs for gateway discovery, making it firewall-friendly.","ref":"kademlia_dht_architecture.html#2-gateway-bootstrap-nodes"},{"type":"extras","title":"3. Service Advertisement TTL - Kademlia DHT","doc":"Services are stored in the DHT with a **Time-To-Live (TTL)**:\n\n- Default TTL: **5 minutes**\n- Providers re-advertise every **60 seconds** (heartbeat)\n- Expired entries are removed by `macula_advertisement_manager`\n\n**Rationale:** Short TTL ensures stale services don't linger after node crashes, while frequent heartbeats maintain availability.","ref":"kademlia_dht_architecture.html#3-service-advertisement-ttl"},{"type":"extras","title":"4. HTTP/3 Transport Integration - Kademlia DHT","doc":"Traditional Kademlia uses UDP for RPCs. Macula uses **QUIC (HTTP/3)**:\n\n**Advantages:**\n- Reliable transport (no packet loss issues)\n- Connection multiplexing (multiple RPCs over one connection)\n- TLS 1.3 encryption (secure by default)\n- NAT traversal (QUIC connection migration)\n\n**Message Encoding:**\n```erlang\n%% DHT query wrapped in Macula protocol\n#{\n  type => dht_query,\n  operation => find_value,\n  key => < >,\n  realm => <<\"macula.arcade\">>,\n  from_node_id => < >,\n  timestamp => erlang:system_time(millisecond)\n}\n```\n\n---","ref":"kademlia_dht_architecture.html#4-http-3-transport-integration"},{"type":"extras","title":"Routing Table Maintenance - Kademlia DHT","doc":"Macula keeps routing tables fresh through **active probing**:","ref":"kademlia_dht_architecture.html#routing-table-maintenance"},{"type":"extras","title":"1. Passive Updates - Kademlia DHT","doc":"- When receiving any message from node N, refresh N's entry in k-bucket\n- Update last-seen timestamp\n- Move N to tail of LRU list (most recently seen)","ref":"kademlia_dht_architecture.html#1-passive-updates"},{"type":"extras","title":"2. Active Probing - Kademlia DHT","doc":"- Every **60 seconds**, ping least-recently-seen node in each non-empty bucket\n- If ping fails 3 times consecutively, evict node\n- Backfill bucket via `FIND_NODE` request","ref":"kademlia_dht_architecture.html#2-active-probing"},{"type":"extras","title":"3. Bucket Splitting - Kademlia DHT","doc":"- When bucket 0 (closest nodes) exceeds `k` entries, split into two buckets\n- Move nodes to new buckets based on refined distance ranges\n- Only split buckets containing own node ID (hot zone)\n\n**Implementation:**\n```erlang\n%% In macula_routing.erl\n-define(REFRESH_INTERVAL, 60000).  %% 60 seconds\n-define(PING_TIMEOUT, 5000).       %% 5 seconds\n-define(MAX_FAILURES, 3).\n\nrefresh_buckets(State) ->\n    lists:foldl(fun refresh_bucket/2, State, State#state.k_buckets).\n\nrefresh_bucket(Bucket, State) ->\n    case get_least_recent_node(Bucket) of\n        undefined -> State;  %% Empty bucket\n        Node ->\n            case ping_node(Node) of\n                pong -> update_node_timestamp(Node, State);\n                timeout -> handle_ping_failure(Node, State)\n            end\n    end.\n```\n\n---","ref":"kademlia_dht_architecture.html#3-bucket-splitting"},{"type":"extras","title":"Performance Characteristics - Kademlia DHT","doc":"| Metric | Value | Notes |\n|--------|-------|-------|\n| **Lookup Time** | O(log N) hops | N = total nodes in mesh |\n| **Routing Table Size** | O(log N) entries | ~160 buckets  20 nodes = 3,200 max |\n| **Network Traffic** | O(log N) messages/lookup |  parallel requests per hop |\n| **Storage** | O(k  log N) | Per node, for advertised services |\n| **Convergence** | < 1 second | Typical for 10,000-node network |\n\n**Example (10,000-node network):**\n- Expected hops: `log(10,000)  13.3`  14 hops max\n- Parallel factor  = 3  ~5 rounds of queries\n- Average lookup time: `5 rounds  100ms RTT = 500ms`\n\n---","ref":"kademlia_dht_architecture.html#performance-characteristics"},{"type":"extras","title":"Comparison to Other DHTs - Kademlia DHT","doc":"| Feature | Kademlia (Macula) | Chord | Pastry |\n|---------|-------------------|-------|--------|\n| **Distance Metric** | XOR (symmetric) | Modular arithmetic | Numeric proximity |\n| **Routing Complexity** | O(log N) | O(log N) | O(log N) |\n| **Lookup Parallelism** | Yes ( = 3) | No (sequential) | Limited |\n| **NAT-Friendly** |  (with HTTP/3) |  |  |\n| **Bootstrap Required** | Optional (gateway) | Yes | Yes |\n| **Self-Organizing** |  |  |  |\n\n---","ref":"kademlia_dht_architecture.html#comparison-to-other-dhts"},{"type":"extras","title":"Future Enhancements - Kademlia DHT","doc":"","ref":"kademlia_dht_architecture.html#future-enhancements"},{"type":"extras","title":"1. S/Kademlia (Secure Kademlia) - Kademlia DHT","doc":"- Cryptographic node ID generation (prevent Sybil attacks)\n- Require nodes to solve proof-of-work for ID assignment\n- Disjoint routing paths for redundancy","ref":"kademlia_dht_architecture.html#1-s-kademlia-secure-kademlia"},{"type":"extras","title":"2. DHT Persistence - Kademlia DHT","doc":"- Store service advertisements in distributed database (e.g., CRDT)\n- Survive network partitions with eventual consistency\n- Reduce re-advertisement overhead","ref":"kademlia_dht_architecture.html#2-dht-persistence"},{"type":"extras","title":"3. Adaptive K-Bucket Sizing - Kademlia DHT","doc":"- Dynamically adjust `k` based on network churn rate\n- Larger `k` for stable networks (less probing overhead)\n- Smaller `k` for high-churn networks (faster convergence)\n\n---","ref":"kademlia_dht_architecture.html#3-adaptive-k-bucket-sizing"},{"type":"extras","title":"References - Kademlia DHT","doc":"1. **Kademlia Paper:** [Maymounkov & Mazires (2002)](http://www.scs.stanford.edu/~dm/home/papers/kpos.pdf)\n2. **S/Kademlia:** [Baumgart & Mies (2007)](https://ieeexplore.ieee.org/document/4447808)\n3. **BitTorrent DHT (BEP-0005):** [bittorrent.org/beps/bep_0005.html](http://www.bittorrent.org/beps/bep_0005.html)\n4. **QUIC Protocol:** [RFC 9000](https://www.rfc-editor.org/rfc/rfc9000.html)\n5. **Macula Architecture:** `docs/QUIC_TLS_GATEWAY_SETUP.md`\n\n---\n\n**Last Updated:** 2025-11-15\n**Macula Version:** 0.6.0\n**Status:**  Production-ready DHT implementation","ref":"kademlia_dht_architecture.html#references"},{"type":"extras","title":"Development Guide","doc":"# Development Guide\n\nThis guide covers setting up a development environment for contributing to Macula.","ref":"development.html"},{"type":"extras","title":"Prerequisites - Development Guide","doc":"- **Erlang/OTP 26+** - [Installation Guide](https://www.erlang.org/downloads)\n- **Rebar3** - Erlang build tool ([Installation](https://rebar3.org/docs/getting-started/))\n- **Git** - Version control\n- **Docker** (optional) - For multi-node testing","ref":"development.html#prerequisites"},{"type":"extras","title":"Quick Setup - Development Guide","doc":"```bash\n# Clone the repository\ngit clone https://github.com/macula-io/macula.git\ncd macula\n\n# Fetch dependencies\nrebar3 get-deps\n\n# Compile\nrebar3 compile\n\n# Run tests\nrebar3 eunit\n\n# Start a shell with Macula loaded\nrebar3 shell\n```","ref":"development.html#quick-setup"},{"type":"extras","title":"Project Structure - Development Guide","doc":"Macula is organized as a single Erlang/OTP library with ~68 modules:\n\n```\nmacula/\n src/                    # Source code (~68 .erl files)\n    macula_quic*.erl   # QUIC transport layer\n    macula_protocol*.erl # Wire protocol encoding/decoding\n    macula_connection*.erl # Connection management\n    macula_gateway*.erl # Gateway components\n    macula_routing*.erl # Kademlia DHT routing\n    macula_pubsub*.erl # Pub/Sub messaging\n    macula_rpc*.erl    # RPC operations\n    macula_*.erl       # Core utilities\n test/                  # EUnit tests\n include/               # Header files (.hrl)\n architecture/          # Architecture documentation\n docs/                  # User-facing documentation\n examples/              # Example applications\n rebar.config          # Build configuration\n```\n\nSee [Project Structure](../architecture/MACULA_PROJECT_STRUCTURE.md) for complete module documentation.","ref":"development.html#project-structure"},{"type":"extras","title":"Running Tests - Development Guide","doc":"","ref":"development.html#running-tests"},{"type":"extras","title":"All Tests - Development Guide","doc":"```bash\nrebar3 eunit\n```","ref":"development.html#all-tests"},{"type":"extras","title":"Specific Module Tests - Development Guide","doc":"```bash\nrebar3 eunit --module=macula_id_tests\nrebar3 eunit --module=macula_gateway_client_manager_tests\n```","ref":"development.html#specific-module-tests"},{"type":"extras","title":"Test Coverage - Development Guide","doc":"```bash\nrebar3 do eunit, cover\n```","ref":"development.html#test-coverage"},{"type":"extras","title":"Multi-Node Integration Tests - Development Guide","doc":"```bash\ncd docker\ndocker compose -f docker-compose.multi-node-test.yml build --no-cache\ndocker compose -f docker-compose.multi-node-test.yml up\n```","ref":"development.html#multi-node-integration-tests"},{"type":"extras","title":"Code Quality Standards - Development Guide","doc":"Macula follows **Idiomatic Erlang** principles:","ref":"development.html#code-quality-standards"},{"type":"extras","title":"Core Principles - Development Guide","doc":"-  **Pattern matching on function heads** - Avoid `if` and `cond`\n-  **Guards instead of case** - Use guards for simple conditions\n-  **Shallow nesting** - Keep nesting to 1-2 levels maximum\n-  **Let it crash** - Don't catch errors unless you can handle them meaningfully\n-  **OTP behaviors** - Use gen_server, gen_statem, supervisor where appropriate","ref":"development.html#core-principles"},{"type":"extras","title":"Example: Good vs. Bad - Development Guide","doc":" **Bad:**\n```erlang\nprocess_message(Msg, State) ->\n    if\n        is_binary(Msg) ->\n            case decode_message(Msg) of\n                {ok, Data} ->\n                    if\n                        Data#data.type == request ->\n                            handle_request(Data, State);\n                        Data#data.type == response ->\n                            handle_response(Data, State)\n                    end\n            end\n    end.\n```\n\n **Good:**\n```erlang\n%% Guard ensures binary input\nprocess_message(Msg, State) when is_binary(Msg) ->\n    case decode_message(Msg) of\n        {ok, Data} -> handle_decoded_message(Data, State);\n        {error, Reason} -> {error, Reason}\n    end;\nprocess_message(_Msg, _State) ->\n    {error, invalid_message}.\n\n%% Pattern match on data type\nhandle_decoded_message(#data{type = request} = Data, State) ->\n    handle_request(Data, State);\nhandle_decoded_message(#data{type = response} = Data, State) ->\n    handle_response(Data, State).\n```\n\nSee [CLAUDE.md](../CLAUDE.md) for complete coding guidelines.","ref":"development.html#example-good-vs-bad"},{"type":"extras","title":"Building Documentation - Development Guide","doc":"Macula uses ex_doc for documentation generation:\n\n```bash\nrebar3 ex_doc\n```\n\nGenerated docs appear in `doc/` directory. Open `doc/index.html` in a browser.","ref":"development.html#building-documentation"},{"type":"extras","title":"Docker Development - Development Guide","doc":"","ref":"development.html#docker-development"},{"type":"extras","title":"Clean Build (Always After Code Changes) - Development Guide","doc":"```bash\n# Prune cache and rebuild from scratch\ndocker builder prune -af\ndocker compose -f   build --no-cache\n```\n\n**Why?** Docker build cache can use stale layers even after code changes. Always prune and rebuild when testing code changes.","ref":"development.html#clean-build-always-after-code-changes"},{"type":"extras","title":"Multi-Node Test Environment - Development Guide","doc":"```bash\ncd docker\ndocker-compose -f docker-compose.multi-node-test.yml up\n```\n\nThis starts:\n- 1 registry node (gateway)\n- 3 provider nodes (advertise services)\n- 1 client node (discovers and calls services)","ref":"development.html#multi-node-test-environment"},{"type":"extras","title":"Memory Management - Development Guide","doc":"Macula implements comprehensive memory leak prevention. See [Memory Management](../architecture/memory_management/README.md) for details.\n\n**Key Mechanisms:**\n- Bounded connection pools (max 1,000 connections, LRU eviction)\n- Client connection limits (max 10,000 clients, configurable)\n- Service TTL/cleanup (5-minute TTL, 60-second cleanup interval)\n- Stream cleanup on disconnect\n- Caller process monitoring for RPC handlers\n\n**Monitoring:**\n```erlang\n%% Check connection pool size\nmacula_gateway_mesh:pool_size(GatewayPid).\n\n%% Check client count\nmacula_gateway_client_manager:client_count(ManagerPid).\n\n%% Check service registry size\nmacula_service_registry:service_count().\n```","ref":"development.html#memory-management"},{"type":"extras","title":"Refactoring Status - Development Guide","doc":"","ref":"development.html#refactoring-status"},{"type":"extras","title":"Gateway Refactoring (COMPLETED - Jan 2025) - Development Guide","doc":"The gateway module has been refactored into 6 focused modules with comprehensive tests:\n\n-  `macula_gateway_client_manager.erl` - Client lifecycle (24 tests)\n-  `macula_gateway_pubsub.erl` - Pub/Sub routing (31 tests)\n-  `macula_gateway_rpc.erl` - RPC handler management (20 tests)\n-  `macula_gateway_mesh.erl` - Mesh connection pooling (16 tests)\n-  `macula_gateway_dht.erl` - DHT query forwarding (stateless)\n-  `macula_gateway_rpc_router.erl` - Multi-hop RPC routing (17 tests)\n-  `macula_gateway_sup.erl` - Supervision tree (24 tests)\n\nTotal: 132 tests, all passing.","ref":"development.html#gateway-refactoring-completed-jan-2025"},{"type":"extras","title":"Connection Refactoring (IN PROGRESS - Jan 2025) - Development Guide","doc":"`macula_connection.erl` (2,030 LOC god module) is being refactored using TDD.\n\nSee:\n- [God Module Refactoring Plan](../architecture/god_module_refactoring_plan.md) - 9-week TDD plan\n- [Connection Behaviors](../architecture/macula_connection_behaviors.md) - 275+ test scenarios\n- [Refactoring Status](../architecture/god_module_refactoring_status.md) - Current progress\n\n**DO NOT** modify `macula_connection.erl` without reading the refactoring plan first!","ref":"development.html#connection-refactoring-in-progress-jan-2025"},{"type":"extras","title":"Contributing Workflow - Development Guide","doc":"1. **Read the documentation**\n   - [README.md](../README.md)\n   - [CONTRIBUTING.md](../CONTRIBUTING.md)\n   - [CLAUDE.md](../CLAUDE.md) - Coding guidelines\n\n2. **Create a feature branch**\n   ```bash\n   git checkout -b feature/your-feature-name\n   ```\n\n3. **Write tests first** (TDD approach preferred)\n   ```bash\n   # Create test file\n   touch test/macula_your_module_tests.erl\n\n   # Write failing tests\n   # Implement functionality\n   # Verify tests pass\n   rebar3 eunit --module=macula_your_module_tests\n   ```\n\n4. **Follow code quality standards**\n   - Pattern matching over conditionals\n   - Guards instead of case where possible\n   - Maximum 1-2 levels of nesting\n   - Comprehensive tests for new functionality\n\n5. **Commit and push**\n   ```bash\n   git add .\n   git commit -m \"Add feature: your feature description\"\n   git push origin feature/your-feature-name\n   ```\n\n6. **Create pull request**\n   - Describe what the PR does\n   - Reference any related issues\n   - Ensure all tests pass\n   - Follow PR template guidelines","ref":"development.html#contributing-workflow"},{"type":"extras","title":"Getting Help - Development Guide","doc":"- **Issues**: [GitHub Issues](https://github.com/macula-io/macula/issues)\n- **Documentation**: [Architecture Docs](../architecture/)\n- **Code Quality**: [CODE_REVIEW_REPORT.md](../CODE_REVIEW_REPORT.md)\n\n---\n\n**[ Back to README](hello_world.html)** | **[Technical Documentation ](macula_http3_mesh_root.html)**","ref":"development.html#getting-help"}],"proglang":"erlang","content_type":"text/markdown","producer":{"name":"ex_doc","version":"0.38.2"}}