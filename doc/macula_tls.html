<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Module macula_tls</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<hr>

<h1>Module macula_tls</h1>
<ul class="index"><li><a href="#description">Description</a></li><li><a href="#index">Function Index</a></li><li><a href="#functions">Function Details</a></li></ul>TLS Certificate Auto-Generation Module.


<h2><a name="description">Description</a></h2><p>TLS Certificate Auto-Generation Module</p>
  
   <p>This module provides zero-config TLS certificate management for Macula nodes.   
Certificates are auto-generated on first boot and persisted to disk for   
stable node identity across restarts.</p>
  
   Key Features:
   - Auto-generate self-signed certificates on first boot
   - Derive stable Node ID from public key (SHA-256 hash)
   - Persist certificates to disk (survives restarts)
   - Proper file permissions (0600 for private key)
  
<h2><a name="index">Function Index</a></h2>
<table width="100%" border="1" cellspacing="0" cellpadding="2" summary="function index"><tr><td valign="top"><a href="#derive_node_id-1">derive_node_id/1</a></td><td>Derive Node ID from certificate public key.</td></tr>
<tr><td valign="top"><a href="#ensure_cert_exists-2">ensure_cert_exists/2</a></td><td>Ensure TLS certificate exists, generate if missing.</td></tr>
<tr><td valign="top"><a href="#generate_self_signed_cert-1">generate_self_signed_cert/1</a></td><td>Generate self-signed TLS certificate using OpenSSL.</td></tr>
<tr><td valign="top"><a href="#get_cert_paths-0">get_cert_paths/0</a></td><td>Get default certificate paths from application environment.</td></tr>
</table>

<h2><a name="functions">Function Details</a></h2>

<h3 class="function"><a name="derive_node_id-1">derive_node_id/1</a></h3>
<div class="spec">
<p><code>derive_node_id(CertPEM::binary()) -&gt; NodeID::binary()</code><br></p>
<p><code>CertPEM</code>: PEM-encoded certificate binary<br>
</p>
<p>returns: NodeID Binary (32-byte SHA-256 hash, hex-encoded)</p>
</div><p><p>Derive Node ID from certificate public key.</p>
 
  Extracts the public key from the PEM-encoded certificate and computes
  SHA-256 hash to create a stable, cryptographically-derived Node ID.
 </p>

<h3 class="function"><a name="ensure_cert_exists-2">ensure_cert_exists/2</a></h3>
<div class="spec">
<p><code>ensure_cert_exists(CertPath::<a href="/home/rl/work/github.com/macula-io/kernel/doc/file.html#type-filename" docgen-rel="seetype" docgen-href="kernel:file#filename/0">file:filename()</a>, KeyPath::<a href="/home/rl/work/github.com/macula-io/kernel/doc/file.html#type-filename" docgen-rel="seetype" docgen-href="kernel:file#filename/0">file:filename()</a>) -&gt; {ok, <a href="/home/rl/work/github.com/macula-io/kernel/doc/file.html#type-filename" docgen-rel="seetype" docgen-href="kernel:file#filename/0">file:filename()</a>, <a href="/home/rl/work/github.com/macula-io/kernel/doc/file.html#type-filename" docgen-rel="seetype" docgen-href="kernel:file#filename/0">file:filename()</a>, binary()} | {error, term()}</code><br></p>
<p><code>CertPath</code>: Path to certificate file (PEM format)<br>
<code>KeyPath</code>: Path to private key file (PEM format)<br>
</p>
<p>returns: {ok, CertPath, KeyPath, NodeID} | {error, Reason}</p>
</div><p><p>Ensure TLS certificate exists, generate if missing.</p>
 
  Checks if certificate and key files exist at the specified paths.
  If they don't exist, generates new self-signed certificate and saves to disk.
  Returns the paths and derived Node ID.
 </p>

<h3 class="function"><a name="generate_self_signed_cert-1">generate_self_signed_cert/1</a></h3>
<div class="spec">
<p><code>generate_self_signed_cert(Opts::map()) -&gt; {ok, CertPEM::binary(), KeyPEM::binary()} | {error, term()}</code><br></p>
<p><code>Opts</code>: Options map (currently unused, reserved for future extensions)<br>
</p>
<p>returns: {ok, CertPEM, KeyPEM} | {error, Reason}</p>
</div><p><p>Generate self-signed TLS certificate using OpenSSL.</p>
 
  Creates a new RSA key pair and self-signed X.509 certificate with:
  - RSA 2048-bit key
  - 10-year validity period
  - Subject: CN=macula-node
  - Self-signed (issuer = subject)
 </p>

<h3 class="function"><a name="get_cert_paths-0">get_cert_paths/0</a></h3>
<div class="spec">
<p><code>get_cert_paths() -&gt; {<a href="/home/rl/work/github.com/macula-io/kernel/doc/file.html#type-filename" docgen-rel="seetype" docgen-href="kernel:file#filename/0">file:filename()</a>, <a href="/home/rl/work/github.com/macula-io/kernel/doc/file.html#type-filename" docgen-rel="seetype" docgen-href="kernel:file#filename/0">file:filename()</a>}</code><br></p>
<p> </p>
<p>returns: {CertPath, KeyPath}</p>
</div><p>Get default certificate paths from application environment.
 </p>
<hr>

<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc</i></p>
</body>
</html>
