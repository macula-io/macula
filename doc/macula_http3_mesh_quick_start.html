<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.2">
    <meta name="project" content="macula v0.6.5">


    <title>Quick Start â€” macula v0.6.5</title>

    <link rel="stylesheet" href="dist/html-erlang-DQDXQC7W.css" />

    <script defer src="dist/sidebar_items-8AB3F2E8.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="hello_world.html" class="sidebar-projectImage">
          <img src="assets/logo.svg" alt="macula" />
        </a>

      <div>
        <a href="hello_world.html" class="sidebar-projectName" translate="no">
macula
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.6.5
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of macula</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>Macula HTTP/3 Mesh - Quick Start Guide</h1>


      <a href="https://github.com/macula-io/macula/blob/0.6.5/architecture/macula_http3_mesh_quick_start.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


<p><strong>Get a 3-node mesh running in 15 minutes</strong></p><hr class="thin"/><h2 id="prerequisites" class="section-heading"><a href="#prerequisites" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Prerequisites</span></h2><h3 id="required-software" class="section-heading"><a href="#required-software" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Required Software</span></h3><ol><li><p><strong>Erlang/OTP 26.0 or later</strong></p><pre><code class="makeup bash" translate="no"><span class=""># Check version
</span><span class="">erl -eval &#39;erlang:display(erlang:system_info(otp_release)), halt().&#39; -noshell
</span></code></pre><p>Install from:</p><ul><li>Ubuntu/Debian: <code class="inline">sudo apt-get install erlang</code></li><li>macOS: <code class="inline">brew install erlang</code></li><li>From source: <a href="https://www.erlang.org/downloads">https://www.erlang.org/downloads</a></li></ul></li><li><p><strong>Elixir 1.15 or later</strong> (optional, for Elixir examples)</p><pre><code class="makeup bash" translate="no"><span class=""># Check version
</span><span class="">elixir --version
</span></code></pre><p>Install from:</p><ul><li>Ubuntu/Debian: <code class="inline">sudo apt-get install elixir</code></li><li>macOS: <code class="inline">brew install elixir</code></li><li>From source: <a href="https://elixir-lang.org/install.html">https://elixir-lang.org/install.html</a></li></ul></li><li><p><strong>Git</strong></p><pre><code class="makeup bash" translate="no"><span class="">git --version
</span></code></pre></li><li><p><strong>C Compiler</strong> (for building quicer NIF)</p><ul><li>Ubuntu/Debian: <code class="inline">sudo apt-get install build-essential cmake</code></li><li>macOS: <code class="inline">xcode-select --install</code></li></ul></li></ol><h3 id="system-requirements" class="section-heading"><a href="#system-requirements" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">System Requirements</span></h3><ul><li><strong>OS</strong>: Linux (Ubuntu 20.04+), macOS 11+, or Windows WSL2</li><li><strong>RAM</strong>: 512 MB minimum per node (2 GB recommended for development)</li><li><strong>Network</strong>: UDP port access (default: 4433)</li><li><strong>Disk</strong>: 100 MB for Macula + dependencies</li></ul><hr class="thin"/><h2 id="step-1-download-and-build-macula" class="section-heading"><a href="#step-1-download-and-build-macula" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Step 1: Download and Build Macula</span></h2><h3 id="clone-the-repository" class="section-heading"><a href="#clone-the-repository" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Clone the Repository</span></h3><pre><code class="makeup bash" translate="no"><span class="">cd ~/projects
</span><span class="">git clone https://github.com/macula-io/macula.git
</span><span class="">cd macula
</span></code></pre><h3 id="install-dependencies" class="section-heading"><a href="#install-dependencies" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Install Dependencies</span></h3><pre><code class="makeup bash" translate="no"><span class=""># For Erlang (Rebar3)
</span><span class="">rebar3 get-deps
</span><span class="">
</span><span class=""># For Elixir (Mix)
</span><span class="">mix deps.get
</span></code></pre><h3 id="build-quicer-quic-library" class="section-heading"><a href="#build-quicer-quic-library" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Build quicer (QUIC Library)</span></h3><p>The <code class="inline">quicer</code> library includes native code and may take a few minutes to compile:</p><pre><code class="makeup bash" translate="no"><span class=""># Rebar3
</span><span class="">rebar3 compile
</span><span class="">
</span><span class=""># Mix
</span><span class="">mix compile
</span></code></pre><p><strong>Expected output</strong>:</p><pre><code class="makeup erlang" translate="no"><span class="o">==</span><span class="p">=&gt;</span><span class="w"> </span><span class="n">Fetching</span><span class="w"> </span><span class="nf">quicer</span><span class="w"> </span><span class="p" data-group-id="4551254067-1">(</span><span class="ss">from</span><span class="w"> </span><span class="p" data-group-id="4551254067-2">{</span><span class="ss">git</span><span class="p">,</span><span class="s">&quot;https://github.com/emqx/quic.git&quot;</span><span class="p">,</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="4551254067-2">}</span><span class="p" data-group-id="4551254067-1">)</span><span class="w">
</span><span class="o">==</span><span class="p">=&gt;</span><span class="w"> </span><span class="n">Compiling</span><span class="w"> </span><span class="ss">quicer</span><span class="w">
     </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
     </span><span class="p" data-group-id="4551254067-3">[</span><span class="mi">100</span><span class="c1">%] Built target msquic</span><span class="w">
</span><span class="o">==</span><span class="p">=&gt;</span><span class="w"> </span><span class="n">Compiled</span><span class="w"> </span><span class="ss">quicer</span></code></pre><h3 id="verify-installation" class="section-heading"><a href="#verify-installation" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Verify Installation</span></h3><pre><code class="makeup bash" translate="no"><span class=""># Erlang
</span><span class="">rebar3 shell
</span><span class="">&gt; macula:version().
</span><span class="">{ok, &quot;0.1.0&quot;}
</span><span class="">
</span><span class=""># Elixir
</span><span class="">iex -S mix
</span><span class="">iex&gt; Macula.version()
</span><span class="">{:ok, &quot;0.1.0&quot;}
</span></code></pre><hr class="thin"/><h2 id="step-2-start-node-1-bootstrap-node" class="section-heading"><a href="#step-2-start-node-1-bootstrap-node" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Step 2: Start Node 1 (Bootstrap Node)</span></h2><h3 id="create-configuration-file" class="section-heading"><a href="#create-configuration-file" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Create Configuration File</span></h3><p>Create <code class="inline">config/node1.config</code>:</p><pre><code class="makeup erlang" translate="no"><span class="c1">%% config/node1.config</span><span class="w">
</span><span class="p" data-group-id="0123544583-1">[</span><span class="w">
 </span><span class="p" data-group-id="0123544583-2">{</span><span class="ss">macula</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0123544583-3">[</span><span class="w">
   </span><span class="p" data-group-id="0123544583-4">{</span><span class="ss">node_id</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0123544583-5">&lt;&lt;</span><span class="s">&quot;node1&quot;</span><span class="p" data-group-id="0123544583-5">&gt;&gt;</span><span class="p" data-group-id="0123544583-4">}</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="0123544583-6">{</span><span class="ss">realm</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0123544583-7">&lt;&lt;</span><span class="s">&quot;org.example.mesh&quot;</span><span class="p" data-group-id="0123544583-7">&gt;&gt;</span><span class="p" data-group-id="0123544583-6">}</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="0123544583-8">{</span><span class="ss">listen_port</span><span class="p">,</span><span class="w"> </span><span class="mi">4433</span><span class="p" data-group-id="0123544583-8">}</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="0123544583-9">{</span><span class="ss">listen_address</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0.0.0.0&quot;</span><span class="p" data-group-id="0123544583-9">}</span><span class="p">,</span><span class="w">

   </span><span class="c1">%% Discovery</span><span class="w">
   </span><span class="p" data-group-id="0123544583-10">{</span><span class="ss">discovery</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0123544583-11">[</span><span class="w">
     </span><span class="p" data-group-id="0123544583-12">{</span><span class="ss">methods</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0123544583-13">[</span><span class="ss">static</span><span class="p" data-group-id="0123544583-13">]</span><span class="p" data-group-id="0123544583-12">}</span><span class="p">,</span><span class="w">  </span><span class="c1">% Use static bootstrap for this example</span><span class="w">
     </span><span class="p" data-group-id="0123544583-14">{</span><span class="ss">static_nodes</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0123544583-15">[</span><span class="p" data-group-id="0123544583-15">]</span><span class="p" data-group-id="0123544583-14">}</span><span class="w">    </span><span class="c1">% First node has no bootstrap peers</span><span class="w">
   </span><span class="p" data-group-id="0123544583-11">]</span><span class="p" data-group-id="0123544583-10">}</span><span class="p">,</span><span class="w">

   </span><span class="c1">%% Topology</span><span class="w">
   </span><span class="p" data-group-id="0123544583-16">{</span><span class="ss">topology</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0123544583-17">[</span><span class="w">
     </span><span class="p" data-group-id="0123544583-18">{</span><span class="ss">type</span><span class="p">,</span><span class="w"> </span><span class="ss">k_regular</span><span class="p" data-group-id="0123544583-18">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="0123544583-19">{</span><span class="ss">k</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="0123544583-19">}</span><span class="w">  </span><span class="c1">% Each node connects to 2 peers</span><span class="w">
   </span><span class="p" data-group-id="0123544583-17">]</span><span class="p" data-group-id="0123544583-16">}</span><span class="p">,</span><span class="w">

   </span><span class="c1">%% TLS/Certificates (auto-generate for demo)</span><span class="w">
   </span><span class="p" data-group-id="0123544583-20">{</span><span class="ss">cert_mode</span><span class="p">,</span><span class="w"> </span><span class="ss">auto_generate</span><span class="p" data-group-id="0123544583-20">}</span><span class="p">,</span><span class="w">

   </span><span class="c1">%% Logging</span><span class="w">
   </span><span class="p" data-group-id="0123544583-21">{</span><span class="ss">log_level</span><span class="p">,</span><span class="w"> </span><span class="ss">info</span><span class="p" data-group-id="0123544583-21">}</span><span class="w">
 </span><span class="p" data-group-id="0123544583-3">]</span><span class="p" data-group-id="0123544583-2">}</span><span class="w">
</span><span class="p" data-group-id="0123544583-1">]</span><span class="p">.</span></code></pre><h3 id="start-node-1" class="section-heading"><a href="#start-node-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Start Node 1</span></h3><pre><code class="makeup bash" translate="no"><span class=""># Erlang
</span><span class="">erl -config config/node1 -pa _build/default/lib/*/ebin -eval &#39;application:ensure_all_started(macula).&#39;
</span><span class="">
</span><span class=""># Elixir
</span><span class="">iex --name node1@127.0.0.1 --cookie macula_demo -S mix run -e &#39;Application.ensure_all_started(:macula)&#39; -- --config config/node1.config
</span></code></pre><p><strong>Expected output</strong>:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="7266537936-1">[</span><span class="ss">info</span><span class="p" data-group-id="7266537936-1">]</span><span class="w"> </span><span class="n">Macula</span><span class="w"> </span><span class="nb">node</span><span class="w"> </span><span class="nc">started</span><span class="p">:</span><span class="w"> </span><span class="ss">node1</span><span class="w">
</span><span class="p" data-group-id="7266537936-2">[</span><span class="ss">info</span><span class="p" data-group-id="7266537936-2">]</span><span class="w"> </span><span class="n">Listening</span><span class="w"> </span><span class="ss">on</span><span class="w"> </span><span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">4433</span><span class="w"> </span><span class="p" data-group-id="7266537936-3">(</span><span class="n">UDP</span><span class="p" data-group-id="7266537936-3">)</span><span class="w">
</span><span class="p" data-group-id="7266537936-4">[</span><span class="ss">info</span><span class="p" data-group-id="7266537936-4">]</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="n">ID</span><span class="p">:</span><span class="w"> </span><span class="ss">a3f5b2e1c4d8a7f9</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="7266537936-5">[</span><span class="ss">info</span><span class="p" data-group-id="7266537936-5">]</span><span class="w"> </span><span class="n">Realm</span><span class="p">:</span><span class="w"> </span><span class="ss">org</span><span class="p">.</span><span class="ss">example</span><span class="p">.</span><span class="ss">mesh</span><span class="w">
</span><span class="p" data-group-id="7266537936-6">[</span><span class="ss">info</span><span class="p" data-group-id="7266537936-6">]</span><span class="w"> </span><span class="n">Topology</span><span class="p">:</span><span class="w"> </span><span class="nf">k_regular</span><span class="w"> </span><span class="p" data-group-id="7266537936-7">(</span><span class="ss">k</span><span class="o">=</span><span class="mi">2</span><span class="p" data-group-id="7266537936-7">)</span><span class="w">
</span><span class="p" data-group-id="7266537936-8">[</span><span class="ss">info</span><span class="p" data-group-id="7266537936-8">]</span><span class="w"> </span><span class="n">Discovery</span><span class="p">:</span><span class="w"> </span><span class="ss">static</span><span class="w">
</span><span class="p" data-group-id="7266537936-9">[</span><span class="ss">info</span><span class="p" data-group-id="7266537936-9">]</span><span class="w"> </span><span class="n">Ready</span><span class="w"> </span><span class="ss">to</span><span class="w"> </span><span class="ss">accept</span><span class="w"> </span><span class="ss">connections</span></code></pre><p><strong>Keep this terminal open</strong> - Node 1 is now running.</p><hr class="thin"/><h2 id="step-3-start-node-2-join-the-mesh" class="section-heading"><a href="#step-3-start-node-2-join-the-mesh" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Step 3: Start Node 2 (Join the Mesh)</span></h2><h3 id="create-configuration-file-1" class="section-heading"><a href="#create-configuration-file-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Create Configuration File</span></h3><p>Create <code class="inline">config/node2.config</code>:</p><pre><code class="makeup erlang" translate="no"><span class="c1">%% config/node2.config</span><span class="w">
</span><span class="p" data-group-id="2482979810-1">[</span><span class="w">
 </span><span class="p" data-group-id="2482979810-2">{</span><span class="ss">macula</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2482979810-3">[</span><span class="w">
   </span><span class="p" data-group-id="2482979810-4">{</span><span class="ss">node_id</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2482979810-5">&lt;&lt;</span><span class="s">&quot;node2&quot;</span><span class="p" data-group-id="2482979810-5">&gt;&gt;</span><span class="p" data-group-id="2482979810-4">}</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="2482979810-6">{</span><span class="ss">realm</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2482979810-7">&lt;&lt;</span><span class="s">&quot;org.example.mesh&quot;</span><span class="p" data-group-id="2482979810-7">&gt;&gt;</span><span class="p" data-group-id="2482979810-6">}</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="2482979810-8">{</span><span class="ss">listen_port</span><span class="p">,</span><span class="w"> </span><span class="mi">4434</span><span class="p" data-group-id="2482979810-8">}</span><span class="p">,</span><span class="w">  </span><span class="c1">% Different port</span><span class="w">
   </span><span class="p" data-group-id="2482979810-9">{</span><span class="ss">listen_address</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0.0.0.0&quot;</span><span class="p" data-group-id="2482979810-9">}</span><span class="p">,</span><span class="w">

   </span><span class="c1">%% Discovery - bootstrap from Node 1</span><span class="w">
   </span><span class="p" data-group-id="2482979810-10">{</span><span class="ss">discovery</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2482979810-11">[</span><span class="w">
     </span><span class="p" data-group-id="2482979810-12">{</span><span class="ss">methods</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2482979810-13">[</span><span class="ss">static</span><span class="p" data-group-id="2482979810-13">]</span><span class="p" data-group-id="2482979810-12">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="2482979810-14">{</span><span class="ss">static_nodes</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2482979810-15">[</span><span class="w">
       </span><span class="p" data-group-id="2482979810-16">{</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4433</span><span class="p" data-group-id="2482979810-16">}</span><span class="w">  </span><span class="c1">% Node 1&#39;s address</span><span class="w">
     </span><span class="p" data-group-id="2482979810-15">]</span><span class="p" data-group-id="2482979810-14">}</span><span class="w">
   </span><span class="p" data-group-id="2482979810-11">]</span><span class="p" data-group-id="2482979810-10">}</span><span class="p">,</span><span class="w">

   </span><span class="c1">%% Topology</span><span class="w">
   </span><span class="p" data-group-id="2482979810-17">{</span><span class="ss">topology</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2482979810-18">[</span><span class="w">
     </span><span class="p" data-group-id="2482979810-19">{</span><span class="ss">type</span><span class="p">,</span><span class="w"> </span><span class="ss">k_regular</span><span class="p" data-group-id="2482979810-19">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="2482979810-20">{</span><span class="ss">k</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="2482979810-20">}</span><span class="w">
   </span><span class="p" data-group-id="2482979810-18">]</span><span class="p" data-group-id="2482979810-17">}</span><span class="p">,</span><span class="w">

   </span><span class="c1">%% TLS/Certificates</span><span class="w">
   </span><span class="p" data-group-id="2482979810-21">{</span><span class="ss">cert_mode</span><span class="p">,</span><span class="w"> </span><span class="ss">auto_generate</span><span class="p" data-group-id="2482979810-21">}</span><span class="p">,</span><span class="w">

   </span><span class="c1">%% Logging</span><span class="w">
   </span><span class="p" data-group-id="2482979810-22">{</span><span class="ss">log_level</span><span class="p">,</span><span class="w"> </span><span class="ss">info</span><span class="p" data-group-id="2482979810-22">}</span><span class="w">
 </span><span class="p" data-group-id="2482979810-3">]</span><span class="p" data-group-id="2482979810-2">}</span><span class="w">
</span><span class="p" data-group-id="2482979810-1">]</span><span class="p">.</span></code></pre><h3 id="start-node-2-in-new-terminal" class="section-heading"><a href="#start-node-2-in-new-terminal" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Start Node 2 (in new terminal)</span></h3><pre><code class="makeup bash" translate="no"><span class=""># Open new terminal
</span><span class="">cd ~/projects/macula
</span><span class="">
</span><span class=""># Erlang
</span><span class="">erl -config config/node2 -pa _build/default/lib/*/ebin -eval &#39;application:ensure_all_started(macula).&#39;
</span><span class="">
</span><span class=""># Elixir
</span><span class="">iex --name node2@127.0.0.1 --cookie macula_demo -S mix run -e &#39;Application.ensure_all_started(:macula)&#39; -- --config config/node2.config
</span></code></pre><p><strong>Expected output</strong>:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="0033920017-1">[</span><span class="ss">info</span><span class="p" data-group-id="0033920017-1">]</span><span class="w"> </span><span class="n">Macula</span><span class="w"> </span><span class="nb">node</span><span class="w"> </span><span class="nc">started</span><span class="p">:</span><span class="w"> </span><span class="ss">node2</span><span class="w">
</span><span class="p" data-group-id="0033920017-2">[</span><span class="ss">info</span><span class="p" data-group-id="0033920017-2">]</span><span class="w"> </span><span class="n">Listening</span><span class="w"> </span><span class="ss">on</span><span class="w"> </span><span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">4434</span><span class="w"> </span><span class="p" data-group-id="0033920017-3">(</span><span class="n">UDP</span><span class="p" data-group-id="0033920017-3">)</span><span class="w">
</span><span class="p" data-group-id="0033920017-4">[</span><span class="ss">info</span><span class="p" data-group-id="0033920017-4">]</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="n">ID</span><span class="p">:</span><span class="w"> </span><span class="ss">b7c3d8e2f5a9b4c1</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="0033920017-5">[</span><span class="ss">info</span><span class="p" data-group-id="0033920017-5">]</span><span class="w"> </span><span class="n">Realm</span><span class="p">:</span><span class="w"> </span><span class="ss">org</span><span class="p">.</span><span class="ss">example</span><span class="p">.</span><span class="ss">mesh</span><span class="w">
</span><span class="p" data-group-id="0033920017-6">[</span><span class="ss">info</span><span class="p" data-group-id="0033920017-6">]</span><span class="w"> </span><span class="n">Connecting</span><span class="w"> </span><span class="ss">to</span><span class="w"> </span><span class="ss">bootstrap</span><span class="w"> </span><span class="nb">node</span><span class="w"> </span><span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">4433</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="0033920017-7">[</span><span class="ss">info</span><span class="p" data-group-id="0033920017-7">]</span><span class="w"> </span><span class="n">Connected</span><span class="w"> </span><span class="ss">to</span><span class="w"> </span><span class="nf">node1</span><span class="w"> </span><span class="p" data-group-id="0033920017-8">(</span><span class="ss">a3f5b2e1c4d8a7f9</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="0033920017-8">)</span><span class="w">
</span><span class="p" data-group-id="0033920017-9">[</span><span class="ss">info</span><span class="p" data-group-id="0033920017-9">]</span><span class="w"> </span><span class="n">SWIM</span><span class="w"> </span><span class="nc">membership</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nb">nodes</span><span class="w"> </span><span class="ss">alive</span><span class="w">
</span><span class="p" data-group-id="0033920017-10">[</span><span class="ss">info</span><span class="p" data-group-id="0033920017-10">]</span><span class="w"> </span><span class="n">Mesh</span><span class="w"> </span><span class="ss">topology</span><span class="w"> </span><span class="ss">established</span></code></pre><p><strong>In Node 1's terminal</strong>, you should see:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="0755992981-1">[</span><span class="ss">info</span><span class="p" data-group-id="0755992981-1">]</span><span class="w"> </span><span class="n">New</span><span class="w"> </span><span class="ss">connection</span><span class="w"> </span><span class="ss">from</span><span class="w"> </span><span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span><span class="p">:</span><span class="ss">xxxxx</span><span class="w">
</span><span class="p" data-group-id="0755992981-2">[</span><span class="ss">info</span><span class="p" data-group-id="0755992981-2">]</span><span class="w"> </span><span class="n">Handshake</span><span class="w"> </span><span class="nc">complete</span><span class="p">:</span><span class="w"> </span><span class="nf">node2</span><span class="w"> </span><span class="p" data-group-id="0755992981-3">(</span><span class="ss">b7c3d8e2f5a9b4c1</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="0755992981-3">)</span><span class="w">
</span><span class="p" data-group-id="0755992981-4">[</span><span class="ss">info</span><span class="p" data-group-id="0755992981-4">]</span><span class="w"> </span><span class="n">SWIM</span><span class="w"> </span><span class="nc">membership</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nb">nodes</span><span class="w"> </span><span class="ss">alive</span></code></pre><hr class="thin"/><h2 id="step-4-start-node-3-expand-the-mesh" class="section-heading"><a href="#step-4-start-node-3-expand-the-mesh" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Step 4: Start Node 3 (Expand the Mesh)</span></h2><h3 id="create-configuration-file-2" class="section-heading"><a href="#create-configuration-file-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Create Configuration File</span></h3><p>Create <code class="inline">config/node3.config</code>:</p><pre><code class="makeup erlang" translate="no"><span class="c1">%% config/node3.config</span><span class="w">
</span><span class="p" data-group-id="4874771462-1">[</span><span class="w">
 </span><span class="p" data-group-id="4874771462-2">{</span><span class="ss">macula</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4874771462-3">[</span><span class="w">
   </span><span class="p" data-group-id="4874771462-4">{</span><span class="ss">node_id</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4874771462-5">&lt;&lt;</span><span class="s">&quot;node3&quot;</span><span class="p" data-group-id="4874771462-5">&gt;&gt;</span><span class="p" data-group-id="4874771462-4">}</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="4874771462-6">{</span><span class="ss">realm</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4874771462-7">&lt;&lt;</span><span class="s">&quot;org.example.mesh&quot;</span><span class="p" data-group-id="4874771462-7">&gt;&gt;</span><span class="p" data-group-id="4874771462-6">}</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="4874771462-8">{</span><span class="ss">listen_port</span><span class="p">,</span><span class="w"> </span><span class="mi">4435</span><span class="p" data-group-id="4874771462-8">}</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="4874771462-9">{</span><span class="ss">listen_address</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0.0.0.0&quot;</span><span class="p" data-group-id="4874771462-9">}</span><span class="p">,</span><span class="w">

   </span><span class="c1">%% Discovery - can bootstrap from either node</span><span class="w">
   </span><span class="p" data-group-id="4874771462-10">{</span><span class="ss">discovery</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4874771462-11">[</span><span class="w">
     </span><span class="p" data-group-id="4874771462-12">{</span><span class="ss">methods</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4874771462-13">[</span><span class="ss">static</span><span class="p" data-group-id="4874771462-13">]</span><span class="p" data-group-id="4874771462-12">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="4874771462-14">{</span><span class="ss">static_nodes</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4874771462-15">[</span><span class="w">
       </span><span class="p" data-group-id="4874771462-16">{</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4433</span><span class="p" data-group-id="4874771462-16">}</span><span class="p">,</span><span class="w">  </span><span class="c1">% Node 1</span><span class="w">
       </span><span class="p" data-group-id="4874771462-17">{</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4434</span><span class="p" data-group-id="4874771462-17">}</span><span class="w">   </span><span class="c1">% Node 2</span><span class="w">
     </span><span class="p" data-group-id="4874771462-15">]</span><span class="p" data-group-id="4874771462-14">}</span><span class="w">
   </span><span class="p" data-group-id="4874771462-11">]</span><span class="p" data-group-id="4874771462-10">}</span><span class="p">,</span><span class="w">

   </span><span class="c1">%% Topology</span><span class="w">
   </span><span class="p" data-group-id="4874771462-18">{</span><span class="ss">topology</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4874771462-19">[</span><span class="w">
     </span><span class="p" data-group-id="4874771462-20">{</span><span class="ss">type</span><span class="p">,</span><span class="w"> </span><span class="ss">k_regular</span><span class="p" data-group-id="4874771462-20">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="4874771462-21">{</span><span class="ss">k</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4874771462-21">}</span><span class="w">
   </span><span class="p" data-group-id="4874771462-19">]</span><span class="p" data-group-id="4874771462-18">}</span><span class="p">,</span><span class="w">

   </span><span class="c1">%% TLS/Certificates</span><span class="w">
   </span><span class="p" data-group-id="4874771462-22">{</span><span class="ss">cert_mode</span><span class="p">,</span><span class="w"> </span><span class="ss">auto_generate</span><span class="p" data-group-id="4874771462-22">}</span><span class="p">,</span><span class="w">

   </span><span class="c1">%% Logging</span><span class="w">
   </span><span class="p" data-group-id="4874771462-23">{</span><span class="ss">log_level</span><span class="p">,</span><span class="w"> </span><span class="ss">info</span><span class="p" data-group-id="4874771462-23">}</span><span class="w">
 </span><span class="p" data-group-id="4874771462-3">]</span><span class="p" data-group-id="4874771462-2">}</span><span class="w">
</span><span class="p" data-group-id="4874771462-1">]</span><span class="p">.</span></code></pre><h3 id="start-node-3-in-new-terminal" class="section-heading"><a href="#start-node-3-in-new-terminal" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Start Node 3 (in new terminal)</span></h3><pre><code class="makeup bash" translate="no"><span class=""># Open new terminal
</span><span class="">cd ~/projects/macula
</span><span class="">
</span><span class=""># Erlang
</span><span class="">erl -config config/node3 -pa _build/default/lib/*/ebin -eval &#39;application:ensure_all_started(macula).&#39;
</span><span class="">
</span><span class=""># Elixir
</span><span class="">iex --name node3@127.0.0.1 --cookie macula_demo -S mix run -e &#39;Application.ensure_all_started(:macula)&#39; -- --config config/node3.config
</span></code></pre><p><strong>Expected output</strong>:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="6283887376-1">[</span><span class="ss">info</span><span class="p" data-group-id="6283887376-1">]</span><span class="w"> </span><span class="n">Macula</span><span class="w"> </span><span class="nb">node</span><span class="w"> </span><span class="nc">started</span><span class="p">:</span><span class="w"> </span><span class="ss">node3</span><span class="w">
</span><span class="p" data-group-id="6283887376-2">[</span><span class="ss">info</span><span class="p" data-group-id="6283887376-2">]</span><span class="w"> </span><span class="n">Listening</span><span class="w"> </span><span class="ss">on</span><span class="w"> </span><span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">4435</span><span class="w"> </span><span class="p" data-group-id="6283887376-3">(</span><span class="n">UDP</span><span class="p" data-group-id="6283887376-3">)</span><span class="w">
</span><span class="p" data-group-id="6283887376-4">[</span><span class="ss">info</span><span class="p" data-group-id="6283887376-4">]</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="n">ID</span><span class="p">:</span><span class="w"> </span><span class="ss">c8d4e9f3a6b2c7d1</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="6283887376-5">[</span><span class="ss">info</span><span class="p" data-group-id="6283887376-5">]</span><span class="w"> </span><span class="n">Realm</span><span class="p">:</span><span class="w"> </span><span class="ss">org</span><span class="p">.</span><span class="ss">example</span><span class="p">.</span><span class="ss">mesh</span><span class="w">
</span><span class="p" data-group-id="6283887376-6">[</span><span class="ss">info</span><span class="p" data-group-id="6283887376-6">]</span><span class="w"> </span><span class="n">Connecting</span><span class="w"> </span><span class="ss">to</span><span class="w"> </span><span class="ss">bootstrap</span><span class="w"> </span><span class="nb">nodes</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="6283887376-7">[</span><span class="ss">info</span><span class="p" data-group-id="6283887376-7">]</span><span class="w"> </span><span class="n">Connected</span><span class="w"> </span><span class="ss">to</span><span class="w"> </span><span class="nf">node1</span><span class="w"> </span><span class="p" data-group-id="6283887376-8">(</span><span class="ss">a3f5b2e1c4d8a7f9</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="6283887376-8">)</span><span class="w">
</span><span class="p" data-group-id="6283887376-9">[</span><span class="ss">info</span><span class="p" data-group-id="6283887376-9">]</span><span class="w"> </span><span class="n">Connected</span><span class="w"> </span><span class="ss">to</span><span class="w"> </span><span class="nf">node2</span><span class="w"> </span><span class="p" data-group-id="6283887376-10">(</span><span class="ss">b7c3d8e2f5a9b4c1</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="6283887376-10">)</span><span class="w">
</span><span class="p" data-group-id="6283887376-11">[</span><span class="ss">info</span><span class="p" data-group-id="6283887376-11">]</span><span class="w"> </span><span class="n">SWIM</span><span class="w"> </span><span class="nc">membership</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="nb">nodes</span><span class="w"> </span><span class="ss">alive</span><span class="w">
</span><span class="p" data-group-id="6283887376-12">[</span><span class="ss">info</span><span class="p" data-group-id="6283887376-12">]</span><span class="w"> </span><span class="n">Mesh</span><span class="w"> </span><span class="nc">topology</span><span class="p">:</span><span class="w"> </span><span class="nf">k_regular</span><span class="w"> </span><span class="p" data-group-id="6283887376-13">(</span><span class="ss">k</span><span class="o">=</span><span class="mi">2</span><span class="p" data-group-id="6283887376-13">)</span><span class="w">
</span><span class="p" data-group-id="6283887376-14">[</span><span class="ss">info</span><span class="p" data-group-id="6283887376-14">]</span><span class="w"> </span><span class="n">Routing</span><span class="w"> </span><span class="nc">table</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="nb">nodes</span></code></pre><p><strong>Congratulations!</strong> You now have a 3-node mesh network running.</p><hr class="thin"/><h2 id="step-5-verify-mesh-topology" class="section-heading"><a href="#step-5-verify-mesh-topology" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Step 5: Verify Mesh Topology</span></h2><h3 id="check-membership-on-any-node" class="section-heading"><a href="#check-membership-on-any-node" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Check Membership (on any node)</span></h3><p>In any node's console:</p><pre><code class="makeup erlang" translate="no"><span class="c1">% Erlang</span><span class="w">
</span><span class="nc">macula_membership</span><span class="p">:</span><span class="nf">get_members</span><span class="p" data-group-id="3634810588-1">(</span><span class="p" data-group-id="3634810588-1">)</span><span class="p">.</span><span class="w">

</span><span class="c1">% Expected output:</span><span class="w">
</span><span class="p" data-group-id="3634810588-2">[</span><span class="w">
  </span><span class="p" data-group-id="3634810588-3">#{</span><span class="ss">node_id</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="3634810588-4">&lt;&lt;</span><span class="s">&quot;a3f5b2e1...&quot;</span><span class="p" data-group-id="3634810588-4">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="ss">state</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">alive</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="3634810588-3">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3634810588-5">#{</span><span class="ss">node_id</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="3634810588-6">&lt;&lt;</span><span class="s">&quot;b7c3d8e2...&quot;</span><span class="p" data-group-id="3634810588-6">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="ss">state</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">alive</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="3634810588-5">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3634810588-7">#{</span><span class="ss">node_id</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="3634810588-8">&lt;&lt;</span><span class="s">&quot;c8d4e9f3...&quot;</span><span class="p" data-group-id="3634810588-8">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="ss">state</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">alive</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="3634810588-7">}</span><span class="w">
</span><span class="p" data-group-id="3634810588-2">]</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="c1"># Elixir</span><span class="w">
</span><span class="nc">Macula.Membership</span><span class="o">.</span><span class="n">get_members</span><span class="p" data-group-id="9989218504-1">(</span><span class="p" data-group-id="9989218504-1">)</span><span class="w">

</span><span class="c1"># Expected output:</span><span class="w">
</span><span class="p" data-group-id="9989218504-2">[</span><span class="w">
  </span><span class="p" data-group-id="9989218504-3">%{</span><span class="ss">node_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;a3f5b2e1...&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">state</span><span class="p">:</span><span class="w"> </span><span class="ss">:alive</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="9989218504-3">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="9989218504-4">%{</span><span class="ss">node_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;b7c3d8e2...&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">state</span><span class="p">:</span><span class="w"> </span><span class="ss">:alive</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="9989218504-4">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="9989218504-5">%{</span><span class="ss">node_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;c8d4e9f3...&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">state</span><span class="p">:</span><span class="w"> </span><span class="ss">:alive</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="9989218504-5">}</span><span class="w">
</span><span class="p" data-group-id="9989218504-2">]</span></code></pre><h3 id="check-connections" class="section-heading"><a href="#check-connections" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Check Connections</span></h3><pre><code class="makeup erlang" translate="no"><span class="c1">% Erlang</span><span class="w">
</span><span class="nc">macula_topology</span><span class="p">:</span><span class="nf">get_connections</span><span class="p" data-group-id="6202550629-1">(</span><span class="p" data-group-id="6202550629-1">)</span><span class="p">.</span><span class="w">

</span><span class="c1">% Expected output:</span><span class="w">
</span><span class="p" data-group-id="6202550629-2">[</span><span class="w">
  </span><span class="p" data-group-id="6202550629-3">#{</span><span class="ss">peer_id</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6202550629-4">&lt;&lt;</span><span class="s">&quot;b7c3d8e2...&quot;</span><span class="p" data-group-id="6202550629-4">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="ss">state</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">rtt_ms</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mf">1.2</span><span class="p" data-group-id="6202550629-3">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="6202550629-5">#{</span><span class="ss">peer_id</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6202550629-6">&lt;&lt;</span><span class="s">&quot;c8d4e9f3...&quot;</span><span class="p" data-group-id="6202550629-6">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="ss">state</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">rtt_ms</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mf">1.5</span><span class="p" data-group-id="6202550629-5">}</span><span class="w">
</span><span class="p" data-group-id="6202550629-2">]</span></code></pre><h3 id="visualize-topology-ascii-art" class="section-heading"><a href="#visualize-topology-ascii-art" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Visualize Topology (ASCII Art)</span></h3><pre><code class="makeup erlang" translate="no"><span class="c1">% Erlang</span><span class="w">
</span><span class="nc">macula_topology</span><span class="p">:</span><span class="nf">print_topology</span><span class="p" data-group-id="9119668658-1">(</span><span class="p" data-group-id="9119668658-1">)</span><span class="p">.</span></code></pre><p><strong>Expected output</strong>:</p><pre><code class="makeup erlang" translate="no"><span class="n">Mesh</span><span class="w"> </span><span class="n">Topology</span><span class="w"> </span><span class="p" data-group-id="5905873934-1">(</span><span class="ss">k</span><span class="o">-</span><span class="ss">regular</span><span class="p">,</span><span class="w"> </span><span class="ss">k</span><span class="o">=</span><span class="mi">2</span><span class="p" data-group-id="5905873934-1">)</span><span class="w">
</span><span class="o">==</span><span class="o">==</span><span class="o">==</span><span class="o">==</span><span class="o">==</span><span class="o">==</span><span class="o">==</span><span class="o">==</span><span class="o">==</span><span class="o">==</span><span class="o">==</span><span class="o">==</span><span class="o">==</span><span class="o">==</span><span class="o">==</span><span class="w">

</span><span class="nf">node1</span><span class="w"> </span><span class="p" data-group-id="5905873934-2">(</span><span class="ss">a3f5</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="5905873934-2">)</span><span class="w"> </span><span class="err">â†</span><span class="err">â”€</span><span class="err">â†’</span><span class="w"> </span><span class="nf">node2</span><span class="w"> </span><span class="p" data-group-id="5905873934-3">(</span><span class="ss">b7c3</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="5905873934-3">)</span><span class="w">
  </span><span class="err">â†‘</span><span class="w">                     </span><span class="err">â†‘</span><span class="w">
  </span><span class="err">â””</span><span class="err">â”€</span><span class="err">â”€</span><span class="err">â”€</span><span class="err">â”€</span><span class="err">â”€</span><span class="err">â”€</span><span class="err">â”€</span><span class="err">â”€</span><span class="err">â”€</span><span class="err">â”€</span><span class="err">â”€</span><span class="err">â”€</span><span class="err">â†’</span><span class="w"> </span><span class="nf">node3</span><span class="w"> </span><span class="p" data-group-id="5905873934-4">(</span><span class="ss">c8d4</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="5905873934-4">)</span><span class="w">
                       </span><span class="err">â†‘</span><span class="w">
                       </span><span class="err">â””</span><span class="err">â”€</span><span class="err">â”€</span><span class="err">â”€</span><span class="err">â”€</span><span class="err">â”€</span><span class="err">â”€</span><span class="err">â”€</span><span class="err">â”€</span><span class="err">â†’</span><span class="w"> </span><span class="ss">node1</span><span class="w">

</span><span class="mi">3</span><span class="w"> </span><span class="nb">nodes</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="ss">connections</span><span class="w">
</span><span class="n">Average</span><span class="w"> </span><span class="n">RTT</span><span class="p">:</span><span class="w"> </span><span class="mf">1.3</span><span class="ss">ms</span></code></pre><hr class="thin"/><h2 id="step-6-send-your-first-message-pub-sub" class="section-heading"><a href="#step-6-send-your-first-message-pub-sub" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Step 6: Send Your First Message (Pub/Sub)</span></h2><h3 id="subscribe-to-a-topic-on-node-3" class="section-heading"><a href="#subscribe-to-a-topic-on-node-3" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Subscribe to a Topic (on Node 3)</span></h3><p>In Node 3's console:</p><pre><code class="makeup erlang" translate="no"><span class="c1">% Erlang</span><span class="w">
</span><span class="n">Subscriber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4200119411-1">(</span><span class="nf">fun</span><span class="p" data-group-id="4200119411-2">(</span><span class="p" data-group-id="4200119411-2">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
  </span><span class="k">receive</span><span class="w">
    </span><span class="p" data-group-id="4200119411-3">{</span><span class="ss">event</span><span class="p">,</span><span class="w"> </span><span class="n">Topic</span><span class="p">,</span><span class="w"> </span><span class="n">Msg</span><span class="p" data-group-id="4200119411-3">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
      </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4200119411-4">(</span><span class="s">&quot;Received on </span><span class="si">~s</span><span class="s">: </span><span class="si">~p</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4200119411-5">[</span><span class="n">Topic</span><span class="p">,</span><span class="w"> </span><span class="n">Msg</span><span class="p" data-group-id="4200119411-5">]</span><span class="p" data-group-id="4200119411-4">)</span><span class="w">
  </span><span class="k">end</span><span class="w">
</span><span class="k">end</span><span class="p" data-group-id="4200119411-1">)</span><span class="p">.</span><span class="w">

</span><span class="nc">macula_pubsub</span><span class="p">:</span><span class="nf">subscribe</span><span class="p" data-group-id="4200119411-6">(</span><span class="p" data-group-id="4200119411-7">&lt;&lt;</span><span class="s">&quot;hello.world&quot;</span><span class="p" data-group-id="4200119411-7">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Subscriber</span><span class="p" data-group-id="4200119411-6">)</span><span class="p">.</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="c1"># Elixir</span><span class="w">
</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spawn</span><span class="p" data-group-id="9310135735-1">(</span><span class="k" data-group-id="9310135735-2">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="k">receive</span><span class="w"> </span><span class="k" data-group-id="9310135735-3">do</span><span class="w">
    </span><span class="p" data-group-id="9310135735-4">{</span><span class="ss">:event</span><span class="p">,</span><span class="w"> </span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p" data-group-id="9310135735-4">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="9310135735-5">(</span><span class="s">&quot;Received on </span><span class="si" data-group-id="9310135735-6">#{</span><span class="n">topic</span><span class="si" data-group-id="9310135735-6">}</span><span class="s">: </span><span class="si" data-group-id="9310135735-7">#{</span><span class="n">inspect</span><span class="p" data-group-id="9310135735-8">(</span><span class="n">msg</span><span class="p" data-group-id="9310135735-8">)</span><span class="si" data-group-id="9310135735-7">}</span><span class="s">&quot;</span><span class="p" data-group-id="9310135735-5">)</span><span class="w">
  </span><span class="k" data-group-id="9310135735-3">end</span><span class="w">
</span><span class="k" data-group-id="9310135735-2">end</span><span class="p" data-group-id="9310135735-1">)</span><span class="w">

</span><span class="nc">Macula.PubSub</span><span class="o">.</span><span class="n">subscribe</span><span class="p" data-group-id="9310135735-9">(</span><span class="s">&quot;hello.world&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pid</span><span class="p" data-group-id="9310135735-9">)</span></code></pre><p><strong>Expected output</strong>:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="4485427954-1">[</span><span class="ss">info</span><span class="p" data-group-id="4485427954-1">]</span><span class="w"> </span><span class="n">Subscribed</span><span class="w"> </span><span class="ss">to</span><span class="w"> </span><span class="ss">org</span><span class="p">.</span><span class="ss">example</span><span class="p">.</span><span class="ss">mesh</span><span class="p">.</span><span class="ss">hello</span><span class="p">.</span><span class="ss">world</span><span class="w">
</span><span class="ss">ok</span></code></pre><h3 id="publish-a-message-on-node-1" class="section-heading"><a href="#publish-a-message-on-node-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Publish a Message (on Node 1)</span></h3><p>In Node 1's console:</p><pre><code class="makeup erlang" translate="no"><span class="c1">% Erlang</span><span class="w">
</span><span class="nc">macula_pubsub</span><span class="p">:</span><span class="nf">publish</span><span class="p" data-group-id="0318320262-1">(</span><span class="p" data-group-id="0318320262-2">&lt;&lt;</span><span class="s">&quot;hello.world&quot;</span><span class="p" data-group-id="0318320262-2">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0318320262-3">#{</span><span class="w">
  </span><span class="ss">message</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="0318320262-4">&lt;&lt;</span><span class="s">&quot;Hello from Node 1!&quot;</span><span class="p" data-group-id="0318320262-4">&gt;&gt;</span><span class="p">,</span><span class="w">
  </span><span class="ss">timestamp</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">system_time</span><span class="p" data-group-id="0318320262-5">(</span><span class="ss">millisecond</span><span class="p" data-group-id="0318320262-5">)</span><span class="w">
</span><span class="p" data-group-id="0318320262-3">}</span><span class="p" data-group-id="0318320262-1">)</span><span class="p">.</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="c1"># Elixir</span><span class="w">
</span><span class="nc">Macula.PubSub</span><span class="o">.</span><span class="n">publish</span><span class="p" data-group-id="7035785637-1">(</span><span class="s">&quot;hello.world&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7035785637-2">%{</span><span class="w">
  </span><span class="ss">message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Hello from Node 1!&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">timestamp</span><span class="p">:</span><span class="w"> </span><span class="nc">System</span><span class="o">.</span><span class="n">system_time</span><span class="p" data-group-id="7035785637-3">(</span><span class="ss">:millisecond</span><span class="p" data-group-id="7035785637-3">)</span><span class="w">
</span><span class="p" data-group-id="7035785637-2">}</span><span class="p" data-group-id="7035785637-1">)</span></code></pre><p><strong>Expected output on Node 1</strong>:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="2534971076-1">[</span><span class="ss">info</span><span class="p" data-group-id="2534971076-1">]</span><span class="w"> </span><span class="n">Published</span><span class="w"> </span><span class="ss">to</span><span class="w"> </span><span class="ss">org</span><span class="p">.</span><span class="ss">example</span><span class="p">.</span><span class="ss">mesh</span><span class="p">.</span><span class="ss">hello</span><span class="p">.</span><span class="ss">world</span><span class="w">
</span><span class="ss">ok</span></code></pre><p><strong>Expected output on Node 3</strong> (subscriber):</p><pre><code class="makeup erlang" translate="no"><span class="n">Received</span><span class="w"> </span><span class="ss">on</span><span class="w"> </span><span class="ss">org</span><span class="p">.</span><span class="ss">example</span><span class="p">.</span><span class="ss">mesh</span><span class="p">.</span><span class="ss">hello</span><span class="p">.</span><span class="nc">world</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0987419210-1">#{</span><span class="w">
  </span><span class="ss">message</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="0987419210-2">&lt;&lt;</span><span class="s">&quot;Hello from Node 1!&quot;</span><span class="p" data-group-id="0987419210-2">&gt;&gt;</span><span class="p">,</span><span class="w">
  </span><span class="ss">timestamp</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1704723456789</span><span class="p">,</span><span class="w">
  </span><span class="ss">publisher</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="0987419210-3">&lt;&lt;</span><span class="s">&quot;a3f5b2e1...&quot;</span><span class="p" data-group-id="0987419210-3">&gt;&gt;</span><span class="w">
</span><span class="p" data-group-id="0987419210-1">}</span></code></pre><p><strong>Message flow</strong>: Node 1 â†’ QUIC/HTTP3 â†’ Node 3 (may route via Node 2 depending on topology)</p><hr class="thin"/><h2 id="step-7-make-your-first-rpc-call" class="section-heading"><a href="#step-7-make-your-first-rpc-call" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Step 7: Make Your First RPC Call</span></h2><h3 id="register-rpc-endpoint-on-node-2" class="section-heading"><a href="#register-rpc-endpoint-on-node-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Register RPC Endpoint (on Node 2)</span></h3><p>In Node 2's console:</p><pre><code class="makeup erlang" translate="no"><span class="c1">% Erlang</span><span class="w">
</span><span class="n">EchoHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="8196335036-1">(</span><span class="n">Args</span><span class="p" data-group-id="8196335036-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
  </span><span class="p" data-group-id="8196335036-2">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8196335036-3">#{</span><span class="ss">echo</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="n">Args</span><span class="p">,</span><span class="w"> </span><span class="nb">node</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">node</span><span class="p" data-group-id="8196335036-4">(</span><span class="p" data-group-id="8196335036-4">)</span><span class="p" data-group-id="8196335036-3">}</span><span class="p" data-group-id="8196335036-2">}</span><span class="w">
</span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="nc">macula_rpc</span><span class="p">:</span><span class="nf">register</span><span class="p" data-group-id="8196335036-5">(</span><span class="p" data-group-id="8196335036-6">&lt;&lt;</span><span class="s">&quot;echo_service&quot;</span><span class="p" data-group-id="8196335036-6">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">EchoHandler</span><span class="p" data-group-id="8196335036-5">)</span><span class="p">.</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="c1"># Elixir</span><span class="w">
</span><span class="n">echo_handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="3115938334-1">fn</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="p" data-group-id="3115938334-2">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3115938334-3">%{</span><span class="ss">echo</span><span class="p">:</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="ss">node</span><span class="p">:</span><span class="w"> </span><span class="nc">Node</span><span class="o">.</span><span class="n">self</span><span class="p" data-group-id="3115938334-4">(</span><span class="p" data-group-id="3115938334-4">)</span><span class="p" data-group-id="3115938334-3">}</span><span class="p" data-group-id="3115938334-2">}</span><span class="w">
</span><span class="k" data-group-id="3115938334-1">end</span><span class="w">

</span><span class="nc">Macula.RPC</span><span class="o">.</span><span class="n">register</span><span class="p" data-group-id="3115938334-5">(</span><span class="s">&quot;echo_service&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">echo_handler</span><span class="p" data-group-id="3115938334-5">)</span></code></pre><p><strong>Expected output</strong>:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="5007892459-1">[</span><span class="ss">info</span><span class="p" data-group-id="5007892459-1">]</span><span class="w"> </span><span class="n">Registered</span><span class="w"> </span><span class="n">RPC</span><span class="w"> </span><span class="nc">endpoint</span><span class="p">:</span><span class="w"> </span><span class="ss">org</span><span class="p">.</span><span class="ss">example</span><span class="p">.</span><span class="ss">mesh</span><span class="p">.</span><span class="ss">echo_service</span><span class="w">
</span><span class="ss">ok</span></code></pre><h3 id="call-rpc-from-node-1" class="section-heading"><a href="#call-rpc-from-node-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Call RPC (from Node 1)</span></h3><p>In Node 1's console:</p><pre><code class="makeup erlang" translate="no"><span class="c1">% Erlang</span><span class="w">
</span><span class="nc">macula_rpc</span><span class="p">:</span><span class="nf">call</span><span class="p" data-group-id="2684758646-1">(</span><span class="p" data-group-id="2684758646-2">&lt;&lt;</span><span class="s">&quot;echo_service&quot;</span><span class="p" data-group-id="2684758646-2">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2684758646-3">#{</span><span class="w">
  </span><span class="ss">test</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="2684758646-4">&lt;&lt;</span><span class="s">&quot;Hello RPC!&quot;</span><span class="p" data-group-id="2684758646-4">&gt;&gt;</span><span class="p">,</span><span class="w">
  </span><span class="ss">value</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">42</span><span class="w">
</span><span class="p" data-group-id="2684758646-3">}</span><span class="p">,</span><span class="w"> </span><span class="mi">5000</span><span class="p" data-group-id="2684758646-1">)</span><span class="p">.</span><span class="w">  </span><span class="c1">% 5 second timeout</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="c1"># Elixir</span><span class="w">
</span><span class="nc">Macula.RPC</span><span class="o">.</span><span class="n">call</span><span class="p" data-group-id="2899750611-1">(</span><span class="s">&quot;echo_service&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2899750611-2">%{</span><span class="w">
  </span><span class="ss">test</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Hello RPC!&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">value</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="w">
</span><span class="p" data-group-id="2899750611-2">}</span><span class="p">,</span><span class="w"> </span><span class="mi">5000</span><span class="p" data-group-id="2899750611-1">)</span></code></pre><p><strong>Expected output on Node 1</strong>:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="3912518326-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3912518326-2">#{</span><span class="w">
  </span><span class="ss">echo</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="3912518326-3">#{</span><span class="ss">test</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="3912518326-4">&lt;&lt;</span><span class="s">&quot;Hello RPC!&quot;</span><span class="p" data-group-id="3912518326-4">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="ss">value</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">42</span><span class="p" data-group-id="3912518326-3">}</span><span class="p">,</span><span class="w">
  </span><span class="nb">node</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">&#39;node2@127.0.0.1&#39;</span><span class="w">
</span><span class="p" data-group-id="3912518326-2">}</span><span class="p" data-group-id="3912518326-1">}</span></code></pre><p><strong>Expected output on Node 2</strong> (handler):</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="4847067686-1">[</span><span class="ss">info</span><span class="p" data-group-id="4847067686-1">]</span><span class="w"> </span><span class="n">RPC</span><span class="w"> </span><span class="ss">call</span><span class="w"> </span><span class="nc">received</span><span class="p">:</span><span class="w"> </span><span class="ss">echo_service</span><span class="w">
</span><span class="p" data-group-id="4847067686-2">[</span><span class="ss">info</span><span class="p" data-group-id="4847067686-2">]</span><span class="w"> </span><span class="n">Args</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4847067686-3">#{</span><span class="ss">test</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="4847067686-4">&lt;&lt;</span><span class="s">&quot;Hello RPC!&quot;</span><span class="p" data-group-id="4847067686-4">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="ss">value</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">42</span><span class="p" data-group-id="4847067686-3">}</span></code></pre><p><strong>RPC flow</strong>: Node 1 â†’ finds registration via DHT â†’ routes to Node 2 â†’ executes handler â†’ returns result</p><hr class="thin"/><h2 id="step-8-test-fault-tolerance" class="section-heading"><a href="#step-8-test-fault-tolerance" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Step 8: Test Fault Tolerance</span></h2><h3 id="stop-node-2" class="section-heading"><a href="#stop-node-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Stop Node 2</span></h3><p>In Node 2's terminal, press <code class="inline">Ctrl+C</code> twice to stop the node.</p><p><strong>Expected output on Node 1 and Node 3</strong>:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="8099987269-1">[</span><span class="ss">warning</span><span class="p" data-group-id="8099987269-1">]</span><span class="w"> </span><span class="n">Connection</span><span class="w"> </span><span class="ss">lost</span><span class="w"> </span><span class="ss">to</span><span class="w"> </span><span class="nf">node2</span><span class="w"> </span><span class="p" data-group-id="8099987269-2">(</span><span class="ss">b7c3d8e2</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="8099987269-2">)</span><span class="w">
</span><span class="p" data-group-id="8099987269-3">[</span><span class="ss">info</span><span class="p" data-group-id="8099987269-3">]</span><span class="w"> </span><span class="n">SWIM</span><span class="w"> </span><span class="ss">detected</span><span class="w"> </span><span class="nc">failure</span><span class="p">:</span><span class="w"> </span><span class="ss">node2</span><span class="w">
</span><span class="p" data-group-id="8099987269-4">[</span><span class="ss">info</span><span class="p" data-group-id="8099987269-4">]</span><span class="w"> </span><span class="n">SWIM</span><span class="w"> </span><span class="nc">membership</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nb">nodes</span><span class="w"> </span><span class="ss">alive</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="ss">suspect</span><span class="w">
</span><span class="p" data-group-id="8099987269-5">[</span><span class="ss">info</span><span class="p" data-group-id="8099987269-5">]</span><span class="w"> </span><span class="n">Topology</span><span class="w"> </span><span class="ss">reconfiguring</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="8099987269-6">[</span><span class="ss">info</span><span class="p" data-group-id="8099987269-6">]</span><span class="w"> </span><span class="n">New</span><span class="w"> </span><span class="ss">connection</span><span class="w"> </span><span class="nc">established</span><span class="p">:</span><span class="w"> </span><span class="ss">node1</span><span class="w"> </span><span class="err">â†</span><span class="err">â†’</span><span class="w"> </span><span class="ss">node3</span><span class="w">
</span><span class="p" data-group-id="8099987269-7">[</span><span class="ss">info</span><span class="p" data-group-id="8099987269-7">]</span><span class="w"> </span><span class="n">SWIM</span><span class="w"> </span><span class="nc">membership</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nb">nodes</span><span class="w"> </span><span class="ss">alive</span></code></pre><h3 id="verify-mesh-adapted" class="section-heading"><a href="#verify-mesh-adapted" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Verify Mesh Adapted</span></h3><p>On Node 1 or Node 3:</p><pre><code class="makeup erlang" translate="no"><span class="c1">% Erlang</span><span class="w">
</span><span class="nc">macula_topology</span><span class="p">:</span><span class="nf">get_connections</span><span class="p" data-group-id="6312323239-1">(</span><span class="p" data-group-id="6312323239-1">)</span><span class="p">.</span><span class="w">

</span><span class="c1">% Expected output (now only 1 connection):</span><span class="w">
</span><span class="p" data-group-id="6312323239-2">[</span><span class="w">
  </span><span class="p" data-group-id="6312323239-3">#{</span><span class="ss">peer_id</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6312323239-4">&lt;&lt;</span><span class="s">&quot;c8d4e9f3...&quot;</span><span class="p" data-group-id="6312323239-4">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="ss">state</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">rtt_ms</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mf">1.1</span><span class="p" data-group-id="6312323239-3">}</span><span class="w">
</span><span class="p" data-group-id="6312323239-2">]</span></code></pre><p>The mesh <strong>automatically adapts</strong> - Node 1 and Node 3 now connect directly.</p><h3 id="restart-node-2" class="section-heading"><a href="#restart-node-2" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Restart Node 2</span></h3><p>Restart Node 2 (using the same command from Step 3).</p><p><strong>Expected output</strong>:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="9000962813-1">[</span><span class="ss">info</span><span class="p" data-group-id="9000962813-1">]</span><span class="w"> </span><span class="n">Macula</span><span class="w"> </span><span class="nb">node</span><span class="w"> </span><span class="nc">started</span><span class="p">:</span><span class="w"> </span><span class="ss">node2</span><span class="w">
</span><span class="p" data-group-id="9000962813-2">[</span><span class="ss">info</span><span class="p" data-group-id="9000962813-2">]</span><span class="w"> </span><span class="n">Reconnecting</span><span class="w"> </span><span class="ss">to</span><span class="w"> </span><span class="ss">mesh</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="9000962813-3">[</span><span class="ss">info</span><span class="p" data-group-id="9000962813-3">]</span><span class="w"> </span><span class="n">SWIM</span><span class="w"> </span><span class="nc">membership</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="nb">nodes</span><span class="w"> </span><span class="ss">alive</span><span class="w">
</span><span class="p" data-group-id="9000962813-4">[</span><span class="ss">info</span><span class="p" data-group-id="9000962813-4">]</span><span class="w"> </span><span class="n">Topology</span><span class="w"> </span><span class="ss">restored</span></code></pre><p>The mesh <strong>self-heals</strong> automatically.</p><hr class="thin"/><h2 id="common-operations" class="section-heading"><a href="#common-operations" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Common Operations</span></h2><h3 id="list-all-nodes-in-mesh" class="section-heading"><a href="#list-all-nodes-in-mesh" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">List All Nodes in Mesh</span></h3><pre><code class="makeup erlang" translate="no"><span class="c1">% Erlang</span><span class="w">
</span><span class="nc">macula_membership</span><span class="p">:</span><span class="nf">list_nodes</span><span class="p" data-group-id="0908770738-1">(</span><span class="p" data-group-id="0908770738-1">)</span><span class="p">.</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="c1"># Elixir</span><span class="w">
</span><span class="nc">Macula.Membership</span><span class="o">.</span><span class="n">list_nodes</span><span class="p" data-group-id="7397983138-1">(</span><span class="p" data-group-id="7397983138-1">)</span></code></pre><h3 id="get-node-statistics" class="section-heading"><a href="#get-node-statistics" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Get Node Statistics</span></h3><pre><code class="makeup erlang" translate="no"><span class="c1">% Erlang</span><span class="w">
</span><span class="nc">macula</span><span class="p">:</span><span class="nf">stats</span><span class="p" data-group-id="8041374323-1">(</span><span class="p" data-group-id="8041374323-1">)</span><span class="p">.</span><span class="w">

</span><span class="c1">% Output:</span><span class="w">
</span><span class="p" data-group-id="8041374323-2">#{</span><span class="w">
  </span><span class="ss">messages_sent</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1543</span><span class="p">,</span><span class="w">
  </span><span class="ss">messages_received</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1687</span><span class="p">,</span><span class="w">
  </span><span class="ss">bytes_sent</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">245678</span><span class="p">,</span><span class="w">
  </span><span class="ss">bytes_received</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">267890</span><span class="p">,</span><span class="w">
  </span><span class="ss">active_connections</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
  </span><span class="ss">routing_table_size</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
  </span><span class="ss">uptime_seconds</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">3600</span><span class="w">
</span><span class="p" data-group-id="8041374323-2">}</span></code></pre><h3 id="subscribe-with-pattern-matching" class="section-heading"><a href="#subscribe-with-pattern-matching" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Subscribe with Pattern Matching</span></h3><pre><code class="makeup erlang" translate="no"><span class="c1">% Erlang - Subscribe to all topics starting with &quot;sensor.&quot;</span><span class="w">
</span><span class="nc">macula_pubsub</span><span class="p">:</span><span class="nf">subscribe</span><span class="p" data-group-id="3978321711-1">(</span><span class="p" data-group-id="3978321711-2">&lt;&lt;</span><span class="s">&quot;sensor.*&quot;</span><span class="p" data-group-id="3978321711-2">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3978321711-3">#{</span><span class="ss">match</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">prefix</span><span class="p" data-group-id="3978321711-3">}</span><span class="p" data-group-id="3978321711-1">)</span><span class="p">.</span><span class="w">

</span><span class="c1">% Matches: sensor.temperature, sensor.humidity, etc.</span></code></pre><h3 id="publish-with-options" class="section-heading"><a href="#publish-with-options" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Publish with Options</span></h3><pre><code class="makeup erlang" translate="no"><span class="c1">% Erlang - Publish with acknowledgment</span><span class="w">
</span><span class="nc">macula_pubsub</span><span class="p">:</span><span class="nf">publish</span><span class="p" data-group-id="7723819776-1">(</span><span class="p" data-group-id="7723819776-2">&lt;&lt;</span><span class="s">&quot;important.event&quot;</span><span class="p" data-group-id="7723819776-2">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7723819776-3">#{</span><span class="w">
  </span><span class="ss">acknowledge</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">true</span><span class="p">,</span><span class="w">  </span><span class="c1">% Wait for delivery confirmation</span><span class="w">
  </span><span class="ss">retain</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">true</span><span class="w">        </span><span class="c1">% Store for late subscribers</span><span class="w">
</span><span class="p" data-group-id="7723819776-3">}</span><span class="p" data-group-id="7723819776-1">)</span><span class="p">.</span></code></pre><hr class="thin"/><h2 id="troubleshooting" class="section-heading"><a href="#troubleshooting" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Troubleshooting</span></h2><h3 id="problem-port-already-in-use" class="section-heading"><a href="#problem-port-already-in-use" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Problem: &quot;Port already in use&quot;</span></h3><p><strong>Error</strong>:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="2287474349-1">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="ss">eaddrinuse</span><span class="p" data-group-id="2287474349-1">}</span></code></pre><p><strong>Solution</strong>: Change the <code class="inline">listen_port</code> in your config file to an unused port (e.g., 4436, 4437).</p><hr class="thin"/><h3 id="problem-nodes-can-t-discover-each-other" class="section-heading"><a href="#problem-nodes-can-t-discover-each-other" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Problem: Nodes can't discover each other</span></h3><p><strong>Symptoms</strong>: Node 2 or 3 logs show &quot;Connection timeout&quot; or &quot;No route to bootstrap node&quot;</p><p><strong>Checks</strong>:</p><ol><li><p><strong>Firewall</strong>: Ensure UDP port 4433-4435 are not blocked</p><pre><code class="makeup bash" translate="no"><span class=""># Ubuntu/Debian
</span><span class="">sudo ufw allow 4433:4435/udp
</span><span class="">
</span><span class=""># macOS
</span><span class=""># Check System Preferences â†’ Security &amp; Privacy â†’ Firewall
</span></code></pre></li><li><p><strong>Correct IP address</strong>: If running on different machines, replace <code class="inline">127.0.0.1</code> with actual IP</p><pre><code class="makeup bash" translate="no"><span class=""># Find your IP
</span><span class="">ip addr show  # Linux
</span><span class="">ifconfig      # macOS
</span></code></pre></li><li><p><strong>Same realm</strong>: All nodes must have the same <code class="inline">realm</code> in config</p></li></ol><hr class="thin"/><h3 id="problem-certificate-validation-failed" class="section-heading"><a href="#problem-certificate-validation-failed" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Problem: &quot;Certificate validation failed&quot;</span></h3><p><strong>Error</strong>:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="8401803408-1">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8401803408-2">{</span><span class="ss">tls_alert</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;certificate unknown&quot;</span><span class="p" data-group-id="8401803408-2">}</span><span class="p" data-group-id="8401803408-1">}</span></code></pre><p><strong>Cause</strong>: Certificate mismatch (usually in manual cert mode)</p><p><strong>Solution</strong>: Use <code class="inline">{cert_mode, auto_generate}</code> for development, or ensure all nodes trust the same CA.</p><hr class="thin"/><h3 id="problem-high-latency-or-packet-loss" class="section-heading"><a href="#problem-high-latency-or-packet-loss" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Problem: High latency or packet loss</span></h3><p><strong>Check network conditions</strong>:</p><pre><code class="makeup erlang" translate="no"><span class="c1">% Erlang</span><span class="w">
</span><span class="nc">macula_connection</span><span class="p">:</span><span class="nf">ping</span><span class="p" data-group-id="1311342488-1">(</span><span class="p" data-group-id="1311342488-2">&lt;&lt;</span><span class="s">&quot;node2_id&quot;</span><span class="p" data-group-id="1311342488-2">&gt;&gt;</span><span class="p" data-group-id="1311342488-1">)</span><span class="p">.</span><span class="w">

</span><span class="c1">% Output:</span><span class="w">
</span><span class="p" data-group-id="1311342488-3">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="mf">1.2</span><span class="p" data-group-id="1311342488-3">}</span><span class="w">  </span><span class="c1">% RTT in milliseconds</span></code></pre><p>If RTT &gt; 100ms on localhost, check:</p><ul><li>System load (CPU usage)</li><li>Other applications using network</li><li>Docker/VM networking overhead</li></ul><hr class="thin"/><h2 id="next-steps" class="section-heading"><a href="#next-steps" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Next Steps</span></h2><p>Congratulations! You've successfully:</p><ul><li>âœ… Built Macula from source</li><li>âœ… Started a 3-node mesh network</li><li>âœ… Verified mesh topology</li><li>âœ… Sent pub/sub messages across the mesh</li><li>âœ… Made RPC calls between nodes</li><li>âœ… Tested fault tolerance and self-healing</li></ul><h3 id="learn-more" class="section-heading"><a href="#learn-more" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Learn More</span></h3><ul><li><strong><a href="macula_http3_mesh_hello_world.html">Hello World Tutorial</a></strong> - Build a complete application</li><li><strong><a href="macula_http3_mesh_api_reference.md">API Reference</a></strong> - Complete API documentation</li><li><strong><a href="macula_http3_mesh_deployment_patterns.md">Deployment Patterns</a></strong> - Production deployments</li><li><strong><a href="macula_http3_mesh_performance.md">Performance Tuning</a></strong> - Optimize for your use case</li></ul><h3 id="try-more-advanced-features" class="section-heading"><a href="#try-more-advanced-features" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Try More Advanced Features</span></h3><ol><li><strong>Realm isolation</strong>: Start nodes in different realms and use gateways</li><li><strong>NAT traversal</strong>: Run nodes on different networks (home, cloud, mobile)</li><li><strong>Large mesh</strong>: Scale to 10+ nodes and observe routing behavior</li><li><strong>Persistence</strong>: Add event sourcing with persistent subscriptions</li><li><strong>Monitoring</strong>: Set up Prometheus metrics and Grafana dashboards</li></ol><h3 id="join-the-community" class="section-heading"><a href="#join-the-community" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Join the Community</span></h3><ul><li><strong>GitHub</strong>: <a href="https://github.com/macula-io/macula">https://github.com/macula-io/macula</a></li><li><strong>Discord</strong>: <a href="https://discord.gg/macula">https://discord.gg/macula</a></li><li><strong>Docs</strong>: <a href="https://docs.macula.io">https://docs.macula.io</a></li></ul><hr class="thin"/><p><strong>Happy meshing!</strong> ðŸŽ‰</p>

</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="macula_http3_mesh_root.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          â† Previous Page
        </span>
        <span class="title">
Architecture
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="macula_http3_mesh_hello_world.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page â†’
        </span>
        <span class="title">
Hello World
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/macula/0.6.5" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/macula/0.6.5">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/macula/0.6.5/show/architecture/macula_http3_mesh_quick_start.md">current file</a>)

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="macula.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.2) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
